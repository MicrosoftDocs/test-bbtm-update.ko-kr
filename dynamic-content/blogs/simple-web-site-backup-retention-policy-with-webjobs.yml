### YamlMime:Yaml
ms.openlocfilehash: cde2b3d77eb5380dad5fc00ba4b8ef1740a1397c
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139900666"
Slug: simple-web-site-backup-retention-policy-with-webjobs
Title: WebJobs를 사용하는 간단한 웹 사이트 백업 보존 정책
Summary: Azure는 WebJobs를 사용하여 웹 사이트 컨텍스트에서 코드를 실행하는 기능을 제공합니다. Azure에 액세스하는 동안 웹 사이트에 대한 애플리케이션 시나리오 솔루션 측면에서 다양한 기능을 제공합니다.
Content: >-
  Azure는 <a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-create-web-jobs/" target="_blank">WebJobs</a>를 사용하여 웹 사이트 컨텍스트에서 코드를 실행하는 기능을 제공합니다. Azure 리소스에 액세스하는 동시에 웹 사이트에 대한 애플리케이션 시나리오 솔루션과 이를 해결할 수 있는 다양한 방법을 제공합니다. <a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-backup/" target="_blank">웹 사이트 백업 기능은</a> 일정에 따라 실행되며 Azure Storage를 활용하므로 특히 흥미로운 예입니다. 이 게시물에서는 이전 웹 사이트 백업 파일을 정기적으로 정리하는 간단한 WebJob을 빌드하는 방법에 대한 세부 정보를 다룹니다. <em> </em>

  <h4>백업 파일 레이아웃</h4>

  컨텍스트를 설정하려면 이 솔루션 이해와 관련된 백업 기능에 대한 몇 가지 세부 정보를 살펴보겠습니다. 디자인의 가장 좋은 측면 중 하나는 백업 콘텐츠가 고객에게 얼마나 액세스 가능하고 관리 가능한지입니다. 백업이 성공적으로 실행될 때마다 지정된 스토리지 계정에 백업 내용을 설명하는 XML 파일과 백업된 실제 파일이 있는 ZIP 파일 등 두 개의 파일이 저장됩니다. 파일의 명명 규칙은 <em>website_name&gt;_&lt;timestamp&gt;입니다&lt;.&lt; 확장.&gt; </em> 예를 들어:


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/2630.2014_2D00_04_2D00_01_5F00_17h23_5F00_00.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/2630.2014_2D00_04_2D00_01_5F00_17h23_5F00_00.png" border="0"></a>


  대부분의 고객은 하루에 한 번과 같이 일정에 따라 실행되도록 백업 작업을 설정합니다. 이렇게 하면 백업 스토리지 계정에 시간이 지남에 따라 누적되는 매일 2개 파일이 만들어집니다. 이 기능은 미리 보기 모드에 있지만 보존 정책은 아직 기본 제공되지 않았지만 이 정리를 수행하도록 사이트를 구성할 수 있습니다.

  <h4>솔루션 개요</h4>

  이전 백업을 정리하는 간단한 방법 중 하나는 백업 파일 보존 정책을 적용하는 예약된 WebJob을 실행하는 것입니다. WebJobs에 익숙해지려면 Azure 웹 사이트에서 <a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-create-web-jobs/">이 문서를</a> 확인하세요. 이를 위해 WebJobs를 사용하려면 간단한 애플리케이션을 만들고 매일 실행하도록 WebJob을 구성해야 합니다. 애플리케이션은 백업 폴더의 모든 파일을 살펴보고, 파일을 만든 시기를 확인하고, 정의된 정책보다 오래된 경우 삭제합니다.

  <h4>샘플 코드</h4>

  애플리케이션은 다양한 방법으로 작성 및 배포할 수 있습니다. 아래 예제는 C#으로 작성되어 콘솔 앱(.exe)으로 배포되지만 다른 언어로 쉽게 수행할 수 있습니다. <strong>참고: </strong>이 코드를 직접 사용하려면 WebJob으로 빌드 및 배포하는 데 사용할 수 있는 전체 버전을 다운로드하는 방법에 대한 다음 섹션의 지침을 따르세요.


  코드의 첫 번째 부분에서는 백업 스토리지 계정, 백업 폴더 위치, 유지할 최대 기간(일) 및 웹 사이트 이름에 대한 구성을 수집합니다. 구성 값(아래 대문자 문자열)은 웹 사이트의 애플리케이션 설정에서 가져옵니다. 이 게시물의 뒷부분에서 해당 설정에 대한 값을 설정하는 방법을 알아봅니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/0412.code-1.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/0412.code-1.png" border="0"></a>


  설정을 적용하면 코드의 두 번째 부분이 백업 파일이 있는 Blob Storage에 연결됩니다. 그런 다음 현재 시간에서 max-age 정책까지의 날짜 및 시간 오프셋을 계산합니다. 다음으로 <em>foreach</em> 루프를 사용하여 폴더의 각 파일과 <strong>zip</strong> 또는 <strong>xml</strong> 확장명이 있고 백업 프로세스 규칙에 따라 이름이 지정된 파일에 대해 이동합니다. 그런 다음, 프로그램에서 각 파일 사용 기간을 계산합니다. 해당 기간이 정의된 최대 기간보다 오래된 경우 코드는 파일을 삭제합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/3644.code-2.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/3644.code-2.png" border="0"></a>

  <h4>이진 파일 빌드 및 패키징(.exe)</h4>

  cmd 줄 실행 파일(.exe)을 빌드하는 데 익숙하지 않은 경우 <a href="https://msdn.microsoft.com/en-us/library/dd831853.aspx" target="_blank">Visual Studio 2013</a> 및 <a href="https://azure.microsoft.com/en-us/downloads/" target="_blank">Azure SDK</a>를 사용하여 실행 파일을 빌드하는 몇 가지 단계는 다음과 같습니다(둘 다 미리 설치해야 합니다).

  <ol>
   <li>새 콘솔 앱 만들기 -&gt; 템플릿 Visual C# -&gt; 콘솔 애플리케이션 –&gt; 이름을 지정합니다(예: "WebJobProject").</li>
   <li>Program.cs의 콘텐츠를 <a href="https://gist.github.com/eduardolaureano/9822461#file-backupretentionpolicyWebJob" target="_blank">여기에서 사용할 수</a> 있는 위의 코드의 전체 버전으로 바꿉니다.
  <ol>
   <li>라이브러리(문 <em>사용 </em>), 로깅 진행률 + 오류를 표준 출력, 네임스페이스/클래스 정의 및 추가 코드 주석에 대한 참조가 있습니다.</li>
  </ol>

  </li>
   <li>참조 추가(솔루션 탐색기 대화 상자에서 -&gt; 마우스 오른쪽 단추로 참조 클릭 –&gt; 참조 추가)
  <ol>
   <li>Framework –&gt; System.Configuration</li>
   <li>확장 –&gt; Microsoft.WindowsAzure.Storage</li>
  </ol>

  </li>
   <li>솔루션 빌드(Ctrl+Shift+B)</li>
   <li>프로젝트 "디버그"의 내용을 압축하고 이름을 지정합니다(예: "WebJobProject.zip").
  <ol>
   <li>디버그 폴더로 이동하려면 솔루션 탐색기로 이동하여 모든 파일 표시 아이콘&gt;을&gt; 클릭하고 "bin" 폴더를 확장하여 "디버그" 폴더&gt;를 표시합니다. 파일 탐색기에서 폴더 열기를 마우스 오른쪽 단추로 클릭합니다.</li>
   <li>Windows 8 컴퓨터의 콘텐츠를 압축하려면: 모든 콘텐츠 선택 –&gt; 보내기를 마우스 오른쪽 단추로 클릭 –&gt; "압축(압축) 폴더"</li>
  </ol>

  </li>

  </ol>

  <div>

  <h4>WebJob 설정</h4>

  WebJob 설정은 다음과 같습니다. 이후 섹션에서는 WebJob 콘텐츠 zip 파일을 만드는 방법을 알아보세요.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/8244.2014_2D00_04_2D00_01_5F00_17h41_5F00_01.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/8244.2014_2D00_04_2D00_01_5F00_17h41_5F00_01.png" border="0"></a>


  다음은 일정 세부 정보입니다. 백업 기능이 매일 실행되므로 WebJob 일정도 동일한 방식으로 설정됩니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/5226.2014_2D00_04_2D00_01_5F00_17h44_5F00_46.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/5226.2014_2D00_04_2D00_01_5F00_17h44_5F00_46.png" border="0"></a>

  <h4>애플리케이션 매개 변수 설정</h4>

  이 WebJob은 설정해야 하는 특정 웹 사이트 앱 설정을 찾습니다. 설정하려면 Azure Portal의 사이트로 이동하여 "구성" 탭을 선택하고 아래로 스크롤하여 "앱 설정"으로 스크롤해야 합니다. 다음은 며칠 동안 백업 파일 보존 정책을 정의하고 백업 프로세스에 사용되는 스토리지 계정(그림에 숨겨진 실제 정보)을 나타내는 위치입니다. "WEBSITE_SITE_NAME" 설정은 이미 모든 웹 사이트에 대해 제공되며 추가할 필요가 없습니다. 모든 애플리케이션 설정을 보려면 website_name.scm.azurewebsites.net&gt; 이동하여 &lt;"환경"을 클릭합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/1754.BackupRetentionWebjob_2D00_AppSettingsMasked.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/1754.BackupRetentionWebjob_2D00_AppSettingsMasked.png" border="0"></a>

  <h4>결과</h4>

  설정 및 성공적인 실행 후 모든 것이 어떻게 보이는지 알아보는 방법은 다음과 같습니다.


  WebJobs 대시보드 게시 성공 실행


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/1884.2014_2D00_04_2D00_01_5F00_17h49_5F00_28.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/1884.2014_2D00_04_2D00_01_5F00_17h49_5F00_28.png" border="0"></a>

  <h4>WebJob의 로그 파일</h4>

  WebJobs 대시보드의 로그 링크 다음에는 이전 실행 결과가 모두 포함된 웹 페이지가 표시됩니다. 로그는 WebJob 실행의 오류를 이해하거나 예상대로 수행된 작업을 확인하는 데 매우 유용합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/4520.2014_2D00_04_2D00_01_5F00_17h58_5F00_51.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/4520.2014_2D00_04_2D00_01_5F00_17h58_5F00_51.png" border="0"></a>


  특정 실행 결과를 클릭하면 WebJobs의 텍스트 출력을 볼 수 있습니다. 이 예제에서는 WebJob 인프라("SYS INFO")의 로그 항목과 이 WebJob에서 출력한 항목("INFO")이 표시됩니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/6403.2014_2D00_04_2D00_01_5F00_18h00_5F00_09.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/361/6403.2014_2D00_04_2D00_01_5F00_18h00_5F00_09.png" border="0"></a>

  <h4>보존 정책 확장 아이디어</h4>

  콘텐츠 크기, 로그 주기(최신 백업 및 더 적은 수의 이전 백업 유지)에 따라 보다 정교한 보존 정책으로 쉽게 변경하거나 zip 콘텐츠 차이를 비교하여 삭제할 백업을 선택할 수도 있습니다. 여기에 게시된 대로 WebJob을 코딩하고 배포하는 다른 여러 방법도 있습니다. 개선에 대한 아이디어뿐만 아니라 가지고 있을 수 있는 피드백을 공유하세요.


  </div>
