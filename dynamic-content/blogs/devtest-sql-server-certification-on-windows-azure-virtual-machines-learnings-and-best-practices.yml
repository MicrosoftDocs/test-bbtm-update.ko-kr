### YamlMime:Yaml
ms.openlocfilehash: f13122d77789107272902aef58e90def883bbafa
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139903326"
Slug: devtest-sql-server-certification-on-windows-azure-virtual-machines-learnings-and-best-practices
Title: Azure Virtual Machines Windows 개발/테스트 SQL Server 인증 - 학습 및 모범 사례
Summary: '편집자 주: 이 게시물은Arvind Ranasaria와&nbsp;Khalid Mouss에 의해&nbsp; 작성되었습니다.  Windows Azure Virtual Machines 서비스에서 SQL Server 제품 인증의 일환으로 엔지니어링 팀을 SQL Server...'
Content: '<p class="Publishwithline"><strong>편집기 참고 사항: </strong> 이 게시물은Arvind 라나사리아와&nbsp;칼리드 무스에 의해&nbsp; 작성되었습니다.</p>  <p class="Publishwithline">Windows Azure Virtual Machines 서비스에서 SQL Server 제품을 인증하는 과정에서 SQL Server 엔지니어링 팀은 몇 주 동안 Windows Azure Virtual Machines에서 100&rsquo;개의 테스트 제품군을 실행합니다. 또한 랩 및 인프라 관리에 사용되는 주요 발권 애플리케이션 중 하나를 온-프레미스 서버에서 azure Virtual Machines를 Windows 마이그레이션하기 위한 병렬 작업이 실행되었습니다. 이러한 두 가지 노력은 이러한 노력 전반에 걸쳐 채택된 몇 가지 주요 학습 및 몇 가지 모범 사례를 강조했습니다. SQL Server Windows Azure Virtual Machines에서 실행되는 중요한 워크로드입니다. 이 블로그에서는 몇 가지 학습을 요약하고 작동하는 것으로 입증된 내용을 제공하려고 합니다.</p>  <p><strong>대규모 VM 프로비전/프로비전 해제</strong></p>  <p><strong></strong>Windows Azure Virtual Machines에서 SQL Server 인증하는 동안 랩은 전체 테스트 실행을 완료하기 위해 수십 개의 SQL 서버 및 Windows VM을 프로비전해야 하는 경우가 많습니다. 이 프로비전은 사용자 지정 도구&rsquo; 자동화를 통해 수행됩니다. 가장 일반적인 시나리오는 대부분의 경우 동일한 VM 이름을 사용하여 이러한 VM을 프로비전하고, 여러 테스트 및 워크로드를 실행하고, 완료되면 VM을 해체하고, 다음 실행을 위해 다시 만드는 것입니다. 이러한 많은 VM이 일괄 처리되고 Windows Azure에서 클라우드 서비스당 현재 50개의 VM으로 인해 별도의 클라우드 서비스에 배치됩니다.</p>  <p>여러 라운드 후에는 전체 성공률이 일반적으로 50%에서만 실행되도록 재시도 메커니즘을 추가했습니다. 특히 당시 VM이 10개 이상 일괄 처리되는 경우 그렇습니다. 또한 이러한 이벤트의 대부분은 단일 스토리지 계정으로 수행되는 것이 중요합니다. 시나리오에서 대규모로 프로비전 및 프로비저닝 해제되는 많은 VM을 요구하는 경우 다음을 권장합니다.</p>  <ol>  <li>오류 409를 시도하고 catch하고 재시도 메커니즘을 준비합니다.</li>  <li>여러 배포를 스토리지 계정에 분산(참고: 지원 티켓을 통해 늘릴 수 있는 구독당 스토리지 계정의 기본 한도는 10개임)</li>  <li>높은 실패율이 표시되면 프로비전/프로비전 해제를 위한 병렬 호출 수를 줄이십시오. 이렇게 하면 동일한 스토리지 계정으로 가는 여러 작업의 잠금 충돌을 줄일 수 있습니다. 또한 VM 일괄 처리를 10개 미만으로 줄이고 당시에는 5개의 VM을 사용하는 것이 좋습니다.</li>  </ol>  <p>이 영역에 대한 Windows Azure의 개선 사항이 계속 개선되고 있으며, 향후 몇 주 및 몇 달 동안 이 영역에서 추가 결과 및 권장 사항을 계속 지켜봐 주시기 바랍니다.</p>  <p><em>알려진 제한 사항: 클라우드 서비스당 한 번에 50개의 VM이 프로비전됩니다.</em></p>  <p><strong>Windows 업데이트 및 Microsoft 업데이트</strong></p>  <ul>  <li>SQL Server 갤러리 이미지에는 기본적으로 업데이트가 Windows 설정됩니다. 미리 설정된 기본값은 해당 지역의 매일 오전 3:00입니다.</li>  <li>SQL 자동으로 업데이트하려면 <a href="https://support.microsoft.com/kb/901037" target="_blank">여기에서</a> Microsoft 업데이트가 세부 정보도 켜져 &ndash; 있는지 확인합니다. Microsoft 업데이트는 향후 릴리스에서 기본적으로 켜질 수 있습니다.</li>  <li>일부 Windows 업데이트에는 재설정이 필요하므로 VM을 가용성 집합에 두고 각 복제본에서 다른 Windows 업데이트 시간을 갖는 것이 좋습니다.&nbsp;</li>  </ul>  <p><strong>SMK(서비스 마스터 키) 다시 생성</strong></p>  <p>모든 배포에 동일한 서비스 마스터 키를 사용하지 않도록 키 회전 정책을 갖습니다.</p>  <p><span style="text-decoration: underline;">권장 사항 1</span>: 실행: <em>ALTER SERVICE MASTER KEY REGENERATE; GO</em> 를 사용하여 새 키를 생성합니다.</p>  <p><span style="text-decoration: underline;">권장 사항2</span>: 리소스를 많이 사용하는 작업입니다. 는 수요가 적은 기간 동안 실행됩니다.</p>  <p>자세한 내용은 <a href="https://technet.microsoft.com/en-us/library/ms189060.aspx" target="_blank">여기</a>에 있습니다. 이렇게 하면 Azure에서 더 안전한 SQL Server 동일한 마스터 키가 다시 사용되지 않도록&rsquo; 할 수 있습니다.</p>  <p><strong>구독 및 리소스 관리</strong></p>  <p>여러 팀과 Azure 구독을 공유하고 조직 전체에서 많은 리소스를 관리할 것으로 예상하는 경우 구독을 열기 전에 일부 리소스 계획을 수행하고 조직에 대한 몇 가지 프로세스 지침을 제공하는 것이 좋습니다. 이렇게 하면 구독 사용량이 정상이고 사용되지 않는 리소스가 많지 않고 불필요한 용량에 대한 비용을 지불해야 할 때 많은 시간을 절약할 수 있습니다.</p>  <p>이 항목에 대한 자세한 내용 및 권장 사항은 이 링크를 참조하세요.</p>  <p><strong>VNet 구성 문제</strong></p>  <p><strong></strong>온-프레미스 티켓 애플리케이션을 Azure Virtual Machines 서비스에 Windows 리프트 앤 시프트하는 동안 VNet 구성과 관련하여 몇 가지 문제가 발생했습니다.</p>  <ol>  <li>웹 계층 머신과 SQL Server 계층 컴퓨터는 서로 다른 두 VNet에 있었습니다. 이러한 각 Vnet은 VPN 디바이스를 사용하여 온-프레미스 네트워크에 다시 연결되었으며 Azure Virtual Networking 기능을 Windows. 이는 온-프레미스 네트워크와의 통신을 위해 더 큰 대역폭을 허용하기 위해 수행되었습니다. 그러나 이로 인해 웹 계층 컴퓨터는 Azure 네트워크 내에서 VM과 VM 간 통신을 직접 수행하는 대신 온-프레미스 네트워크로 왕복을 수행하여 Sql 계층 머신에 연결하게 Windows.</li>  <li>Windows Azure Virtual Machine 환경의 발권 애플리케이션은 서버와 통신해야 했습니다(예: Server1, 온-프레미스). 온-프레미스 네트워크에 연결된 VNet을 구성하는 동안 Windows Azure 환경의 VNet에서 VM이 연결할 수 있는 온-프레미스 서브넷 목록을 지정해야 합니다. Server1 서버를 호스트하는 서브넷이 이 목록에서 누락되었으므로 애플리케이션이 완전히 작동하지 않았습니다. 해결을 위해서는 Vnet 및 Vnet에 배포된 모든 VM을 재구성해야 했습니다.</li>  </ol>  <p>위의 두 문제 모두 VM 및 VNet을 다시 배포해야 했습니다. 아쉽게도 VNet에 대한 변경은 현재 온라인 방식으로 수행할 수 없습니다. 따라서 VNet 레이아웃을 신중하게 계획하고 Windows Azure의 VM에서 연결할 수 있어야 하는 온-프레미스의 모든 서브넷이 VNet 구성에 포함되도록 하는 것이 좋습니다.</p>  <p><strong>COPY BLOB API를 사용하여 시스템 디스크 백업/복원</strong></p>  <p>SharePoint, 도메인 컨트롤러, 웹 프런트, 앱 서버 등을 사용하여 HA 환경에서 SQL Server 실행하는 데 필요한 여러 VM이 필요한 배포가 있는 경우 이러한 컴퓨터가 배포된 후 백업하는 것은 프로덕션 환경을 유지하는 데 중요합니다.</p>  <p><strong>VM 준비 단계</strong></p>  <p>VM이 새 호스트 머신에 처음 등장하면 로컬 VM 캐시가 빌드되는 데 다소 시간이 걸립니다. 이 단계에서는 VM에서 인식된 성능이 매우 낮을 수 있으며 VM이 완전히 실행될 때까지 UI 환경이 매우 느려집니다. 이를 완화하기 위한 권장 사항은 실행 중인 VM이 프로덕션에서 한 번 수행하는 일반적인 기능을 수행하여 VM을 예열하는 것입니다.</p>  <p><strong>일부 VPN 디바이스에서 패킷 다시 정렬 문제</strong></p>  <p>일부 VPN 디바이스에는 기본적으로 TCP 패킷 순서를 다시 정렬하는 보안 설정이 함께 제공됩니다. 온-프레미스 네트워크에 IPSec이 구성된 경우 이 설정으로 인해 문제가 발생할 수 있으며 TCP 패킷 다시 정렬이 필요하지 않으므로 해제해야 합니다.</p>  <p><strong> 참조</strong></p>  <p><a href="https://msdn.microsoft.com/en-us/library/jj823132.aspx" target="_blank">Microsoft Azure Virtual Machines의 SQL Server</a></p>  <p>&nbsp;</p>  <p>&nbsp;</p>  <p>&nbsp;</p>  <p>&nbsp;</p>'
