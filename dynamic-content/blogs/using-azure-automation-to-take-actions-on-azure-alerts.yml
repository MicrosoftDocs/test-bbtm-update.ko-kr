### YamlMime:Yaml
ms.openlocfilehash: 3190cc0bf866bbc33c8397e045d81343cff85806
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139906359"
Slug: using-azure-automation-to-take-actions-on-azure-alerts
Title: Azure Automation을 사용하여 Azure 경고에 대한 작업 수행
Summary: Azure Automation Runbook을 사용하여 Azure 경고에 대한 응답으로 작업을 시작하는 방법을 알아봅니다.
Content: "<p>이 블로그 게시물의 게시 이후 추가 정보가 공개되었습니다. 자세한 내용은 경고를 사용하여&nbsp; <a href=\"https://docs.microsoft.com/azure/automation/automation-create-alert-triggered-runbook\" target=\"_blank\">Azure Automation Runbook을 트리거</a>하세요.</p>\n\n<p>이 블로그 게시물에서는 Azure Automation Runbook을 사용하여 Azure 경고에 대한 응답으로 작업을 시작하는 방법에 대해 설명합니다.</p>\n\n<p>웹후크를 사용하면 사용자가 사후 처리 또는 사용자 지정 알림을 위해 Azure 경고 알림을 다른 시스템으로 라우팅할 수 있습니다. Azure 경고 알림에 대한 자세한 내용은 <a href=\"https://azure.microsoft.com/en-us/documentation/articles/insights-receive-alert-notifications/\">설명서를 참조하세요</a>.</p>\n\n<p>경고가 발생할 때(예: 자동화된 수정을 수행하기 위해 스크립트 호출) 이메일 알림을 받는 것 외에 어떤 조치를 취할 수 있을지 궁금하신가요? 그런 다음 더 이상 기다릴 필요가 없습니다&rsquo;. 이제 Azure Automation은 Azure 경고 창 내에서 이 작업을 수행할 수 있는 기능을 제공합니다. 이제 경고가 발생할 때 Azure Automation 웹후크를 호출하는 모든 Azure 경고를 수행할 수 있습니다.</p>\n\n<p>예를 들어 지정된 메트릭의 값이 할당된 임계값을 초과하면 경고 규칙이 활성화되고 Automation Runbook을 트리거하여 일부 작업을 수행할 수 있습니다. Runbook은 단일 HTTP 요청을 통해 Azure Automation에서 특정 Runbook을 시작할 수 있는 Automation 웹후크를 호출하여 트리거됩니다. Azure Automation을 새로운 기능으로 사용하시겠습니까? <a href=\"https://azure.microsoft.com/en-us/documentation/services/automation/\">여기</a>를 참조하세요.</p>\n\n<p>Azure Alerts를 사용하여 자동화 Runbook을 구성하기 위한 자세한 단계는 다음과 같습니다. 시나리오:&nbsp; 지난 1시간 동안 VM(가상 머신)에서 디스크가 1MB/초를 초과하면 전자 메일을 통해 알림을 받고 VM을 다시 시작하려고 합니다(Automation 웹후크를 호출하여 수행됨).</p>\n\n<h2>자세한 단계:</h2>\n\n<ol>\n <li>\n <p><strong>경고 임계값 설정</strong>: Azure 미리 보기 <a href=\"https://portal.azure.com/\">포털</a>에서 <strong>찾아보기를</strong> 클릭하고 모니터링에 관심이&#39;VM 리소스를 선택한 다음 경고 화면에서 조건(메트릭: 디스크 읽기, 조건: 임계값보다 큼: 지난 1시간 동안 1MB/초과)을 추가합니다.</p>\n\n <p style=\"text-align: center;\"><img border=\"0\" height=\"480\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0a7fefdc-5879-45f9-aa12-17f93d76c6f7.jpeg\" width=\"152\"></p>\n </li>\n <li>\n <p><strong>Runbook 작성:</strong> Azure Automation에서 경고에 대응&nbsp; 하는 Runbook을 만듭니다. 웹후크 데이터 및 VM 컨텍스트를 가져오는 샘플 Runbook(아래)을 안내하여 작업을 수행할 수 있도록 합니다.</p>\n </li>\n <li>\n <p><strong>웹후크 만들기:</strong> Azure 미리 보기 포털에서 Runbook에 연결된 새 웹후크를 만듭니다. 웹후크의 URL을 복사합니다(웹후크를 만든 후에는 더 이상 Azure Portal에서 URL을 볼 수 없으므로 웹후크 URL을 추적해야 합니다).</p>\n\n <p style=\"text-align: center;\"><img border=\"0\" height=\"480\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/bbb9ca28-44b3-4d43-a5b5-987e78a5b89c.jpeg\" width=\"405\"></p>\n\n <p style=\"text-align: center;\"><img border=\"0\" height=\"480\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/84f9ee8a-2224-4454-a23f-e9577e2d5a0e.jpeg\" width=\"257\"></p>\n </li>\n <li>\n <p><strong>경고 임계값을 웹후크 URL로 업데이트</strong> 합니다. 이제 모니터링 및 경고할 Azure의 적절한 리소스로 이동하고 경고 만들기/업데이트 화면에서 웹후크 URL을 추가할 수 있습니다.</p>\n </li>\n <li>\n <p>경고 조건이 충족되고 Runbook을 트리거하면 Runbook에 경고 컨텍스트를 보냅니다.&nbsp; 볼 수 있듯이 경고 컨텍스트에는 runbook에서 작업할 리소스를 식별하는 데 필요한 subscriptionID, resourceGroupName, resourceName, resourceType, resourceId 및 타임스탬프와 같은 세부 정보가 포함됩니다. <strong>webhookData 개체</strong>의 일부로 Runbook에 전달되며 <strong>웹후크에서 사용할 수 있습니다. RequestBody 속성입니다</strong>. 이를 JSON 개체로 변환하고 경고 컨텍스트를 추출할 수 있습니다. 아래 샘플 출력 화면을 참조하세요.</p>\n\n <div>\n <div>\n <div id=\"_com_1\" uage=\"JavaScript\">\n <p>찾아보기를 클릭하고 포털에서 Automation 계정 &ndash;&gt; Runbook으로 이동하여 Runbook 작업 상태를 확인하고 필요에 따라 문제를 해결합니다.</p>\n </div>\n </div>\n </div>\n </li>\n</ol>\n\n<p><strong>경고 컨텍스트의 예:</strong></p>\n\n<pre>\n{&quot;WebhookName&quot;:&quot;AzureAlertTest&quot;,&quot;RequestBody&quot;:&quot;{\\&quot;status\\&quot;:\\&quot;Resolved\\&quot;,\\&quot;context\\&quot;:{\\&quot;id\\&quot;:\\&quot;/subscriptions/&lt;subscriptionID&gt;/resourceGroups/Group/providers/microsoft.insights/alertrules/AlertVM\\&quot;,\\&quot;name\\&quot;:\\&quot;AlertVM\\&quot;,\\&quot;description\\&quot;:\\&quot;\\&quot;,\\&quot;condition\\&quot;:{\\&quot;metricName\\&quot;:\\&quot;Diskread\\&quot;,\\&quot;metricUnit\\&quot;:\\&quot;Count\\&quot;,\\&quot;metricValue\\&quot;:\\&quot;361.811648\\&quot;,\\&quot;threshold\\&quot;:\\&quot;1073741\\&quot;,\\&quot;windowSize\\&quot;:\\&quot;5\\&quot;,\\&quot;timeAggregation\\&quot;:\\&quot;Average\\&quot;,\\&quot;operator\\&quot;:\\&quot;GreaterThan\\&quot;},\\&quot;subscriptionId\\&quot;:\\&lt;subscriptionID&gt; \\&quot;,\\&quot;resourceGroupName\\&quot;:\\&quot;Group\\&quot;,\\&quot;timestamp\\&quot;:\\&quot;2015-09-22T22:51:19.4549592Z\\&quot;,\\&quot;resourceName\\&quot;:\\<strong>&quot;Testvm</strong>\\&quot;,\\&quot;resourceType\\&quot;:\\&quot;microsoft.classiccompute/virtualmachines\\&quot;,\\&quot;resourceId\\&quot;:\\&quot;/subscriptions/&lt;subscriptionID&gt;/resourceGroups/Group/providers/Microsoft.ClassicCompute/virtualMachines/<strong>TestVM</strong>\\&quot;,\\&quot;portalLink\\&quot;:\\&quot;\\&quot;},\\&quot;properties\\&quot;:{}}&quot;,&quot;RequestHeader&quot;:{&quot;Connection&quot;:&quot;Keep-Alive&quot;,&quot;Host&quot;:&quot;&lt;webhookURL&gt;&quot;}</pre>\n\n<p>다음은 웹후크 데이터를 가져와서 주석을 사용하여 VM을 다시 시작하는 샘플 Runbook입니다. Azure Alert에서 시작할 수 있도록 웹후크로 작동하도록 수정할 수 있는 기존 Runbook 라이브러리에 대한 Runbook 갤러리에 액세스할 수도 있습니다.</p>\n\n<p><strong>샘플 PS 스크립트 Runbook</strong></p>\n\n<pre class=\"prettyprint\">\nparam ( \n    [object]$WebhookData\n)\n\nif ($WebhookData -ne $null) {  \n    # Collect properties of WebhookData.\n    $WebhookName    =   $WebhookData.WebhookName\n    $WebhookBody    =   $WebhookData.RequestBody\n    $WebhookHeaders =   $WebhookData.RequestHeader\n       \n    # Information on the webhook name that called This\n    Write-Output &quot;This runbook was started from webhook $WebhookName.&quot;\n       \n    # Obtain the WebhookBody containing the AlertContext\n    $WebhookBody = (ConvertFrom-Json -InputObject $WebhookBody)\n    Write-Output &quot;`nWEBHOOK BODY&quot;\n    Write-Output &quot;=============&quot;\n    Write-Output $WebhookBody\n       \n    # Obtain the AlertContext\n    $AlertContext = [object]$WebhookBody.context\n\n    # Some selected AlertContext information\n    Write-Output &quot;`nALERT CONTEXT DATA&quot;\n    Write-Output &quot;===================&quot;\n    Write-Output $AlertContext.name\n    Write-Output $AlertContext.subscriptionId\n    Write-Output $AlertContext.resourceGroupName\n    Write-Output $AlertContext.resourceName\n    Write-Output $AlertContext.resourceType\n    Write-Output $AlertContext.resourceId\n    Write-Output $AlertContext.timestamp\n      \n    # Act on the AlertContext data, for example, restart the VM.\n       \n    # Authenticate to your Azure subscription using OrganizationId to be able to restart that Virtual Machine. For authenticating to Azure using Azure Active Directory, please see the blog.\n    $cred = Get-AutomationPSCredential -Name &quot;&lt;AutomationCredentialAssetName&gt;&quot;\n    Add-AzureAccount -Credential $cred\n    Select-AzureSubscription -subscriptionName &quot;Visual Studio Ultimate with MSDN&quot;\n       \n    Restart-AzureVM -ServiceName $AlertContext.resourceName -Name $AlertContext.resourceName\n}\nelse \n{\n    Write-Error &quot;This runbook is meant to only be started from a webhook.&quot; \n}\n</pre>\n\n<p><br>\nRunbook이 실행되면 alertcontext를 Runbook 출력으로 볼 수 있습니다.</p>\n\n<p><img src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1dd3738a-d12e-4ec9-a47c-5a177ba98139.png\"></p>\n\n<h2>Automation을 새로 사용하시겠습니까?</h2>\n\n<p>보려는 솔루션, 추가하려는 기능이 있나요, 아니면 기존 기능에 대한 피드백이 있나요?&nbsp; <a href=\"https://feedback.azure.com/forums/246290-azure-automation/suggestions/9551967-deploy-to-azure-automation-automation-account-nam\">Azure Automation UserVoice</a>에서 요청합니다.</p>\n\n<p>Azure Automation을 시작하기만 하면 되었나요?&nbsp; <a href=\"https://azure.microsoft.com/en-us/services/automation/\">여기서</a> 서비스에 대해 알아보고 <a href=\"https://twitter.com/AzureAutomation\">Twitter에서 Azure Automation을</a> 따르세요.</p>\n\n<p>행복한 자동화!</p>"
