### YamlMime:Yaml
ms.openlocfilehash: 062a02e5b925f04ae991ef7e1af4df770634a140
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139910924"
Slug: linux-and-graceful-shutdowns-2
Title: Linux 및 정상 종료
Summary: Azure의 IaaS 가상 머신은 Azure 관리 포털, Azure Powershell cmdlet 또는 CLI 도구를 통해 또는 대화형으로 로그인한 사용자에 의해서도 여러 가지 방법으로 종료될 수 있습니다.…
Content: >-
  Azure의 IaaS 가상 머신은 Azure 관리 포털, Azure Powershell cmdlet 또는 CLI 도구를 통해 또는 대화형으로 로그인한 사용자에 의해서도 여러 가지 방법으로 종료될 수 있습니다.Azure 플랫폼 자체는 플랫폼 유지 관리를 수행하기 위해 종료를 시작할 수도 있습니다.운영 체제 미설치 온-프레미스에서 실행되는 Linux 시스템의 종료 프로세스는 잘 이해되지만 클라우드에서 이 모든 것이 어떻게 작동하나요?

  <h4 align="left">Azure에서 정상 종료 시작</h4>

  Azure에서 Linux 가상 머신을 종료하는 프로세스는 온-프레미스와 거의 동일하게 작동합니다.사용자가 로그인하여 '/sbin/shutdown now'를 실행하면 시스템이 실행 중인 서비스를 즉시 중지하기 시작하고 결국 시스템 전원을 끕니다.물론 정확한 메커니즘은 사용 중인 배포 및 init 시스템(일반적으로 SysV, Upstart 또는 systemd)에 따라 다소 달라지지만 결과는 동일합니다.


  이제 포털 또는 Azure 플랫폼에서 종료가 시작되면 어떻게 되나요?요컨대, 다시 말하지만, 거의 같은 일이 일어날 것입니다.이러한 경우 Azure는 호스트와 통신하여 게스트 Linux 시스템의 정상적인 종료를 시작합니다.Hyper-V 및 Azure 환경에서 정상 종료를 수행하는 신호는 하이퍼바이저에서 제공되며 Linux 커널에 포함된 Linux Integration Services의 일부 <a href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/drivers/hv/">인</a>  hv_utils driver에 의해 처리됩니다.이 기능을  <em>통합된 종료</em>라고 합니다.


  하이퍼바이저에서 이 신호를 받은 후 hv_utils 드라이버는 Linux 게스트의 정상적인 종료를 시작하고 사용자가 수동으로 '/sbin/shutdown'을 실행한 것처럼 기본적으로 동일한 메커니즘을 시작합니다.hv_utils 하이퍼바이저에서 이 신호를 받으면 다음 메시지를 로그(일반적으로 /var/log/messages 또는 Ubuntu 시스템의 /var/log/syslog)로 보내서 하이퍼바이저에 의해 Linux 시스템이 종료되었음을 나타냅니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1796/4382.Stephen-1.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1796/4382.Stephen-1.png" border="0"></a>


  그러나 작은 캐치가 있습니다.Azure 플랫폼은 정상 종료를 시작한 후 영원히 기다릴 수 없습니다.플랫폼은 가상 머신이 정상적으로 종료될 때까지  <strong>5분</strong>  정도 기다리며, 해당 시간 후에도 계속 실행되면 컴퓨터 전원이 꺼집니다.이는 VM이 할당된 시간 내에 모든 스크립트를 실행하고 완전히 종료할 수 있는지 확인하는 것이 중요합니다.

  <h4 align="left">종료 프로세스 관리</h4>

  Azure의 Linux 사용자 간에 일반적인 요구 사항은 Azure에서 VM의 정상적인 종료를 시작할 때 애플리케이션이 제대로 종료되도록 하는 것입니다.이제 수동 및 하이퍼바이저 시작 종료에 동일한 메커니즘이 사용됨을 이해했으므로 기존 Linux init 시스템을 사용하여 애플리케이션이 제대로 종료되도록 할 수 있습니다.


  대부분의 경우 기존 SysV, 시스템 또는 시작 스크립트는 애플리케이션을 제대로 종료하기에 충분합니다.그러나 충분하지 않거나 애플리케이션을 "정리"하기 위해 추가 프로세스를 실행해야 하는 경우 다음과 같은 몇 가지 작업을 수행할 수 있습니다.

  <ul>
   <li>물론 가장 쉬운 방법은 애플리케이션 init 스크립트를 편집하고 추가 작업을 추가하는 것입니다.여기에는 몇 가지 단점이 있습니다.스크립트를 편집할 때 발생할 수 있는 명백한 오타 및 기타 오류 외에도 이러한 스크립트는 일반적으로 RPM 또는 Deb 패키지에서 관리되므로 스크립트가 업그레이드되지 않을 수 있습니다.한 가지 장점은 업그레이드 <em>된 shutdownis</em> 가 하이퍼바이저 기능이므로 Azure에 배포하기 전에 Hyper-V에서 이 모든 것을 로컬로 테스트할 수 있다는 것입니다.</li>
   <li>또 다른 옵션은 사용자 고유의 init 스크립트를 만드는 것입니다.Linux 시스템에 사용할 수 있는 다양한 init 시스템이 있기 때문에 여러 가지 방법으로 이 작업을 수행할 수 있습니다.대부분의 시스템은 기본 init 시스템과 함께 적어도 SysV 호환성을 갖기 때문에 가장 쉬운 방법은 SysV 호환 스크립트를 작성하고 runlevel 0에서 실행되도록 하는 것입니다.</li>
   <li>그리고 약간 더 정교한 접근 방식은 최근에 Azure 갤러리에서 CentOS 이미지를 사용하여 테스트한 것일 수 있습니다.이 스크립트는 필요한 사전 종료 작업을 수행하기 위해 사용자 고유의 init 스크립트를 만들기 위한 좋은 시작점일 수 있지만, 전원이 꺼지기 전에 VM을 완전히 종료하는 데 5분 정도의 기간이 유지된다는 점에 유의하세요.</li>
  </ul>

  그러나 Linux 자체와 마찬가지로 모든 배포 및 워크로드에 대해 하나의 크기에 적합한 접근 방식은 없을 수 있습니다.여기서 요점은 이 문제를 해결하는 여러 가지 방법이 있지만 VM을 완전히 종료하기 위해 Hyper-V 또는 Azure에서 수행해야 하는 고유한 작업은 없다는 것입니다.Azure에서 해당 시스템을 호스팅하는 이점을 누리면서 즐겨 찾는 Linux 배포판에서 이미 사용할 수 있는 표준 절차 및 메커니즘을 계속 사용할 수 있습니다.
