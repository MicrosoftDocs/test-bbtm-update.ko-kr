### YamlMime:Yaml
ms.openlocfilehash: b6842617d914b3c1d65b915ac9bfd2aa4cde098e
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139906007"
Slug: detect-largescale-cryptocurrency-mining-attack-against-kubernetes-clusters
Title: Kubernetes 클러스터에 대한 대규모 암호화 마이닝 공격 검색
Summary: Azure Security Center의 위협 방지를 사용하면 IaaS(Infrastructure-as-a-Service) 계층에서 PaaS(Platform-as-a-Service)에 이르기까지 다양한 서비스에서 위협을 감지하고 방지할 수 있습니다...
Content: >-
  <p>Azure Security Center&#39;위협 방지를 사용하면 IaaS(Infrastructure as a Service) 계층에서 Azure의 PaaS(Platform as a Service) 리소스(예: IoT, App Service 및 온-프레미스 가상 머신)에 이르는 다양한 서비스에서 위협을 감지하고 방지할 수 있습니다.</p>


  <p>Ignite 2019에서는 <a href="https://docs.microsoft.com/en-us/azure/security-center/azure-kubernetes-service-integration" target="_blank">Security Center의 AKS(Azure Kubernetes Service) 지원에 대한 위협 방지</a> 미리 보기 및 <a href="https://docs.microsoft.com/en-us/azure/security-center/azure-container-registry-integration" target="_blank">ACR(Azure Container Registry) 이미지에 대한 취약성 평가</a> 미리 보기를 포함하여 클라우드 플랫폼의 정교한 위협에 대응하기 위한 <a href="https://techcommunity.microsoft.com/t5/azure-security-center/ignite-2019-releases-for-azure-security-center-and-azure/ba-p/975570" target="_blank">새로운 위협 방지 기능을</a> 발표&nbsp;했습니다.</p>


  <h2>Azure Security Center 및 Kubernetes 클러스터&nbsp;</h2>


  <p>이 블로그에서는 <a href="https://azure.microsoft.com/en-us/services/security-center/" target="_blank">Azure Security Center</a>에서 최근에 발견한&nbsp; Kubernetes 클러스터에 대한 최근 대규모 암호 화폐 마이닝 공격에 대해 설명합니다. 이는 Azure Security Center가 위협으로부터 Kubernetes 클러스터를 보호하는 데 도움이 될 수 있는 많은 예제 중 하나입니다.</p>


  <p>컨테이너화된 환경에서 암호화 마이닝 공격은 새로운 것이 아닙니다&rsquo;. Azure Security Center에서는 컨테이너 내에서 실행되는 광범위한 마이닝 활동을 정기적으로 검색합니다. 일반적으로 이러한 활동은 웹 애플리케이션과 같은 취약한 컨테이너 내에서 실행되며 알려진 취약성이 악용됩니다.</p>


  <p>최근 Azure Security Center는 Kubernetes 환경을 대상으로 하는 새로운 암호화 마이닝 캠페인을 검색했습니다. 이 공격이 다른 암호화 마이닝 공격과 다른 점은 규모입니다. 2시간 이내에 수십 개의 Kubernetes 클러스터에 악성 컨테이너가 배포되었습니다.</p>


  <p>컨테이너는 공용 리포지토리인 <strong>kannix/monero-miner</strong>에서 이미지를 실행했습니다.&nbsp; 이 이미지는 매우 인기있는 오픈 소스 모네로 광부 인 XMRig를 실행합니다.</p>


  <p>원격 분석 결과 컨테이너가 <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank">Kubernetes Deployment</a> 에 의해 배포된 것으로 <code>kube-control</code>나타났습니다.</p>


  <p>아래 배포 구성에 나와 있는 것처럼 배포는 이 경우 각 클러스터에서 Pod의 복제본 10개만 실행되도록 합니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d7792131-5294-4eb1-9488-c983c2f7e1d7.png"><img alt="KB cluster2" border="0" height="768" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d8b54b28-e0d9-4ceb-9b70-d62a3667d974.png" style="margin: 0px; border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="KB cluster2" width="435"></a></p>


  <p><br>

  또한 암호화 마이닝 컨테이너를 배포한 동일한 행위자도 Kubernetes 비밀을 포함한 클러스터 리소스를 열거했습니다. 이로 인해 횡적 이동을 가능하게 할 수 있는 연결 문자열, 암호 및 기타 비밀이 노출될 수 있습니다.</p>


  <p>흥미로운 부분은 이 활동의 ID가 대시보드&rsquo; 서비스 계정이라는 <code>system:serviceaccount:kube-system:kubernetes-dashboard</code> 것입니다.<br>

  이 사실은 악의적인 컨테이너가 Kubernetes 대시보드에 의해 배포되었음을 나타냅니다. 리소스 열거형은 대시보드&rsquo; 서비스 계정에서도 시작되었습니다.</p>


  <p>공격자가 Kubernetes 대시보드를 활용하는 방법에 대한 세 가지 옵션이 있습니다.</p>


  <ol>
      <li>노출된 대시보드: 클러스터 소유자가 대시보드를 인터넷에 노출했고 공격자는 검색을 통해 대시보드를 발견했습니다.</li>
      <li>공격자는 클러스터의 단일 컨테이너에 액세스하고 대시보드에 액세스하기 위해 클러스터의 내부 네트워킹을 사용했습니다(Kubernetes의 기본 동작에 의해 가능).</li>
      <li>클라우드 또는 클러스터 자격 증명을 사용하여 대시보드를 합법적으로 검색합니다.</li>
  </ol>


  <p>문제는 위의 세 가지 옵션 중 어느 것이 이 공격에 연루되었는가하는 것입니다. 이 질문에 대답하기 위해 Azure Security Center에서 제공하는 힌트, Kubernetes 대시보드 노출에 대한 보안 경고를 사용할 수 있습니다. Azure Security Center는 Kubernetes 대시보드가 인터넷에 노출되면 경고합니다. 이 보안 경고가 공격받은 클러스터 중 일부에서 트리거되었다는 사실은 여기에 있는 액세스 벡터가 인터넷에 노출된 대시보드임을 의미합니다.</p>


  <p><a href="https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/" target="_blank">Kubernetes 공격 매트릭스</a>에 대한 이 공격의 표현은 다음과 같습니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/95215dd8-f603-4ae6-a36c-423df556a0b0.png"><img alt="kb cluster3" border="0" height="386" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4bf8211f-e625-4912-8925-0fb84b90e257.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="kb cluster3" width="1067"></a></p>


  <h2>암호화 마이닝 공격 방지</h2>


  <p>이를 어떻게 피할 수 있을까요?</p>


  <ol>
      <li>Kubernetes 대시보드를 인터넷에 노출하지 마세요. 대시보드를 인터넷에 노출하는 것은 관리 인터페이스를 노출하는 것을 의미합니다.</li>
      <li>클러스터에서 RBAC 적용: RBAC를 사용하도록 설정하면 대시보드&rsquo; 서비스 계정에는 기본적으로 매우 제한된 권한이 있으므로&rsquo; 새 컨테이너 배포를 비롯한 모든 기능을 허용하지 않습니다.</li>
      <li>서비스 계정에 필요한 권한만 부여합니다. 대시보드를 사용하는 경우 대시보드&rsquo; 서비스 계정에 필요한 권한만 적용해야 합니다. 예를 들어 대시보드가 모니터링에만 사용되는 경우 서비스 계정에 대한 권한&rdquo;만 &ldquo;부여합니다.</li>
      <li>신뢰할 수 있는 이미지만 허용: 신뢰할 수 있는 레지스트리에서 신뢰할 수 있는 컨테이너만 배포합니다.</li>
  </ol>


  <h2>자세한 정보</h2>


  <p>Kubernetes는 클라우드에서 소프트웨어를 배포하고 관리하기 위한 새로운 표준으로 빠르게 자리 잡고 있습니다. Kubernetes에 대한 풍부한 경험을 가지고 있는 사람은 거의 없으며 일반적으로 일반 엔지니어링 및 관리에만 중점을 두고 보안 측면을 간과하는 사람들이 많습니다. Kubernetes 환경을 안전하게 구성하여, 컨테이너에 초점을 맞춘 공격 표면 도어가 공격자에게 노출되지 않도록 해야 합니다. Azure Security Center는 다음을 제공합니다.</p>


  <ol>
      <li>검색 및 표시 유형: Security Centers&rsquo; 등록 구독 내에서 관리되는 AKS 인스턴스를 지속적으로 검색합니다.</li>
      <li>보안 점수 권장 사항: 고객이 고객 보안 점수의 일부로 AKS의&rsquo; 보안 모범 사례를 준수하는 데 도움이 되는 실행 가능한 항목(예: &quot;역할 기반 액세스 제어)을 사용하여 Kubernetes Service 클러스터에 대한 액세스를 제한해야 합니다.&quot;</li>
      <li>위협 감지: 호스트 및 클러스터 기반 분석(예: &ldquo;권한 있는 컨테이너가 검색됨).&quot;</li>
  </ol>


  <p>Azure Security Center의 AKS 지원에 대한 자세한 내용은 <a href="https://docs.microsoft.com/en-us/azure/security-center/azure-kubernetes-service-integration" target="_blank">여기 설명서를</a> 참조하세요.</p>
