### YamlMime:Yaml
ms.openlocfilehash: 2fd5e4ae4e0accde1fc435a78071de0b8f280ef8
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139912388"
Slug: running-freebsd-in-azure
Title: Azure에서 FreeBSD 실행
Summary: 이 블로그의 많은 독자가 알 수 있듯이, 수년 동안 Microsoft는 Linux 커뮤니티와 함께 일해 왔으며 Linux 통합으로 알려진 Linux 커널에 많은 디바이스 드라이버를 제공했습니다.
Content: >-
  <p><strong>참고:</strong> &nbsp;Microsoft Azure FreeBSD 이미지를 구성하는 방법에 대한 <strong><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/freebsd-intro-on-azure">공식 문서가</a></strong> 있습니다! 당신은 아마&nbsp; 대신 그 하나를 읽어야한다.</p>


  <p>&nbsp;</p>


  <p>이 블로그의 많은 독자가 알 수 있듯이 Microsoft는 수년 동안 Linux 커뮤니티와 함께 일해 왔으며 Linux <a href="https://blogs.technet.com/b/in_the_cloud/archive/2014/04/25/why-and-how-to-use-linux-integration-services.aspx">Integration Services로 알려진 Linux</a> 커널에 많은 디바이스 드라이버를 제공했습니다. 이러한 드라이버를 사용하면 Linux 시스템이 Hyper-V 및 Microsoft Azure 잘 실행되도록 할 수 있습니다. 최근 Microsoft는 FreeBSD 커뮤니티와 협력하여 FreeBSD 10에 동등한 드라이버를 기여했습니다. 이를 FreeBSD용 BIS(BSD Integration Services)라고 합니다. 이 문서에서는 Microsoft Azure 실행할 FreeBSD 10 이미지를 준비하고 업로드하는 방법에 대한 지침을 제공합니다. <b>면책 조항:</b> 이 문서에서는 Azure에서 FreeBSD를 실행하는 방법에 대한 자세한 지침을 제공하지만 FreeBSD는 현재 Microsoft Azure <a href="https://azure.microsoft.com/en-us/documentation/articles/linux-endorsed-distributions/">보증 플랫폼</a>이 아니므로 지원되지 않습니다.</p>


  <h2>기본 FreeBSD 이미지 가져오기</h2>


  <p>이 문서에서는 Microsoft Azure FreeBSD 10 x86_64 이미지를 준비하는 데 중점을  두겠습니다. 시작하려면 먼저 Hyper-V에 FreeBSD를 로컬로 설치해야 합니다(Windows Server 2012 R2 권장). 우리의 삶을 더욱 쉽게 만들기 위해 FreeBSD 커뮤니티는 미리 만든 FreeBSD 이미지를 VHD 형식으로 제공했습니다.</p>


  <ol>
      <li>먼저 ftp.freebsd.org/pub/FreeBSD/snapshots/VM-IMAGES/10.0-RELEASE/amd64/Latest/ 찾아보고 최신 *.vhd.xz 파일을 다운로드합니다(예: ftp.freebsd.org/pub/FreeBSD/snapshots/VM-IMAGES/10.0-RELEASE/amd64/Latest/FreeBSD-10.0-RELEASE-amd64-20140116-r260789.vhd.xz</li>
      <li>.xz 파일을 압축 해제하여 FreeBSD-10.0-RELEASE-amd64-*.vhd 파일을 추출합니다. 여기에 도움이 될 수있는 많은 유틸리티가 있습니다. 나는 일반적으로 <a href="https://7-zip.org/">7 zip을</a> 사용합니다.</li>
      <li>Hyper-V에서 새 가상 머신을 만들고 추출된 VHD를 IDE 디스크로 연결합니다.</li>
  </ol>


  <p><a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/05/FreeBSD01-a.png"><img alt="Attach a VHD to a virtual machine" border="0" height="307" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/FreeBSD01-a_thumb.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; margin-right: auto; margin-left: auto;" title="가상 머신에 VHD 연결" width="612"></a></p>


  <h2>FreeBSD VHD 크기 조정(필요한 경우)</h2>


  <p>설치 ISO를 통해 Hyper-V VM에 FreeBSD를 직접 설치하도록 선택한 경우 이 섹션을 건너뛸 수 있습니다.&nbsp; 그러나 <a href="ftp://ftp.freebsd.org">ftp.freebsd.org</a> 미리 생성된 VHD를 사용하는 경우 Azure와 호환되도록 VHD의 크기를 조정해야 할 수 있습니다. Microsoft Azure VHD를 만들 때 VHD의 크기는 정수(MB)여야 합니다. 그렇지 않으면 Azure에서 새 FreeBSD 이미지를 만들려고 할 때 다음과 유사한 오류가 표시됩니다.</p>


  <blockquote><i>&ldquo;VHD https://&lt; mystorageaccount.blob.core.windows.net/vhds/FreeBSD-10.0-RELEASE-amd64-20140116-r260789.vhd&gt; 지원되지 않는 가상 크기는 21475270656 바이트입니다. 크기는 정수(MB)여야 합니다.&rdquo;</i></blockquote>


  <p>따라서 위의 예제에서 21475270656 바이트는 실제로 20480.4140625MB입니다. 따라서 이 문제를 해결하려면 VHD의 크기를 조정하여 디스크가 21000MB가 되도록 합니다. Powershell 또는 Hyper-V 관리 콘솔을 사용하여 이 작업을 쉽게 수행할 수 있습니다.</p>


  <ul>
      <li>Hyper-V 서버에서 Powershell 명령 프롬프트를 열고 Resize-VHD cmdlet을 실행하여 VHD 크기를 약간 조정합니다. <pre class="prettyprint">
  PS &gt; Resize-VHD -Path \&lt;PATH&gt;\FreeBSD-10.0-RELEASE-amd64-20140116-r260789.vhd -SizeBytes 21GB</pre>

  &nbsp;</li>
      <li>또는 Hyper-V 관리 콘솔에서 디스크 크기를 조정할 수도 있습니다. FreeBSD VM의 설정 메뉴에서 FreeBSD 가상 IDE 드라이브를 클릭한 다음 편집&rdquo;을 클릭하여 &ldquo;VHD 편집 마법사를 엽니다.</li>
  </ul>


  <p><a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/05/FreeBSD02-a.png"><img alt="Resize a VHD in the Hyper-V managemnet console" border="0" height="312" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/FreeBSD02-a_thumb.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; margin-right: auto; margin-left: auto;" title="Hyper-V managemnet 콘솔" width="612"></a> 다음에서 VHD 크기를 조정하고 FreeBSD 시스템을 시작하고 루트로 로그인합니다 <i>.</i> 미리 생성된 커뮤니티 VHD에는 기본적으로 루트 암호가 없으므로 암호를 묻는 메시지가 표시되지 않습니다. 로그인한 후 <i>gpart를 </i>실행하고 디스크 파티션을 살펴봅니다. VHD의 크기를 조정했으므로 디스크 da0이 <i>CORRUPT</i> 로 표시되는 것을 볼 수 있습니다.</p>


  <pre class="prettyprint">

  root@:~# gpart show
        34  41942973  da0  GPT  (21G) [CORRUPT]
          34      1024    1  freebsd-boot  (512K)
        1058   2097152    2  freebsd-swap  (1.0G)
     2098210  39844797    3  freebsd-ufs  (19G)</pre>

  <p>&nbsp; 문제 없습니다. 다음 명령을 실행하여 da0을 수정합니다.</p>


  <pre class="prettyprint">

  root@:~# gpart recover da0

  da0 recovered


  root@:~# gpart show

  =&gt;      34  44040125  da0  GPT  (21G)
          34      1024    1  freebsd-boot  (512K)
        1058   2097152    2  freebsd-swap  (1.0G)
     2098210  39844797    3  freebsd-ufs  (19G)
    41943007   2097152       - free -  (1.0G)</pre>

  <p>&nbsp; 필요에 따라 FreeBSD 루트 파티션의 크기를 조정하여 원하는 경우 사용 가능한 공간을 회수할 수 있습니다. 그러나 루트 파일 시스템의 크기를 조정하기 위해 FreeBSD Live CD에서 부팅해야 할 수 있으므로 좀 더 문제가 됩니다. 하지만 사용 가능한 공간을 다시 원하는 경우 루트 파일 시스템을 확장하는 방법은 다음과 같습니다.</p>


  <pre class="prettyprint">

  root@:~# gpart resize -i 3 da0

  da0p3 resized


  root@:~# gpart show

  =&gt;      34  44040125  da0  GPT  (21G)
          34      1024    1  freebsd-boot  (512K)
        1058   2097152    2  freebsd-swap  (1.0G)
     2098210  41941949    3  freebsd-ufs  (20G)

  root@:~# growfs /dev/da0p3</pre>


  <p>&nbsp; 허레이! VHD가 좋아&rsquo; 보입니다. 이제 Azure용 FreeBSD 시스템을 준비할 준비가 되었습니다.</p>


  <h2>Azure용 FreeBSD 시스템 준비</h2>


  <p>이제 쉬운 부분 (예, 정말). 몇 가지 추가 구성 요소를 설치하고 이 시스템이 Azure에서 실행되도록 몇 가지를 구성하기만 하면 됩니다.</p>


  <ul>
      <li><strong>네트워킹 사용</strong> /etc/rc.d/netif를 사용하여 네트워킹을 중지하고 시작할 수 있도록 hn0 인터페이스를 구성합니다.

      <pre class="prettyprint">
  root@:~# echo &#39;ifconfig_hn0=&quot;SYNCDHCP&quot;&#39; &gt;&gt; /etc/rc.conf

  root@:~# service netif restart</pre>
      </li>
  </ul>


  <p>&nbsp; &nbsp;</p>


  <ul>
      <li><strong>SSH 사용</strong> /etc/rc.conf에서 SSH 디먼을 사용하도록 설정하고 새 호스트 키를 만듭니다.

      <pre class="prettyprint">
  root@:~# echo &#39;sshd_enable=&quot;YES&quot;&#39; &gt;&gt; /etc/rc.conf


  root@:~# ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key

  root@:~# ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key

  root@:~# service sshd restart</pre>

  이제 SSH를 FreeBSD 게스트로 연결하여 구성을 계속하려면 새 권한 없는 사용자를 만들거나 &#39;루트&#39; 사용자에 대한 암호를 설정하고 /etc/ssh/sshd_config PermitRootLogin yes&quot;를 설정&quot;해야 합니다(권장하지 않음).</li>

  </ul>


  <p>&nbsp; &nbsp;</p>


  <ul>
      <li><strong>Python 2.7 및 필수 모듈을 설치합니다. </strong>

      <pre class="prettyprint">
  root@:~# pkg install python27 py27-asn1

  The package management tool is not yet installed on your system.

  Do you want to fetch and install it now? [y/N]: y


  Bootstrapping pkg from pkg+https://pkg.FreeBSD.org/freebsd:10:x86:64/latest, please wait&hellip;

  Verifying signature with trusted certificate pkg.freebsd.org.2013102301&hellip; done

  Installing pkg-1.2.7_2&hellip; done

  If you are upgrading from the old package format, first run:

    # pkg2ng
  Updating repository catalogue

  digests.txz                                              100% 1071KB   1.1MB/s   1.1MB/s   00:00

  packagesite.txz                                          100% 4929KB   4.8MB/s   4.8MB/s   00:01

  Incremental update completed, 22926 packages processed:

  0 packages updated, 0 removed and 22926 added.

  The following 4 packages will be installed:

          Installing gettext: 0.18.3.1
          Installing python27: 2.7.6_4
          Installing py27-setuptools27: 2.0.1
          Installing py27-asn1: 0.1.4_1,1

  The installation will require 81 MB more space


  12 MB to be downloaded


  Proceed with installing packages [y/N]: y</pre>

  쉽게 찾을 수 있도록 <em>/usr/bin/python</em> 을 사용하여 새 python 2.7 이진 파일을 symlink해야 할 수도 있습니다.

      <pre class="prettyprint">
  root@:~# ln -s /usr/local/bin/python2.7 /usr/bin/python</pre>
      </li>
  </ul>


  <p>&nbsp;</p>


  <ul>
      <li><strong>sudo 설치</strong> 일반적으로 Azure에서 <i>루트</i> 계정을 사용하지 않도록 설정하고 권한 없는 사용자의 <i>sudo </i>를 활용하여 상승된 권한으로 명령을 실행합니다.

      <pre class="prettyprint">
  root@:~# pkg install sudo</pre>
      </li>
  </ul>


  <p>&nbsp;</p>


  <ul>
      <li><strong>Azure Linux 에이전트 설치</strong> Azure Linux 에이전트의 최신 릴리스는 항상 Github <a href="https://github.com/Azure/WALinuxAgent/releases">https://github.com/Azure/WALinuxAgent/releases</a>에서 찾을 수 있습니다. FreeBSD에는 버전 2.0.5 이상이 권장됩니다. 그러나 원격 2.0 분기는 일반적으로 매우 안정적이므로 지금은 해당 분기에서 직접 최신 에이전트를 끌어올 것입니다.&nbsp; 그러면 FreeBSD를 지원하는 최신 에이전트가 제공됩니다.

      <pre class="prettyprint">
  root@:~# pkg install wget

  ......


  root@:~# wget https://raw.githubusercontent.com/Azure/WALinuxAgent/2.0/waagent

  root@:~# mv ./waagent /usr/sbin/

  root@:~# chmod 755 /usr/sbin/waagent


  root@:~# /usr/sbin/waagent -install</pre>

  이제 Azure 에이전트가 설치되어 실행되고 있습니다.</li>

  </ul>


  <ul>
      <li><strong>(선택 사항) Azure에 VHD를 업로드하기 전에 시스템 프로비전 해제 </strong> 프로비전 해제는 이미지를 <i>일반화</i> 하려고 시도합니다. 이 작업은 SSH 호스트 키를 제거하고, 루트 사용자를 사용하지 않도록 설정하고, 암호를 제거하고, DHCP 캐시 항목 등을 제거합니다. 일반적으로 이 방법은 좋은 방법이지만 이 VHD를 광범위하게 공유하지 않을 경우 이 단계를 건너뛸 수도 있습니다.

      <pre class="prettyprint">
  root@:~# /usr/sbin/waagent &ndash;deprovision

  WARNING! The waagent service will be stopped.

  WARNING! All SSH host key pairs will be deleted.

  WARNING! Cached DHCP leases will be deleted.

  WARNING! Nameserver configuration in /etc/resolv.conf will be deleted.

  WARNING! root password will be disabled. You will not be able to login as root.

  Do you want to proceed (y/n)? y</pre>
      <b> 참고:</b> 이 명령을 실행한 후 ovf-env.xml 파일이 없으므로 경고 메시지가 표시 될 수 있습니다. 이 메시지는 무시해도 됩니다.</li>
      <li><strong>FreeBSD 가상 머신 종료 </strong></li>
  </ul>


  <p><strong>All done!</strong> 와우, 그건 쉬웠어, 맞아?</p>


  <h2>FreeBSD VHD를 Azure에 업로드</h2>


  <p>Azure에 VHD를 업로드하는 몇 가지 방법이 있습니다. 이 문서에서는 Azure Powershell 도구를 사용하여 스토리지 계정에 VHD를 업로드합니다.</p>


  <ul>
      <li>먼저 Hyper-V 서버에서 FreeBSD 가상 머신을 종료해야 합니다.</li>
      <li>다음으로 Add-AzureVhd cmdlet을 사용하여 VHD를 업로드합니다. <pre class="prettyprint">
  PS C:\&gt; $destination = &ldquo;https://MYACCOUNT.blob.core.windows.net/vhds/FreeBSD-10.0-RELEASE-amd64-20140116-r260789.vhd&rdquo;

  PS C:\&gt; $localfile = &ldquo;C:\PATH\FreeBSD-10.0-RELEASE-amd64-20140116-r260789.vhd&rdquo;

  PS C:\&gt; Add-AzureVhd -Destination $destination -LocalFilePath $localfile</pre>
      </li>
  </ul>


  <p>&nbsp;</p>


  <ul>
      <li>업로드가 완료되면 이제 해당 VHD를 사용하여 <i>이미지를</i> 만들 수 있습니다. 그러면 Azure에서 원하는 수의 FreeBSD 가상 머신을 프로비전할 수 있습니다.

      <pre class="prettyprint">
  PS C:\&gt; $destination = &ldquo;https://MYACCOUNT.blob.core.windows.net/vhds/FreeBSD-10.0-RELEASE-amd64-20140116-r260789.vhd&rdquo;


  PS C:\&gt; Add-AzureVMImage -ImageName FreeBSD10.0 -MediaLocation $destination -OS Linux</pre>

  여기서는 OS 유형의 &ldquo;Linux&rdquo; 를 사용해야 합니다. 안타깝게도 Powershell 도구는 현재 -OS FreeBSD&rdquo; 매개 변수 :) 지원하지 &ldquo;않습니다.</li>

  </ul>


  <h2>Azure에서 FreeBSD Virtual Machine 만들기</h2>


  <p>마지막으로, 이제 Azure에서 새 FreeBSD 가상 머신을 만들 준비가 되었습니다. 이에 대해 Powershell 또는 CLI 도구를 사용하거나 일반적인 방법으로 포털에서 FreeBSD 10 이미지를 스핀업할 수 있습니다.</p>


  <ul>
      <li>Azure 관리 포털(<a href="https://manage.windowsazure.com/">https://manage.windowsazure.com/</a>)에 &ldquo;로그인하고 NEW-COMPUTE-VIRTUAL&gt; MACHINE-FROM&gt;&gt; 갤러리를 클릭합니다.&rdquo;</li>
      <li>내 이미지를 클릭합니다.&ldquo;&rdquo;</li>
      <li>&ldquo;이미지&rdquo; 선택 메뉴에서 내 이미지 선택 &ldquo;&rdquo;</li>
      <li>FreeBSD10 이미지를 선택하고 프롬프트를 통해 호스트 이름, 암호/SSH 키 등을 설정합니다.</li>
  </ul>


  <p>프로비전이 완료되면 Azure에서 새 FreeBSD 10 VM을 실행해야 합니다. 즐겨보세요! <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/05/FreeBSD08.png"><img alt="FreeBSD VM running in Microsoft Azure" border="0" height="150" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/FreeBSD08_thumb.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; margin-right: auto; margin-left: auto;" title="Microsoft Azure 실행되는 FreeBSD VM" width="612"></a></p>
