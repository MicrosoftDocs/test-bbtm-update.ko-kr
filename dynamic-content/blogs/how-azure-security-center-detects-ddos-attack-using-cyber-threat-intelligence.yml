### YamlMime:Yaml
ms.openlocfilehash: 2ae4ba20a5f218a141601d0efdf507f44d006d97
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139898973"
Slug: how-azure-security-center-detects-ddos-attack-using-cyber-threat-intelligence
Title: Azure Security Center가 사이버 위협 인텔리전스를 사용하여 DDoS 공격을 감지하는 방법
Summary: Azure Security Center는 다양한 Azure 리소스에서 로그 데이터를 자동으로 수집, 분석 및 통합합니다. 보안 센터에 우선 순위가 지정된 보안 경고 목록이 다음과 함께 표시됩니다.
Content: >-
  <p>Azure Security Center는 다양한 Azure 리소스에서 로그 데이터를 자동으로 수집, 분석 및 통합합니다. 우선 순위가 지정된 보안 경고 목록은 공격을 해결하는 방법에 대한 권장 사항과 함께 문제를 신속하게 조사하는 데 필요한 정보와 함께 Security Center에 표시됩니다. 또한 보안 연구원 및 전문가 팀은 종종 고객과 직접 협력하여 보안 센터 검색 및 경고 기능을 지속적으로 개선하는 것을 목표로 Microsoft Azure 고객에게 영향을 미치는 보안 인시던트에 대한 인사이트를 얻습니다.</p>


  <p>이전 블로그 게시물 &quot; 에서 <a href="https://azure.microsoft.com/en-us/blog/azure-security-center-adds-context-alerts-to-aid-threat-investigation/" target="_blank">Azure Security Center는 위협 조사를 지원하기 위해 컨텍스트 경고를 추가</a>했으며,&quot; Ian Hellen은 보안 조사를 자동화하는 데 도움이 되는 컨텍스트 경고 기능을 설명하고 공격 도중과 공격 직전에 시스템에서 발생한 다른 상황에 대한 관련 컨텍스트를 제공합니다. 이 블로그 게시물에서는 실제 DDoS 공격 캠페인과 사이버 위협 인텔리전스를 사용하여 검색된 방법에 초점을 맞춥니다.</p>


  <p>조사에 대한 자세한 내용을 알아보기 전에 이 블로그를 통해 확인할 몇 가지 용어를&rsquo; 빠르게 설명해 드리겠습니다&rsquo;. 그렇다면 DDoS란? DDoS(분산 서비스 거부)는 대상의 가용성을 방해하기 위한 공격 유형의 컬렉션입니다. 이러한 공격에는 여러 인터넷에 연결된 시스템을 사용하여 DNS 서버, 웹 서비스, 전자 메일 등과 같은 대상에 대해 많은 네트워크 요청을 시작하는 조정된 노력이 포함됩니다. 공격자&rsquo;의 목표는 더 이상 합법적인 트래픽을 효과적으로 처리할 수 없도록 대상 서버에서 시스템 리소스를 압도하여 시스템에 액세스할 수 없도록 하는 것입니다. 또 다른 용어는 &ldquo;무차별 암호 대입(Brute Force&rdquo; )으로, 컴퓨터 호스트에 대한 무단 액세스를 얻기 위해 유효한 사용자 이름/암호 조합을 계산하거나 추측하려고 시도하는 공격 유형입니다. 종종 무차별 암호 대입 시도의 엄청난 양은 대상 시스템의 DDoS를 효과적으로 초래할 수 있습니다.</p>


  <h2>초기 Azure Security Center 경고 세부 정보</h2>


  <p>Azure Security Center가 일련의 <em><strong>실패한 RDP 무차별 암호 대입 공격</strong></em> 및 그 직후 <em><strong>RDP 무차별 암호 대입 공격 성공</strong></em> 에 대해 경고했을 때 초기 조사를 시작했습니다. 동시에 Azure Security Center에서 일관된 <strong><em>RDP 들어오는 BF 다에서 하나의 &amp; RDP 들어오는 BF 1 대 1 공격</em></strong> 경고도 관찰했습니다. 이러한 공격은 RDP 서비스를 주기적으로 대상으로 하려는 최대 79-85개의 고유 IP 주소에서 발생한 것으로 보입니다.&nbsp;</p>


  <p>아래에는 Azure Security Center에서 이 일련의 경고가 표시됩니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0efaee73-4a8d-401e-9a1f-a42999f5ba70.png"><img alt="Security alerts" border="0" height="483" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/7dbbb034-95d0-41c0-8b21-141f5db949db.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="보안 경고" width="491"></a></p>


  <p>또한 Azure Security Center는 아래와 같이 사용되는 공격 기술에 대한 자세한 인사이트를 제공하는 경고에 대한 위협 인텔리전스 보고서를 제공합니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/90f91a16-fd37-4d1a-9876-eb16c672cfd8.png"><img alt="Threat summary image" border="0" height="506" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/7669d576-a4d3-410f-b6ac-5d733908a9d0.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="위협 요약 이미지" width="764"></a></p>


  <p>무차별 암호 대입 공격이 성공한 후 공격자가 먼저 동일한 암호를 사용하여 세 개의 새 사용자 계정을 만든 것으로 밝혀지는 심층 조사를 시작했습니다.</p>


  <ul>
   <li><em>&lsquo;관리자&rsquo;, </em></li>
   <li><em>&lsquo;관리자&rsquo;, </em></li>
   <li><em>&lsquo;adminserver&rsquo;</em></li>
  </ul>


  <p>각각의 암호는 lman321&rsquo;이었습니다&lsquo;.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c0b057d7-3f66-488c-99b9-544ca808352e.png"><img alt="Table 1" border="0" height="229" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0f03a3c2-e14f-4291-9878-3b4ac570ec33.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="표 1" width="661"></a></p>


  <ul>
   <li>나중에 Azure Security Center는 공격자가 사용자 계정&rsquo; %temp% 디렉터리에서 실행되는 알 수 없는 이진<em> &lsquo;wrsd.exe&rsquo; </em>연결된 프로세스를 실행했음을 발견했습니다.</li>
   <li>다운로드한 후에는 현재 기록된 도메인\사용자 계정을 표시하는 whoami 명령을 실행하여 wrsd.exe 관찰했습니다.</li>
   <li>그런 다음 공격자는 원격 데스크톱 서비스에서 NLA(네트워크 수준 인증)를 사용하도록 설정하기 위해 아래 레지스트리 키를 변경했습니다. 이는 다른 공격자가 RDP 무차별 암호 대입 공격을 성공적으로 수행하지 못하도록 하기 위해 수행됩니다.
   <ul>
    <li><em>REG ADD &ldquo;HKLM\SYSTEM\ControlSet001\Control\Terminal Server\WinStations\RDP-Tcp&rdquo; /v UserAuthentication /t REG_DWORD /d 1 /f</em></li>
    <li><em>&quot;reg add &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /v UserAuthentication /t REG_DWORD /d 1 /f&quot;</em></li>
   </ul>
   </li>
  </ul>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/efe0f234-21d8-431b-ba31-b53029598158.png"><img alt="Table 2" border="0" height="241" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/6802ad5e-b8ae-494d-ab5e-a2aff82c11d3.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="표 2" width="740"></a></p>


  <ul>
   <li>그런 다음 공격자는 LegalNoticeCaption 및 LegalNoticeText 표시와 관련된 터미널 서비스 레지스트리 키 항목을 삭제합니다. 이러한 레지스트리 키는 사용자 지정 법적 알림을 사용하도록 설정하고 구성하고 로그온 시 모든 원격 RDP 사용자에게 Windows 표시되는 메시지를 시작하는 데 사용됩니다. UI가 때때로 공격자&rsquo; 자동화를 중단하거나 중단할 수 있으므로 공격자는 일반적으로 이러한 LegalNotice 키를 삭제합니다.</li>
  </ul>


  <p><em>reg delete </em></p>


  <p><em>&quot;&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System/v legalnoticecaption /f&nbsp;&nbsp;&nbsp; </em></p>


  <p><em>reg delete </em></p>


  <p><em>&quot;&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System/v legalnoticetext /f</em></p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5899ea1d-a54c-49f2-a0bb-a6af5ea458e2.png"><img alt="Unauthorized Use of This System" border="0" height="290" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/60da2f0e-eeac-452d-a73a-fd5f72c71cc5.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="이 시스템의 무단 사용" width="519"></a></p>


  <ul>
   <li>그런 다음 부모 프로세스는 /f(force) 옵션과 함께 Taskill.exe 사용하여 실행 중인 Chrome 또는 Firefox 프로세스를 종료하는 명령을 시작합니다. 작업 종료(Taskill.exe)<strong></strong>는 하나 이상의 작업 또는 프로세스를 종료하는 데 사용되는 프로그램입니다. 프로세스 ID 또는 이미지 이름으로 프로세스를 종료할 수 있습니다. /f&rsquo; 매개 변수는 &lsquo;프로세스를 강제로 종료하려는 its를 나타냅니다&rsquo;.</li>
   <li>프로세스를 종료한 후 다음이 표시됩니다.</li>
  </ul>


  <ol>
   <li>공격자는 먼저 종료 /l /f&rdquo; 명령을 사용하여 &ldquo;로그오프를 시도합니다. /l 스위치는 /f 스위치가 &ldquo;실행 중인 애플리케이션을 강제로 닫는 동안 로그오프&rdquo; 를 나타냅니다.</li>
   <li>이어서 &ldquo;ping -n 3 127.0.0.1&rdquo; 명령이 이어지며, localhost를 3번 ping합니다. 이 명령은 각 ping이 1초 정도 걸리기 때문에 약 3초의 지연을 삽입하는 데 사용되는 것으로 보입니다.</li>
   <li>마지막으로 공격자가 로그오프&rdquo; 명령을 사용하여 로그오프하는 것을 &ldquo;볼 수 있습니다.</li>
  </ol>


  <p>손상 후 1시간 이내에 Azure Security Center는 Microsofts&rsquo; 위협 인텔리전스를 사용하여 손상된 구독이 나가는 DNS 증폭 공격을 수행하기 위해 섀도 서버로 사용될 가능성이 있음을 감지했습니다.&nbsp;</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/641ab4d2-a7c7-4276-868d-3351086c383c.png"><img alt="Screenshot_1" border="0" height="94" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4fd3b273-5045-4edb-bdd0-a9aa9174dd4a.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="Screenshot_1" width="501"></a></p>


  <p>DNS 증폭 공격은 일반적으로 두 가지 정교한 단계를 포함하는 분산 DDoS 공격의 인기 있는 형태입니다. 공격자는 먼저 피해자 주소를 스푸핑한 다음 피해자 주소를 원본 주소로 대체하여 다수의 열린 해결자에게 많은 수의 DNS 요청을 보냅니다. 그 결과 모든 DNS 회신이 피해자&#39;서버로 전송됩니다. 두 번째 단계에서 공격자는 많은 DNS 레코드에 등록될 수 있는 인터넷 도메인을 검색합니다.</p>


  <p>그러면 공격자는 해당 도메인에 대한 전체 DNS 레코드 집합을 요청하는 DNS 쿼리를 보냅니다. DNS 서버&rsquo; 응답은 대개 너무 커서 대상에 대량의 패킷으로 넘쳐나게 됩니다.</p>


  <p>이와 같은 사례의 높은 심각도와 우선 순위를 고려하여 보안 연구원 및 전문가 팀은 즉시 고객에게 연락하여 위협을 식별하고 피해자 호스트에서 일어난 활동, 침입 범위 및 그 배후에 있는 동기를 확인하기 위해 법의학 조사 단계를 수행했습니다. 지속적인 노출과 고객&rsquo; 네트워크의 추가 손상 가능성을 방지하기 위해 추가 수정 단계도 수행되었습니다. 수행된 모든 권장 작업은 아래의 수정 및 완화 섹션에 자세히 설명되어 있습니다.</p>


  <h2>권장되는 수정 및 완화 단계</h2>


  <p>초기 손상은 성공적인 RDP 무차별 암호 대입 공격으로 인해 컴퓨터가 완전히 손상되었으며 DDoS- DNS 증폭 공격에 더 많이 사용되었습니다. 이 경우 호스트가 사악한 목적으로 사용되고 있었습니다. Microsoft는 사용 가능한 로그 원본, 호스트 기반 분석 및 필요한 경우 포렌식 분석을 검토하여 손상의 그림을 작성하는 데 도움이 되는 초기 손상의 원인을 조사하는 것이 좋습니다. Azure &lsquo;IaaS(Infrastructure as a Service&rsquo; ) VM(가상 머신)의 경우 데이터 드라이브를 실행 중인 머신 및 디스크 이미징 기능에 연결하는 기능을 포함하여 데이터 수집을 용이하게 하기 위한 몇 가지 기능이 있습니다. 또한 호스트에서 실행되는 악성 소프트웨어를 식별하고 제거하는 데 도움이 되도록 맬웨어 보호 소프트웨어를 사용하여 검사를 수행하는 것이 좋습니다. 손상된 호스트에서 횡적 이동이 식별된 경우 수정 작업은 이러한 호스트로 확장되어야 합니다.</p>


  <p>피해자 호스트를 깨끗하게 확인할 수 없거나 손상의 근본 원인을 식별할 수 없는 경우 중요한 데이터를 백업하고 새 가상 머신으로 마이그레이션하는 것이 좋습니다. 또한 다시 연결을 방지하기 위해 네트워크에 다시 배치하기 전에 새 호스트 또는 수정된 호스트를 강화해야 합니다. 그러나 이 작업을 즉시 수행할 수 없다는 점을 이해하면 다음 수정/예방 단계를 구현하는 것이 좋습니다.</p>


  <ul>
   <li><strong>암호 정책:</strong> 공격자는 일반적으로 단어 목록 및 스마트 규칙 집합을 활용하여 사용자 암호를 지능적으로 자동으로 추측하는 널리 사용 가능한 도구를 사용하여 무차별 암호 대입 공격을 시작합니다. 따라서 첫 번째 단계는 모든 VM에 복잡한 암호를 활용하는 것입니다. 자주 암호 변경을 적용하는 복잡한 암호 정책이 적용되어야 합니다. <a href="https://technet.microsoft.com/en-us/library/ff741764.aspx" target="_blank">암호 정책을 적용하기 위한 모범 사례에</a> 대해 자세히 알아봅니다.</li>
   <li><strong>끝점:</strong> 엔드포인트를 사용하면 인터넷에서 VM과 통신할 수 있습니다. Azure 환경에서 VM을 만들 때 VM, 원격 데스크톱 및 PowerShell을 관리하는 데 도움이 되는 두 개의 엔드포인트가 기본적으로 만들어집니다. 필요하지 않은 엔드포인트를 제거하고 필요한 경우에만 추가하는 것이 좋습니다. 엔드포인트가 열려 있는 경우 가능할 때마다 사용되는 공용 포트를 변경하는 것이 좋습니다. 새 Windows VM을 만들 때 기본적으로 원격 데스크톱의 공용 포트는 자동&rdquo;으로 &ldquo;설정됩니다. 즉, 임의의 공용 포트가 자동으로 생성됩니다. <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/classic/setup-endpoints" target="_blank">Azure의 클래식 Windows 가상 머신에서 엔드포인트를 설정하는 방법에 대한</a> 자세한 내용을 알아봅니다.</li>
   <li><strong>네트워크 보안 그룹 사용:</strong> Azure Security Center는 NSG(네트워크 보안 그룹)가 아직 사용하도록 설정되지 않은 경우 사용하도록 설정하는 것이&rsquo; 좋습니다. NSG에는 Virtual Network의 VM 인스턴스에 대한 네트워크 트래픽을 허용하거나 거부하는 ACL(액세스 제어 목록) 규칙 목록이 포함되어 있습니다. 엔드포인트 ACL을 사용하면 해당 관리 프로토콜에 대한 액세스를 허용하려는 IP 주소 또는 주소의 CIDR 서브넷을 제어할 수 있습니다. <a href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-nsg" target="_blank">네트워크 보안 그룹을 사용하여 네트워크 트래픽을 필터링</a>하고 <a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-enable-network-security-groups" target="_blank">Azure Security Center에서 네트워크 보안 그룹을 사용하도록 설정하는</a> 방법에 대해 자세히 알아봅니다.</li>
   <li><strong>관리에 VPN 사용:</strong> VPN 게이트웨이는 공용 연결을 통해 암호화된 트래픽을 온-프레미스 위치로 보내는 가상 네트워크 게이트웨이의 유형입니다. 또한 VPN Gateway를 사용하여 Microsoft 네트워크를 통해 Azure 가상 네트워크 간에 암호화된 트래픽을 보낼 수 있습니다. Azure 가상 네트워크와 온-프레미스 사이트 간에 암호화된 네트워크 트래픽을 보내려면 가상 네트워크에 대한 VPN 게이트웨이를 만들어야 합니다. <a href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways#site-to-site-and-multi-site-ipsecike-vpn-tunnel" target="_blank">사이트 간</a> 및 지점 및 <a href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways#a-namep2sapoint-to-site-vpn-over-sstp" target="_blank">사이트</a> 간 게이트웨이 연결을 모두 사용하면 공용 엔드포인트를 완전히 제거하고 보안 VPN 연결을 통해 Virtual Machine에 직접 연결할 수 있습니다.</li>
  </ul>


  <p>Azure Security Center에 대한 자세한 내용은 다음을 참조하세요.</p>


  <ul>
   <li><a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities" target="_blank">Azure Security Centers&rsquo; 검색 기능</a></li>
   <li><a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-managing-and-responding-alerts" target="_blank">Azure Security Center에서 보안 경고 관리 및 대응</a></li>
   <li><a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-recommendations" target="_blank">Azure Security Center에서 보안 권장 사항 관리</a></li>
   <li><a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-monitoring" target="_blank">Azure Security Center에서 보안 상태 모니터링</a></li>
   <li><a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-partner-solutions" target="_blank">Azure Security Center를 사용하여 파트너 솔루션 모니터링</a></li>
   <li><a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-faq" target="_blank">Azure Security Center FAQ</a></li>
   <li>Azure Security 블로그를 읽어 최신 <a href="https://blogs.msdn.com/b/azuresecurity/" target="_blank">Azure 보안</a> 뉴스 및 정보를 가져옵니다.</li>
  </ul>
