### YamlMime:Yaml
ms.openlocfilehash: a7533133728e3d28b00d5e4ead3ed1966f5402cc
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139902061"
Slug: monitoring-azure-sql-data-sync-using-oms-log-analytics
Title: OMS Log Analytics를 사용하여 Azure SQL 데이터 동기화 모니터링
Summary: Azure SQL 데이터 동기화 고객이 여러 Azure SQL 데이터베이스 및/또는 온-프레미스 SQL 데이터베이스 간에 양방향 또는 단방향으로 데이터를 쉽게 동기화할 수 있는 솔루션입니다.
Content: >-
  <p><a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-sync-data" target="_blank">Azure SQL 데이터 동기화</a> 고객이 여러 Azure SQL 데이터베이스 및/또는 온-프레미스 SQL 데이터베이스 간에 양방향 또는 단방향으로 데이터를 쉽게 동기화할 수 있는 솔루션입니다.</p>


  <p>이전에는 사용자가 Azure Portal에서 SQL Azure 데이터 동기화 수동으로 확인하거나 PowerShell/RestAPIs&rsquo;를 사용하여 로그를 끌어오고 오류 및 경고를 검색해야 했습니다. 이 블로그 게시물의 단계에 따라 데이터 동기화 사용자가 데이터 동기화 모니터링 환경을 크게 개선하는 사용자 지정 솔루션을 구성할 수 있습니다. 이 솔루션은 시나리오에 맞게 사용자 지정할 수 있고 사용자 지정되어야 합니다.</p>


  <h2>모든 동기화 그룹에 대한 모니터링 대시보드</h2>


  <p>사용자는 더 이상 문제를 찾기 위해 각 동기화 그룹의 로그를 개별적으로 수동으로 살펴볼 필요가 없습니다. 사용자는 사용자 지정 OMS 보기를 사용하여 한 곳에서 구독의 모든 동기화 그룹을 모니터링할 수 있습니다. 이 보기를 사용하면 사용자는 중요한 정보를 표시할 수 있습니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d938b741-2da5-4aeb-8666-bb965cb3d9b0.jpg"><img alt="Monitoring Dashboard" border="0" height="564" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d5eae062-26d8-40a4-a59f-c4e4576a00c7.jpg" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" title="모니터링 대시보드" width="1089"></a></p>


  <h2>자동화된 전자 메일 알림</h2>


  <p>사용자는 더 이상 Azure Portal 또는 PowerShell/RestAPIs&rsquo;를 통해 로그를 수동으로 볼 필요가 없습니다. <a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-overview" target="_blank">OMS Log Analytics</a>를 활용하여 오류가 발생할 경우 해당 경고를 확인해야 하는 메일로 직접 이동하는 경고를 만들 수 있습니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3dd943e8-f97c-4fc3-9a2a-e9b7904cf785.jpg"><img alt="Data sync error" border="0" height="362" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1752d6b6-1b93-45de-a54e-4349ee1606fe.jpg" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="데이터 동기화 오류" width="1254"></a></p>


  <h2>모니터링을 설정하는 방법</h2>


  <p>아래 단계에 따라 지정된 샘플을 최소한으로 변경하여 사용자 지정 데이터 동기화 OMS 모니터링 솔루션을 1시간 이내에 구현할 수 있습니다.</p>


  <p>&rsquo;다음 세 가지 구성 요소를 구성해야 합니다.</p>


  <ul>
   <li>OMS에 데이터 동기화 로그 데이터를 공급하는 PowerShell Runbook</li>
   <li>이메일 알림에 대한 OMS Log Analytics 경고</li>
   <li>모니터링을 위한 OMS 보기</li>
  </ul>


  <p>2개의 샘플을 다운로드합니다.</p>


  <ul>
   <li><a href="https://github.com/Microsoft/sql-server-samples/blob/master/samples/features/sql-data-sync/DataSyncLogPowerShellRunbook.ps1">데이터 동기화 로그 PowerShell Runbook</a></li>
   <li><a href="https://github.com/Microsoft/sql-server-samples/blob/master/samples/features/sql-data-sync/DataSyncLogOmsView.omsview">데이터 동기화 로그 OMS 보기</a></li>
  </ul>


  <p>필수 조건:</p>


  <ul>
   <li>Azure Automation 계정</li>
   <li>OMS 작업 영역과 연결된 Log Analytics</li>
  </ul>


  <h2>데이터 동기화 로그를 가져오는 PowerShell Runbook</h2>


  <p>Azure Automation에서 호스트되는 PowerShell Runbook을 사용하여 데이터 동기화 로그 데이터를 끌어와 OMS로 보냅니다. 샘플 스크립트가 포함되어 있습니다. 필수 구성 요소로 Azure Automation 계정이 있어야 합니다. Runbook을 만들고 실행 일정을 만들어야 합니다.</p>


  <p><a href="https://docs.microsoft.com/en-us/azure/automation/automation-first-runbook-textual-powershell">Runbook을</a> 만들려면 다음을 수행합니다.</p>


  <ol>
   <li>Azure Automation 계정 아래에서 프로세스 자동화 아래의 <strong>Runbook 탭</strong> 을 클릭합니다.</li>
   <li>Runbook 블레이드의 왼쪽 위 모서리에 있는 <strong>Runbook 추가</strong> 를 클릭합니다.</li>
   <li><strong>기존 Runbook 가져오기를</strong> 클릭합니다.</li>
   <li><strong>Runbook 파일</strong>에서 지정된 &ldquo;DataSyncLogPowerShellRunbook&rdquo; 파일을 사용합니다. <strong>Runbook 형식</strong>을 PowerShell&rdquo;로 &ldquo;설정합니다. 원하는 이름을 사용할 수 있습니다.</li>
   <li><strong>만들기</strong>를 클릭합니다. 이제 Runbook이 있습니다.</li>
   <li>Azure Automation 계정 아래에서 공유 리소스 아래 <strong>의 변수</strong> 탭을 클릭합니다.</li>
   <li>변수 블레이드의 왼쪽 위에 있는 변수 <strong>추가</strong> 를 클릭합니다. Runbook의 마지막 실행 시간을 저장하는 변수를 만들어야 합니다. Runbook이 여러 개 있는 경우&#39;각각 하나의 변수가 필요합니다.</li>
   <li>이름을 DataSyncLogLastUpdatedTime&rdquo;으로 &ldquo;설정하고 DateTime으로 입력합니다.</li>
   <li>Runbook을 선택하고 블레이드 맨 위에 있는 편집 단추를 클릭합니다.</li>
   <li>필요한 변경(스크립트의 세부 정보) <ul>
    <li>Azure 정보</li>
    <li>동기화 그룹 정보</li>
    <li><a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-data-collector-api" target="_blank">OMS 정보(OMS</a> 포털에서 이 정보 찾기 -&gt; 설정 -&gt; 연결된 원본)</li>
   </ul>
   </li>
   <li>테스트 창에서 Runbook을 실행하고 성공적인지&rsquo; 확인합니다.
   <ul>
    <li>참고: 오류가 있는 경우 최신 PowerShell 모듈이 설치되어 있는지 확인합니다. [Automation] 계정의 <strong>모듈 갤러리</strong>에서 이 작업을 수행할 수 있습니다.</li>
   </ul>
   </li>
   <li><strong>게시</strong>를 클릭합니다.</li>
  </ol>


  <p>Runbook 일정을 예약하려면 다음을 수행합니다.</p>


  <ol>
   <li>Runbook에서 리소스 아래의 <strong>일정</strong> 탭을 클릭합니다.</li>
   <li>일정 블레이드에서 <strong>일정 추가</strong> 를 클릭합니다.</li>
   <li><strong>Runbook에 일정 연결을</strong> 클릭합니다.</li>
   <li><strong>새 일정 만들기를</strong> 클릭합니다.</li>
   <li><strong>되풀이</strong>를 되풀이로 설정하고 원하는&rsquo; 간격을 설정합니다. 여기서 스크립트 및 OMS에서 동일한 간격을 사용해야 합니다.</li>
   <li><strong>만들기</strong></li>
  </ol>


  <p>자동화가 실행 중인지 모니터링하려면 다음을 수행합니다.</p>


  <ol>
   <li>Automation 계정에 대한 <strong>개요</strong> 아래에서 <strong>모니터링</strong>에서 <strong>작업 통계</strong> 보기를 찾습니다. 이 보기를 쉽게 볼 수 있도록 대시보드에 고정합니다.</li>
   <li>Runbook의 성공적인 실행은 완료됨&rdquo;으로 &ldquo;표시되고 실패한 실행은 실패&rdquo;로 &ldquo;표시됩니다.</li>
  </ol>


  <h2>전자 메일 알림에 대한 OMS 로그 판독기 경고</h2>


  <p>OMS Log Analytics를 사용하여 경고를 만듭니다. 필수 구성 요소로 OMS 작업 영역과 연결된 Log Analytics가 있어야 합니다.</p>


  <ol>
   <li>OMS 포털에서 왼쪽 위 방향으로 <strong>로그 검색</strong> 을 클릭합니다.</li>
   <li>사용 중인 간격 내에서 동기화 그룹별로 오류 및 경고를 선택하는 쿼리를 만듭니다.
   <ul>
    <li>Type=DataSyncLog_CL LogLevel_s!=Success| 측정값 개수() by SyncGroupName_s interval 60minute</li>
   </ul>
   </li>
   <li>쿼리를 실행한 후 <strong>경고</strong>라는 종을 클릭합니다.</li>
   <li>선택 <strong>메트릭 측정</strong><strong>값을 기반으로</strong> <strong>경고 생성</strong>에서
   <ul>
    <li>[집계 값]을 <strong>다음 값보다 큼</strong>으로 설정합니다.</li>
    <li>초과한 후에는 알림을 받기 전에 설정하려는 임계값&rsquo;을 사용합니다.</li>
    <li>일시적인 오류는 데이터 동기화 필요합니다. 노이즈를 줄이려면 임계값을 5로 설정하는 것이 좋습니다.</li>
   </ul>
   </li>
   <li><strong>작업</strong>에서 <strong>전자 메일 알림을</strong> &ldquo;예로&rdquo; 설정합니다. 원하는 받는 사람을 입력합니다.</li>
   <li><strong>저장</strong>을 클릭합니다. 이제 오류에 따라 전자 메일 알림을 받게 됩니다.</li>
  </ol>


  <h2>모니터링을 위한 OMS 보기</h2>


  <p>모든 동기화 그룹을 시각적으로 모니터링하는 OMS 보기를 만듭니다. 보기에는 다음과 같은 몇 가지 주요 구성 요소가 포함됩니다.</p>


  <ul>
   <li>개요 타일은 모든 동기화 그룹에 있는 오류, 성공 및 경고 수를 보여 줍니다.</li>
   <li>동기화 그룹이 있는 동기화 그룹당 오류 및 경고의 양을 보여 주는 모든 동기화 그룹의 타일입니다. 문제가 없는 그룹은 표시되지 않습니다.</li>
   <li>숫자 오류, 성공, 경고 및 최근 오류 메시지를 표시하는 각 동기화 그룹의 타일입니다.</li>
  </ul>


  <p>보기를 구성하려면 다음을 수행합니다.</p>


  <ol>
   <li>OMS 홈페이지에서 왼쪽에 있는 더하기(plus)를 클릭하여 <strong>뷰 디자이너</strong>를 엽니다.</li>
   <li>뷰 디자이너의 위쪽 표시줄에서 <strong>가져오기</strong>를 클릭하고 DataSyncLogOMSView&rdquo; 파일을 선택합니다&ldquo;.</li>
   <li>지정된 보기는 2개의 동기화 그룹을 관리하기 위한 샘플입니다. 사례에 맞게 편집할 수 있습니다. <strong>편집</strong>을 클릭하고 다음을 변경합니다.
   <ul>
    <li>필요에 따라 갤러리에서 새 &ldquo;도넛 &amp; 목록&rdquo; 개체를 만듭니다.</li>
    <li>각 타일에서 쿼리를 정보로 업데이트합니다.&nbsp; <ul>
     <li>모든 타일에서 원하는 대로 TimeStamp_t 간격을 변경합니다.</li>
     <li>동기화 그룹 특정 타일에서 동기화 그룹 이름을 업데이트합니다.</li>
    </ul>
    </li>
    <li>각 타일에서 필요에 따라 타이틀을 업데이트합니다.</li>
   </ul>
   </li>
   <li><strong>저장</strong>을 클릭하면 보기가 준비됩니다.</li>
  </ol>


  <h2>Cost</h2>


  <p>대부분의 경우 이 솔루션은 무료입니다.</p>


  <p><strong>Azure Automation:</strong> 사용량에 따라 Azure Automation 계정에 비용이 발생할 수 있습니다. 매월 처음 500분의 작업 실행 시간은 무료입니다. 대부분의 경우 이 솔루션에 500분 미만을 사용합니다. 요금이 청구되지 않도록 하려면 Runbook이 2시간 이상 간격으로 실행되도록 예약합니다.</p>


  <p><strong>OMS Log Analytics:</strong> 사용량에 따라 OMS와 관련된 <a href="https://azure.microsoft.com/en-us/pricing/details/log-analytics/" target="_blank">비용이</a> 발생할 수 있습니다. 체험 계층에서는 매일 500MB의 데이터를 수집할 수 있습니다. 대부분의 경우 이 솔루션에 충분합니다. 사용량을 줄이려면 Runbook에 포함된 오류 필터링만 사용합니다. 하루에 500MB 이상을 사용하는 경우 분석이 제한에 도달하는 것을 방지하기 위해 유료 계층으로 업그레이드합니다.</p>


  <h2>코드 샘플</h2>


  <ul>
   <li><a href="https://github.com/Microsoft/sql-server-samples/blob/master/samples/features/sql-data-sync/DataSyncLogPowerShellRunbook.ps1" target="_blank">데이터 동기화 로그 PowerShell Runbook</a></li>
   <li><a href="https://github.com/Microsoft/sql-server-samples/blob/master/samples/features/sql-data-sync/DataSyncLogOmsView.omsview" target="_blank">데이터 동기화 로그 OMS 보기</a></li>
  </ul>
