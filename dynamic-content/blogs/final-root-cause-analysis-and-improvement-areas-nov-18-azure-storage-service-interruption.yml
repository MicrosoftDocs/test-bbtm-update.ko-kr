### YamlMime:Yaml
ms.openlocfilehash: ab4d53fd85be4f58e835d71c7ca175d9276ced1b
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139911061"
Slug: final-root-cause-analysis-and-improvement-areas-nov-18-azure-storage-service-interruption
Title: '최종 근본 원인 분석 및 개선 영역: 11월 18일 Azure Storage 서비스 중단'
Summary: 2014년 11월 18일, 많은 Microsoft Azure 고객이 Azure Storage 및 Virtual Machines를 포함한 여러 다른 서비스에 영향을 주는 서비스 중단을 경험했습니다.
Content: >-
  2014년 11월 18일, 많은 Microsoft Azure 고객이 Azure Storage 및 Virtual Machines를 포함한 여러 다른 서비스에 영향을 주는 서비스 중단을 경험했습니다. 인시던트가 발생한 후 고객이 문제를 해결하기 위해 어떻게 노력하고 있는지 이해할 수 있도록 예비 RCA(근본 원인 분석)를 설명하는 <a href="https://azure.microsoft.com/blog/2014/11/19/update-on-azure-storage-service-interruption/">블로그</a> 를 게시했습니다. 그 이후로, 우리의 가장 높은 우선 순위는 적극적으로 조사하고이 사건을 완화하고있다. 오늘, 우리는 우리의 최종 RCA를 공유하고 있습니다, 이는 우리가 다시 일어나는이 상황을 완화하기 위해 취한 단계의 포괄적 인 개요를 포함, 뿐만 아니라 우리가 우리의 통신 및 지원 응답을 개선하기 위해 취하고있는 단계. 이 서비스 중단이 애플리케이션 및 서비스에 미칠 수 있는 중대한 영향을 진심으로 사과하고 인정합니다. 우리는 고객이 Microsoft Azure 있는 신뢰에 감사드리며, 비즈니스가 지속적으로 개선되는 데 도움이 될 피드백에 대해 모든 분들께 개인적으로 감사드립니다.

  <h2>근본 원인 분석</h2>

  11월 18<sup>일</sup> [PST](11월 19<sup>일</sup> [UTC]) Microsoft Azure 서비스 중단으로 인해 여러 지역의 Azure Storage 서비스에 간헐적으로 연결 문제가 발생했습니다. 종속 서비스(주로 Azure Virtual Machines)는 Azure Storage 서비스와의 연결 손실로 인해 보조 영향을 경험했습니다.


  이 문서에서는 표준 스토리지 업데이트 프로세스를 설명하고, 해당 프로세스에서 벗어나 중단을 초래한 방법을 설명하고, 일부 고객이 겪는 보조 영향의 원인을 설명하고, 고객 커뮤니케이션 및 지원의 결함에 대해 설명하고, 유사한 중단의 재발을 방지하고 통신 및 지원 응답을 개선하기 위해 수행하는 단계의 요약으로 마무리합니다.

  <h2>Microsoft Azure Storage 배포</h2>

  소프트웨어 배포(예: 코드 게시) 및 구성 배포(예: 설정 변경)의 두 가지 유형의 Azure Storage 배포가 있습니다. 소프트웨어 및 구성 배포는 모두 여러 단계의 유효성 검사가 필요하며, 작은 일괄 처리로 Azure 인프라에 증분 방식으로 배포됩니다. 이 점진적 배포 접근 방식을 '플라이팅'이라고 합니다. 플라이트가 진행 중인 경우 상태 검사를 면밀히 모니터링합니다. 지속적인 사용 및 테스트가 성공적인 결과를 보여 주므로 Azure Storage 인프라 전반의 추가 조각에 변경 사항을 배포합니다.


  일반적인 배포 프로세스는 다음과 같습니다.

  <ol>
      <li>먼저 테스트를 수행하고 유효성을 검사하는 내부 테스트 환경에 업데이트를 배포합니다.</li>
      <li>테스트 환경 유효성 검사가 통과되면 프로덕션 수준 워크로드를 실행하는 사전 프로덕션 환경에 업데이트를 배포합니다.</li>
      <li>사전 프로덕션 환경에서 유효성을 검사한 후 프로덕션 인프라의 작은 조각에 업데이트를 배포합니다.</li>
      <li>각 조각에 대한 유효성 검사를 완료한 후 업데이트를 증분 방식으로 더 큰 조각으로 플라이트합니다. 이러한 업데이트를 플라이팅할 때 조각은 지리적으로 격리되도록 선택되므로 노출될 수 있는 새로운 문제는 쌍을 이루는 지역 집합(예: 서유럽 및 북유럽)의 한 지역에만 영향을 줍니다.</li>
  </ol>

  <h2>Storage 인시던트 개요</h2>

  우리는 지속적으로 플랫폼의 모든 측면의 성능을 향상시킬 수있는 방법을 찾고 있습니다. 이 경우 Azure Storage 테이블 프런트 엔드의 CPU 공간을 줄여 Azure Storage 성능을 향상시키는 소프트웨어 변경을 개발했습니다.


  구성 스위치를 사용하여 기본적으로 사용하지 않도록 설정된 새 코드와 함께 설명된 플라이팅 방법을 사용하여 소프트웨어 변경을 배포했습니다. 이후 테스트 및 사전 프로덕션 환경 내에서 구성 스위치를 사용하여 Azure Table Storage Front-Ends 대한 코드를 사용하도록 설정했습니다. 상태 검사를 성공적으로 통과한 후 프로덕션 환경의 하위 집합에 대한 변경을 사용하도록 설정하고 몇 주 동안 테스트했습니다.


  테스트하는 동안 수정 사항은 주목할 만한 성능 향상을 보여주었으며 Azure Table Storage 성능과 관련된 몇 가지 알려진 고객 문제를 해결했습니다. 향상된 기능으로 인해 프로덕션 환경에서 수정 사항을 광범위하게 배포하기로 결정했습니다. 이 배포 중에는 두 가지 운영 오류가 발생했습니다.


  1. 작은 조각에 변경 내용을 증분 방식으로 배포하는 표준 플라이팅 배포 정책은 따르지 않았습니다.


  Azure Table Storage 성능 문제를 해결하는 엔지니어는 변경 내용이 이미 몇 주 동안 프로덕션 인프라의 일부에서 플라이트되었기 때문에 인프라 전반에서 이를 가능하게 하는 것은 낮은 위험이라고 믿었습니다. 아쉽게도 구성 도구는 인프라 전반에 걸쳐 변경 사항을 증분 방식으로 배포하는 이 정책을 적절하게 적용하지 못했습니다.


  2. Azure Table Storage 프런트 엔드에 대해 테스트 및 사전 프로덕션의 유효성 검사가 수행되었지만 Azure Blob Storage 프런트 엔드에 대해 구성 스위치가 잘못 사용하도록 설정되었습니다.


  Azure Blob Storage Front-Ends 이 변경을 사용하도록 설정하면 일부 Azure Blob Storage Front-Ends 무한 루프를 입력하고 요청을 처리할 수 없는 버그가 노출되었습니다.


  자동화된 모니터링 경고는 인시던트 발생 후 몇 분 이내에 엔지니어링 팀에 알렸습니다. 많은 Azure Blob Storage Front-Ends 문제가 발생하지 않도록 보호하는 문제가 시작된 후 30분 이내에 변경 사항을 전역적으로 되돌려 했습니다. 이미 무한 루프를 입력한 Azure Blob Storage Front-Ends 무한 루프로 인해 구성 변경 내용을 수락할 수 없습니다. 이렇게 하려면 구성 변경 내용을 되돌려 복구할 시간을 연장한 후 다시 시작해야 했습니다.

  <h2>배포 정책 적용</h2>

  문제가 검색된 후 핵심 배포 도구의 간격을 검사하기 위해 모든 구성 변경 내용이 즉시 중단되었습니다.분석이 완료된 후 코드 또는 구성에 관계없이 표준 업데이트에 대해 위의 테스트 및 플라이팅 정책을 준수하도록 배포 시스템 도구에 대한 업데이트를 릴리스했습니다.


  요약하자면, Microsoft Azure 명확한 운영 지침을 가지고 있었지만, 사람의 결정과 프로토콜에 의존하는 배포 도구에는 차이가 있었습니다. 도구 업데이트를 사용하면 이제 배포 플랫폼 자체에 의해 정책이 적용됩니다.

  <h2>Virtual Machines에 대한 보조 서비스 중단</h2>

  Azure Compute의 자동화된 복구 메커니즘으로 인해 Azure Storage 서비스 중단이 해결된 후 수동 개입 없이 거의 모든 Virtual Machine이 복구되었습니다. 그러나 성공적으로 시작되지 않았거나 RDP, SSH 또는 기타 공용 엔드포인트를 통해 액세스할 수 없으므로 수동 복구가 필요한 Virtual Machines의 하위 집합을 확인했습니다. 기본 문제는 다음 세 가지 범주로 분류되었습니다.


  <b>1. <strong>디스크 탑재 시간 제한</strong></b>


  복구하는 동안 서비스가 중단에서 복구되는 동안 Storage Service의 높은 부하로 인해 부팅 프로세스 중에 VM 집합에 디스크 탑재 시간 초과 오류가 발생했습니다. 이러한 고객은 Azure 문제 해결 지원 <a href="https://blogs.msdn.com/b/mast/archive/2014/11/20/recovering-azure-vm-by-attaching-os-disk-to-another-azure-vm.aspx">블로그</a>에 게시한 단계에 따라 VM의 차단을 해제할 수 있습니다. 대부분의 VM에서 필요한 복구 단계는 중단이 완전히 해결되면 Azure Storage 서비스의 부하가 정상 수준으로 감소한다는 점을 감안하여 Virtual Machine을 다시 부팅하는 것이었습니다.


  <b>2. <strong>Storage</strong></b> Service 중단 중에 프로비전되고 생성된 VM이 설치 Windows Virtual Machines에서 실패하여 Windows 설치를 완료하지 못했습니다. 이러한 Virtual Machines는 VM 프로비전 단계를 반복하여 다시 생성되었습니다. Linux Virtual Machines는 영향을 받지 않았습니다.


  <b>3. 네트워크 프로그래밍 오류</b>


  Virtual Network에 배포된 Virtual Machines 중 일부만 공용 IP 주소 엔드포인트를 통해 연결할 수 없습니다. 여기에는 이러한 VM에 대한 RDP 및 SSH 연결이 포함되었습니다. 스토리지 중단 중 특정 조건으로 인해 Storage 중단 후 네트워크를 다시 프로그래밍하지 못했습니다. 몇 시간 내에 다시 부팅할 필요 없이 영향을 받는 Virtual Machines에 서비스를 복원하는 완화 방법을 배포했습니다.

  <h2>중단 이벤트 타임라인 [UTC]</h2>

  <ul>
      <li><b>11/19 오전 00:50</b> – 다중 지역 Storage 서비스 중단 이벤트가 감지됨</li>
      <li><b>11/19 오전 00:51 - 오전</b> - 05:50 주 다중 지역 Storage 영향 대부분의 고객은 이 기간 동안 영향과 복구를 경험했을 것입니다.</li>
      <li><b>11/19 오전 05:51 - 오전</b>  - 11:00 Storage 작은 고객 하위 집합으로 격리된 영향</li>
      <li><b>11/19 오전</b>  - 10:50 Storage 영향이 완전히 해결되고 기본 Storage 서비스 중단 이벤트로 인한 Virtual Machines의 작은 하위 집합에 대한 지속적인 영향을 식별했습니다.</li>
      <li><b>11/19 오전 11:00</b> – Azure Engineering은 지속적인 플랫폼 자동화를 실행하여 영향을 받은 나머지 Virtual Machines를 검색하고 복구했습니다.</li>
      <li><b>오전 11/21 11:00</b> – Azure 환경에서 자동화된 복구가 완료되었습니다. Azure 팀은 후속 질문 또는 지원 요청이 있는 모든 고객이 계속 사용할 수 있습니다.</li>
  </ul>

  <h2>고객 커뮤니케이션 및 지원 문제</h2>

  위에서 설명한 서비스 중단 외에도 인시던트 중에 고품질 통신 및 지원을 제공하지 않았습니다. 우리는 다음 세 가지 영역에서 부족했습니다.


  1) <a href="https://azure.microsoft.com/en-us/status/">서비스 상태 대시보드</a>에 게시된 상태 정보의 지연 및 오류입니다.


  2) 통신 채널이 부족합니다(트윗, 블로그, 포럼).


  3) Microsoft 지원의 느린 응답입니다.

  <h2>Service Health 대시보드 초기 게시 지연 및 오류</h2>

  서비스 상태 대시보드에는 상태를 업데이트하는 데 사용되는 게시 도구뿐만 아니라 웹 구성 요소가 있습니다.웹 구성 요소에는 필요한 경우 장애 조치(failover)를 사용하도록 설정하는 기본 배포와 보조 배포가 모두 있습니다. Storage 중단으로 인해 보조 웹 구성 요소로 장애 조치(failover)한 경우 게시 도구가 주 서버에서 보조 스토리지 위치로 성공적으로 마이그레이션할 수 없었습니다. 결과적으로 업데이트된 상태 게시가 지연되어 전체 플랫폼 상태에 대한 초기 혼란이 발생했습니다.


  데이터 불일치 문제를 해결한 후 Service Health 대시보드에 명확성이 부족한 세 가지 추가 문제가 있었습니다.


  1) 대시보드 헤더의 버그로 인해 대시보드에 활성 권고가 있음에도 불구하고 페이지 맨 위에 'All Good'이 부정확하게 나열되었습니다. 이 잘못된 상태를 수정하기 위해 인시던트 중에 업데이트가 배포되었습니다.


  2) 서비스 그리드는 모든 개별 Azure 서비스의 상태를 정확하게 반영하지 않았습니다. 서비스 영향 세부 정보는 요약 게시물에서만 설명되었으며 표에는 설명되어 있지 않습니다.


  3) Virtual Machines에 영향을 미치는 보조 문제를 보고할 때 서비스 상태 대시보드는 하위 지역 하위 집합에만 미치는 영향을 잘못 발표했습니다. 서비스 상태 대시보드는 나중에 영향의 전체 범위를 반영하도록 업데이트되었습니다.

  <h2>통신 채널 부족(트윗, 블로그, 포럼)</h2>

  서비스 상태 대시보드는 상태 정보의 기본 원본입니다.위에서 설명한 문제 때문에 서비스 중단과 관련된 계정의 트윗 @Azure 이 전송되어 진행 중인 문제를 인정했습니다.그러나 이러한 트윗에는 고객에게 현재 상태와 인시던트 해결을 위해 수행되는 조치를 알리는 적절한 빈도와 실체가 부족했습니다. 또한 서비스 중단에 대한 지속적인 업데이트를 제공하기 위해 Azure 블로그에 시기 적절한 업데이트를 게시하지 않았습니다.

  <h2>Microsoft 지원의 지연된 응답 시간</h2>

  서비스 상태 대시보드 오류의 연속적인 효과는 Microsoft 지원 에코시스템에도 영향을 줍니다. 서비스 상태 대시보드가 정확한 상태를 보고하지 않았기 때문에 지원 호출 볼륨이 평소보다 훨씬 높았습니다. 인시던트의 영향을 받은 고객은 서비스에 대한 정확한 정보를 찾을 수 없으며 Microsoft 지원에 의존했습니다. 아쉽게도 고객 지원 볼륨이 높기 때문에 고객 하위 집합에서 지원 문의에 대한 응답 시간이 지연되었습니다. 이러한 문제를 해결하기 위해 Azure 엔지니어링 팀은 고객이 서비스를 복구할 수 있도록 직접 고객 참여를 제공하여 Azure 지원 팀을 지원했습니다.

  <h2>향상 된 기능</h2>

  Azure Platform을 사용하여 환경을 개선하기 위해 최선을 다하고 있으며 다음과 같은 개선 작업을 수행하고 있습니다.

  <h2>Storage 서비스 중단:</h2>

  배포 도구가 증분 일괄 처리에서 표준 프로덕션 변경 내용을 적용하는 배포 프로토콜을 적용하는지 확인합니다.

  <h2>Virtual Machine 서비스 중단:</h2>

  <ul>
      <li>Windows 및 Linux VM에 대한 "느린 부팅" 시나리오에 대한 복원력 및 복구를 개선합니다.</li>
      <li>스토리지 인시던트로 인한 Windows 설치 프로비저닝 실패에서 검색 및 복구를 개선합니다.</li>
      <li>고객의 하위 집합에 대한 네트워킹 프로그래밍 오류를 발생시킨 네트워킹 서비스 수정</li>
  </ul>

  <h2>통신:</h2>

  <ul>
      <li>잘못된 헤더 상태를 초래한 서비스 상태 대시보드의 잘못된 구성을 수정합니다.</li>
      <li>여러 메커니즘을 사용하여 상태를 효과적으로 전달하기 위한 새로운 소셜 미디어 통신 절차를 구현합니다.</li>
      <li>서비스 상태 대시보드 및 제작 도구의 복원력을 향상시킵니다.</li>
  </ul>

  <h2>지원:</h2>

  <ul>
      <li>Microsoft 지원 자동화 도구 및 인프라의 복원력 향상</li>
  </ul>
