### YamlMime:Yaml
ms.openlocfilehash: 9d6d3cccda5a4b0db83b879c92bc9386be538b1b
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139912818"
Slug: how-to-make-token-authorized-aes-encrypted-hls-stream-working-in-safari
Title: Safari에서 토큰 인증 AES 암호화 HLS 스트림이 작동하도록 하는 방법
Summary: Azure Media Services 고객이 AES 키 검색에 구성된 토큰 권한 부여를 사용하여 AES 암호화된 HLS 스트림을 생성하는 기능을 제공합니다.
Content: "<p>Azure Media Services 고객이 <a href=\"https://azure.microsoft.com/blog/2015/01/29/azure-media-services-enhances-streaming-security-with-general-availability-of-drm-technology/\" target=\"_blank\">AES 키 검색에 구성된 토큰 권한 부여를 사용하여 AES 암호화된 HLS 스트림을 생성하는</a> 기능을 제공합니다. 그러나 알고 있듯이 Safari는 네이티브 스택 내에서 HLS 재생 목록 및 키 검색을 처리하며 개발자가 키 요청을 가로채 토큰을 2단계 HLS 재생 목록에 추가하는 쉬운 방법은 없습니다. 인증 모듈에서 이 작업을 수행하는 경우 제안된 솔루션은 다음과 같습니다. 다음은 이 솔루션의 작동 방식을 보여 주는 다이어그램입니다. <img alt=\"\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/architecture_thumb.png\" style=\"padding-top: 0px; padding-left: 0px; padding-right: 0px; border-width: 0px; width: 640px; height: 247px;\" title=\"\"></p>\n\n<h2>각 단계에 대한 설명:</h2>\n\n<p>1. 고객이 비디오 ID를 사용하여 인증 시스템에 요청을 보냅니다. 비디오 ID와 실제 스트리밍 URL 간에 몇 가지 매핑이 있어야 합니다. 2. 인증 시스템은 사용자를 인증하고 비디오 스트리밍 URL을 사용하여 Azure Media Services 상위 재생 목록을 요청합니다. 스트리밍 URL이 다음과 같다고 가정해 보겠습니다&rsquo;<a href=\"(format=m3u8-aapl\">( format=m3u8-aapl</a>). 3. Azure Media Services 상위 재생 목록을 인증 시스템에 반환합니다. 상위 재생 목록은 다음과 같습니다.</p>\n\n<pre class=\"prettyprint\">\n#EXTM3U \n#EXT-X-VERSION:4 \n#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID=&quot;audio&quot;,NAME=&quot;AAC_und_ch2_96kbps&quot;,URI=&quot;QualityLevels(92405)/Manifest(AAC_und_ch2_96kbps,format=m3u8-aapl)&quot; \n#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID=&quot;audio&quot;,NAME=&quot;AAC_und_ch2_56kbps&quot;,DEFAULT=YES,URI=&quot;QualityLevels(53017)/Manifest(AAC_und_ch2_56kbps,format=m3u8-aapl)&quot;\n#EXT-X-STREAM-INF:BANDWIDTH=1092766,RESOLUTION=384x288,CODECS=&quot;avc1.4d4015,mp4a.40.2&quot;,AUDIO=&quot;audio&quot;\nQualityLevels(960870)/Manifest(video,format=m3u8-aapl)\n#EXT-X-STREAM-INF:BANDWIDTH=1607960,RESOLUTION=480x360,CODECS=&quot;avc1.4d401e,mp4a.40.2&quot;,AUDIO=&quot;audio&quot;\nQualityLevels(1464974)/Manifest(video,format=m3u8-aapl)\n#EXT-X-STREAM-INF:BANDWIDTH=62343,CODECS=&quot;mp4a.40.2&quot;,AUDIO=&quot;audio&quot;\nQualityLevels(53017)/Manifest(AAC_und_ch2_56kbps,format=m3u8-aapl) \n</pre>\n\n<p>4. 상위 재생 목록을 수정하여 플레이어(이 경우 Safari)가 키 서비스 대신 프록시 서버를 직접 ping하고 재생 목록에 토큰을 추가합니다. 인증 시스템에는 토큰을 작성하는 방법에 대한 지식이 있지만 프록시 서버는 작성하지 않습니다&rsquo;. 상위 재생 목록을 수정하는 방법은 다음과 같습니다.</p>\n\n<pre class=\"prettyprint\">\n#EXTM3U\n#EXT-X-VERSION:4\n#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID=&quot;audio&quot;,NAME=&quot;AAC_und_ch2_56kbps&quot;,URI=&quot;https://test.cloudvideo.azure-int.net/api/ManifestProxy?playbackUrl=(53017)/Manifest(AAC_und_ch2_56kbps,format=m3u8-aapl)&amp;token=[PUT_YOUR_TOKEN_HERE]&quot;\n#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID=&quot;audio&quot;,NAME=&quot;AAC_und_ch2_96kbps&quot;,DEFAULT=YES,URI=&quot;https://proxy.cloudvideo.azure-int.net/api/ManifestProxy?playbackUrl=(92405)/Manifest(AAC_und_ch2_96kbps,format=m3u8-aapl)&amp;token=[PUT_YOUR_TOKEN_HERE]&quot;\n#EXT-X-STREAM-INF:BANDWIDTH=1092766,RESOLUTION=384x288,CODECS=&quot;avc1.4d4015,mp4a.40.2&quot;,AUDIO=&quot;audio&quot;\nhttps://proxy.cloudvideo.azure-int.net/api/ManifestProxy?playbackUrl=(960870)/Manifest(video,format=m3u8-aapl)&amp;token=[PUT_YOUR_TOKEN_HERE]\n#EXT-X-STREAM-INF:BANDWIDTH=1607960,RESOLUTION=480x360,CODECS=&quot;avc1.4d401e,mp4a.40.2&quot;,AUDIO=&quot;audio&quot;\nhttps://proxy.cloudvideo.azure-int.net/api/ManifestProxy?playbackUrl=(1464974)/Manifest(video,format=m3u8-aapl)&amp;token=[PUT_YOUR_TOKEN_HERE]\n</pre>\n\n<p>위의 예제에서는 URI의 절대 경로를 입력해야 합니다(그렇지 않으면 요청이 인증 서버로 돌아갑니다.)</p>\n\n<ul>\n <li><a href=\"https://test.cloudvideo.azure-int.net/api/ManifestProxy?\" title=\"https://test.cloudvideo.azure-int.net/api/ManifestProxy?\">https://test.cloudvideo.azure-int.net/api/ManifestProxy?</a> 는 프록시 서버의 주소이고 ManifestProxy는 나중에 URI를 구문 분석하기 위한 매개 변수일 뿐입니다.</li>\n <li>PlaybackURL은 실제 스트리밍 URL입니다(그러나 이제 URL은 품질 수준이 추가된 두 번째 수준 매니페스트입니다.)</li>\n <li>토큰은 끝에 매개 변수로 추가됩니다. 키 서비스는 키 요청에서 토큰을 매개 변수로 수락합니다.</li>\n</ul>\n\n<p>5. 이제 Safari는 URI 매개 변수에 제공된 URL을 기반으로 요청을 보내&nbsp; 키 정보가 포함된 두 번째 수준 재생 목록을 검색합니다. 프록시 서버를 가리키도록 재생 목록을 변경했으므로 요청이 프록시 서버 6으로 전송됩니다. 프록시 서버는 두 번째 수준 재생 목록 요청을 받게 됩니다. 재생 목록에서 playbackUrl을 사용하여 원본 서버를 제거하고 <a href=\"https://test.cloudvideo.azure-int.net/api/ManifestProxy?\" title=\"https://test.cloudvideo.azure-int.net/api/ManifestProxy?https://test.cloudvideo.azure-int.net/api/ManifestProxy?\"></a> ping하여 실제 키 URL이 포함된 두 번째 재생 목록을 가져옵니다. 이 두 번째 수준 재생 목록 내에 토큰을 추가합니다. 따라서 반환된 재생 목록은 다음과 같습니다.</p>\n\n<pre class=\"prettyprint\">\n#EXTM3U\n#EXT-X-VERSION:4\n#EXT-X-ALLOW-CACHE:NO\n#EXT-X-MEDIA-SEQUENCE:0\n#EXT-X-TARGETDURATION:10\n#EXT-X-KEY:METHOD=AES-128,URI=&quot;https://test.keydelivery.mediaservices.windows.net/?kid=a99263cd-43b3-490a-a4d6-ea04d4645fb7&amp;token=[PUT_YOUR_Token]\n#EXT-X-PROGRAM-DATE-TIME:1970-01-01T00:00:00Z\n#EXTINF:3.947392,no-desc\n(92405)/Fragments(AAC_und_ch2_96kbps=0,format=m3u8-aapl)\n#EXT-X-ENDLIST\n</pre>\n\n<p>7. 이제 Safari는 #EXT-X-KEY:METHOD=AES-128,URI= 후 URI를 사용하여 키 요청을 키 서버에 보냅니다. 토큰이 매개 변수로 포함되므로 키 서비스는 요청에 권한을 부여하고 플레이어에게 AES 키를 제공할 수 있습니다. <a href=\"https://github.com/AzureMediaServicesSamples/HLSSafariProxy\" target=\"_blank\">여기서</a> 프록시 서버의 재생 목록을 수정하는 데 사용한 코드를 업로드하는 이 작업을&nbsp;&#39;여기에서 작업 <a href=\"https://mingfeiy.azurewebsites.net/\" target=\"_blank\">샘플 사이트를 볼</a> 수 있습니다.&nbsp; 질문이 있는 경우 자유롭게 연락해 주세요!</p>"
