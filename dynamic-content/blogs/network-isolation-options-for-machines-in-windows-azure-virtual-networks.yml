### YamlMime:Yaml
ms.openlocfilehash: 4b272db0ae0f5f861e2dfac2ffdb81e61b1987aa
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139912745"
Slug: network-isolation-options-for-machines-in-windows-azure-virtual-networks
Title: Microsoft Azure Virtual Network의 컴퓨터에 대한 네트워크 격리 옵션
Summary: 최근에 고객이 플랫폼의 기본 기능을 활용하여 가장 잘 보호할 수 있는 방법에 대한 인사이트를 제공하는 Windows 네트워크 보안 백서(여기에서 다운로드)를 게시했습니다.
Content: >-
  최근에 고객이 플랫폼의 네이티브 기능을 활용하여 정보 자산을 가장 잘 보호하는 방법에 대한 인사이트를 제공하는 Windows 네트워크 보안 백서(<a href="https://download.microsoft.com/download/4/3/9/43902EC9-410E-4875-8800-0788BE146A3D/Windows%20Azure%20Network%20Security%20Whitepaper%20-%20FINAL.docx">여기에서</a> 다운로드)를 게시했습니다.


  <strong>수석 컨설턴트인 Walter Myers</strong>의 이 게시물은 이 백서를 확장하고 네트워크 수준에서 Virtual Network 내에서 VM을 격리하는 방법을 설명합니다.

  <h6>소개</h6>

  엔터프라이즈 고객이 무단 또는 원치 않는 액세스로부터 다양한 환경을 보호하기 위해 노력하므로 애플리케이션 격리는 엔터프라이즈 환경에서 중요한 관심사입니다.여기에는 특정 백 엔드 네트워크 또는 하위 네트워크의 컴퓨터에서 특정 클라이언트 또는 다른 컴퓨터만 IP 주소 허용 목록에 따라 특정 엔드포인트에 연결할 수 있는 클래식 프런트 엔드 및 백 엔드 시나리오가 포함됩니다.이러한 시나리오는 클라이언트 애플리케이션이 인터넷, Azure 환경 내 또는 VPN 연결을 통해 온-프레미스에서 가상 머신 애플리케이션 서버에 액세스하는지 여부에 관계없이 Windows Azure에서 쉽게 구현할 수 있습니다.

  <h6>컴퓨터 격리 옵션</h6>

  이 문서에서는 Windows Azure 플랫폼에서 머신 격리를 구현할 수 있는 세 가지 기본 옵션을 설명합니다.

  <ol>
   <li>단일 가상 네트워크에 배포된 컴퓨터 간</li>
   <li>고유 가상 네트워크에 배포된 컴퓨터 간</li>
   <li>두 가상 네트워크를 사용하여 온-프레미스에서 VPN 연결이 설정된 고유한 가상 네트워크에 배포된 컴퓨터 간</li>
  </ol>

  이러한 옵션은 다음 섹션에서 자세히 설명합니다.


  기본적으로 갤러리에서 만든 Windows 서버 가상 머신에는 두 개의 공용 엔드포인트, 특히 RDP 및 원격 PowerShell 연결이 있습니다.관리자가 추가한 추가 엔드포인트를 제외하고 다른 공용 엔드포인트는 없습니다.관리자가 만든 이러한 엔드포인트 및 기타 엔드포인트는 지정된 IaaS 가상 머신에서 ACL(액세스 제어 목록)으로 보호될 수 있습니다.이 쓰기 ACL은 IaaS 가상 머신에 사용할 수 있지만 PaaS 웹 또는 작업자 역할에는 사용할 수 없습니다.

  <h6>네트워크 ACL 작동 방식</h6>

  ACL은 규칙 목록이 포함된 개체입니다. ACL을 만들고 가상 머신 엔드포인트에 적용하면 가상 머신의 호스트 노드에서 패킷 필터링이 발생합니다. 즉, 원격 IP 주소의 트래픽이 가상 머신 대신 ACL 규칙과 일치하기 위해 호스트 노드에 의해 필터링됩니다. 이렇게 하면 가상 머신이 패킷 필터링에 귀중한 CPU 주기를 소비하지 않습니다.


  가상 머신을 만들 경우 기본 ACL이 작동하여 들어오는 모든 트래픽을 차단합니다. 그러나 입력 엔드포인트(예: 포트 3389)가 만들어지면 해당 엔드포인트에 대한 모든 인바운드 트래픽을 허용하도록 기본 ACL이 수정됩니다.위에서 설명한 것처럼 Azure 갤러리에서 가상 머신을 만들 때 아래 포털에 표시된 것처럼 표준 프라이빗 포트를 사용하여 PowerShell 엔드포인트 및 RDP 엔드포인트가 생성되지만 임의로 생성된 공용 포트가 생성됩니다.그러면 원격 서브넷의 인바운드 트래픽이 해당 엔드포인트로 제한되며 방화벽 프로비저닝이 필요하지 않습니다. 해당 포트에 대해 엔드포인트를 만들지 않으면 다른 모든 포트가 인바운드 트래픽에 대해 차단됩니다. 기본적으로 아웃바운드 트래픽은 허용됩니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7462.Network-Isolation-Options--Img1.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7462.Network-Isolation-Options--Img1.png" border="0"></a>


  네트워크 ACL을 사용하여 다음을 수행할 수 있습니다.

  <ul>
   <li>가상 머신 입력 엔드포인트에 대한 원격 서브넷 IPv4 주소 범위에 따라 들어오는 트래픽을 선택적으로 허용하거나 거부합니다.</li>
   <li>IP 주소를 블랙리스트에 올립니다.</li>
   <li>가상 컴퓨터 엔드포인트별로 여러 규칙을 생성합니다.</li>
   <li>가상 컴퓨터 엔드포인트별로 최대 50개의 ACL 규칙을 지정합니다.</li>
   <li>올바른 규칙 집합이 지정된 가상 컴퓨터 엔드포인트에 적용될 수 있도록 규칙 순서를 사용합니다(가장 낮은 값에서 가장 높은 값의 순서로).</li>
   <li>특정 원격 서브넷 IPv4 주소에 대해 ACL을 지정합니다.</li>
  </ul>

  따라서 네트워크 ACL은 가상 머신 퍼블릭 엔드포인트를 보호하고 해당 유형의 액세스를 제어하는 데 핵심적인 요소입니다.현재 인터넷에서 각 가상 머신으로의 액세스를 제어할 수 있는 IaaS 가상 머신 입력 엔드포인트에 대한 네트워크 ACL을 지정할 수 있습니다.엔드포인트를 지정하지 않는 한 가상 네트워크의 가상 머신은 들어오는 트래픽을 받지 않으며 이는 가상 머신별로 재정의할 수 있는 네트워크 수준에서 기본 거부 ACL을 갖는 것과 같습니다.현재 가상 네트워크에 포함된 특정 서브넷에 ACL을 지정할 수 없으며, 향후 이를 검토하고 있습니다.

  <h6>옵션 1: 단일 가상 네트워크 내의 서브넷</h6>

  현재 Windows Azure는 단일 가상 네트워크 내의 서브넷 간에 라우팅을 제공하지만 내부 DIP 주소와 관련하여 어떤 유형의 네트워크 ACL 기능도 제공하지 않습니다.따라서 단일 가상 네트워크 내의 머신에 대한 액세스를 제한하려면 해당 컴퓨터는 아래 다이어그램에 설명된 것처럼 고급 보안으로 Windows 방화벽을 활용해야 합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6574.ashwin-VN.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6574.ashwin-VN.png" border="0"></a>


  서버를 보호하기 위해 모든 인바운드 연결을 차단하도록 Windows 방화벽을 구성할 수 있으며 인바운드 규칙은 다음을 결정하도록 설정됩니다.


  1) 어떤 로컬 포트가 연결을 허용할지,


  2) 연결이 허용되는 원격 포트


  3) 허용되는 원격 IP 주소


  4) 권한이 부여된 사용자가 연결할 수 있는 내용 및


  5) 권한 있는 컴퓨터가 연결할 수 있는 기능


  이 경우 방화벽 예외에는 자체 서브넷 내 및 가상 네트워크에 대해 구성된 다른 서브넷 간에 로컬 DIP(동적 IP) 주소가 포함됩니다.모든 공용 엔드포인트는 네트워크 ACL로 보호됩니다.방화벽 예외는 물론 네트워크 ACLS로 설정된 퍼블릭 엔드포인트에 대한 프라이빗 포트를 포함해야 합니다.

  <h6>옵션 2: 다른 가상 네트워크의 서브넷</h6>

  다른 Azure 가상 네트워크에 배포된 다른 컴퓨터 또는 가상 네트워크와 연결되지 않은 다른 Azure 클라우드 서비스의 컴퓨터 또는 Windows Azure 플랫폼 외부의 컴퓨터에서 가상 머신을 보호하기 위해 Windows Azure 네트워크 ACL 기능을 사용하여 가상 머신에 대한 액세스 제어를 제공합니다.기본적으로 가상 머신에서 허용되는 유일한 액세스는 기본 제공 RDP 및 원격 PowerShell 공용 엔드포인트이므로 애플리케이션 격리를 위해 Windows Azure에서 가장 자연스러운 시나리오입니다.다른 가상 네트워크의 다른 가상 머신에 액세스하려는 Azure 가상 머신(PaaS 또는 IaaS)의 경우 단일 가상 네트워크 내의 DIP 주소가 아닌 VIP(가상 IP) 주소로 간주됩니다.따라서 허용 ACL이 지정된 가상 머신 엔드포인트에 설정된 경우 ACL은 연결을 원하는 컴퓨터의 공용 VIP를 고려합니다.아래 다이어그램에서 이를 확인할 수 있습니다.


  "허용" 또는 "거부"를 지정하는 규칙을 만들어 가상 머신 입력 엔드포인트에 대한 네트워크 트래픽(관리 포털 또는 PowerShell에서)을 선택적으로 허용하거나 거부할 수 있습니다. 기본적으로 엔드포인트가 만들어지면 모든 트래픽이 엔드포인트에 허용됩니다.따라서 허용/거부 규칙을 만들고 적절한 우선 순위 순서로 배치하여 가상 머신 엔드포인트에 도달할 수 있도록 선택하는 네트워크 트래픽을 세부적으로 제어하는 방법을 이해하는 것이 중요합니다.즉시 하나 이상의 "허용" 범위를 추가하면 기본적으로 다른 모든 범위가 <em>거부</em> 됩니다. 첫 번째 허용 범위에서 앞으로 이동하면 허용된 IP 범위의 패킷 <em>만</em> 가상 머신 엔드포인트와 통신할 수 있습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8360.ashwin-subscription.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8360.ashwin-subscription.png" border="0"></a>


  따라서 동일한 클라우드 서비스에 두 개의 프런트 엔드 가상 머신과 SQL Server 있는 백 엔드 가상 머신 하나를 포함하는 예제에서 실제로 작동하는 방법을 살펴보겠습니다.이러한 두 프런트 엔드 머신만 액세스할 수 있도록 SQL Server 보호하려고 합니다.아래 스크린샷에는 <strong>canis-testvm1 및 canis-testvm2</strong>라는 두 개의 프런트 엔드 가상 머신이 포함된 공용 VIP 주소 168.62.207.83이 있는 <strong>canis-testvms</strong>라는 클라우드 서비스가 표시됩니다<strong></strong>.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6320.Network-Isolation-Options--Img2.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6320.Network-Isolation-Options--Img2.png" border="0"></a>


  아래 스크린샷에서는 <strong>프런트 엔드</strong> 서브넷에서 <strong>testvirtualnetwork</strong>라는 가상 네트워크에서 두 개의 프런트 엔드 컴퓨터인 <strong>canis-testvm1</strong> 및 <strong>canis-testvm2participating</strong>을 확인합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/5050.Network-Isolation-Options--Img3.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/5050.Network-Isolation-Options--Img3.png" border="0"></a>


  아래에는 백 엔드 SQL Server 컴퓨터의 스크린샷이 있습니다<strong>. sql12-01</strong>은 <strong>BackEndSubnet 서브넷</strong>의 <strong>waltervirtualnetwork</strong>라는 가상 네트워크에 참여합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2627.Network-Isolation-Options--Img4.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2627.Network-Isolation-Options--Img4.png" border="0"></a>


  이제 SQL Server 가상 머신에 대한 액세스를 구성해야 합니다.아래와 같이 가장 먼저 하는 일은 14333을 공용 포트로 사용하여 프라이빗 포트 1433에 대한 퍼블릭 엔드포인트를 설정하는 것입니다.위에서 설명한 것처럼 기본 ACL은 모든 원격 주소가 엔드포인트에 액세스할 수 있도록 허용하므로 네트워크 ACL을 사용하여 이 문제를 해결해야 합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6787.Network-Isolation-Options--Img5.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6787.Network-Isolation-Options--Img5.png" border="0"></a>


  다음으로 아래쪽에 있는 <strong>ACL 관리</strong> 단추를 선택하면 아래와 같이 <strong>엔드포인트 ACL 관리</strong> 대화 상자가 표시됩니다.추가한 첫 번째 ACL은 모든 원격 주소를 잠그는 "거부" 작업으로 기본 ACL을 재정의하는 ACL입니다.  그런 다음 프런트 엔드 머신이 포함된 클라우드 서비스의 VIP 주소를 지정하기 위해 다른 ACL을 더 높게 추가합니다.프런트 엔드 머신을 사용하여 클라우드 서비스가 나타내는 단일 IP 주소에 간단히 매핑되는 /32 네트워크(168.62.207.83/32)를 사용하여 CIDR 형식으로 입력합니다.SQL 서버의 관점에서 두 프런트 엔드 클라이언트에는 클라우드 서비스 내에서 NAT인 168.62.207.83 IP 주소가 있습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/1780.Network-Isolation-Options--Img6.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/1780.Network-Isolation-Options--Img6.png" border="0"></a>


  따라서 공용 VIP 주소를 사용하여 VPN 연결 없이 가상 네트워크에서 엔드포인트를 보호하거나 VPN 연결이 있지만 DIP 주소를 활용하기 위해 온-프레미스 라우터를 통해 라우팅하지 않으려는 경우 이렇게 합니다.VPN이 추가된 다음 옵션에서 DIP를 다룹니다.

  <h6>옵션 3: 서로 다른 가상 네트워크의 서브넷 + VPN</h6>

  VPN 연결이 관련된 경우 가상 네트워크의 기본 격리를 변경하지 않고 네트워크 연결에 대한 추가 옵션을 제공합니다.여기서는 이에 대한 구체적인 예를 살펴보겠습니다.이 시나리오에서 둘 이상의 가상 네트워크에 참여하는 온-프레미스 서브넷은 방화벽 규칙에 의해 차단되지 않은 경우 DIP 주소를 통해 두 가상 네트워크의 가상 머신에 대한 모든 권한을 갖습니다.따라서 여기서 시나리오에서는 서로의 주소 공간에 액세스해야 하는 온-프레미스 위치에서 두 개의 가상 네트워크가 종료됩니다.이 작업은 온-프레미스 라우터를 "스포크-스포크" 구성에서 허브로 구성하여 수행할 수 있습니다.라우터는 허브이고 "스포크"는 Azure 쪽에서 사이트-사이트 연결을 종료하는 VPN 디바이스입니다.


  스포크-스포크 구성이 작동하려면 먼저 Azure 쪽의 게이트웨이에서 지정된 가상 네트워크에 해당하는 로컬 네트워크를 구성해야 합니다. 그러면 가상 네트워크가 다른 가상 네트워크의 주소 공간에 액세스할 수 있습니다(물론 다른 주소 공간이어야 합니다).관리 포털의 로컬 네트워크 구성에서 아래에서 확인할 수 있습니다.각 로컬 네트워크에 대해 각 가상 네트워크에 액세스해야 하는 온-프레미스 192.168.1.0/24 로컬 네트워크 주소 공간이 있으며 액세스하려는 <em>다른</em> 가상 네트워크에 해당하는 각 가상 네트워크에 대해 추가 주소 공간이 추가됩니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/3036.Network-Isolation-Options--Img7.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/3036.Network-Isolation-Options--Img7.png" border="0"></a>


  다음으로 온-프레미스 VPN 디바이스(광산은 Cisco ASA 5505)를 구성해야 합니다. 기본적으로 한 가상 네트워크에서 다른 쪽의 액세스 목록을 기존 액세스 목록에 추가하는 문제입니다.예를 들어 로컬 온-프레미스 네트워크에 192.168.1.0/24 주소 공간이 있는 경우 가상 네트워크 중 하나에 10.5.0.0/16 주소 공간이 있는 경우 로컬 네트워크에서 가상 네트워크로의 액세스 목록 항목(일반적으로 이미 설정했을 것)과 10.5.0.0/16 가상 네트워크부터 10.4.0.0/16 가상 네트워크까지의 다른 액세스 목록 항목이 필요합니다.  아래와 같습니다.


  액세스 목록 AzureAccess 확장 허용 IP 192.168.1.0 255.255.255.0 10.4.0.0 255.255.0.0


  access-list AzureAccess 확장 허용 ip 10.5.0.0 255.255.0.0 10.4.0.0 255.255.0.0


  그런 다음 아래와 같이 10.5.0.0/16 가상 네트워크에 대해 동일한 작업을 수행하여 10.4.0.0/16 가상 네트워크에서 10.5.0.0/16 네트워크로 액세스 목록 항목을 만듭니다.


  access-list AzureAccess2 확장 허용 IP 192.168.1.0 255.255.255.0 10.5.0.0 255.255.0.0


  액세스 목록 AzureAccess2 확장 허용 IP 10.4.0.0 255.255.0.0 10.5.0.0 255.255.0.0


  다음 단계는 아래와 같이 이러한 두 "외부" 네트워크 간에 NAT를 설정하는 것입니다.


  개체 그룹 네트워크 VPN_OUT_AZ1


  network-object 10.4.0.0 255.255.0.0


  개체 그룹 네트워크 VPN_OUT_AZ2


  network-object 10.5.0.0 255.255.0.0


  nat(외부, 외부) 1개의 원본 정적 VPN_OUT_AZ1 VPN_OUT_AZ1 대상 정적 VPN_OUT_AZ2 VPN_OUT_AZ2 no-proxy-arp route-lookup


  따라서 각 가상 네트워크는 DIP 주소를 사용하여 VPN 게이트웨이를 통해 다른 가상 네트워크에 액세스할 수 있습니다(이제는 위의 <em>단일 가상 네트워크 시나리오 내의 서브넷 </em>과 동일함). 방화벽 규칙이 이를 방지하지 않는다고 가정합니다.네트워킹 트래픽이 허브를 통해 앞뒤로 이동하여 트랜잭션 비용 및 추가 대기 시간이 증가하므로 일부 사용자에게는 바람직한 시나리오가 아닐 수<em> 있지만 외부 엔드</em> 포인트를 노출하지 않으려는 조직에는 이러한 절충이 허용 가능한 절충이 될 수 있습니다.다른 사용자는 퍼블릭 엔드포인트를 사용하여 둘 이상의 가상 네트워크 간에 연결하고 IPsec 및 그룹 정책 개체를 사용하여 퍼블릭 엔드포인트를 더욱 안전하게 보호할 수 있습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4087.Ashwin-Subscription-_2800_2_2900_.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4087.Ashwin-Subscription-_2800_2_2900_.png" border="0"></a>

  <h6>Windows 방화벽/IPsec을 사용하여 엔드 투 엔드 네트워크 통신 보호</h6>

  IPsec 통합을 통해 고급 보안이 포함된 Windows 방화벽은 인증된 엔드 투 엔드 네트워크 통신을 적용하는 간단한 방법을 제공합니다. 이를 통해 신뢰할 수 있는 네트워크 리소스에 확장 가능한 계층 방식으로 액세스할 수 있으므로 데이터의 무결성을 쉽게 보장할 수 있고 데이터의 기밀을 유지하는 데도 도움이 됩니다.IPsec(인터넷 프로토콜 보안)은 암호화 보안 서비스를 사용하여 IP(인터넷 프로토콜) 네트워크를 통한 통신을 보호합니다.


  두 개의 가상 네트워크를 사용하는 아래 다이어그램의 예로, DIP 주소가 10.5.1.5인 컴퓨터가 고급 보안을 사용하는 Windows 방화벽 또는 PowerShell을 통해 구성될 수 있는 IPsec 인증서를 사용하여 온-프레미스 도메인에 가입되지 않은 것을 볼 수 있습니다.즉, 보호된 포트에 액세스하려는 모든 머신에도 IPsec 인증서가 필요합니다.또한 Windows 방화벽, PowerShell 스크립트 또는 그룹 정책을 통해 IPsec 연결을 요구하도록 구성할 수 있는 두 개의 도메인 가입 컴퓨터인 10.4.1.6 및 10.5.1.4가 있습니다.따라서 이러한 컴퓨터는 내부 DIP 주소를 통해 액세스하든 공용 VIP 주소를 통해 액세스하든 관계없이 완전히 보호될 수 있습니다.공용 VIP 주소의 경우 네트워크 ACL 기능을 활용하여 허용된 외부 IP 주소의 허용 목록을 만듭니다. 여기서 외부 클라이언트 머신에는 IPsec 인증서가 필요합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7558.ashwin-sbscription-_2800_3_2900_.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7558.ashwin-sbscription-_2800_3_2900_.png" border="0"></a>

  <h6>수동으로 단일 가상 머신에 IPsec 적용</h6>

  가상 네트워크 내의 가상 머신에 대한 최대 보호를 제공하기 위해 Windows 방화벽을 활성화하고 처음에 구성하여 모든 인바운드 연결을 차단할 수 있습니다.그런 다음 필요에 따라 포트를 열고 보안 연결을 적용하고 해당 연결을 암호화하기 위해 IPsec을 추가할 수 있습니다.Windows Server 2008 이상에서 IPsec을 수동으로 구성하려면 Windows 방화벽을 시작하고 인바운드 규칙 노드를 선택한 다음 아래와 같이 새 규칙을 만듭니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7853.Network-Isolation-Options--Img8.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7853.Network-Isolation-Options--Img8.png" border="0"></a>


  그런 다음 아래와 같이 IPsec을 사용하여 보호하려는 특정 포트를 선택할 수 있습니다.


  다음으로 원하는 포트에 대한 연결을 보호하도록 지정합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8420.Network-Isolation-Options--Img10.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8420.Network-Isolation-Options--Img10.png" border="0"></a>


  <strong>사용자 지정</strong>을 선택한 후... 단추, 아래와 같이 결과 대화 상자에서 IPsec 설정을 지정합니다.여기에서 마법사를 계속 진행하고 마지막으로 규칙에 이름을 지정합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4532.Network-Isolation-Options--Img10.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4532.Network-Isolation-Options--Img10.png" border="0"></a>


  <strong>사용자 지정</strong>을 선택한 후... 단추, 아래와 같이 결과 대화 상자에서 IPsec 설정을 지정합니다.여기에서 마법사를 계속 진행하고 마지막으로 규칙에 이름을 지정합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/0474.Network-Isolation-Options-Img11.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/0474.Network-Isolation-Options-Img11.png" border="0"></a>


  PowerShell을 사용하여 IPsec 구성을 스크립팅하려는 경우 <a href="https://technet.microsoft.com/en-us/library/hh831755.aspx">여기</a> 링크를 따라 자세히 알아볼 수 있습니다.

  <h6>도메인에서 그룹 정책을 사용하여 Virtual Machines에 대한 IPsec 정책 설정</h6>

  VPN 연결을 통해 온-프레미스 네트워크에 연결된 가상 네트워크의 경우 가상 네트워크의 컴퓨터가 온-프레미스 도메인에 가입할 수 있습니다.온-프레미스 도메인에 가입된 경우 IPsec 정책을 사용하여 그룹 정책을 적용하여 여러 컴퓨터를 구성하여 이러한 컴퓨터가 조직 정책에 따라 보호되도록 할 수 있습니다.<a href="https://technet.microsoft.com/en-us/library/cc730656.aspx">여기에서</a> 그룹 정책을 사용하여 IPsec 정책을 만드는 방법에 대해 자세히 알아볼 수 있습니다. 여기서는 지금 살펴보겠습니다.


  도메인 컨트롤러에서 Windows Azure의 도메인 가입 서버에 특정 정책을 적용하려고 하므로, 내 첫 번째 작업은 아래와 같이 <strong>Azure Servers</strong>라는 자체 OU에 이러한 컴퓨터를 추가하는 것입니다.이 연습에서는 <strong>canis-sql12-01</strong> 이라는 가상 머신을 사용합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6622.Network-Isolation-Options-Img12.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6622.Network-Isolation-Options-Img12.png" border="0"></a>


  다음은 가상 머신 canis-sql12-01의 현재 방화벽 상태입니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7041.Network-Isolation-Options--Img13.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7041.Network-Isolation-Options--Img13.png" border="0"></a>


  도메인 컨트롤러로 돌아가<em>서Administrative Tools</em> 메뉴에서 그룹 정책 관리 콘솔을 시작합니다.그런 다음 도메인을 확장하고 canisnetworks.com 그룹 정책 개체 노드를 선택한 다음 마우스 오른쪽 단추로 클릭합니다.그런 다음 아래와 같이 <em>새</em> 메뉴 항목을 선택합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4150.Network-Isolation-Options-Img14.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4150.Network-Isolation-Options-Img14.png" border="0"></a>


  <strong>새 GPO</strong> 대화 상자에서 새 GPO에 대한 설명이 포함된 이름을 제공하고 <strong>확인</strong> 단추를 선택합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/5734.Network-Isolation-Options--Img15.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/5734.Network-Isolation-Options--Img15.png" border="0"></a>


  이제 GPO가 GPO 개체 목록에 추가되었으므로 이제 아래와 같이 <em>편집</em> 메뉴 항목을 마우스 오른쪽 단추로 클릭하고 선택하여 구성해야 합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6560.Network-Isolation-Options--Img16.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6560.Network-Isolation-Options--Img16.png" border="0"></a>


  이제 그룹 정책 관리 편집기가 표시됩니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6082.Network-Isolation-Options--Img17.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6082.Network-Isolation-Options--Img17.png" border="0"></a>


  다음과 같이 두 개의 GPO를 추가하겠습니다.

  <ol>
   <li>도메인 프로필을 켭니다.</li>
   <li>IPsec에 의해 보호되도록 SCOM 모니터링 포트 5723을 구성합니다.(그런 다음 이 GPO가 온-프레미스 SCOM 설치에서 외부 IP 주소를 통해 안전하게 적용된 컴퓨터를 모니터링할 수 있습니다.)</li>
  </ol>

  아래에서 컴퓨터 구성 | 확장했습니다. 정책 | 트리를 Windows 설정 고급 보안 노드가 있는 Windows 방화벽으로 이동했습니다.그런 다음 <em>Windows 방화벽 속성</em> 링크를 선택합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/1425.Network-Isolation-Options--Img18.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/1425.Network-Isolation-Options--Img18.png" border="0"></a>


  아래 표시된 대화 상자에서 도메인 프로필의 방화벽 상태를 "끄기"에서 "켜기(권장)"로 변경합니다.그런 다음 <strong>확인</strong> 단추를 선택합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4403.Network-Isolation-Options--Img19.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4403.Network-Isolation-Options--Img19.png" border="0"></a>


  아래에서 도메인 프로필에 Windows 방화벽이 켜져 있는 것을 볼 수 있습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/1307.Network-Isolation-Options--Img20.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/1307.Network-Isolation-Options--Img20.png" border="0"></a>


  이제 왼쪽에서 <em>Windows 방화벽</em> 노드를 확장하고 아래와 같이 <em>인바운드 Rulesnode</em>를 선택합니다.현재 규칙이 없으므로 규칙 목록이 비어 있습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4555.Network-Isolation-Options-_2D00_-Img21.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4555.Network-Isolation-Options-_2D00_-Img21.png" border="0"></a>


  <em>인바운드 규칙</em> 노드를 마우스 오른쪽 단추로 클릭하고 <em>새 규칙을 선택합니다...</em> 아래와 같이 팝업 메뉴에서


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/0317.Network-Isolation-Options-Img22.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/0317.Network-Isolation-Options-Img22.png" border="0"></a>


  IPsec을 사용하여 포트를 보호하기 위해 개별 머신 <strong>에 규칙을</strong> 만들 때 이전과 동일한 수동 단계를 수행합니다.그래서 아래에서 포트 규칙을 선택합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6646.Network-Isolation-Options--Img23.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6646.Network-Isolation-Options--Img23.png" border="0"></a>


  <strong>프로토콜 및 포트</strong> 마법사 페이지에서 원하는 포트를 입력합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2654.Network-Isolation-Options--Img24.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2654.Network-Isolation-Options--Img24.png" border="0"></a>


  <strong>작업</strong> 마법사 페이지에서 <em>보안 옵션인 경우 연결 허용</em>을 선택한 다음 <strong>사용자 지정...</strong> 클릭합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/0552.Network-Isolation-Options-Img25.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/0552.Network-Isolation-Options-Img25.png" border="0"></a>


  아래와 같이 대화 상자에서 인증 및 무결성 보호를 강제로 선택하여 보안 설정을 선택하는 옵션을 그대로 둡니다.그런 다음 <strong>확인</strong> 단추를 선택합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/5277.Network-Isolation-Options--Img26.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/5277.Network-Isolation-Options--Img26.png" border="0"></a>


  이제 <strong>다음</strong> 단추를 선택하고 <strong>사용자</strong> 및 <strong>컴퓨터</strong> 마법사 페이지의 기본값을 계속 적용합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2654.Network-Isolation-Options-Img27.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2654.Network-Isolation-Options-Img27.png" border="0"></a>


  <strong>프로필</strong> 마법사 페이지에서 아래와 같이 도메인 프로필을 선택합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/5305.Network-Isolation-Options-Img28.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/5305.Network-Isolation-Options-Img28.png" border="0"></a>


  마지막으로 아래와 같이 새 인바운드 규칙에 이름을 지정합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4861.Network-Isolation-Options--Img29.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4861.Network-Isolation-Options--Img29.png" border="0"></a>


  GPO 설정이 완료되었으므로 이제 그룹 정책 관리 편집기의 인바운드 규칙 목록에 새 인바운드 규칙이 표시됩니다.그런 다음 편집기를 닫고 원래 그룹 정책 관리 콘솔로 돌아갑니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8540.Network-Isolation-Options-Img30.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8540.Network-Isolation-Options-Img30.png" border="0"></a>


  이제 GPO를 설정했으므로 이 GPO를 Azure 서버 OU에 연결해야 합니다.이제 Azure Servers OU를 마우스 오른쪽 단추로 클릭하고 <em>기존 GPO 연결을 선택합니다.</em> 아래와 같이 팝업 메뉴에서


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/1031.Network-Isolation-Options--Img31.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/1031.Network-Isolation-Options--Img31.png" border="0"></a>


  <strong>GPO 선택</strong> 대화 상자에서 새 GPO를 선택한 다음 대화 상자를 닫습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7558.Network-Isolation-Options-Img32.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7558.Network-Isolation-Options-Img32.png" border="0"></a>


  이제 GPO는 아래와 같이 Azure Server OU와 연결됩니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2018.Network-Isolation-Options--Img33.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2018.Network-Isolation-Options--Img33.png" border="0"></a>


  이제 가상 머신(canis-sql12-01)으로 돌아가서 GPO를 적용하고 GPO가 적용되었는지 확인합니다.아래 명령 프롬프트에서 <strong>gpupdate /force</strong> 명령을 입력합니다.아래에서 정책 업데이트가 성공적으로 완료되었음을 확인할 수 있습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7823.Network-Isolation-Options--Img34.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7823.Network-Isolation-Options--Img34.png" border="0"></a>


  GPO가 적용되었는지 확인하기 위해 아래와 같이 <strong>gpresult /r /scope computercommand</strong>를 입력합니다.여기서 볼 수 있듯이 GPO가 적용되었는지 확인했습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7802.Network-Isolation-Options--Img35.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7802.Network-Isolation-Options--Img35.png" border="0"></a>


  이제 Windows 방화벽을 열고 두 GPO 개체를 모두 확인해 보겠습니다.Windows 방화벽 최상위 노드에서 도메인 프로필 창 방화벽이 있는지 확인할 수 있습니다.또한 방화벽 상태에 그룹 정책 설정이 적용되었다는 알림이 표시됩니다(특히 이 경우 도메인 프로필의 경우).


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/5875.Network-Isolation-Options--Img36.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/5875.Network-Isolation-Options--Img36.png" border="0"></a>


  이제 <em>인바운드 규칙</em> 노드를 선택하면 아래와 같이 IPSec 인바운드 규칙이 포트 5723에 적용되었는지 확인할 수 있습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/3487.Network-Isolation-Options--Img37.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/3487.Network-Isolation-Options--Img37.png" border="0"></a>

  <h6>Virtual Machines에서 아웃바운드 인터넷 연결 제한</h6>

  명백한 이유로 기업 고객은 서버, 특히 회사 외부에서 공유되는 경우 중간 또는 높은 비즈니스 영향을 가진 중요한 데이터가 포함된 백 엔드 서버에서 아웃바운드 인터넷 액세스를 제한하는 것이 일반적입니다.퍼블릭 클라우드에서는 엔터프라이즈 고객이 이미 클라우드 플랫폼을 고려하여 클라우드 공급자에 대한 많은 신뢰를 확보하고 있으며, 보안 제어가 온-프레미스보다 덜 강력하지 않기를 원하기 때문에 더욱 두드러집니다.다행히 Azure 가상 머신과 PaaS 머신을 Windows 도메인에 가입할 수 있고 방금 본 것처럼 그룹 정책을 적용할 수 있으므로 엔터프라이즈 사용자 지정은 친숙한 기술을 사용하여 서버를 보호하고 서버 자체에서 중요한 정보를 공유하지 못하도록 방지할 수 있습니다.이 연습에서는 가상 머신에서 아웃바운드 인터넷 연결을 제한하는 방법을 보여 줍니다.이 경우 그룹 정책을 사용하지 않지만 IPsec에 대해 위와 동일한 방식으로 적용됩니다.


  시작하려면 아래와 같이 이전 섹션에서 사용한 SQL Server 가상 머신으로 시작합니다.그룹 정책을 적용한 후 앞에서 본 것처럼 고급 보안이 시작된 방화벽을 Windows.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4024.Network-Isolation-Options-Img38.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4024.Network-Isolation-Options-Img38.png" border="0"></a>


  이 컴퓨터는 현재 인터넷에 액세스할 수 있으며 SQL Server Management Studio 다른 온-프레미스 SQL Server 액세스할 수도 있습니다.VPN 구성(192.168.1.0/24)에 정의된 대로 온-프레미스 서브넷에만 액세스할 수 있도록 가상 머신을 제한하려고 합니다.최상위 노드를 마우스 오른쪽 단추로 클릭하여 속성 페이지를 가져옵니다. 아래와 같이 기본적으로 아웃바운드 연결이 허용됩니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/3060.Network-Isolation-Options--Img39.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/3060.Network-Isolation-Options--Img39.png" border="0"></a>


  아래와 같이 이를 "차단"으로 변경합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/0243.Network-Isolation-Options-Img40.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/0243.Network-Isolation-Options-Img40.png" border="0"></a>


  이제 아래와 같이 온-프레미스 SQL Server 또는 인터넷에 액세스할 수 없습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7065.Network-Isolation-Options-Img42.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7065.Network-Isolation-Options-Img42.png" border="0"></a>


  이제 Windows 방화벽의 <em>아웃바운드 규칙</em> 노드를 클릭하고 마우스 오른쪽 단추를 클릭하고 <em>새 규칙을 선택합니다...</em> 팝업 메뉴에서아래와 같이 <strong>새 아웃바운드 규칙 마법사</strong>의 <strong>규칙 유형</strong> 페이지에서 사용자 지정 규칙을 선택합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2541.Network-Isolation-Options--Img43.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2541.Network-Isolation-Options--Img43.png" border="0"></a>


  <strong>프로그램</strong> 페이지에서 기본값을 그대로 둡니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2110.Network-Isolation-Options-Img44.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2110.Network-Isolation-Options-Img44.png" border="0"></a>


  <strong>프로토콜 및 포트</strong> 페이지에서 내 목적을 위해 아래와 같이 TCP 프로토콜을 선택합니다.


  다음으로 <strong>범위 페이지가</strong> 있습니다.원격 IP 주소 옵션을 "이러한 IP 주소:"로 변경한 다음 <strong>추가...</strong>를 선택합니다. 클릭합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4544.Network-Isolation-Options-Img46.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/4544.Network-Isolation-Options-Img46.png" border="0"></a>


  제공된 대화 상자에서 아래와 같이 이 가상 머신에서 액세스할 수 있는 유일한 IP 주소 집합으로 온-프레미스 서브넷을 지정합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8787.Network-Isolation-Options-Img47.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8787.Network-Isolation-Options-Img47.png" border="0"></a>


  따라서 최종 <strong>범위</strong> 페이지는 아래와 같이 표시됩니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2727.Network-Isolation-Options-Img48.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2727.Network-Isolation-Options-Img48.png" border="0"></a>


  <strong>작업</strong> 페이지에서 "연결 허용" 옵션을 선택합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6318.Network-Isolation-Options-_2D00_-Img49.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6318.Network-Isolation-Options-_2D00_-Img49.png" border="0"></a>


  다음으로 <strong>프로필</strong> 페이지가 있습니다. 여기서 내 용도로 도메인 프로필만 선택합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6470.Network-Isolation-Options--Img50.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6470.Network-Isolation-Options--Img50.png" border="0"></a>


  <strong>성 페이지에서</strong> 아래와 같이 새 규칙에 "온-프레미스 서브넷에 대한 아웃바운드 연결"이라는 이름을 지정합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/3884.Network-Isolation-Options-Img51.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/3884.Network-Isolation-Options-Img51.png" border="0"></a>


  그러면 아웃바운드 규칙 마법사가 완료되고 아래에 새 규칙이 표시됩니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7345.Network-Isolation-Options-Img52.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7345.Network-Isolation-Options-Img52.png" border="0"></a>


  이제 온-프레미스 SQL Server 또는 온-프레미스 서브넷의 다른 서버에 연결할 수 있지만 원하는 대로 인터넷에 연결할 수 없습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8345.Network-Isolation-Options--Img53.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8345.Network-Isolation-Options--Img53.png" border="0"></a>


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7673.Network-Isolation-Options--Img54.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/7673.Network-Isolation-Options--Img54.png" border="0"></a>


  따라서 이 가상 머신이 인터넷에 액세스하지 못하도록 효과적으로 제한했습니다.하지만 이제 Windows Azure 환경의 다른 머신에 액세스할 수 없습니다.이 문제는 방금 만든 아웃바운드 규칙에 개별 IP 주소 또는 IP 주소 범위를 추가하여 해결할 수 있습니다.예를 들어 아래와 같이 이 가상 머신의 SQL Server Management Studio 사용하여 URL pcv94pjwnj.database.windows.net 사용하여 <strong>Azure SQL Database</strong> 서버에 액세스하려고 했습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6518.Network-Isolation-Options-Img55.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/6518.Network-Isolation-Options-Img55.png" border="0"></a>


  아래와 같이 서버를 ping하고 해당 IP 주소를 찾습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/5756.Network-Isolation-Options--Img56.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/5756.Network-Isolation-Options--Img56.png" border="0"></a>


  그런 다음 아래와 같이 원격 IP 주소의 허용 목록에 개별 IP 주소를 추가합니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8176.Network-Isolation-Options--Img57.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8176.Network-Isolation-Options--Img57.png" border="0"></a>


  그런 다음 서버에 액세스할 수 있습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8585.Network-Isolation-Options--Img58.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/8585.Network-Isolation-Options--Img58.png" border="0"></a>


  Windows Azure 플랫폼에서 IP 주소 범위를 지정하려면 <a href="">여기에서</a> Azure 데이터 센터 IP 범위 목록을 다운로드할 수 있습니다.선택할 수 있는 범위가 많으므로 선택적으로 실제로 사용하는 데이터 센터에 적용되는 항목만 추가하는 것이 가장 좋습니다.주로 미국 서부 데이터 센터를 사용하지만 여전히 미국 북부에 오래된 데이터베이스 서버가 있으므로 내 예제에서는 가상 머신이 모든 미국 북부에 액세스할 수 있도록 다음 항목을 추가할 수 있습니다.방금 아웃바운드 규칙에 추가한 내 데이터베이스 서버가 포함된 아래 범위가 강조 표시된 것을 볼 수 있습니다.


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2744.ashwin-last-code.png"><img alt="" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1727/2744.ashwin-last-code.png" border="0"></a>


  따라서 이제 가상 머신 아웃바운드 액세스를 잠그는 것에 대해 모두 설정해야 합니다.또한 주기적으로 Azure 주소 범위가 변경되므로 이러한 범위는 몇 달마다 확인하거나, 갑자기 허용 목록에 있는 IP 주소의 Azure 리소스를 더 이상 사용할 수 없는 경우 확인해야 합니다.

  <h6>결론</h6>

  이 문서에서는 IaaS 가상 머신을 보호하기 위한 여러 가지 방법을 검토했습니다.실제로 Windows Azure IaaS 환경을 온-프레미스 네트워크의 확장으로 효과적으로 구성할 수 있으므로 Windows Azure에서 보강된 기존 온-프레미스 보안 구문을 활용하여 엔터프라이즈 애플리케이션을 실행하는 Azure에 배포한 가상 머신을 효과적으로 보호할 수 있습니다.고급 보안이 포함된 네트워크 ACL, 가상 네트워크 및 Windows 방화벽은 모두 함께 작동하여 강력한 보안 시나리오를 보장합니다.

  <h6>참조</h6>

  <ul>
   <li><strong>Azure 네트워크 보안 백서 Windows</strong>:<a href="https://download.microsoft.com/download/4/3/9/43902EC9-410E-4875-8800-0788BE146A3D/Windows%20Azure%20Network%20Security%20Whitepaper%20-%20FINAL.docx">https://download.microsoft.com/download/4/3/9/43902EC9-410E-4875-8800-0788BE146A3D/Windows%20Azure%20Network%20Security%20Whitepaper%20-%20FINAL.docx</a></li>
   <li><strong>ACL(네트워크 액세스 제어 목록) 정보</strong>:  <a href=""></a></li>
   <li><strong>가상 머신에 엔드포인트를 설정하는 방법</strong>:  <a href="https://azure.microsoft.com/en-us/manage/windows/how-to-guides/setup-endpoints/">https://azure.microsoft.com/en-us/manage/windows/how-to-guides/setup-endpoints/</a></li>
   <li><strong>Windows Azure의 네트워크 액세스 제어 목록 기능</strong>: Powershell<a href=""></a></li>
   <li><strong>Windows Azure에서 엔드포인트 ACL 설정</strong>: VMhttps://convective.wordpress.com/2013/06/08/setting-an-endpoint-acl-on-a-windows-azure-vm/</li>
   <li><strong>Windows Server 2012 IKEv2를 사용하여 엔드 투 엔드 IPsec 연결 보호</strong>:<a href="https://technet.microsoft.com/en-us/library/hh831807.aspx#BKMK_Step2">https://technet.microsoft.com/en-us/library/hh831807.aspx#BKMK_Step2</a></li>
   <li><strong>Windows 방화벽 및 IPsec 정책 배포 단계별 가이드</strong>:<a href="https://technet.microsoft.com/en-us/library/deploy-ipsec-firewall-policies-step-by-step%28v=WS.10%29.aspx">https://technet.microsoft.com/en-us/library/deploy-ipsec-firewall-policies-step-by-step%28v=WS.10%29.aspx</a></li>
   <li><strong>Windows PowerShell 사용하여 고급 보안 관리를 사용하여 방화벽을 Windows</strong>.  <a href="https://technet.microsoft.com/en-us/library/hh831755.aspx">https://technet.microsoft.com/en-us/library/hh831755.aspx</a></li>
   <li><strong>Azure 데이터 센터 IP 범위 Windows:</strong>  </li>
  </ul>

  애쉬윈 팔레카르


  Azure 네트워킹 팀 Windows
