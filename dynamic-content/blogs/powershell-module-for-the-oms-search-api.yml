### YamlMime:Yaml
ms.openlocfilehash: 699fc143fd4595cb3e01726e8af9a409e4a66fbb
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139908754"
Slug: powershell-module-for-the-oms-search-api
Title: OMS Search API용 PowerShell 모듈
Summary: Azure Automation에 업로드하고 Runbook에서 직접 사용할 수 있는 PowerShell 모듈을 활용하는 방법을 알아봅니다. OMS 모듈은 인증 및 권한 부여에 Azure Active Directory 사용합니다.
Content: "<p><strong>업데이트 2016년 4월 5일:</strong> 이 블로그 게시물은 이제 <a href=\"https://blogs.technet.microsoft.com/privatecloud/2016/04/05/using-the-oms-search-api-with-native-powershell-cmdlets/\" target=\"_blank\">이</a>&nbsp; 블로그 게시물로 대체됩니다.</p>\n\n<p><strong>업데이트 2015년 10월 15일: </strong> Github의 OMS PowerShell 모듈은 이제 Azure 리소스 그룹, 시작/종료 날짜 &amp; 시간을 지원하도록 <a href=\"https://github.com/tiander/OMSsearchAPI\" target=\"_blank\">여기에서</a> 업데이트되며 SPN(서비스 사용자 이름) 사용을 지원합니다.</p>\n\n<p><a href=\"https://azure.microsoft.com/blog/2015/07/21/leveraging-the-oms-search-api-in-an-azure-automation-runbook/\" target=\"_blank\">이전 블로그 게시물</a>에서 Azure Automation에 업로드하고 온-프레미스 리소스를 활용하는 쉬운 방법이 없는 사용자를 위해 Hybrid Runbook Worker에 대한 시나리오 및 사용 사례를 설명했습니다. Hybrid Runbook Worker를 사용하여 <strong>ARMclient </strong>를 활용하여 OMS Search API에 연결했습니다. 이 블로그 게시물에서는 Azure Automation에 업로드하고 Runbook에서 직접 사용할 수 있는 PowerShell 모듈을 활용할&#39;있습니다. OMS 모듈은 인증 및 권한 부여에 Azure Active Directory 사용합니다.</p>\n\n<blockquote><strong>참고: OMS 검색 API는 OMS 분석 데이터를 대량으로 내보내기 위한 것이 아닙니다. 범위가 지정되고 시간 및 날짜 범위가 제한된 짧은&rdquo; 쿼리를 실행&ldquo;하기 위한 것입니다.</strong></blockquote>\n\n<p>여기서 이 블로그 게시물에 설명된 PowerShell 모듈을 다운로드 <a href=\"https://github.com/tiander/OMSsearchAPI\" target=\"_blank\">합니다</a>. 이 블로그 게시물에서 다음을 수행합니다.</p>\n\n<ul>\n <li>Azure Automation으로 모듈 가져오기</li>\n <li>Azure Active Directory 사용자 만들기</li>\n <li>Azure Automation에서 필요한 자산 만들기</li>\n <li>Runbook을 만들어 OMS 검색 API 결과 가져오기</li>\n</ul>\n\n<h2>Azure Automation에서 PowerShell 모듈 가져오기</h2>\n\n<p>다음 단계에서는 Azure 미리 보기 포털을 사용합니다.</p>\n\n<ul>\n <li><a href=\"https://github.com/tiander/OMSsearchAPI\" target=\"_blank\">여기에서</a> 두 개의 PowerShell 모듈을 컴퓨터로 다운로드합니다.</li>\n <li>Azure Automation 계정으로 이동하고 <strong>자산을 클릭합니다.</strong></li>\n</ul>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/08/10/Adding-Module-1.jpg\"><img alt=\"Adding Module 1\" border=\"0\" height=\"244\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Adding-Module-1_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"모듈 1 추가\" width=\"206\"></a></blockquote>\n\n<ul>\n <li><strong>모듈</strong>을 클릭합니다.</li>\n</ul>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/08/10/Adding-Module-2.jpg\"><img alt=\"Adding Module 2\" border=\"0\" height=\"221\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Adding-Module-2_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"모듈 2 추가\" width=\"244\"></a></blockquote>\n\n<ul>\n <li><strong>모듈 추가를 클릭합니다.</strong></li>\n</ul>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/08/10/Adding-Module-3.jpg\"><img alt=\"Adding Module 3\" border=\"0\" height=\"117\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Adding-Module-3_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"모듈 3 추가\" width=\"155\"></a></blockquote>\n\n<ul>\n <li><strong>업로드 파일을</strong> 선택하고 다운로드한 PowerShell 모듈로 이동한 다음 <strong> , 먼저AzureActiveDirectory.zip</strong> 선택하고 <strong>확인을 클릭합니다.</strong></li>\n <li>그러면 PowerShell 모듈이 가져오고 가져오기 후에 <strong>활동 추출</strong> 이 시작됩니다.</li>\n</ul>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/08/10/Adding-Module-4.jpg\"><img alt=\"Adding Module 4\" border=\"0\" height=\"107\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Adding-Module-4_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"모듈 4 추가\" width=\"244\"></a></blockquote>\n\n<ul>\n <li>추출이 성공적으로 완료되었는지 확인합니다.</li>\n</ul>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/08/10/Adding-Module-5.jpg\"><img alt=\"Adding Module 5\" border=\"0\" height=\"68\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Adding-Module-5_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"모듈 5 추가\" width=\"244\"></a></blockquote>\n\n<ul>\n <li>첫 번째 모듈과 동일한 방식으로 <strong> 두 번째 모듈OperationsManagementSuite.zip</strong> 가져오고 추출이 성공적으로 완료되었는지 확인합니다.</li>\n</ul>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/08/10/Adding-Module-6.jpg\"><img alt=\"Adding Module 6\" border=\"0\" height=\"176\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Adding-Module-6_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"모듈 6\" width=\"244\"></a> 추가 &nbsp;</blockquote>\n\n<h2>Azure Active Directory 사용자 만들기</h2>\n\n<p>OMS Search API PowerShell 모듈에서 인증에 AAD 사용하므로 기존 AAD(Azure Active Delivery) 계정을 만들거나 사용해야 합니다. Joe Levy는 이 과정에 대해 전체적으로 설명 <a href=\"https://azure.microsoft.com/blog/2014/08/27/azure-automation-authenticating-to-azure-using-azure-active-directory/\" target=\"_blank\">합니다</a>.</p>\n\n<h2>필요한 자산 만들기</h2>\n\n<p>이전 단계에서 가져온 두 PowerShell 모듈&rsquo;의 경우 두 개의 연결 개체를 만들어야 합니다. 이렇게 하면 Runbook에서 우리의 삶이 훨씬 쉬워질 것입니다. <strong>자산</strong>으로 이동하고 <strong>연결을 클릭합니다.</strong></p>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/08/11/Connections-1.jpg\"><img alt=\"Connections 1\" border=\"0\" height=\"215\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Connections-1_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"연결 1\" width=\"244\"></a></blockquote>\n\n<p><strong>연결 추가를 클릭합니다.</strong></p>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/08/11/Connections-2.jpg\"><img alt=\"Connections 2\" border=\"0\" height=\"115\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Connections-2_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"연결 2\" width=\"142\"></a></blockquote>\n\n<p><strong>AzureActiveDirectory</strong> 형식의 새 <strong>연결을</strong> 만듭니다. <strong>ClientID</strong> 및 <strong>Secret</strong>에 대한 필드는 필수이므로(곧 수정될 예정) 여기에서 항목을 입력해야 합니다. Runbook은 애플리케이션을 위한 이러한 필드를 활용하지 않습니다. 지금은 <strong>N/A</strong> 를 입력합니다.</p>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/08/11/Connections-5.jpg\"><img alt=\"Connections 5\" border=\"0\" height=\"471\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Connections-5_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"연결 5\" width=\"150\"></a></blockquote>\n\n<p><strong>저장</strong>을 클릭하고 <strong>OperationsManagementSuite</strong> 형식의 두 번째 <strong>연결을</strong> 만듭니다.</p>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/08/11/Connections-4.jpg\"><img alt=\"Connections 4\" border=\"0\" height=\"349\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Connections-4_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"연결 4\" width=\"146\"></a></blockquote>\n\n<p><strong>Save</strong>를 클릭합니다.</p>\n\n<h2>OMS 검색 API Runbook 만들기</h2>\n\n<p><a href=\"https://azure.microsoft.com/blog/2015/07/21/leveraging-the-oms-search-api-in-an-azure-automation-runbook/\" target=\"_blank\">이전 블로그 게시물</a>에서 허니팟 계정 모니터링에 대해 이야기했습니다. &rsquo;동일한 시나리오를 사용하여 특정 서버에서 실패한 허니팟 계정 로그인을 확인하는 Runbook을 만들 수 있습니다. 이번에는 가져온 PowerShell 모듈을 활용합니다.</p>\n\n<ul>\n <li>새 Runbook을 만듭니다.</li>\n</ul>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/08/10/Create-runbook.jpg\"><img alt=\"Create runbook\" border=\"0\" height=\"181\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Create-runbook_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"Runbook 만들기\" width=\"244\"></a></blockquote>\n\n<ul>\n <li>지금은 PowerShell 워크플로를 사용하여 Runbook을 만듭니다.</li>\n</ul>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/08/10/Create-runbook-2.jpg\"><img alt=\"Create runbook 2\" border=\"0\" height=\"138\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Create-runbook-2_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"Runbook 2\" width=\"244\"></a> 만들기 &nbsp;</blockquote>\n\n<p><strong>Our Runbook:</strong></p>\n\n<pre class=\"prettyprint\">\nworkflow Get-OMSsearchQuery\n{\n $Alert = $false\n \n #Get our Connection Objects\n       $OMSConnection = Get-AutomationConnection -Name &#39;OMSConnection&#39;\n $ADConnection = Get-AutomationConnection -Name &#39;ADConnection&#39;\n\n #Create our Token \n $UserName = $ADConnection.UserName + &quot;@&quot; + $ADConnection.AzureADDomain\n $ADConn = @{&quot;Username&quot;=$Username;&quot;AzureADDomain&quot;=$ADConnection.AzureADDomain;&quot;Password&quot;=$ADConnection.Password;&quot;APPIdURI&quot;=$ADConnection.AppIdURI;}\n $Token = Get-AzureADToken -Connection $ADConn\n \n #Use our OMSConnection object to retrieve our OMS information\n $WorkSpace = $OMSConnection.Workspace\n $SubID = $OMSConnection.SubscriptionID\n $Region = $OMSConnection.Region\n $APIVersion = $OMSConnection.APIVersion\n \n #Define our search query\n $Query = &#39;Type=SecurityEvent EventID=4625 Computer=WHDVM1&#39;\n Write-Output &quot;*** Executing query *** &quot; $Query\n\n #Get our OMS Search query results for our Honeypot Account\n $Results = Search-OMSWorkspace -Token $Token -Subscription $SubID -Workspace $Workspace -Region $Region -APIVersion &quot;2015-03-20&quot; -Query $Query\n #Uncomment the next line if you want to see all results returned\n #$Results\n $Accounts = $Results.TargetUserName\n \n #Check our Honeypot Account\n foreach ($Account in $Accounts)\n  {\n   if($Account -eq &quot;LocalAdmin&quot;)\n           {\n     $Alert = $true\n     $AccountName = $Account\n     }\n  } \n #We have a match\n if($Alert -eq $true)\n {\n  Write-Output &quot;Raising Alert! Logon attempt found for account: $AccountName&quot;\n }\n #We don&#39;t have a match\n else\n  {\n   Write-Output &quot;These are not the droids you are looking for!&quot;\n  }\n }</pre>\n\n<p>Runbook이 실행되면 출력:</p>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/08/10/runbook-output.jpg\"><img alt=\"runbook output\" border=\"0\" height=\"179\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/runbook-output_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"Runbook 출력\" width=\"244\"></a></blockquote>\n\n<p>&nbsp; 다음까지. 행복한 자동화!</p>"
