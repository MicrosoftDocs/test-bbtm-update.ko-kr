### YamlMime:Yaml
ms.openlocfilehash: d0d25785f29a7aa4da8d464a121a817aa3f712cd
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139905632"
Slug: azure-load-balancer-new-distribution-mode
Title: 새 배포 모드 Azure Load Balancer
Summary: '원본 IP 선호도라는 새로운 배포 모드를 도입했으며 세션 선호도 또는 클라이언트 IP 선호도라고도 합니다. 2개 튜플(원본 IP, 대상 IP) 또는 3개 튜플(원본 IP, 대상 IP, 프로토콜)을 사용하도록 Azure 부하 분산 장치를 구성하여 사용 가능한 서버에 트래픽을 매핑할 수 있습니다. '
Content: "Azure Load Balancer 클라우드 서비스 또는 부하 분산 장치 집합에 정의된 가상 머신의 정상 서비스 인스턴스 간에 들어오는 트래픽을 분산하는 계층 4(TCP, UDP) 유형 부하 분산 장치입니다.\n\n사용되는 배포 알고리즘은 트래픽을 사용 가능한 서버에 매핑하는 5개 튜플(원본 IP, 원본 포트, 대상 IP, 대상 포트, 프로토콜 종류) 해시입니다. 전송 세션 내에서만 연결이 유지됩니다. 동일한 TCP 또는 UDP 세션의 패킷은 부하 분산 엔드포인트 뒤의 동일한 DIP(데이터 센터 IP) 인스턴스로 전송됩니다. 클라이언트가 연결을 닫았다가 다시 열거나 동일한 원본 IP에서 새 세션을 시작하는 경우 원본 포트가 변경되어 트래픽이 다른 DIP 엔드포인트로 이동합니다.\n\n<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/21/SLB-5-tuple.png\"><img style=\"float: none;padding-top: 0px;padding-left: 0px;margin-left: auto;padding-right: 0px;margin-right: auto;border-width: 0px\" title=\"SLB 5 튜플\" alt=\"SLB 5 tuple\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/SLB-5-tuple_thumb.png\" width=\"640\" height=\"252\" border=\"0\" /></a>\n\n원본 IP 선호도(세션 선호도 또는 클라이언트 IP 선호도라고도 함)라는 새로운 배포 모드가 도입되었습니다. 2개 튜플(원본 IP, 대상 IP) 또는 3개 튜플(원본 IP, 대상 IP, 프로토콜)을 사용하도록 Azure 부하 분산 장치를 구성하여 사용 가능한 서버에 트래픽을 매핑할 수 있습니다. 원본 IP 선호도를 사용하면 동일한 클라이언트 컴퓨터에서 시작된 연결이 동일한 DIP 엔드포인트로 이어집니다.\n\n<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/21/SLB-2-tuple.png\"><img style=\"float: none;padding-top: 0px;padding-left: 0px;margin-left: auto;padding-right: 0px;margin-right: auto;border-width: 0px\" title=\"SLB 2 튜플\" alt=\"SLB 2 tuple\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/SLB-2-tuple_thumb.png\" width=\"640\" height=\"262\" border=\"0\" /></a>\n\n원본 IP 선호도는 <a href=\"https://go.microsoft.com/fwlink/p/?LinkId=517389\" target=\"_blank\">Azure Load Balancer RD 게이트웨이 간의 비호환성을 해결합니다</a>. 이제 단일 클라우드 서비스에서 RD 게이트웨이 팜을 빌드할 수 있습니다.\n\n또 다른 사용 시나리오는 UDP를 통해 실제 데이터 업로드가 발생하지만 TCP를 통해 컨트롤 플레인이 달성되는 미디어 업로드입니다.\n<ul>\n <li>클라이언트는 먼저 부하 분산 공용 주소에 대한 TCP 세션을 시작하고 특정 DIP로 전송됩니다. 이 채널은 연결 상태를 모니터링하기 위해 활성 상태로 유지됩니다.</li>\n <li>동일한 클라이언트 컴퓨터에서 동일한 부하 분산 공용 엔드포인트로 새 UDP 세션이 시작됩니다. 여기서 예상은 TCP를 통해 제어 채널을 유지하는 동시에 높은 처리량으로 미디어 업로드를 실행할 수 있도록 이 연결도 이전 TCP 연결과 동일한 DIP 엔드포인트로 전송되는 것입니다.</li>\n</ul>\n&nbsp;\n\n부하 분산 집합이 변경되면(가상 머신 추가 또는 제거) 클라이언트 요청 배포가 다시 계산됩니다. 기존 클라이언트 세션의 새 연결이 동일한 서버로 수행된다고 확신할 수 없습니다. 또한 원본 IP 선호도를 사용하는 경우 트래픽이 불규칙하게 배포될 수 있습니다. 프록시 뒤에서 실행되는 클라이언트는 하나의 고유한 클라이언트 애플리케이션으로 표시될 수 있습니다.\n\n&nbsp;\n<h2>시나리오</h2>\n<ul>\n <li>PowerShell 또는 서비스 관리 API를 통해 <a href=\"https://azure.microsoft.com/en-us/documentation/articles/virtual-machines-set-up-endpoints/\" target=\"_blank\">Virtual Machine</a> 의 엔드포인트에 부하 분산 장치 배포 구성</li>\n <li>PowerShell 또는 서비스 관리 API를 통해 Load-Balanced Endpoint Sets에 대한 부하 분산 장치 배포를 구성합니다.</li>\n <li><a href=\"https://msdn.microsoft.com/en-us/library/windowsazure/ee758711.aspx\" target=\"_blank\">서비스 모델을</a> 통해 웹/작업자 역할에 대한 부하 분산 장치 배포를 구성합니다.</li>\n</ul>\n&nbsp;\n<h2>PowerShell 예제</h2>\n<a href=\"https://github.com/Azure/azure-sdk-tools/releases\" target=\"_blank\">최신 Azure PowerShell</a> 다운로드하고 설치해야 합니다(10월 릴리스).\n\n&nbsp;\n<h3>Virtual Machine에 Azure 엔드포인트를 추가하고 부하 분산 장치 배포 모드 설정</h3>\n<pre class=\"prettyprint\">Get-AzureVM -ServiceName \"mySvc\" -Name \"MyVM1\" | Add-AzureEndpoint -Name \"HttpIn\" -Protocol \"tcp\" -PublicPort 80 -LocalPort 8080 –LoadBalancerDistribution “sourceIP”| Update-AzureVM</pre>\nLoadBalancerDistribution은 2 튜플(원본 IP, 대상 IP) 부하 분산을 위한 <strong>sourceIP</strong> , 3 튜플(원본 IP, 대상 IP, 프로토콜) 부하 분산에 대한<strong> sourceIPProtocol</strong> 또는 5 튜플 부하 분산의 기본 동작을 원하는 경우 <strong>없음</strong> 으로 설정할 수 있습니다.\n\n&nbsp;\n<h3>엔드포인트 부하 분산 장치 배포 모드 구성 검색</h3>\n<pre class=\"prettyprint\">PS C:\\&gt; Get-AzureVM –ServiceName “MyService” –Name “MyVM” | Get-AzureEndpoint\n\nVERBOSE: 6:43:50 PM - Completed Operation: Get Deployment\nLBSetName : MyLoadBalancedSet\nLocalPort : 80\nName : HTTP\nPort : 80\nProtocol : tcp\nVip : 65.52.xxx.xxx\nProbePath :\nProbePort : 80\nProbeProtocol : tcp\nProbeIntervalInSeconds : 15\nProbeTimeoutInSeconds : 31\nEnableDirectServerReturn : False\nAcl : {}\nInternalLoadBalancerName :\nIdleTimeoutInMinutes : 15\nLoadBalancerDistribution : sourceIP</pre>\n&nbsp;\n\nLoadBalancerDistribution 요소가 없으면 Azure 부하 분산 장치는 기본값인 5개 튜플 알고리즘을 사용합니다.\n\n&nbsp;\n<h3>부하 분산된 엔드포인트 집합에 대한 배포 모드 설정</h3>\n엔드포인트가 부하 분산 엔드포인트 집합의 일부인 경우 부하 분산 엔드포인트 집합에서 배포 모드를 설정해야 합니다.\n<pre class=\"prettyprint\">Set-AzureLoadBalancedEndpoint -ServiceName \"MyService\" -LBSetName \"LBSet1\" -Protocol tcp -LocalPort 80 -ProbeProtocolTCP -ProbePort 8080 –LoadBalancerDistribution \"sourceIP\"</pre>\n<h2>클라우드 서비스 예제</h2>\nAzure SDK for .NET 2.5(11월에 릴리스 예정)를 활용하여 클라우드 서비스를 업데이트할 수 있습니다.\n\n.csdef에서 Cloud Services용 엔드포인트 설정을 지정합니다. Cloud Services 배포의 부하 분산 장치 배포 모드를 업데이트하려면 배포를 업그레이드해야 합니다.\n\n아래에 .csdef에서 엔드포인트 설정을 변경하는 예제가 나와 있습니다.\n<pre class=\"prettyprint\">&lt;WorkerRole name=\"worker-role-name\" vmsize=\"worker-role-size\" enableNativeCodeExecution=\"[true|false]\"&gt;\n  &lt;Endpoints&gt;\n    &lt;InputEndpoint name=\"input-endpoint-name\" protocol=\"[http|https|tcp|udp]\" localPort=\"local-port-number\" port=\"port-number\" certificate=\"certificate-name\" loadBalancerProbe=\"load-balancer-probe-name\" loadBalancerDistribution=\"sourceIP\" /&gt;\n  &lt;/Endpoints&gt;\n&lt;/WorkerRole&gt;\n&lt;NetworkConfiguration&gt;\n  &lt;VirtualNetworkSite name=\"VNet\"/&gt;\n  &lt;AddressAssignments&gt;\n    &lt;InstanceAddress roleName=\"VMRolePersisted\"&gt;\n      &lt;PublicIPs&gt;\n        &lt;PublicIP name=\"public-ip-name\" idleTimeoutInMinutes=\"timeout-in-minutes\"/&gt;\n      &lt;/PublicIPs&gt;\n    &lt;/InstanceAddress&gt;\n  &lt;/AddressAssignments&gt;\n&lt;/NetworkConfiguration&gt;</pre>\n<h2>API 예제</h2>\n<a href=\"https://msdn.microsoft.com/en-us/library/azure/ee460799.aspx\" target=\"_blank\">서비스 관리 API</a>를 사용하여 부하 분산 장치 배포를 구성할 수 있습니다.\n\n이때 x-ms-version 헤더는 버전 2014-09-01 이상으로 설정해야 합니다.\n\n&nbsp;\n<h3>배포에서 지정한 부하 분산된 집합의 구성 업데이트</h3>\n<b>요청 예제</b>\n<pre class=\"prettyprint\">POST https://management.core.windows.net/&lt;subscription-id&gt;/services/hostedservices/&lt;cloudservice-name&gt;/deployments/&lt;deployment-name&gt;?comp=UpdateLbSet \n\nx-ms-version: 2014-09-01 \n\nContent-Type: application/xml \n\n&lt;LoadBalancedEndpointList xmlns=\"\" xmlns:i=\"https://www.w3.org/2001/XMLSchema-instance\"&gt; \n\n&lt;InputEndpoint&gt; \n\n&lt;LoadBalancedEndpointSetName&gt; endpoint-set-name &lt;/LoadBalancedEndpointSetName&gt; \n\n&lt;LocalPort&gt; local-port-number &lt;/LocalPort&gt; \n\n&lt;Port&gt; external-port-number &lt;/Port&gt; \n\n&lt;LoadBalancerProbe&gt; \n\n&lt;Port&gt; port-assigned-to-probe &lt;/Port&gt; \n\n&lt;Protocol&gt; probe-protocol &lt;/Protocol&gt; \n\n&lt;IntervalInSeconds&gt; interval-of-probe &lt;/IntervalInSeconds&gt; \n\n&lt;TimeoutInSeconds&gt; timeout-for-probe &lt;/TimeoutInSeconds&gt; \n\n&lt;/LoadBalancerProbe&gt; \n\n&lt;Protocol&gt; endpoint-protocol &lt;/Protocol&gt; \n\n&lt;EnableDirectServerReturn&gt; enable-direct-server-return &lt;/EnableDirectServerReturn&gt; \n\n&lt;IdleTimeoutInMinutes&gt;idle-time-out&lt;/IdleTimeoutInMinutes&gt; \n\n&lt;LoadBalancerDistribution&gt;sourceIP&lt;/LoadBalancerDistribution&gt; \n\n&lt;/InputEndpoint&gt; \n\n&lt;/LoadBalancedEndpointList&gt;</pre>\nLoadBalancerDistribution 값은 2 튜플 선호도에 대한 <strong>sourceIP</strong> , 3 튜플 선호도의 <strong>경우 sourceIPProtocol</strong> 또는 <strong>없음</strong> (선호도 없음)일 수 있습니다. 5개 튜플이 사용됨).\n\n<b>응답</b>\n<pre class=\"prettyprint\">HTTP/1.1 202 Accepted \n\nCache-Control: no-cache \n\nContent-Length: 0 \n\nServer: 1.0.6198.146 (rd_rdfe_stable.141015-1306) Microsoft-HTTPAPI/2.0 \n\nx-ms-servedbyregion: ussouth2 \n\nx-ms-request-id: 9c7bda3e67c621a6b57096323069f7af \n\nDate: Thu, 16 Oct 2014 22:49:21 GMT</pre>"
