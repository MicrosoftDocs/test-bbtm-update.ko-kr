### YamlMime:Yaml
ms.openlocfilehash: f583a2c390f5d50770df044025baf5acbb302b0f
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139900569"
Slug: solve-nodejs-issues-with-app-insights
Title: Node.js 애플리케이션 Insights 더 빠르게 Node.js 문제 해결
Summary: Azure 애플리케이션 Insights 실행 중인 서비스 및 애플리케이션에 대한 성능 및 진단 정보를 제공하는 APM(애플리케이션 성능 관리) 플랫폼입니다.
Content: >-
  <p><a href="https://azure.microsoft.com/en-us/services/application-insights/" target="_blank">Azure 애플리케이션 Insights</a> 실행 중인 서비스 및 애플리케이션에 대한 성능 및 진단 정보를 제공하여 문제를 신속하게 검색하고 진단하는 데 도움이 되는 APM(애플리케이션 성능 관리) 플랫폼입니다. Node.js 애플리케이션이 컨테이너, <a href="https://docs.microsoft.com/en-us/azure/app-service-web/app-service-web-get-started-nodejs" target="_blank">PaaS</a>, <a href="https://azure.github.io/azure-iot-sdk-node/" target="_blank">IoT</a> 및 <a href="https://electron.atom.io/" target="_blank">Electron</a> 데스크톱 앱을 실행하는 모든 위치에서 App Insights 사용합니다. <a href="https://docs.microsoft.com/en-us/azure/application-insights/app-insights-nodejs" target="_blank">지침에</a> 따라 Node.js SDK를 앱에 삭제하고 몇 분 안에 Azure Portal로 유용한 정보 흐름을 확인합니다.</p>


  <p>APM&rsquo;은 애플리케이션에서 발생하는 일을&rsquo; 이해하고 조치를 수행하는 데 도움이 되므로 문제를 정확히 파악하는 데 도움이 되는 정보를 자동으로 수집하고 표시하는 것이 우리의 임무 중 하나입니다. 최신 SDK 릴리스(<a href="https://github.com/Microsoft/ApplicationInsights-node.js/releases/tag/0.21.0" target="_blank">0.21.0</a>)에서 사용할 수 있는 다음 기능이 이 기능에 기여하기를 바랍니다.</p>


  <h2>관련 이벤트 찾기</h2>


  <p>문제를 정확히 파악할 때 모든 추적 및 로그를 검토하는 것이 유용할 수 있지만, 현재 문제와 직접 관련된 항목만 빠르게 필터링하는 것이 훨씬 더 유용할 수 있습니다. 예를 들어 API 서비스에서 오류 응답을 반환하는 경우 해당&rsquo; 오류와 관련된 다른 모든 추적을 신속하게 찾을 수 있도록 합니다. &rsquo;그들 중 일부는 문제의 원인에 훨씬 더 가까이 당신을 이끌 것입니다 좋은 기회가있다!</p>


  <p>이 릴리스&rsquo;에서는 각 앱 Insights 항목에 공유 상관 관계 식별자를 포함하여 이 상관 관계를 가능하게 했습니다. &rsquo;항목의 세부 정보 보기를 자세히 살펴보면 이 루트 작업에&rdquo; 사용할 수 있는 모든 원격 분석을 클릭하고 &ldquo;상관 관계 ID를 기반으로 관련 항목의 필터링된 보기를 즉시 가져옵니다. 예를 들어 다음 스크린샷에서 Node.js API 요청은 MongoDB 호출로 이어지며 요청 및 종속성 항목을 즉시 함께 볼 수 있습니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/922c945d-4a1c-4a40-8326-339c343e2296.png" target="_blank"><img alt="01-correlation-mongo" border="0" height="289" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/70add026-de33-48e1-967a-3617d92689c1.png" style="background-image: none; float: none; margin-left: auto; display: block; margin-right: auto; border-image: none" title="01-correlation-mongo" width="770"></a></p>


  <p><a href="https://docs.microsoft.com/en-us/azure/application-insights/app-insights-dashboards" target="_blank">애플리케이션 Insights 포털에서 탐색 및 대시보드를</a> 시작하고 자세히 알아보세요.</p>


  <h2>작동 방식</h2>


  <p>Azure Portal에서 상관 관계가 있는 항목을 즉시 필터링하려면 SDK에서 보낸 모든 관련 항목에 동일한 ID(상관 관계 식별자)를 추가해야 합니다. 즉, 원래 요청 컨텍스트와 데이터베이스 및 HTTP 호출 또는 응답 보내기와 같은 이후 작업의 컨텍스트 간에 SDK에서 해당 ID를 공유해야 합니다. JavaScript 및 Node.js 콜백 간에 컨텍스트를 공유하는 표준 방법이 아직 포함되어 있지 않기&rsquo; 때문에 콜백과 Node.js JavaScript의 다른 비동기 작업 간에 이러한 데이터를 공유하는 것은 어려운 일 <a href="https://github.com/nodejs/CTC/issues/4" target="_blank">입니다</a>.</p>


  <p>간단한 날씨 API 서비스의 문제를 설명해 보겠습니다&rsquo;. 이 API에 대한 요청은 HTTP 쿼리 매개 변수로 지정된 미국 우편 번호에 대한 예측 세부 정보를 반환합니다. 서비스 자체는 <a href="https://openweathermap.org/api" target="_blank">OpenWeatherMap</a> HTTP API에서 이러한 예측 세부 정보를 가져옵니다. 기본 처리기는 다음을 수행하며 전체 코드는 <a href="https://gist.github.com/joshgav/e2205d03d7fc357b2d3c7b28dffc71d8" target="_blank">이 요점</a>에 있습니다.</p>


  <pre>

  function httpHandler (request, response) {

    let parsed_url = url.parse(request.url);
    let zip = parsed_url.query.zip;
    let country = parsed_url.query.country || &#39;us&#39;;

    let query_string = `zip=${zip},${country}&amp;APPID=${appid}`
    http.get(`${query_string}`,
      weather_response =&gt; { weather_response.pipe(response) }
    );
  }

  http.createServer(httpHandler).listen(8080);

  </pre>


  <p>앱 Insights 앱 맵에서 검색된 이 <a href="https://docs.microsoft.com/en-us/azure/application-insights/app-insights-app-map" target="_blank">앱</a>&rsquo;의 토폴로지입니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ea89fef9-a8de-4ee2-9145-5b8c6a3d0e35.png"><img alt="02-weather_topo" border="0" height="75" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c2071e10-dccd-4818-9e1b-94879dabf236.png" style="background-image: none; float: none; margin-left: auto; display: block; margin-right: auto; border-image: none" title="02-weather_topo" width="360"></a></p>


  <p>이 코드에서 Nodes&rsquo; HTTP 서버가 들어오는 요청을 받으면 앱 Insights SDK는 해당 요청에 대한 정보를 수집하고 ID(상관 관계 식별자)를 지정합니다. 연결된 HTTP 요청이 OpenWeatherMap API로 전송되면 SDK는 이전에 지정한 상관 관계 ID를 포함하여 해당 요청에 대한 정보도 수집합니다. OpenWeatherMap API의 응답이 서비스에서 수신되고 원래 호출자에게 전송되는 경우 App Insights 원래 상관 관계 식별자도 포함된 더 많은 이벤트가 전송됩니다.</p>


  <p>이러한 모든 작업 및 콜백에서 이러한 식별자를 공유하려면 앱 Insights SDK가 모든 작업에서 공유되는 일부 스토리지에 액세스해야 합니다. 이 문제를 해결하기 위해 App Insights 기본적으로 인기 있는 <a href="https://github.com/angular/zone.js/" target="_blank">zone.js</a> 라이브러리를 활용하여 요청이 시작될 때 상관 관계 식별자를 저장 및 공유하는 영구 컨텍스트를 제공하고, 다른 정보가 수집되어 사용자에게 전송될 때 이를 검색하고 사용합니다. 따라서 사용자와 포털을 대신하여 이 식별자로 필터링하여 앱의 문제를 더 빠르게 검색하고 해결할 수 있습니다.</p>


  <h2>*서비스 간* 관련 이벤트 찾기</h2>


  <p>zone.js 포함된 App Insights 사용하면 단일 서비스에서 문제의 근본 원인을 더 빠르게 파악할 수 있습니다. 그러나 애플리케이션은 실제로 여러 서비스로 구성될 수 있으며 근본 문제는 다른 서비스에 있을 수 있습니다. 이 문제를 해결하고 모든 서비스에서 관련 추적 및 로그에 대한 필터링된 보기를 제공하려면 Microsoft와 <a href="https://azure.microsoft.com/en-us/blog/app-insights-microservices/" target="_blank">.NET 팀이</a> 이 릴리스에서 구현하기 시작한 또 다른 단계를 수행합니다.</p>


  <p>이제 여러 Node.js 및 .NET 서비스 간에 추적을 올바르게 연결할 수 있습니다. 두 서비스 모두 동일한 계측 키(ikey)를 활용할 때 HTTP를 통해 통신합니다. 예를 들어 다음 화면에서&rsquo;는 Node.js API 서비스를 사용하여 애플리케이션에서 실패한 요청을 조사하는 Im이며, 이 서비스는 .NET 서비스를 호출합니다. 관련 이벤트를 찾기 위해 이러한 오류 중 하나를 드릴 인합니다. 여기서는 Node.js 서비스에서 일부 이벤트와 .NET에서 일부 이벤트를 찾습니다. Im&rsquo;은 .NET 서비스의 예외로 인해 실패한 Node.js API 호출이 발생했음을 신속하게 식별할 수 있었습니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/10788ca0-be5c-4c4f-a305-04ea5f8c11cb.png"><img alt="03-transaction_trace_complete" border="0" height="1596" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/77784150-5f69-4cae-8005-002ad93619a4.png" style="background-image: none; float: none; margin-left: auto; display: block; margin-right: auto; border-image: none" title="03-transaction_trace_complete" width="450"></a></p>


  <h2>더 나은 앱 맵 지원</h2>


  <p>위에서 설명한 상관 관계 작업을 통해 앱 Insights&rsquo; 앱 <a href="https://docs.microsoft.com/en-us/azure/application-insights/app-insights-app-map" target="_blank">맵</a>에서 앱&rsquo; 토폴로지도 더 잘 나타낼 수 있습니다. 위에서 언급한 것과 동일한 Node.js 및 .NET 앱은 다음과 같이 앱 맵에 표시되며, Node.js API는 appinsights-node-02&rdquo;로&ldquo;, .NET 서비스는 api-11&rdquo;로 &ldquo;표시됩니다. api-11 노드의 오류(&ldquo;!&rdquo;) 아이콘은 이전 섹션에서 설명한 조사를 위한 또 다른 진입점으로 사용될 수 있습니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1e036fc1-4277-441a-b05e-2c9980da9ffd.png"><img alt="04-appmap" border="0" height="212" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4d0fb79-5c8e-42c0-b0ca-acef291986f0.png" style="background-image: none; float: none; margin-left: auto; display: block; margin-right: auto; border-image: none" title="04-appmap" width="480"></a></p>


  <p>앱 맵에서 제공하는 세부 정보를 계속 실험하고 있으며 요구 사항을 충족하는 데 필요한 사항에&rsquo; 대한 피드백을 받고 싶습니다.</p>


  <h2>타사 모듈의 정보</h2>


  <p>다음으로, Node.js&rsquo;대규모 모듈 에코시스템에서 파생된 가치의 양을 알아봅니다. 문제를&rsquo; 정확히 파악하는 데 도움이 되도록 타사 모듈에 대한 인사이트를 필요로 하는 경우가 많습니다. 예를 들어 MongoDB 호출이 실패하면 Mongo 서비스로 전송된 메시지와 수신된 오류를 파악하는 데 도움이 됩니다.</p>


  <p>앱 Insights 이 작업을 직접 추적하는 데 사용할 수 있는 <a href="https://docs.microsoft.com/en-us/azure/application-insights/app-insights-api-custom-events-metrics" target="_blank">사용자 API</a>를 제공하지만, 이 릴리스에서는 MongoDB, MySQL 및 Redis뿐만 아니라 Bunyan 로깅 프레임워크 및 <a href="https://nodejs.org/api/console.html" target="_blank">콘솔</a> API에 대해 자동으로 이 정보를 수집하기 시작합니다. 이제 실패한 데이터베이스 호출에 대한 자세한 내용을 자동으로 사용할 수 있습니다.</p>


  <p>예를 들어 이전 예제에서 MongoDB 호출로 이어진 Node.js API 호출이 실제로 Mongo에 *대한 2개의* 호출을 나열한 것을 확인할 수 있습니다. 드릴 인을 통해 다음 스크린샷과 같이 <a href="https://docs.mongodb.com/manual/reference/command/find/" target="_blank">find</a> 및 <a href="https://docs.mongodb.com/manual/reference/command/getMore/" target="_blank">getMore</a> 명령이 모두 전송되었는지 확인할 수 있었습니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d24d2e66-5e49-480b-99af-ffef02e9e660.png"><img alt="05-transaction_trace_mongodb-03" border="0" height="160" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/fdf2d0cd-0b36-4855-af61-3e37b947e7ea.png" style="background-image: none; float: none; margin-left: auto; display: block; margin-right: auto; border-image: none" title="05-transaction_trace_mongodb-03" width="770"></a></p>


  <p>타사 모듈에 대한 모듈 패치를 유지 관리하는 것은 일관되고 안정적으로&rsquo; 하기 어렵기 때문에 이러한 패치와 이를 GitHub 오픈 소스 <a href="https://github.com/Microsoft/node-diagnostic-channel" target="_blank">노드 진단 채널</a> 프로젝트로 활용하는 데 사용하는 메커니즘을 게시했습니다. Were&rsquo;는 이 프로젝트를 Project Glimpse과 공유하기 위해 노력하고 있으며, 공동 작업 방법에 대한 다른 도구 공급자 및 모듈 작성자의 <a href="https://github.com/Microsoft/node-diagnostic-channel/issues" target="_blank">피드백을</a> 좋아합니다.</p>


  <h2>샘플링</h2>


  <p>마지막으로 이 릴리스에는 앱 Insights 리소스로 전송되는 데이터의 양을 줄이고 <a href="https://azure.microsoft.com/en-us/pricing/details/application-insights/" target="_blank">비용을</a> 절감할 수 있도록 백분율 기반 샘플링에 대한 지원도 포함되어 있습니다. &rsquo;샘플링 알고리즘은 위에서 설명한 상관 관계 작업에 민감하므로 샘플링을&rsquo; 사용하도록 설정한 경우에도&rsquo; 샘플링된 요청에서 모든 관련 이벤트를 보냅니다.</p>


  <p>샘플링을 사용하도록 설정하려면 다음과 같이 클라이언트를 시작하기 전에 백분율을 지정합니다.</p>


  <pre>

  const appInsights = require(&quot;applicationinsights&quot;);

  appInsights.client.config.samplingPercentage = 33;

  appInsights.start();</pre>


  <h2>결론</h2>


  <p>이러한 업데이트 및 기타 업데이트에 대한 모든 세부 정보는 <a href="https://github.com/Microsoft/ApplicationInsights-node.js/releases/tag/0.20.0" target="_blank">v0.20.0, v0.20.1</a> 및 <a href="https://github.com/Microsoft/ApplicationInsights-node.js/releases/tag/0.20.1" target="_blank">v0.21.0</a>에 대한 변경 로그를 참조 <a href="https://github.com/Microsoft/ApplicationInsights-node.js/releases/tag/0.21.0" target="_blank">하세요</a>.</p>


  <p>우리의 목표는 Node.js 서비스 및 애플리케이션에서 성능 및 기능 문제를 신속하게 검색하고 진단할 수 있도록 돕는 것입니다. wed&rsquo;는 여기와 <a href="https://github.com/Microsoft/ApplicationInsights-node.js/issues" target="_blank">GitHub</a> 당신의 피드백을 사랑 were&rsquo; 하 고 당신에 게 가장 중요 한 것에&rsquo; 대 한. 감사합니다.</p>
