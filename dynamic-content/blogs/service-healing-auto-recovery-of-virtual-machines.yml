### YamlMime:Yaml
ms.openlocfilehash: 9a3b4893e1b5a796342f71d2be0e77ef0cd1c2aa
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139900730"
Slug: service-healing-auto-recovery-of-virtual-machines
Title: 서비스 복구 - Virtual Machines의 자동 복구
Summary: 이 블로그 게시물에서는 오류가 발생할 때 Azure에서 서비스 복구/자동 복구 메커니즘을 살펴보겠습니다.
Content: >-
  <p align="justify">거의 7년 전 PDC 2008에서 시작 및 공개 미리 보기가 시작된 이래로 Microsoft Azure 플랫폼에서 실행되는 VM(가상 머신)의 상태를 감지하고 실패할 경우 해당 가상 머신의 자동 복구를 수행할 수 있는 수단을 제공했습니다. 이 자동 복구 프로세스는 서비스 인스턴스를 복구하는 &ldquo;수단&ldquo;이므로 서비스 복구&rdquo;&rdquo;라고 합니다.&nbsp; 서비스 복구(즉, 자동 복구)는 클라우드에서 중요 비즈니스용 워크로드를 실행하는 데 필수적인 부분이므로 이 <strong>자동 복구 메커니즘은 모든 Azure 지역 및 데이터 센터에서 다양한 VM 크기 및 제품에 걸쳐 가상 머신에서 활성화되고 사용할 수 있습니다</strong>. 이 블로그 게시물에서는 오류가 발생할 때 Azure에서 서비스 복구/자동 복구 메커니즘을 살펴보겠습니다.</p>


  <p align="justify">오류로부터 복구하는 주요 측면은 먼저 오류가 발생했음을 감지하는 것입니다. 오류를 더 빨리 감지할수록 가상 머신이 오류 발생 시 중단되는 횟수는 줄어듭니다. 이를 MTTD(평균 검색 시간)라고도 합니다. Microsoft Azure 클라우드 운영 체제의 커널인 패브릭 컨트롤러에는 모든 가상 머신의 상태와 해당 컴퓨터 내에서 실행되는 코드(웹 또는 작업자 역할의 경우)를 추적하는 다양한 상태 프로토콜이 있습니다.</p>


  <p align="justify">아래 다이어그램에서는 오류가 발생할 수 있는 시스템의 여러 계층에 대한 개요와 Azure가 이를 감지하기 위해 수행하는 상태 검사를 제공합니다. &ndash;</p>


  <p><a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/04/07/Service-Healing-Blog-Post-Diagrams.png"><img alt="Service Healing Blog Post Diagrams" border="0" height="414" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Service-Healing-Blog-Post-Diagrams_thumb.png" style="float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; padding-right: 0px; margin-right: auto; border: 0px;" title="서비스 복구 블로그 게시물 다이어그램" width="640"></a></p>


  <p><strong>Cloud Services:</strong> 웹 및 작업자 역할의 경우 코드가 웹 또는 작업자 역할 인스턴스에서 실행됩니다. &rsquo;웹 역할인 경우 웹 엔드포인트는 15초마다 부하 분산 장치에서 ping하여 정상인지 여부를&#39;. 미리 정의된 연속 ping 수에 대한 상태 검사가 실패하면 엔드포인트가 비정상으로 간주되고, 회전에서 역할을 제거하고 역할을 비정상으로 표시하는 복구 작업이 수행됩니다.</p>


  <p><strong>참고:</strong> 이는 <a href="https://docs.microsoft.com/en-us/previous-versions/azure/reference/jj151530(v=azure.100)" target="_blank">사용자 지정 LB 프로브</a>가 아닌 기본 GA 기반 Load Balancer 회전의 경우에만 적용됩니다.</p>


  <p>웹 역할과 작업자 역할 모두에 대해 Azure는 게스트 에이전트를 VM에 삽입하여 역할을 모니터링합니다. 또한 이 게스트 에이전트는 가상 머신에서 역할 인스턴스의 15초마다 상태 검사를 수행합니다. 다시 말하지만, 미리 정의된 연속 상태 검사 실패 수 또는 부하 분산 장치의 신호로 인해 역할이 비정상 상태가 되고 역할 인스턴스를 다시 시작하는 복구 작업이 시작됩니다. &rsquo;Azure에서 이러한 상태 검사는 15초 간격 내에 수행되며 MTTD를 개선하기 위한 것입니다. 오류를 빠르고 일찍 감지하면 오류가 발생하는 즉시 해결할 수 있으며 종속 시스템이 실패하고 시스템을 통해 연속되지 않도록 방지할 수 있습니다.</p>


  <p>시스템의 다음 계층은 역할 인스턴스가 실행되는 가상 머신 자체의 상태입니다. 가상 머신은 Azure 데이터 센터 내에서 실행되는 물리적 서버에서 호스트됩니다. 물리적 서버는 호스트 에이전트라는 다른 에이전트를 실행합니다. 호스트 에이전트는 15초마다 웹 및 작업자 역할 VM에 대한 게스트 에이전트의 하트비트를 확인하여 가상 머신의 상태를 모니터링합니다. 가상 머신이 워크로드에서 스트레스를 받고 있는 것은 매우 그럴듯하며, CPU가 100% 사용률일 수 있으므로 몇 가지 상태 검사를 누락해도 복구 작업이 보장되지 않습니다&rsquo;. 복구 작업을 시작하기 전에 가상 머신이 상태 검사에 응답하는 데 최대 10분이 허용됩니다. 이 경우 복구 작업은 웹 &amp; 작업자 역할의 경우 깨끗한 OS 디스크로 가상 머신을 재활용하는 것입니다.</p>


  <p><strong>Azure Virtual Machines:</strong> Azure Virtual Machines의 경우 역할 인스턴스가 없고 기본적으로 자동으로 삽입되는 게스트 에이전트가 없습니다. 따라서 상태 검사는 하이퍼바이저에서 보고한 대로 가상 머신의 상태에서 수행됩니다. VM의 전원 상태에 문제가 있는 경우 디스크 상태를 그대로 유지하면서 다시 부팅을 수행합니다. Azure Virtual Machines의 경우 VM 내에서 발생하는 문제에 대해 어떠한 조치도 취하지 않습니다&rsquo;. 여기에는 지속적인 높은 CPU 사용률, VM OS 중지 및 VM OS의 애플리케이션 오류가 포함됩니다. 내부 VM OS 문제의 경우 애플리케이션 내에서 모니터링을 설정해야 합니다.</p>


  <p>시스템의 다음 계층은 가상 머신이 실행 중인 물리적 서버 자체의 상태입니다. 패브릭 컨트롤러는 호스트 에이전트를 통해 정기적으로 물리적 서버에서 상태 검사를 수행합니다. 특정 연속된 상태 검사 수가 연속적으로 실패하면 물리적 서버가 비정상으로 표시되고 컴퓨터가 정상 상태로 돌아오지 않으면&rsquo; 복구 작업이 시작됩니다. 먼저 물리적 서버를 다시 부팅합니다.</p>


  <p align="justify">물리적 서버가 미리 정의된 기간 내에 정상 상태로 돌아오지 않는&rsquo; 경우 물리적 서버에서 실행되는 가상 머신을 데이터 센터의 해당 파티션 내의 다른 정상 서버로 복구합니다.</p>


  <p align="justify">그런 다음 물리적 서버는 회전에서 분리되고, 격리되며, 오류의 원인을 확인하기 위해 광범위한 진단을 받게 되며, 필요한 경우 수리를 위해 제조업체로 보내집니다.</p>


  <p>&nbsp;</p>


  <h2>예방 조치를 취하기 위해 오류가 발생하기 전에도 예측</h2>


  <p align="justify">&rsquo;지금까지 설명한 내용은 오류가 발생한 경우와 Azure에서 검색하고 복구하는 방법에 대해 설명합니다. Azure는 오류에 대응할 뿐만 아니라 추론을 사용하여 오류가 발생하기 전에 임박한 오류를 예측하고 예방 조치를 취하므로 MTTR(평균 복구 시간)이 향상됩니다.</p>


  <p align="justify">앞에서 설명한 호스트 에이전트는 물리적 서버에 있는 서버 및 디스크, 메모리 및 기타 하드웨어와 같은 연결된 다른 디바이스에 대한 상태 정보를 주기적으로 수집합니다. 이 정보에는 CPU 사용률 및 디스크 IO와 같은 성능 카운터뿐만 아니라 다른 메트릭도 포함됩니다. 예를 들어 디스크 드라이브의 잘못된 섹터는 디스크 오류가 임박한 시기를 예측하는 데 도움이 될 수 있습니다. 오류가 발생하기 전에 가능한 한 빨리 해당 서버에서 가상 머신의 복구를 수행하고 광범위한 진단을 위해 물리적 서버를 전달합니다.</p>


  <p>&nbsp;</p>


  <h2>빅 데이터 분석을 사용하여 오류 분석</h2>


  <p align="justify">Microsoft Azure 플랫폼에서 실행되는 모든 가상 머신에서 매일 여러 테라바이트의 진단 로그, 상태 검사 정보 및 크래시 덤프를 생성합니다. 이 데이터를 사용하여 오류의 패턴을 식별합니다. 이러한 로그 및 충돌을 분석하기 위해 <a href="https://bit.ly/1CW8U3f">Cosmos</a>&rdquo;라는 &ldquo; 지도 감소 구현에서 자동화된 빅 데이터 분석을 실행합니다. 이러한 분석은 이러한 오류의 패턴을 식별하는 데 도움이 되며, 이는 시스템의 버그를 식별하는 데 도움이 됩니다. 또한 이러한 기능은 과거에 시스템을 개선하거나 기존 기능을 개선하기 위한 새로운 기능을 식별하는 데 도움이 되는 경우가 많습니다. 이 데이터는 자신과 같은 고객의 귀중한 피드백과 함께 플랫폼을 발전시킬 수 있도록 도와줍니다.</p>


  <p align="justify">또한 MTTD 및 MTTR을 더욱 개선하기 위해 언제든지 이 블로그 게시물에 언급된 상태 검사 값을 조정할 수 있습니다. 이러한 기능은 Azure 서비스 복구 메커니즘의 작동 방식을 설명하기 위해 이 게시물에서 제공되었습니다.</p>
