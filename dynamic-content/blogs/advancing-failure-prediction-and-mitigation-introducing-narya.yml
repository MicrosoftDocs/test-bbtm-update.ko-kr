### YamlMime:Yaml
ms.openlocfilehash: 9860943c4df899c90e0a874bab982fce9ddf9342
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139906665"
Slug: advancing-failure-prediction-and-mitigation-introducing-narya
Title: 오류 예측 및 완화 진행 - Narya 소개
Summary: Project Narya는 시간의 피로에 저항하는 것으로 알려진 반지의 제왕의 "불의 고리"의 이름을 따서 명명된 전체적인 엔드투엔드 예측 및 완화 서비스입니다.
Content: >-
  <p><em>&quot;이 게시물은 Azure 플랫폼<a href="https://www.aka.ms/AdvancingReliability" target="_blank">의 안정성을</a> 지속적으로 개선하기 위해 진행 중인 고급 안정성 시리즈를 강조 표시하는 이니셔티브를 계속 진행합니다. 2018년에는 <a href="https://azure.microsoft.com/blog/improving-azure-virtual-machine-resiliency-with-predictive-ml-and-live-migration/" target="_blank">실시간 마이그레이션</a>을 사용하여 VM(가상 머신) 복원력을 개선하기 위해 수행할&#39;단계를 공유했습니다. 2019년에는 호스트 오류를 식별하고 메모리 보존 소프트 커널 재부팅을 통해 복구하는 <a href="https://azure.microsoft.com/blog/improving-azure-virtual-machines-resiliency-with-project-tardigrade/" target="_blank">Project Tardigrade</a>를 사용하여 가상 머신&nbsp; 저항성을 더욱 개선할&#39;방법을 공유했습니다. 2020년에는 인공 지능을 사용하여 서비스 품질을 개선하기 위한 <a href="https://azure.microsoft.com/blog/advancing-azure-service-quality-with-artificial-intelligence-aiops/" target="_blank">AIOps 비전을</a> 공유했습니다. 현재는 엔드투엔드 예측 및 완화 서비스인 Project Narya를 도입하여 이러한 노력이 어떻게 진화하고 있는지에 대한 업데이트를 제공하고자 했습니다. 지난 주 <a href="https://www.youtube.com/watch?v=69PrhWQorEM" target="_blank">Microsoft Ignite에서 공유</a>한 것처럼 Narya는 Azure의 지능형 인프라에서 중요한 부분이 되었습니다. 다음 게시물은 Azure Compute 팀의 프로그램 관리자인 <strong>Jeffrey He</strong>가 작성했습니다.&quot;&mdash;</em> Mark Russinovich, CTO, Azure</p>


  <hr>

  <p><em>이 게시물에는 수석 데이터 과학자 매니저 <strong>인 Yingnong Dang</strong> 과 수석 데이터 과학자 <strong>세바스티안 레비</strong>, <strong>랜돌프 야오</strong> 및 <strong>유장 우</strong>의 기부금이 포함되어 있습니다.</em></p>


  <p>Project 나리아는 시간의 피로에 저항하는 것으로 알려진 반지의 제왕의 불&quot; 고리 뒤&quot;의 전체적인 엔드투엔드 예측 및 완화 서비스&mdash;입니다. Narya는 Azure 호스트 오류를 예측하고 완화할 뿐만 아니라 완화 작업의 영향을 측정하고 자동 피드백 루프를 사용하여 완화 전략을 지능적으로 조정하도록 설계되었습니다. 전 세계 모든 Azure 컴퓨팅 클러스터에 배포한 일반적인 기계 학습 및 예측 서비스 시스템인 Resource Central 플랫폼을 활용합니다. Narya는 1년 이상 프로덕션 환경에서 실행되어 왔으며, Azure 워크로드를 보다 원활하게 실행하기 위해 평균적으로 가상 머신 중단을 26%&mdash; 줄였습니다.&nbsp; 이 블로그 게시물은 이 Narya 프레임워크에 대한 개요를 제공합니다. 자세한 내용은 운영 체제 디자인 및 구현에 대한 제14회 USENIX 심포지엄(OSDI 2020)에서 <a href="https://www.usenix.org/conference/osdi20/presentation/levy" target="_blank">프로덕션 클라우드 VM 중단&quot; 방지에 대한 예측 및 적응 실패 완화를 참조&quot;</a>하세요.&nbsp;</p>


  <h2>나리아 전에 어떻게 접근했는가?</h2>


  <p>과거에는 기계 학습을 사용하여 오류 예측을 알리고 예측된 오류에 따라 정적으로 완화 작업을 선택했습니다. 예를 들어 하드웨어의 일부가 위험에 처한&quot; 것으로 &quot;확인되면 워크로드를 실행하는 고객에게 인-가상 머신&nbsp; 주석화를 통해&nbsp; 성능이 저하된 하드웨어를 감지했음을 알립니다. 또한 항상 다음 단계 집합을 수행합니다.</p>


  <ol>
      <li>노드에서 새 할당을 차단합니다.</li>
      <li>실시간 마이그레이션을 사용하여 가능한 한 많은 가상 머신을 즉시 마이그레이션합니다.</li>
      <li>수명이 짧은 가상 머신&nbsp;이 유기적으로 중지되거나 고객이 다시 배포할 때까지 며칠 동안 기다립니다.</li>
      <li>나머지 가상 머신을 마이그레이션하여 가상 머신&nbsp;의 연결을 끊고 정상 노드로 이동합니다.</li>
      <li>노드를 프로덕션에서 꺼내고 내부 진단을 실행하여 복구 작업을 결정합니다.</li>
  </ol>


  <p>이 방법은 잘 작동했지만 특정 시나리오에서 개선할 수 있는 몇 가지 기회를 보았습니다. 예를 들어 일부 오류는 너무 심각하여(예: 손상된 디스크) 가상 머신이 중지되거나 다시 배포될 때까지 며칠을 기다릴 수 있습니다. 경우에 따라 위험&quot; 예측은 &quot;더 사소하거나 거짓 긍정일 수 있습니다. 이러한 경우 강제 마이그레이션은 불필요한 고객에게 영향을 미치게 되며, 대신 추가 신호를 계속 모니터링하고 지정된 기간 후에 노드를 다시 평가하는 것이 좋습니다. 궁극적으로 고객에게 가장 적합한 시스템을 설계하려면 예측에 대응하는 방법을 보다 유연하게 설계해야 할 뿐만 아니라 모든 시나리오에 대한 작업의 정확한 고객 영향을 측정해야 한다는 결론을 내렸습니다.</p>


  <h2>나리아와 함께 지금 어떻게 접근해야 할까요?</h2>


  <p>이곳은 나리아가 들어오는 곳입니다. Narya는 위험 예측&quot;에 대해 &quot;미리 결정된 단일 완화 조치를 갖는 대신 가능한 여러 완화 작업을 고려합니다. 지정된 예측 집합의 경우 Narya는 온라인 A/B 테스트 프레임워크 또는 강화 학습 프레임워크를 사용하여 최상의 응답을 결정합니다.</p>


  <h3>1단계: 오류 예측</h3>


  <p>Narya는 플릿 원격 분석을 사용하여 하드웨어 오류로 인한 잠재적인 호스트 오류를 예측하는 것으로 시작합니다. 도메인 전문가, 지식 기반 예측 규칙 및 기계 학습 기반 방법을 혼합하여 정확한 예측을 생성할 수 있습니다.</p>


  <p>도메인 전문가 예측 규칙의 예는&nbsp; IERR(CPUInternal&nbsp; Error)이 n일(예: n = 30) 내에 두 번 발생한다는 것입니다. 이는 노드가 곧 다시 실패할 가능성이 있음을 나타냅니다. Narya는 현재 데이터 기반 메서드에서 파생된 수십 개의 도메인 전문가 예측 규칙을 사용합니다.</p>


  <p>Narya는 또한 기계 학습 모델을 통합합니다. 이는 이전에 오류를 예측하도록 하는 예측 규칙&mdash;보다 더 큰 시간 프레임에 걸쳐 더 많은 신호와 패턴을 분석하기 때문에 유용합니다. 이는 이전의 오류 예측 작업을 기반으로 하지만 개별 구성 요소의 실패에 초점을 맞추지 않고 이제 이 모델은 실제 고객 영향과 관련하여 전반적인 호스트 상태를 검토합니다. 2018년부터 들어오는 신호의 종류도 확장되었으며 신호 품질도 향상되었습니다. 결과적으로 가양성 및 부정의 수를 줄여 궁극적으로 이 실패 예측 단계의 효율성을 향상시켰습니다.</p>


  <h3>2단계: 완화 작업 결정 및 적용</h3>


  <p>한 가지 고정 완화 전략을 사용하는 대신 Narya에서 고려해야 할 완화 작업을 선택했습니다. 각 완화 작업은 다음을 비롯한 여러 작은 단계의 복합으로 간주될 수 있습니다.</p>


  <ul>
      <li>노드를 할당할 수 없음으로 표시합니다.</li>
      <li>가상 머신&nbsp;을 다른 노드로 <a href="https://azure.microsoft.com/blog/improving-azure-virtual-machine-resiliency-with-predictive-ml-and-live-migration/" target="_blank">실시간 마이그레이션</a></li>
      <li>메모리<a href="https://azure.microsoft.com/blog/improving-azure-virtual-machines-resiliency-with-project-tardigrade/" target="_blank">를 유지하면서 커널을 일시</a> 중지하여 짧은 일시 중지만 발생하는 고객 워크로드에 대한 중단을 최소화합니다.</li>
      <li>노드에서&nbsp; 할당 해제</li>
      <li>기타</li>
  </ul>


  <p>예를 들어 한 가지 완화 작업은 노드를 할당할 수 없음으로 표시한 다음 메모리 유지 커널 일시 다시 부팅을 시도하고 성공하면 다시 할당할 수 있도록 표시하는 것입니다. 실패하면 실시간 마이그레이션을 구현하고 노드를 진단으로 전송합니다. 여기서 테스트를 실행하여 하드웨어의 성능이 저하되었는지 확인합니다. 이 경우 하드웨어를 복구하고 교체하기 위해 노드를 보냅니다. 전반적으로 이를 통해 다양한 완화를 통해 다양한 시나리오를 처리할 수 있는 훨씬 더 많은 유연성을 제공하여 전반적인 Azure 호스트 복원력을 개선합니다.</p>


  <p>위험 예측&quot;에 훨씬 더 유연한 방식으로 응답하기 위해 &quot;Narya는 온라인 A/B 테스트 프레임워크 및 RL(강화 학습) 프레임워크를 사용하여 최소한의 가상 머신 중단에 대한 완화 작업을 지속적으로 최적화합니다.</p>


  <h3>A/B 테스트 프레임워크</h3>


  <p>Narya는 A/B 테스트를 수행할 때 다른 완화 작업을 선택하고, 아무 작업도 수행하지 않은 컨트롤 그룹과 비교하고, 모든 데이터를 수집하여 어떤 시나리오에 가장 적합한 완화 작업을 결정합니다. 이후부터 이 지정된 오류 예측 집합에 대해 가상 머신&nbsp; 리소스를 줄이고, 사용 가능한 용량을 더 보장하며, 최상의 성능을 유지하기 위한 최상의 작업을&mdash; 지속적으로 선택합니다.</p>


  <h3>RL(보충 학습) 프레임워크</h3>


  <p>Narya는 강화 학습을 사용하는 경우 시간이 지남에 따라 다양한 작업을 탐색하고 가장 최근의 작업을 가장 많이 가중시켜 전반적인 고객 경험을 최대화하는 방법을 알아봅니다. 강화 학습은 최적 작업 사용과 새로운 작업 탐색 간에 지속적으로 균형을 이루어 최적의 작업을 덜 방지하는 방법을 자동으로 학습한다는 측면에서 A/B 테스트와 다릅니다.</p>


  <h3>3단계: 고객에게 미치는 영향 관찰 및 모델 재학습</h3>


  <p>마지막으로 완화 작업을 수행한 후 새 데이터를 수집할 수 있습니다. 이제 Narya 프레임워크의 모든 단계에서 모델을 지속적으로 개선하는 데 사용하는 최신 고객 영향 데이터의 측정값을 제공합니다. Narya는 이 작업을 자동으로&mdash; 수행하도록 합니다. 데이터는 실패 예측 단계에서 도메인 전문가 규칙 및 기계 학습 모델을 업데이트하는 데 도움이 될 뿐만 아니라 의사 결정 단계에서 더 나은 완화 작업 정책을 알려줍니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/8e1ca08a-b3f4-4108-b491-6819e133e7aa.png"><img alt="Narya starts with a hardware failure prediction, makes a smart decision on how to respond, implements the response, then measures the customer impact and incorporates it via a feedback loop." border="0" height="332" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f61ae5d8-a9d6-44e7-a78c-f15d702aec41.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="" width="1024"></a></p>


  <p><em>그림 1: Narya는 하드웨어 오류 예측으로 시작하고, 응답하는 방법에 대한 현명한 결정을 내리고, 응답을 구현한 다음, 고객에게 미치는 영향을 측정하고 피드백 루프를 통해 통합합니다.</em></p>


  <h2>나리야 작동 중: 예제</h2>


  <p>다음은 Narya가 실제 고객 워크로드를 보호하는 데 도움을 준 실제 예제입니다.</p>


  <ul>
      <li>T0 20:15:31, Narya는 노드가 디스크 문제로 인해 실패할 확률이 높다고 예측했습니다.</li>
      <li>T0 20:32:01, Narya는 완화 작업을 &quot;선택했습니다. 노드를 3일 동안 할당할 수 없는 것으로 표시하고, 실시간 마이그레이션을 시도하고, 모든 가상 머신이 마이그레이션된 후 또는 호스트가 실패하면 노드를 진단으로 보냅니다.&quot;</li>
      <li>T0 20:32:11, 노드는 할당할 수 없는 것으로 표시되었으며 실시간 마이그레이션이 트리거되었습니다.</li>
      <li>T0 20:47:22 &ndash; 00:11:55, 실시간 마이그레이션에 적합한 9개의 가상 머신이 노드에서 성공적으로 마이그레이션되었습니다.</li>
      <li>T1 19:14:01, 노드가 비정상 상태가 되었으며 노드의 가상 머신&nbsp; 15개가 다시 부팅되었습니다.</li>
      <li>T1 19:55:07, 노드가 오류 상태를 입력한 후 진단으로 전송됩니다.</li>
      <li>T2 00:14:12, 디스크 스트레스 테스트에 실패했습니다.</li>
      <li>T3 00:19:56, 디스크가 교체되었습니다.</li>
  </ul>


  <p>이 실제 예제에서 Narya는 9개의 가상 Machinereboots&nbsp;를 방지하고 곧 실패할 것으로 예상되는 노드에 새 워크로드가 할당되지 않도록 하여 고객의 추가적인 고통을 방지했습니다. 또한 손상된 노드는 즉시 복구를 위해 전송되었으며, 이미 문제를 예상했기 때문에 반복된 가상 머신&nbsp; 부팅이 없었습니다. 이 예제는 비교적 간단하지만 주요 목적은 Narya가 상황을 평가하고 이 상황에 대해 이 완화 작업을 현명하게 선택했음을 설명하는 것입니다. 다른 시나리오에서 완화 작업에는 노드를 다른 일 수 동안 할당할 수 없는 상태로 표시하거나, 실시간 마이그레이션 대신 소프트 커널 다시 부팅을 시도하거나, 할당 취소로 노드를 완전히 표시하지 않고 할당을 취소하는 작업이 포함될 수 있습니다. Narya는 다양한 &quot;위험 예측&quot; 에 훨씬 더 유연하게 대응하여 전반적인 고객 환경을 가장 잘 개선하기 위해 구축되었습니다.</p>


  <h2>나리아의 다른 점은 무엇인가요?</h2>


  <ol>
      <li><strong>데이터 기반 작업 선택:</strong> 이제 완화 작업을 가장 잘 추측하는 대신 데이터를 사용하여 선택한 각 완화 작업의 실제 영향을 확인하여 각 완화 작업의 효과를 테스트하고 측정하고 있습니다.</li>
      <li><strong>가능한 경우 동적:</strong> 정적 완화 할당이 있는 것과는 달리, 이제 Narya는 소프트웨어 업데이트, 하드웨어 업데이트 또는 고객 워크로드 변경 등을 통해 시스템이 변경되는 경우에도 최상의 완화 작업이 선택되도록 지속적으로 보장합니다. 예를 들어 CPU 빈도 저하로 인해 예측된 실패로 인해 실시간 마이그레이션을 수행할 수 있는 정적 할당이 있을 수 있습니다. 이는 임박한 오류를 나타내는 방어 메커니즘일 수 있지만, Azure 플랫폼에 대한 최근 업데이트에서는 시스템이 의도적으로 CPU 빈도를 조정하여 전력 소비의 균형을 조정할 수 있습니다. 즉, CPU 빈도의 하락이 반드시 실시간 마이그레이션을 수행해야 한다는 의미는 아닙니다. 정적 할당을 사용하면 정상 노드를 실수로 사용하지 않기 때문에 실수로 피해를 입히는 작업을 적용합니다. Narya를 사용하면 A/B 테스트 및 강화 학습에서 이 특정 시나리오의 경우 실시간 마이그레이션이 더 이상 최적의 완화 작업이 아닙니다.</li>
      <li><strong>유연한 완화 작업:</strong> 과거에는 주어진 증상 집합에 대해 주어진 완화 조치 중 하나만 처방 될 수 있습니다. 그러나 다중 테넌트 및 다양한 고객 워크로드의 경우 전문가 도메인 지식이 있더라도 미리 최상의 완화 방법을 결정하기가 어려웠습니다. 이제 Narya를 사용하여 원하는 만큼 완화 작업을 구성하고 Narya가 다른 오류 예측에 가장 적합한 작업 항목을 자동으로 테스트하고 선택할 수 있도록 할 수 있습니다. 마지막으로, 스마트 안전 메커니즘이 마련되어 있기 때문에 Narya&#39;완화 작업 체인이 무기한 차단으로 이어질 수 있는 데드 잠금을 방지할 수 있다고 확신할 수 있습니다.</li>
  </ol>


  <h2>앞으로 이동</h2>


  <p>앞으로는 Azure를 더욱 복원력 있고 안정적으로 만들기 위해 Narya를 개선할 수 있기를 바랍니다. 특히 다음을 수행할 계획입니다.</p>


  <ul>
      <li><strong>더 많은 예측 시나리오를 통합합니다.</strong> 더 많은 하드웨어 오류 유형을 다루는 고급 하드웨어 오류 예측 기술을 개발할 계획입니다. 또한 이 예측 단계에 더 많은 소프트웨어 시나리오를 통합할 계획입니다.</li>
      <li><strong>추가 완화 작업 통합:</strong> 추가 완화 작업을 구축하면 Narya가 광범위한 오류 예측에 응답하는 방법에 더 많은 유연성을 추가할 수 있습니다.</li>
      <li><strong>의사 결정을 더 스마트하게 만들기:</strong> 마지막으로, 최상의 완화 조치를 결정하는 스마트 의사 결정&quot; 단계에 더 많은 뉘앙스를 &quot;추가하여 Narya를 개선할 계획입니다. 예를 들어 지정된 노드에서 실행 중인 워크로드를 살펴보고, 해당 정보를 &quot;스마트 의사 결정&quot; 단계에 통합하고, 중단을 최소화하는 방식으로 완화 작업을 수행할 수 있습니다.</li>
  </ul>


  <p>Narya 프레임워크에 대한 자세한 설명은 운영 체제 디자인 및 구현에 대한 제14회 USENIX Symposium(OSDI 2020)에서 <a href="https://www.usenix.org/conference/osdi20/presentation/levy" target="_blank">프로덕션 클라우드 VM 인터럽트&quot;페이퍼를 피하기 위한 outourPredictive&quot;</a>&nbsp;&nbsp; 및 적응 오류 완화를 확인하세요.&nbsp;</p>
