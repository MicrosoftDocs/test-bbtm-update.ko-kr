### YamlMime:Yaml
ms.openlocfilehash: b221f1dad652a7f9b2f8a942a6c2cdf3cf9586e7
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139911965"
Slug: creating-a-bing-map-tile-server-from-windows-azure
Title: Windows Azure에서 Bing 맵 타일 서버 만들기
Summary: '[이 문서는 SQL Azure 팀에서 제공했습니다.] 이 예제 애플리케이션에서는 타일에 푸시 핀을 그리는 Windows Azure를 사용하여 Bing 지도 타일 서버를 빌드합니다.'
Content: "<p>[이 문서는 SQL Azure 팀에서 제공했습니다.]</p><p>이 예제 애플리케이션에서는 SQL Azure 공간 데이터로 저장된 좌표를 기반으로 타일에 푸시 핀을 그리는 Windows Azure를 사용하여 Bing 지도 타일 서버를 빌드합니다. Bing 지도 사용자 지정 타일을 사용하여 맵을 그릴 수 있습니다. 이러한 타일은 Windows Azure 서버에서 동적으로 생성할 수 있습니다. 이 예제에서 생성하는 오버레이는 SQL Azure 데이터베이스에 저장된 위도 및 경도 지점에 해당합니다. </p> <p>압정을 그리는 또 다른 옵션이 있습니다. JavaScript를 사용하여 Bing 맵 Ajax 컨트롤을 사용하면 압정을 그릴 수 있습니다. 그러나 지도에 약 200개의 푸시 핀이 있으면 JavaScript를 사용할 때 성능이 저하됩니다.&nbsp; 따라서 압정이 많은 경우 타일 서버를 사용하여 서버 쪽을 그립니다.</p> <p>Windows Azure는 맵을 제공하는 웹 사이트의 트래픽 요구 사항에 맞게 크기를 조정할 수 있으므로 타일 서버를 만들 때 사용할 수 있는 완벽한 솔루션입니다. SQL Azure 공간 데이터 형식 지원으로 인해 푸시 핀으로 그릴 위도 및 경도 지점을 보유하기에 완벽한 일치입니다. </p> <p>이 애플리케이션에 대한 쓰기의 까다로운 부분은 블로그 게시물의 공간에서 이러한 연결되지 않은 기술에 대한 모든 지식을 조립하는 것입니다. 이 때문에 Bing 지도, Windows Azure 및 SQL Azure 대한 쓰기에 대한 문서에 연결하지 않을 것입니다. </p> <p><a href=\"\"><img style=\"border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px\" title=\"이미지\" border=\"0\" alt=\"image\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/7343.image_5F00_thumb_5F00_02394066.png\" width=\"534\" height=\"531\"></a> </p> <h4>Bing 지도</h4> <p>웹 페이지에 Bing 맵을 포함하려면 Bing 맵 개발자 계정 및 Bing 매핑 키를 가져와야 합니다. Bing <a href=\"https://www.bingmapsportal.com/\">맵 포털</a>에서 이 작업을 수행할 수 있습니다. 키가 있으면 Bing 지도 AJAX 컨트롤을 시작하는 방법에 대한 이 <a href=\"https://msdn.microsoft.com/en-us/library/ee692181.aspx\">문서를</a> 읽어보세요. 이 예제에서는 웹 페이지에 Bing 맵을 포함하는 데 사용했습니다. 자체 Bing 맵 타일 서버를 빌드할 예정이므로 Bing 타일을 구성하는 방법과 사용자 고유의 타일 서버 <a href=\"https://msdn.microsoft.com/en-us/library/bb545006.aspx\">빌드</a>라는 제목의 문서에서 타일 서버를 참조하기 위해 추가해야 하는 JavaScript에 대해 알아봅니다. 또는 다음과 같이 간단한 포함된 맵을 위해 HTML을 잘라내어 붙여넣을 수 있습니다.</p><pre class=\"csharpcode\"><span class=\"kwrd\">&lt;!</span><span class=\"html\">DOCTYPE</span> <span class=\"attr\">html</span> <span class=\"attr\">PUBLIC</span> <span class=\"kwrd\">\"-//W3C//DTD XHTML 1.0 Transitional//EN\"</span> <span class=\"kwrd\">\"\"</span><span class=\"kwrd\">&gt;</span>  <span class=\"kwrd\">&lt;</span><span class=\"html\">html</span> <span class=\"attr\">xmlns</span><span class=\"kwrd\">=\"https://www.w3.org/1999/xhtml\"</span><span class=\"kwrd\">&gt;</span>  <span class=\"kwrd\">&lt;</span><span class=\"html\">head</span><span class=\"kwrd\">&gt;</span>      <span class=\"kwrd\">&lt;</span><span class=\"html\">title</span><span class=\"kwrd\">&gt;</span>My Virtual Earth<span class=\"kwrd\">&lt;/</span><span class=\"html\">title</span><span class=\"kwrd\">&gt;</span>      <span class=\"kwrd\">&lt;</span><span class=\"html\">meta</span> <span class=\"attr\">http-equiv</span><span class=\"kwrd\">=\"Content-Type\"</span> <span class=\"attr\">content</span><span class=\"kwrd\">=\"text/html; charset=utf-8\"</span> <span class=\"kwrd\">/&gt;</span>        <span class=\"kwrd\">&lt;</span><span class=\"html\">script</span> <span class=\"attr\">type</span><span class=\"kwrd\">=\"text/javascript\"</span> <span class=\"attr\">src</span><span class=\"kwrd\">=\"\"</span><span class=\"kwrd\">&gt;</span>      <span class=\"kwrd\">&lt;/</span><span class=\"html\">script</span><span class=\"kwrd\">&gt;</span>        &lt;script type=<span class=\"str\">\"text/javascript\"</span>&gt;          <span class=\"kwrd\">var</span> map = <span class=\"kwrd\">null</span>;          <span class=\"kwrd\">function</span> OnPageLoad() {              map = <span class=\"kwrd\">new</span> VEMap(<span class=\"str\">'myMap'</span>);              map.SetCredentials                  (<span class=\"str\">\"...\"</span>);                map.LoadMap(<span class=\"kwrd\">new</span> VELatLong(0, 0), 1, <span class=\"str\">'r'</span>, <span class=\"kwrd\">false</span>);                <span class=\"kwrd\">var</span> opacity = 0.9;              <span class=\"kwrd\">var</span> tileSourceSpec = <span class=\"kwrd\">new</span> VETileSourceSpecification(                  <span class=\"str\">\"sqltiles\"</span>,                       <span class=\"str\">\"\"</span>);              tileSourceSpec.NumServers = 1;              tileSourceSpec.MinZoom = 1;              tileSourceSpec.MaxZoom = 18;              tileSourceSpec.Opacity = opacity;              tileSourceSpec.ZIndex = 100;                map.AddTileLayer(tileSourceSpec, <span class=\"kwrd\">true</span>);                map.ShowTileLayer(<span class=\"str\">\"sqltiles\"</span>);            }      <span class=\"kwrd\">&lt;/</span><span class=\"html\">script</span><span class=\"kwrd\">&gt;</span>    <span class=\"kwrd\">&lt;/</span><span class=\"html\">head</span><span class=\"kwrd\">&gt;</span>  <span class=\"kwrd\">&lt;</span><span class=\"html\">body</span> <span class=\"attr\">onload</span><span class=\"kwrd\">=\"OnPageLoad();\"</span><span class=\"kwrd\">&gt;</span>      <span class=\"kwrd\">&lt;</span><span class=\"html\">div</span> <span class=\"attr\">id</span><span class=\"kwrd\">='myMap'</span> <span class=\"attr\">style</span><span class=\"kwrd\">=\"position: relative; width: 512px; height: 512px;\"</span><span class=\"kwrd\">&gt;</span>      <span class=\"kwrd\">&lt;/</span><span class=\"html\">div</span><span class=\"kwrd\">&gt;</span>  <span class=\"kwrd\">&lt;/</span><span class=\"html\">body</span><span class=\"kwrd\">&gt;</span>  <span class=\"kwrd\">&lt;/</span><span class=\"html\">html</span><span class=\"kwrd\">&gt;</span>  </pre>  <p>    </p>  <p>타일 서버에 로컬 서버를 사용하고 있습니다. 이렇게 하면 ASP.NET 코드를 프로그래밍할 때마다 Windows Azure에 배포하지 않고도 Windows Azure 개발 패브릭에서 타일 서버를 신속하게 테스트할 수 있습니다. </p>  <h4>Windows Azure</h4>  <p>Windows Azure 웹 역할을 사용하여 Bing Map Ajax Control에 타이틀을 제공할 예정입니다. 웹 역할을 아직 만들지 않은 경우 다음을 읽어야 합니다. 연습: 첫 번째 Windows Azure 로컬 애플리케이션 만들기. 배포할 준비가 되면 <a href=\"https://windows.azure.com/\">Windows Azure Portal</a>을 방문하여 타일을 인터넷에 제공하는 새 Hosted Service를 만들어야 합니다. 그러나 지금은 Windows Azure Development Fabric에서 타일을 제공할 수 있습니다. Windows Azure Tools를 설치할 때 설치됩니다. 다운로드는 여기에서 찾을 수 <a href=\"https://msdn.microsoft.com/en-us/windowsazure/cc974146.aspx\">있습니다</a>. </p>  <p>클라우드 프로젝트에서 웹 역할을 만든 후에는 tile.aspx라는 ASP.NET 페이지를 추가합니다. ASP.NET 페이지는 일반적으로 HTML을 제공하지만, 이 경우 ASP.NET 페이지에서 이미지를 PNG로 제공하려고 합니다. Bing Map AJAX Control은 쿼리 문자열에 쿼드키가 있는 tile.aspx 페이지를 호출하여 타일(이미지)을 가져옵니다. 이 작업은 표시되는 모든 확대/축소 수준에 대해 4개의 서로 다른 타일 식별자를 사용하여 약 4번 수행됩니다. 쿼드키에 대한 자세한 내용은 여기에서 찾을 수 <a href=\"https://msdn.microsoft.com/en-us/library/bb259689.aspx\">있습니다</a>. 예제 ASP.NET 코드는 쿼드키를 사용하여 타일의 경계 위도/경도를 파악합니다. 이 정보를 사용하여 경계 위도 및 경도에 속하는 모든 지점에 대해 SQL Azure 쿼리를 만들 수 있습니다. 지점은 SQL Azure 지<a href=\"https://msdn.microsoft.com/en-us/library/bb933802.aspx\">리 데이터 형식</a>(POINT)으로 저장되며 <a href=\"https://msdn.microsoft.com/en-us/library/bb933899.aspx\">공간 교집합</a> 쿼리를 사용하여 타일 내에 있는 점을 파악합니다. </p>  <h4>SQL Azure</h4>  <p>다음은 예제에 대해 SQL Azure 만든 테이블에 대한 스크립트입니다.</p><pre class=\"csharpcode\"><span class=\"kwrd\">CREATE</span> <span class=\"kwrd\">TABLE</span> [dbo].[Points](      [ID] [<span class=\"kwrd\">int</span>] <span class=\"kwrd\">IDENTITY</span>(1,1) <span class=\"kwrd\">NOT</span> <span class=\"kwrd\">NULL</span>,      [LatLong] [geography] <span class=\"kwrd\">NULL</span>,      [Name] [<span class=\"kwrd\">varchar</span>](50) <span class=\"kwrd\">NULL</span>,   <span class=\"kwrd\">CONSTRAINT</span> [PrimaryKey_2451402d-8789-4325-b36b-2cfe05df04bb] <span class=\"kwrd\">PRIMARY</span> <span class=\"kwrd\">KEY</span> <span class=\"kwrd\">CLUSTERED</span>   (      [ID] <span class=\"kwrd\">ASC</span>  )  )  </pre>  <p>    </p>  <p>내 위도와 경도를 보관하는 지리 데이터 형식과 함께 멋진 것은 아닙니다. 그런 다음 다음과 같이 테이블에 일부 데이터를 삽입했습니다.</p><pre class=\"csharpcode\">INSERT <span class=\"kwrd\">INTO</span> Points (Name, LatLong) <span class=\"kwrd\">VALUES</span>       (<span class=\"str\">'Statue of Liberty'</span>,       geography::STPointFromText(<span class=\"str\">'POINT(-74.044563 40.689168)'</span>, 4326))  INSERT <span class=\"kwrd\">INTO</span> Points (Name, LatLong) <span class=\"kwrd\">VALUES</span>       (<span class=\"str\">'Eiffel Tower'</span>,       geography::STPointFromText(<span class=\"str\">'POINT(2.294694 48.858454)'</span>, 4326))  INSERT <span class=\"kwrd\">INTO</span> Points (Name, LatLong) <span class=\"kwrd\">VALUES</span>       (<span class=\"str\">'Leaning Tower of Pisa'</span>,       geography::STPointFromText(<span class=\"str\">'POINT(10.396604 43.72294)'</span>, 4326))  INSERT <span class=\"kwrd\">INTO</span> Points (Name, LatLong) <span class=\"kwrd\">VALUES</span>      (<span class=\"str\">'Great Pyramids of Giza'</span>,       geography::STPointFromText(<span class=\"str\">'POINT(31.134632 29.978989)'</span>, 4326))  INSERT <span class=\"kwrd\">INTO</span> Points (Name, LatLong) <span class=\"kwrd\">VALUES</span>       (<span class=\"str\">'Sydney Opera House'</span>,       geography::STPointFromText(<span class=\"str\">'POINT( 151.214967 -33.856651)'</span>, 4326))  INSERT <span class=\"kwrd\">INTO</span> Points (Name, LatLong) <span class=\"kwrd\">VALUES</span>      (<span class=\"str\">'Taj Mahal'</span>,       geography::STPointFromText(<span class=\"str\">'POINT(78.042042 27.175047)'</span>, 4326))  INSERT <span class=\"kwrd\">INTO</span> Points (Name, LatLong) <span class=\"kwrd\">VALUES</span>      (<span class=\"str\">'Colosseum'</span>,       geography::STPointFromText(<span class=\"str\">'POINT(41.890178 12.492378)'</span>, 4326))  </pre>  <p>    </p>  <p>이 코드는 지점의 정확한 그래픽만 그리도록 설계되었으며 지리 데이터 형식에서 지원하는 다른 셰이프를 처리하지 않습니다. 즉, LatLong 열에 POINT만 삽입해야 합니다. </p>  <p>한 가지 주의해야 할 점은 SQL Azure 지리 데이터 형식은 <a href=\"https://en.wikipedia.org/wiki/Well-known_text\">WKT</a> 형식의 위도와 경도를 사용합니다. 즉, 경도가 첫 번째 및 위도임을 의미합니다. C# 코드에서 지리 데이터 형식을 문자열로 즉시 검색하고 위도 및 경도를 제거하고 코드에 대해 역방향으로 처리합니다. </p>  <p>이제 테이블과 데이터가 있으므로 애플리케이션에서 데이터를 쿼리할 수 있어야 합니다. 다음은 내가 작성한 저장 프로시저입니다.</p><pre class=\"csharpcode\"><span class=\"kwrd\">CREATE</span> <span class=\"kwrd\">PROC</span> [dbo].[spInside](      @southWestLatitude <span class=\"kwrd\">float</span>,      @southWestLongitude <span class=\"kwrd\">float</span>,      @northEastLatitude <span class=\"kwrd\">float</span>,      @northEastLongitude <span class=\"kwrd\">float</span>)  <span class=\"kwrd\">AS</span>  <span class=\"kwrd\">DECLARE</span> @SearchRectangleString <span class=\"kwrd\">VARCHAR</span>(<span class=\"kwrd\">MAX</span>);  <span class=\"kwrd\">SET</span> @SearchRectangleString = <span class=\"str\">'POLYGON(('</span> +       <span class=\"kwrd\">CONVERT</span>(<span class=\"kwrd\">varchar</span>(<span class=\"kwrd\">max</span>),@northEastLongitude) + <span class=\"str\">' '</span> +           <span class=\"kwrd\">CONVERT</span>(<span class=\"kwrd\">varchar</span>(<span class=\"kwrd\">max</span>),@southWestLatitude) + <span class=\"str\">','</span> +       <span class=\"kwrd\">CONVERT</span>(<span class=\"kwrd\">varchar</span>(<span class=\"kwrd\">max</span>),@northEastLongitude) + <span class=\"str\">' '</span> +          <span class=\"kwrd\">CONVERT</span>(<span class=\"kwrd\">varchar</span>(<span class=\"kwrd\">max</span>),@northEastLatitude) + <span class=\"str\">','</span> +       <span class=\"kwrd\">CONVERT</span>(<span class=\"kwrd\">varchar</span>(<span class=\"kwrd\">max</span>),@southWestLongitude) + <span class=\"str\">' '</span> +           <span class=\"kwrd\">CONVERT</span>(<span class=\"kwrd\">varchar</span>(<span class=\"kwrd\">max</span>),@northEastLatitude) + <span class=\"str\">','</span> +       <span class=\"kwrd\">CONVERT</span>(<span class=\"kwrd\">varchar</span>(<span class=\"kwrd\">max</span>),@southWestLongitude) + <span class=\"str\">' '</span> +           <span class=\"kwrd\">CONVERT</span>(<span class=\"kwrd\">varchar</span>(<span class=\"kwrd\">max</span>),@southWestLatitude) + <span class=\"str\">','</span> +       <span class=\"kwrd\">CONVERT</span>(<span class=\"kwrd\">varchar</span>(<span class=\"kwrd\">max</span>),@northEastLongitude) + <span class=\"str\">' '</span> +           <span class=\"kwrd\">CONVERT</span>(<span class=\"kwrd\">varchar</span>(<span class=\"kwrd\">max</span>),@southWestLatitude) + <span class=\"str\">'))'</span>      <span class=\"kwrd\">DECLARE</span> @SearchRectangle geography;  <span class=\"kwrd\">SET</span> @SearchRectangle = geography::STPolyFromText(@SearchRectangleString, 4326)    <span class=\"kwrd\">SELECT</span> <span class=\"kwrd\">CONVERT</span>(<span class=\"kwrd\">varchar</span>(<span class=\"kwrd\">max</span>),LatLong) <span class=\"str\">'LatLong'</span>  <span class=\"kwrd\">FROM</span> Points  <span class=\"kwrd\">WHERE</span> LatLong.STIntersects(@SearchRectangle) = 1  </pre>  <p>    </p><pre class=\"csharpcode\"></pre>  <p>    </p>  <p>쿼리는 상자의 두 모서리를 사용하고 사각형 다각형을 만든 다음 다각형 내에 있는 Points 테이블에 있는 모든 위도 및 경도를 찾는 쿼리입니다. 쿼리에는 몇 가지 미묘한 작업이 진행되며, 그 중 하나는 직사각형을 시계 단위로 그려야 하며 첫 번째 점이 마지막 점이라는 것입니다. 두 번째는 사각형이 단일 반구에 있어야 한다는 것입니다. 즉, 날짜선의 동쪽 또는 서쪽에 있지만 적도의 북쪽 또는 남쪽 모두는 아니지만 둘 다는 아닙니다. 코드는 사각형(코드의 경계 상자라고 함)이 크로스오버인지 확인하고 상자를 전체와 동일한 여러 쿼리로 나눕니다. </p>  <h4>코드</h4>  <p>제가 아는 한 인터넷에서 Bing 타일 서버의 완전한 무료 코드 예제는 몇 가지뿐입니다. 나는 롭 블랙웰의 \"롤 나만의 타일 서버\"와 조 슈워츠의 \"<a href=\"https://msdn.microsoft.com/en-us/library/bb259689.aspx\">Bing 지도 타일 시스템</a>\"에서 크게 빌렸다. </p>  <p>나는 몇 가지 변경을했다, 그 중 하나는 단일 푸시 핀에 대한 하나 이상의 타일에 그리는 것입니다. 푸시 핀 그래픽은 넓고 키가 크고 타일 가장자리에 그리면 지도에서 다음 타일로 잘립니다. 즉, 가장자리 근처에 있는 푸시 핀의 경우 두 타일에 부분적으로 그려야 합니다. 이렇게 하려면 타일에 있는 푸시 핀과 타일의 푸시 핀을 데이터베이스에 쿼리해야 합니다. 다운로드 가능한 코드에서 이 작업을 수행합니다. </p>  <h3>캐싱</h3>  <p>전체 예제 애플리케이션은 캐싱의 이점을 누릴 수 있습니다. 푸시 핀을 실시간으로 업데이트해야 하는 것은 아닙니다. 즉, 애플리케이션 요구 사항에 따라 서버와 브라우저 모두에서 타일을 캐시할 수 있습니다. SQL Azure 쿼리하고, 페이지당 4개의 타일에 대해 실시간으로 비트맵을 그리는 것은 푸시 핀이 많은 트래픽이 많은 사이트에서 많은 작업이 될 것입니다. 타일을 캐시하여 Windows Azure 및 SQL Azure 부하를 줄이는 것이 좋습니다. 단 몇 분 동안 캐시해도 워크로드가 크게 줄어듭니다. </p>  <p>성능을 향상시키는 또 다른 방법은 핀 수가 많은 경우 타일에 모든 핀을 그리는 것이 아닙니다. 대신 타일에 X 개 이상의 핀이 있을 때 한 번 그려지는 클러스터 그래픽을 만듭니다. 이는 개별 핀을 보기 위해 확대해야 함을 사용자에게 나타냅니다. 이 기술을 사용하려면 데이터베이스에서 타일 내의 행 수를 쿼리하여 클러스터 그래픽을 사용해야 하는지 확인해야 합니다. </p>  <p>성능 및 부하 테스트에 대한 자세한 내용은 <a href=\"https://msdn.microsoft.com/en-us/library/cc451897.aspx\">Bing 지도 여기에서</a> 확인할 수 있습니다. </p>  <h4>요약</h4>  <p>버그를 찾으시겠습니까? 질문, 우려 사항, 의견이 있나요? 아래에 게시하고 우리는 그들을 해결하기 위해 노력할 것입니다.</p>"
