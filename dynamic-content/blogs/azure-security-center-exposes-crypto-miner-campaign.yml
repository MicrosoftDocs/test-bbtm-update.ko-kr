### YamlMime:Yaml
ms.openlocfilehash: df37bfd16f3b13af74c07f5243a91e0f2dbc59ca
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139897759"
Slug: azure-security-center-exposes-crypto-miner-campaign
Title: Azure Security Center는 암호화 광부 캠페인을 노출합니다.
Summary: Azure Security Center는 Azure 고객 리소스에 대한 새로운 암호 화폐 마이닝 작업을 발견했습니다.
Content: >-
  <p>Azure Security Center는 Azure 고객 리소스에 대한 새로운 암호 화폐 마이닝 작업을 발견했습니다.<br>

  이 작업은 알려진 RCE 취약성(<a href="https://www.drupal.org/sa-core-2018-002">CVE-2018-7600</a>)을 진입점으로 사용하여 알려진 오픈 소스 CMS의 이전 버전을 활용한 다음, 지속성을 위해 CRON 유틸리티를 사용한 후 XMRig&rdquo; 오픈 소스 암호화 마이닝 도구의 &ldquo;새로 컴파일된 이진을 사용하여 Monero&rdquo; 암호 화폐를 마&ldquo;이닝합니다.</p>


  <p>ASC(Azure Security Center)는 실시간으로 공격을 발견하고 영향을 받는 고객에게 다음과 같은 경고를 표시했습니다.</p>


  <ul>
   <li><b>의심스러운 파일 다운로드</b> &ndash; wget을 사용하여 악성 파일 다운로드가 검색됨</li>
   <li><b>의심스러운 </b><b>CRON 작업</b> &ndash; 가능한 의심스러운 예약 작업 액세스가 검색됨</li>
   <li><b>의심스러운 활동</b> &ndash; ASC가 의심스러운 원본에서 주기적인 파일 다운로드 및 실행을 검색했습니다.</li>
   <li><b>의심스러운 위치에서 실행된</b> <b>프로세스 </b></li>
  </ul>


  <p><strong><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4b2f1916-64c2-4b68-ab51-6c0f39036cf4.png"><img alt="Azure Security Center alert on a file downloaded and executed." border="0" height="404" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5afbfed9-2c52-4b28-a52a-0d246c6d73fb.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="다운로드 및 실행된 파일에 대한 Azure Security Center 경고입니다." width="429"></a></strong></p>


  <h2>진입점</h2>


  <p>공격자가 남긴 추적에 따라 이 맬웨어의 진입점을 추적하고 알려진 오픈 소스 CMS의 원격 코드 실행 취약성인 <a href="https://www.drupal.org/sa-core-2018-002">CVE-2018-7600</a>을 활용하여 시작되었다고 결론을 내릴 수 있었습니다.</p>


  <p>이 취약성은 이 CMS의 이전 버전에서 노출되며 오래된 버전을 사용하는 많은 웹 사이트에 영향을 주는 것으로 추정됩니다. 이 취약성의 원인은 API 호출 내에서 입력 유효성 검사가 충분하지 않습니다.</p>


  <p>영향을 받은 Linux 머신에서 처음 발견한 의심스러운 명령줄은 다음과 같습니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/25e6ee00-b074-4ca5-be51-f6b76ae7ce7c.png"><img alt="Base64 encoded bash command line (details censored)." border="0" height="50" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2203604c-5004-4dea-bfc8-33d099913b2d.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Base64로 인코딩된 bash 명령줄(세부 정보 검열)." width="515"></a></p>


  <p>명령줄의 base64 부분을 디코딩하면 CRON 유틸리티를 사용하여 bash 스크립트 파일을 정기적으로 다운로드하고 실행하는 논리가 표시됩니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5374ff11-805a-4c7a-9652-e6a2b4292752.png"><img alt="Base64 decoded bash command line (details censored) – wget | sh." border="0" height="18" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e88aaa2c-3440-455f-877e-ddc1533bcb43.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Base64 디코딩된 bash 명령줄(세부 정보 검열) – wget | Sh." width="539"></a></p>


  <p>URL 경로에는 진입점에 대한 또 다른 표시인 CMS 이름에 대한 참조도 포함됩니다(그리고 실수 공격자도 마찬가지임).</p>


  <p>또한 피해를 입은 컴퓨터에서 수집된 원격 분석에서 이 첫 번째 명령줄이 apache&rdquo; 사용자 컨텍스트 내에서 그리고 상대 CMS 작업 디렉터리 내에서 &ldquo;실행된다는 것도 배웠습니다.</p>


  <p>영향을 받는 리소스를 조사한 결과, 공격자가 노출된 리소스에서 악성 코드를 실행할 수 있는 매우 중요한 보안 위험에 노출되는 상대 CMS의 패치되지 않은 버전으로 모든 리소스가 실행되고 있음을 발견했습니다.</p>


  <h2>맬웨어 분석</h2>


  <p>맬웨어는 CRON 테이블 파일에 다음 줄을 추가하여 지속성을 위해 CRON 유틸리티(Unix 작업 스케줄러)를 사용합니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b6914f67-790a-443a-a2c6-a1c84ae9f5ce.png"><img alt="Cron command running wget | sh." border="0" height="22" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f267be76-eb27-4c79-a7ba-f1292414a9d5.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="wget | 실행하는 Cron 명령 Sh." width="471"></a></p>


  <p>그러면 1분마다 bash 스크립트 파일을 다운로드하고 실행하게 되며 공격자가 bash 스크립트를 사용하여 명령하고 제어할 수 있습니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/dc43b920-0c8d-4d8e-875a-5a3fde0936bd.png"><img alt="The malicious bash script file (details censored)." border="0" height="360" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/bcc9dfd1-37aa-4515-96fa-5b201733ed07.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="악의적인 bash 스크립트 파일(세부 정보가 검열됨)입니다." width="429"></a></p>


  <p>bash 파일(이 시간에 캡처한 대로)은 이진 파일을 다운로드하고 실행합니다(위의 이미지에서 볼 수 있듯이).<br>

  컴퓨터가 이미 손상되어 HTTP 1.1 POST 메서드 또는 컴퓨터의 프로세서 수에 따라 다른 이진 파일을 사용하여 다운로드하는지 이진 확인합니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/09279cde-d84a-490e-af1e-a2dcdd81518c.png"><img alt="Malicious network traffic sniff." border="0" height="338" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/6cf2b27e-3dff-4ec7-8bfa-50652a5186e8.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="악의적인 네트워크 트래픽을 검색합니다." width="448"></a></p>


  <p>첫눈에, 두 번째 이진은 명확하게 난독화되기 때문에&rsquo; 조사하기가 더 어려워 보인다. 다행히 공격자는 난독 처리가 아닌 압축에 중점을 둔 UPX 패커를 사용하도록 선택했습니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ff0c80ab-9e4b-4f14-9a77-7c83e8bf62c3.png"><img alt="Malicioud binary packed with UPX packer." border="0" height="365" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/51f168f6-4704-43a9-9aaa-c6d0c3e2ef7a.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="UPX 패커로 포장된 말리시오드 이진 파일." width="490"></a></p>


  <p>이진 파일을 압축 해제한 후 버전 2.6.3에서 오픈 소스 암호 화폐 광부 &ldquo;XMRig&rdquo; 의 컴파일을 발견했습니다. 광부는 내부 구성으로 컴파일하고 마이닝 프록시 서버에서 마이닝 작업을 끌어오므로 공격자의 클라이언트 수와 수익을 예측할 수 없었습니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/58526870-df61-4ff7-bae3-aca207925883.png"><img alt="XMRig assembly code." border="0" height="369" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/cf134cb7-4565-4e04-ba77-f40967b42dce.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="XMRig 어셈블리 코드입니다." width="492"></a></p>


  <h2>큰 그림</h2>


  <p>여러 암호화 광부의 동작을 분석하여 암호화 광부 기반 공격에 대한 2 가지 강력한 지표를 발견했습니다.</p>


  <p><b>1. 경쟁자</b> &ndash; 살해 많은 암호화 공격은 컴퓨터가 이미 손상되어 있다고 가정하고 다른 컴퓨팅 능력 경쟁자를 죽이려고 합니다. 프로세스 목록을 관찰하여 다음을 중점으로 수행합니다.</p>


  <ol start="1" style="margin-left: 40px; list-style-type: lower-alpha;">
   <li>프로세스 이름 - 인기 있는 오픈 소스 광부에서 덜 알려진 마이닝 캠페인까지</li>
   <li>알려진 풀 도메인, 암호화 해시 알고리즘, 마이닝 프로토콜 등과 같은 명령줄 인수입니다.</li>
   <li>CPU 사용량</li>
  </ol>


  <p>식별한 또 다른 일반적인 방법은 CRON 탭 &ndash; 을 다시 설정하는 것입니다. 대부분의 경우 다른 컴퓨팅 성능 경쟁업체의 지속성 메서드로 사용되고 있습니다.</p>


  <p><b>2. 마이닝 풀 &shy;</b>- Crypto 마이닝 작업은 마이닝 풀에서 관리되고 있으며, 이는 여러 클라이언트를 수집하여 클라이언트 간에 수익을 기여하고 공유하는 일을 담당합니다. 대부분의 공격자는 배포 및 사용하기 간단한 공용 마이닝 풀을 사용하지만 공격자가 노출되면 계정이 차단될 수 있습니다. 최근에 공격자가 자신의 프록시 마이닝 서버를 사용하는 사례가 증가하고 있습니다. 이 기술은 공격자가 호스트 내의 보안 제품(예: Linux용 Azure Security Center 위협 검색)에 의한 검색과 공용 마이닝 풀의 검색에서 익명으로 유지하는 데 도움이 됩니다.</p>


  <h2>결론 및 방지</h2>


  <p>이 공격을 방지하는 것은 최신 보안 업데이트를 설치하는 것만큼 쉽습니다. 기본 옵션은 전체 웹 서버 및 소프트웨어 환경을 유지 관리하는 대신 SaaS(Software as a Service)를 사용하는 것입니다.</p>


  <p>암호화-광부 활동은 상당한 리소스를 소비하기 때문에 대부분의 시간을 쉽게 감지할 수 있습니다.<br>

  <a href="https://azure.microsoft.com/en-us/services/security-center/">Azure Security Center</a>와 같은 클라우드 보안 솔루션을 사용하면 머신, 네트워크 및 Azure 서비스의 보안을 지속적으로 모니터링하고 비정상적인 활동이 감지되면 경고합니다.</p>
