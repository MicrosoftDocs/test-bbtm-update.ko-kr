### YamlMime:Yaml
ms.openlocfilehash: 2aebdc13536b146070bf3dd78ddac473a7d48525
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139900650"
Slug: simplify-always-on-availability-group-deployments-on-azure-vm-with-sql-vm-cli
Title: SQL VM CLI를 사용하여 Azure VM에서 Always On 가용성 그룹 배포 간소화
Summary: 'Always On AG(가용성 그룹)는 온-프레미스, 클라우드 또는 둘 다의 조합에 관계없이 SQL Server 데이터베이스에 고가용성 및 재해 복구 기능을 제공합니다. '
Content: >-
  <p>Always On AG(가용성 그룹)는 온-프레미스, 클라우드 또는 둘 다의 조합에 관계없이 SQL Server 데이터베이스에 고가용성 및 재해 복구 기능을 제공합니다. Azure VM(<a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-availability-group-tutorial" target="_blank">Virtual Machines)에 SQL Server 가용성 그룹을 수동으로 배포하는 것은 Azure</a>&rsquo; 인프라에 대한 이해가 필요한 복잡한 프로세스이지만, 새로운 향상된 기능으로 프로세스가 크게 간소화되었습니다.</p>


  <p>최근에 Azure 빠른 시작 템플릿을 통해 <a href="https://azure.microsoft.com/en-us/blog/automate-always-on-availability-group-deployments-with-sql-virtual-machine-resource-provider/" target="_blank">SQL Virtual Machine 리소스 공급자를 사용하여 Azure VM에서 Always On AG 배포를 자동화</a>하는 새로운 방법을 게시했습니다. 현재는 이 자동화를 SQL VM <a href="https://azure.microsoft.com/en-us/blog/sql-server-on-azure-virtual-machine-resource-provider/" target="_blank">리소스 공급자</a>를 위한 관리 API인 <a href="https://docs.microsoft.com/en-us/cli/azure/sql/vm?view=azure-cli-latest" target="_blank">Azure SQL VM CLI</a>와 더욱 간소화한 것을 자랑스럽게 생각합니다.</p>


  <p>이제 간단한 단계를 수행하여 <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-server-iaas-overview" target="_blank">Azure VM에서 SQL Server</a> 대한 Always On AG 구성을 배포할 수 있습니다.</p>


  <h2>Windows 장애 조치(failover) 클러스터 메타데이터 정의</h2>


  <p><a href="https://docs.microsoft.com/en-us/cli/azure/sql/vm/group?view=azure-cli-latest">az sql vm group</a>은 Always On AG를 호스트할 Windows 장애 조치(failover) 클러스터 서비스에 대한 메타데이터를 관리합니다. 클러스터 메타데이터에는 클라우드 감시 및 SQL Server 버전으로 사용할 AD(Active Directory) 도메인, 클러스터 계정 및 스토리지 계정이 포함됩니다. <a href="https://docs.microsoft.com/en-us/cli/azure/sql/vm/group?view=azure-cli-latest#az-sql-vm-group-create">az sql vm group create</a>를 사용하여 첫 번째 VM이 추가될 때 클러스터가 정의된 대로 생성되도록 Windows 장애 조치(failover) 클러스터 메타데이터를 정의합니다. 예제 명령은 아래에 제공됩니다.</p>


  <pre>

  az sql vm group create -n &lt;cluster name&gt; -l &lt;region ex:eastus&gt; -g &lt;resource group name&gt; --image-offer &lt;SQL2016-WS2016 or SQL2017-WS2016&gt; --image-sku Enterprise --domain-fqdn &lt;FQDN ex: domain.com&gt; --operator-acc &lt;domain account ex: testop@domain.com&gt; --bootstrap-acc &lt;domain account ex:bootacc@domain.com&gt; --service-acc &lt;service account ex:testservice@domain.com&gt; --sa-key &lsquo;&lt;PublicKey&gt;&rsquo; --storage-account &lsquo;&lt;ex:<a href="https://cloudwitness.blob.core.windows.net/">https://cloudwitness.blob.core.windows.net/</a>&gt;&rsquo;</pre>


  <p>장애 조치(failover) 클러스터 정의를 Windows AD 도메인 조인만 지원합니다. FQDN은 필수 속성이며 모든 AG 복제본이 클러스터에 추가되기 전에 이미 AD 도메인에 조인되어야 합니다.</p>


  <p>클러스터에서 기존 스토리지 계정을 클라우드 감시로 사용하거나 새 스토리지 계정을 만들 수 있습니다. 스토리지 계정을 만드는 Azure CLI 명령의 예는 다음과 같습니다.</p>


  <pre>

  az storage account create -n &lt;name&gt; -g &lt;resource group name&gt; -l &lt;region ex:eastus&gt; --sku Standard_LRS --kind StorageV2 --access-tier Hot --https-only true</pre>


  <h2>클러스터 &ndash; 에 SQL VM 추가 첫 번째 VM을 추가하면 클러스터가 생성됩니다.</h2>


  <p><a href="https://docs.microsoft.com/en-us/cli/azure/sql/vm?view=azure-cli-latest#az-sql-vm-add-to-group" target="_blank">az sql vm add-to-group</a>은 위에서 정의한 Windows 장애 조치(failover) 클러스터에 AG 복제본 추가를 관리합니다. 클러스터는 첫 번째 VM이 그룹에 추가되면 만들어집니다. VM에 클러스터 역할을 설치하고 지정된 이름으로 클러스터를 만드는 작업은 이 명령에 의해 자동화됩니다. 그룹 추가 호출에 따라 클러스터에 다음 복제본이 추가됩니다.</p>


  <pre>

  az sql vm add-to-group -n &lt;VM Name&gt; -g &lt;Resource Group Name&gt; --sqlvm-group &lt;cluster name&gt; -b &lt;bootstrap account password&gt; -p &lt;operator account password&gt; -s &lt;service account password&gt;</pre>


  <p>AZURE Marketplace의 Enterprise SQL Server 2016 또는 2017 이미지에서 새 SQL VM 인스턴스를 배포하여 AG 복제본으로 사용할 수 있습니다. Azure Portal에서 SQL VM을 배포하는 경우 기본적으로 SQL VM RP에 SQL IaaS 확장이 설치되고 등록됩니다. Azure Power Shell, CLI 또는 비 SQL Server 이미지에서 배포하는 경우 다음 단계를 수동으로 수행해야 합니다.</p>


  <ol>
      <li><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-server-agent-extension" target="_blank">가상 머신에 SQL IaaS 확장을 설치</a>합니다.</li>
      <li><a href="https://docs.microsoft.com/en-us/cli/azure/sql/vm?view=azure-cli-latest#az-sql-vm-create" target="_blank">az sql vm create</a>를 사용하여 VM과 연결된 SqlVirtualMachine 리소스를 만듭니다. 이에 대한 예는 다음과 같습니다.</li>
  </ol>


  <pre>

  az sql vm create -n &lt;VM Name&gt; -g &lt;Resource Group Name&gt; -l &lt;region ex:eastus&gt;</pre>


  <p>이러한 필수 구성 요소를 따르는 경우 기존 SQL VM을 AG 복제본으로 클러스터에 추가할 수 있습니다.</p>


  <h2>SSMS 통해 가용성 그룹 만들기</h2>


  <p>모든 SQL VM이 클러스터에 추가되면 해당 VM 중 하나에 로그인하고 <a href="https://docs.microsoft.com/en-us/sql/database-engine/availability-groups/windows/use-the-availability-group-wizard-sql-server-management-studio?view=sql-server-2017" target="_blank">SSMS 새 가용성 그룹 마법사</a>를 통해 가용성 그룹을 설정할 수 있습니다. 이 시점에서 가용성 그룹을 만드는 것은 모든 복제본이 이미 클러스터에 추가되어 있으므로 매우 간단합니다.</p>


  <h2>가용성 그룹 수신기 만들기</h2>


  <p>Always On AG 구성의 마지막 단계는 장애 조치(failover) 후 자동화된 연결 라우팅을 사용하도록 설정하는 AG 수신기를 만드는 것입니다. 아래와 같이 <a href="https://docs.microsoft.com/en-us/cli/azure/sql/vm/group/ag-listener?view=azure-cli-latest#az-sql-vm-group-ag-listener-create" target="_blank">az sql vm ag-listener create</a> 명령을 사용하여 AG 수신기를 만들 수 있습니다.</p>


  <pre>

  az sql vm group ag-listener create -n &lt;listener name&gt; -g &lt;resource group name&gt; --ag-name &lt;availability group name&gt; --group-name &lt;cluster name&gt; --ip-address &lt;ag listener IP address&gt; --load-balancer {lbname} --probe-port &lt;Load Balancer probe port, default 59999&gt;  --subnet {subnet resource id} --sqlvms &lt;names of SQL VM&rsquo;s hosting AG replicas ex: sqlvm1 sqlvm2&gt;</pre>


  <p>AG 수신기에는 Azure VM의 ILB( <a href="https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-overview" target="_blank">내부 부하 분산 장치</a> )가 필요합니다. SQL VM이 동일한 가용성 집합에 있는 경우 <a href="https://docs.microsoft.com/en-us/azure/load-balancer/quickstart-create-basic-load-balancer-cli" target="_blank">기본 ILB</a>를 사용할 수 있습니다. 그렇지 않으면 <a href="https://docs.microsoft.com/en-us/azure/load-balancer/quickstart-load-balancer-standard-public-cli" target="_blank">표준 ILB</a>를 사용해야 합니다. 아래 예제와 같이 Azure CLI를 통해 ILB를 만들 수 있습니다.</p>


  <pre>

  az network lb create --name &lt;ILB name&gt; -g &lt;resource group name&gt; --sku Standard --vnet-name &lt;VNet Name&gt; --subnet &lt;subnet name&gt;</pre>


  <p>이것이 Always On AG 구성을 사용하여 <a href="https://azure.microsoft.com/en-us/services/virtual-machines/sql-server/" target="_blank">Azure Virtual Machines에 SQL Server</a> 배포하는 것입니다. 현재 <a href="https://azure.microsoft.com/en-us/blog/sql-server-on-azure-virtual-machine-resource-provider/" target="_blank">SQL VM 리소스 공급자</a> 및 <a href="https://docs.microsoft.com/en-us/cli/azure/sql/vm?view=azure-cli-latest" target="_blank">Azure SQL VM CLI</a>에서 사용하도록 설정된 이러한 확장된 기능을 활용하기 시작합니다. 질문이 있거나 제안하려는 경우 <a href="https://aka.ms/sqlfeedback" target="_blank">UserVoice</a>를 통해 문의할 수 있습니다. 여러분의 소중한 의견을 기다리고 있습니다.</p>
