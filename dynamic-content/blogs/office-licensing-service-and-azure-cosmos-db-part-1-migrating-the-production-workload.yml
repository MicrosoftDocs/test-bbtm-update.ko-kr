### YamlMime:Yaml
ms.openlocfilehash: dedc14cdebcf557ceeb2d1fe1b04fceaa8f8d4dd
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139908817"
Slug: office-licensing-service-and-azure-cosmos-db-part-1-migrating-the-production-workload
Title: 'Office 라이선스 서비스 및 Azure Cosmos DB 1부: 프로덕션 워크로드 마이그레이션'
Summary: '이 게시물은 조직에서 Azure Cosmos DB를 사용하여 실제 요구 사항을 충족하는 방법과 이러한 요구 사항을 충족하는 차이점에 대한 두 부분으로 구성된 시리즈의 1부입니다. '
Content: >-
  <p><i>이 게시물은 </i><i>조직에서 Azure Cosmos DB를 사용하여 실제 요구 사항을 충족하는 방법과 이에 대한 차이점&rsquo;에 대한 두 부분으로 구성된 시리즈의 1부입니다. 1부에서는 Microsoft Office 라이선스 서비스 팀이 Azure Table Storage에서 Azure Cosmos DB로 이동하게 된 과제와 프로덕션 워크로드를 새 서비스로 마이그레이션하는 방법을 살펴봅니다. </i><a href="https://azure.microsoft.com/blog/office-licensing-service-and-azure-cosmos-db-part-2-improved-performance-and-availability" target="_blank"><i>2부</i></a>에서는 <i>팀의&rsquo; 노력으로 인한 결과를 살펴봅니다.</i></p>


  <h2>과제: 제한된 처리량 및 기타 기능</h2>


  <p>Microsoft에서 OLS(Office 라이선스 서비스)는 Windows, Mac, 태블릿 및 모바일을 포함하는 전 세계&mdash; 수백만 대의 디바이스에서 Microsoft Office 클라이언트의 정품 인증을 지원합니다. 컴퓨터 ID, 제품 ID, 정품 인증 횟수, 만료 날짜 등의 정보를 저장합니다. OLS는 전 세계 사용자가 하루에 2억 4천만 번 이상 Office 클라이언트에서 액세스하며, 라이선스 정품 인증 시 클라이언트에서 첫 번째 호출을 받은 후 2~3일마다 클라이언트가 라이선스가 여전히 유효한지 확인합니다.</p>


  <p>최근까지 OLS는 소비자, 엔터프라이즈 및 OEM 사전 설치와 같은 다양한 라이선스 범주에 사용되는 별도의 테이블과 함께 18개 테이블에&mdash; 분산된 약 5TB의 데이터를 포함하는 백 엔드 데이터 저장소에 Azure Table Storage에 의존했습니다.</p>


  <p>2018년 초, 수년간의 지속적인 워크로드 증가 후 OLS 서비스는 Table Storage가 제공할 수 있는 것보다 더 많은 처리량이 필요한 지점에 접근하기 시작했습니다. 문제가 해결되지 않으면&rsquo; Table Storage의 내재된 처리량 제한이 전 세계 수백만 명의 사용자에게 해를 끼치는 전반적인 서비스 품질을 위협하기 시작합니다.</p>


  <p>OLS 개발 팀을 이끄는 Microsoft의 소프트웨어 엔지니어 대니 청(Danny Cheng)은 다음과 같이 설명합니다.</p>


  <p style="margin-left: 40px;"><em>&ldquo;각 Table Storage 계정에는 고정된 최대 처리량이 있으며 이를 지나서 크기를 조정하지 않습니다&rsquo;. 2018년까지 OLS는 사용 가능한 스토리지 처리량이 부족했고, 자체 Table Storage 계정에서 각 테이블을 이미 유지 관리하고 있다는 점을 감안할 때 고객의 더 많은 요청을 처리할 수 있는 더 많은 처리량을 얻을 수 있는 방법이 없었습니다. OLS 서비스의 사용량이 가장 많은 시간 동안 제한되었으므로 곧 더 확장 가능한 스토리지 백 엔드를 찾아야 했습니다.</em></p>


  <p style="margin-left: 40px;"><em>OLS 팀은 스토리지 요구 사항에 대한 장기적인 솔루션을 모색하면서 추가 처리량 이상의 것을 원했습니다. 서비스 복사본을 사용자의 위치에 더 가깝게 배치하여 대기 시간을 최소화하기 위한 수단으로 전 세계 여러 지역에 OLS를 배포하는 기능을 원했습니다. 그러나 Table Storage를 사용하면 지역에서 복제 기능이 상당히 제한됩니다.&rdquo;</em></p>


  <p>OLS 팀은 또한 더 나은 재해 복구를 원했습니다. Table Storage를 사용하면 모든 데이터를 미국 내의 여러 지역에 저장했습니다. 모든 읽기 및 쓰기가 주 지역으로 이동했으며, 두 백업 지역으로 복제하기 위한 SLA가 없으므로 최대 60분이 걸릴 수 있습니다. 주 지역을 사용할 수 없게 되면 사람의 개입이 필요하며 데이터 손실이 발생할 수 있습니다.</p>


  <p style="margin-left: 40px;"><em>&ldquo;지역이 다운되면 가동 중지 시간이 30~60분이고 데이터 손실&rdquo;에 대한 유사한 창이 있는 실제 공황 상황이&mdash; 될 것이라고 Cheng은 말합니다.</em></p>


  <h2>솔루션: Azure Cosmos DB로 리프트 앤 시프트 마이그레이션</h2>


  <p>OLS 팀은 Table Storage&mdash; 메이킹에서 리프트 앤 시프트 마이그레이션 경로를 제공하는 <a href="https://azure.microsoft.com/en-us/services/cosmos-db/" target="_blank">Azure Cosmos DB</a>로 전환하여 턴키 글로벌 배포, 짧은 대기 시간, 거의 무제한 확장성, 보장된 고가용성 등으로 프리미엄 백 엔드 서비스를 쉽게 교환할 수 있도록 했습니다.</p>


  <p style="margin-left: 40px;"><em>&ldquo;처음에는 새 스토리지 백 엔드가 필요하다는 것을 깨달았을 때 얼마나 많은 새 코드가 필요한&rdquo;지 알지 못했다&rsquo;는 측면에서 위협적이었습니다. &ldquo; Azure에서 몇 가지 스토리지 옵션을 살펴보았습니다. Azure Cosmos DB는 모든 요구 사항을 충족하는 유일한 스토리지 옵션이었습니다. <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/table-introduction" target="_blank">또한 Table API</a>&rsquo;를 사용하면 많은 새 코드를 작성할 필요도 없습니다. 여러 가지 면에서 필요한 확장성과 약간의 작업으로 많은 다른 이점을 가져오는 것이 이상적인 리프트 앤 시프트&mdash;였습니다.&rdquo;</em></p>


  <h3>디자인 의사 결정</h3>


  <p>AZURE Cosmos DB 배포를 준비할 때 OLS 팀은 몇 가지 기본적인 디자인 결정을 내려야 했습니다.</p>


  <p><a href="https://docs.microsoft.com/en-us/azure/cosmos-db/consistency-levels" target="_blank">일관성 수준</a>- 팀에게 읽기 일관성과 대기 시간, 가용성 및 처리량 간의 근본적인 절충을 해결하기 위한 옵션을 제공했습니다.</p>


  <p style="margin-left: 40px;"><em>&ldquo;비즈니스 논리 중 일부는 쓰기 직후 스토리지에서 읽기가 필요하기 때문에 강력한 일관성을&rdquo; 선택했다고 Cheng은 설명합니다.</em></p>


  <p>Azure Cosmos DB 컨테이너 내의 항목을 논리 파티션으로 나누는 방법을 지시하고 데이터 저장소의 궁극적인 확장성을 결정하는 <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/partitioning-overview" target="_blank">파티션</a>&mdash; 키입니다.</p>


  <p style="margin-left: 40px;"><em>&ldquo;Azure Cosmos DB Table API를 사용하면 파티션 키가 Table Storageso&mdash;에 있는 것과 자연스럽게 매핑되며 동일한 파티션 키를&rdquo; 다시 사용할 수 있었다고 Cheng은 말합니다.</em></p>


  <h3>마이그레이션 프로세스</h3>


  <p>Azure Cosmos DB는 데이터 마이그레이션 도구를 제공했지만, 당시에는 OLS 서비스에 대한 가동 중지 시간이 수반되었으므로 이는 옵션이 아니었&rsquo;습니다. <i>(</i><em>참고: 오늘 <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/cosmosdb-migrationchoices" target="_blank">가동 중지 시간 없이 실시간 마이그레이션을</a> 수행할 수 있습니다.) </em> 이 문제를 해결하기 위해 OLS 팀은 다음 세 가지 구성 요소로 구성된 데이터 마이그레이션 솔루션을 빌드했습니다.</p>


  <ol>
      <li>Table Storage에서 Azure Cosmos DB로 현재 데이터를 이동하는 데이터 마이그레이션기입니다.</li>
      <li>Table Storage와 Azure Cosmos DB 모두에 새 데이터베이스 변경 내용을 기록하는 이중 작성기입니다.</li>
      <li>Table Storage와 Azure Cosmos DB 간의 불일치를 catch하는 일관성 검사기입니다.</li>
  </ol>


  <p>데이터 마이그레이션기 구성 요소는 <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/table-import" target="_blank">Azure Cosmos DB 팀에서 Microsoft 고객에게 제공하는 것과 동일한</a> 구성 요소를 기반으로 합니다.</p>


  <p style="margin-left: 40px;"><em>&ldquo;가동 중지 시간 문제를 해결하기 위해 OLS 서비스 자체&rdquo; 와 동일한 프로덕션 서버에서 실행되는 이중 기록기 및 일관성 검사기 구성 요소를 추가했습니다.</em></p>


  <p>OLS 팀은 2019년 말에 마이그레이션 프로세스를 완료했습니다. 현재 Azure Cosmos DB는 Table Storage와 동일한 세 지역에 배포되며, 이 팀은 마이그레이션 중에 Table Storage 토폴로지와 최대한 가깝게 모방했습니다. 마찬가지로 미국 중북부가 주(읽기/쓰기) 지역인 반면 다른 두 지역은 현재 읽기 전용입니다. Azure Cosmos DB 환경에는 5TB의 데이터를 포함하는 18개의 테이블이 있으며 Azure Cosmos DB에서 보장된 데이터베이스 처리량을 예약하는 데 사용되는 초당 약 100만 <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/request-units" target="_blank">RU(요청 단위)</a>를 사용합니다.</p>


  <p>이제 마이그레이션이 완료되었으므로 팀은 <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/how-to-multi-master" target="_blank">다중 마스터 기능을</a> 설정하여 기본 지역이 아닌 모든 지역을 쓰기 가능하게 할 계획입니다. 이에 따라 팀은 백 엔드 저장소를 전 세계&mdash; 추가 지역에 복제하여 전 세계적으로 확장할 계획입니다. OLS 데이터의 복사본을 사용자가 있는 위치에 더 가깝게 배치하여 Office 클라이언트의 관점에서 대기 시간을 개선하는 수단입니다.</p>


  <p>이 시리즈의 <a href="https://azure.microsoft.com/blog/office-licensing-service-and-azure-cosmos-db-part-2-improved-performance-and-availability" target="_blank">2부</a>에서는 Azure Cosmos DB에서 새로운 Office 라이선스 서비스를 빌드하기 위한 팀의&rsquo; 노력의 결과를 살펴봅니다.</p>


  <h2>오늘 Azure Cosmos DB 시작</h2>


  <ul>
      <li>
      <p><u><a href="https://azure.microsoft.com/en-us/services/cosmos-db/" target="_blank">Azure Cosmos DB</a></u>를 방문하세요.</p>
      </li>
      <li><a href="https://docs.microsoft.com/en-us/azure/cosmos-db/table-introduction" target="_blank">Azure Cosmos DB Table API 소개</a>를 참조하세요.</li>
  </ul>
