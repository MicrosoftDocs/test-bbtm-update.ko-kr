### YamlMime:Yaml
ms.openlocfilehash: 2f8f5732e195e3ccba0b4ea553722e00113418a9
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139899970"
Slug: azure-load-balancer-to-become-more-efficient
Title: 효율성을 높이는 Azure Load Balancer
Summary: Azure는 최근에 보다 효율적인 고급 Load Balancer 플랫폼을 도입했습니다. 이 플랫폼은 새로운 표준 Load Balancer를 사용하여 고객 워크로드에 대한 완전히 새로운 기능 집합을 추가합니다. 새로운 Load Balancer 플랫폼이 제공하는 주요 추가 사항 중 하나는 간소화되고 예측 가능하며 효율적인 아웃바운드 포트 할당 알고리즘입니다.
Content: >-
  <p>Azure는 최근에 보다 효율적인 고급 Load Balancer 플랫폼을 도입했습니다. 이 플랫폼은 새로운 <a href="https://aka.ms/lbpreview" target="_blank">표준 Load Balancer</a>를 사용하여 고객 워크로드에 대한 완전히 새로운 기능 집합을 추가합니다. 새로운 Load Balancer 플랫폼이 제공하는 주요 추가 사항 중 하나는 간소화되고 예측 가능하며 효율적인 아웃바운드 포트 할당 알고리즘입니다.</p>


  <p>표준 Load Balancer와 이미 통합되어 있지만 이제 Azure의 나머지 부분에 이 이점을 제공합니다.</p>


  <h2>Load Balancer 및 원본 NAT</h2>


  <p>Azure 배포는 고객&rsquo; 배포 모델 및 활용 및 구성된 리소스에 따라 <a href="https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-connections#scenarios" target="_blank">아웃바운드 연결에 대해 세 가지 시나리오</a> 중 하나 이상을 사용합니다. Azure는 SNAT(원본 네트워크 주소 변환)를 사용하여 이러한 시나리오를 사용하도록 설정합니다. 여러 개인 IP 주소 또는 역할이 동일한 공용 IP(Load Balancer에 할당된 공용 IP 주소 또는 독립 실행형 VM에 대해 자동으로 할당된 공용 IP 주소)를 공유하는 경우 Azure는 PAT(포트 위장 SNAT)를 사용하여 공용 IP 주소의 임시 포트를 사용하여 개인 IP 주소를 공용 IP 주소로 변환합니다. ILPIP(인스턴스 수준 공용 IP 주소)가 할당된 경우에는 PAT가 적용되지 않습니다.</p>


  <p>여러 인스턴스가 공용 IP 주소를 공유하는 경우 Azure Load Balancer VIP 뒤에 있는 각 인스턴스에는 아웃바운드 흐름을 가장하는 데 사용하는 PAT(SNAT 포트)에 사용할 고정된 수의 임시 포트가 미리 할당됩니다. 인스턴스당 미리 할당된 포트 수는 백 엔드 풀의 크기에 따라 결정됩니다. 자세한 내용은 새 SNAT 알고리즘 섹션을 참조하세요.</p>


  <h2>SNAT 알고리즘을 변경하는 이유는 무엇인가요?</h2>


  <p>Azure의 기존 배포는 본질적으로 동적으로 설계된 SNAT 포트 할당 버전을 사용합니다. 이 버전은 아웃바운드 포트 인스턴스당 160개의 포트를 할당하여 시작 후 <strong>주문형 모델을</strong> 따릅니다. 백 엔드 인스턴스는 이러한 포트를 사용하여 연결을 시작하고 기본 구성에서 4분의 유휴 시간 후에 이러한 포트를 다시 사용할 수 있습니다. 또한 할당된 SNAT 포트를 모두 소모하는 여러 개의 동시 아웃바운드 연결이 있는 경우 요청 인스턴스는 가용성 및 요청 속도에 따라 더 적은 수의 포트를 추가로 할당합니다.</p>


  <p>이 모델은 분산 모델을 사용하는 서비스, 균일한 아웃바운드 흐름 만들기 또는 여러 외부 엔드포인트를 사용하여 흐름을 설정해야 하는 서비스에 적합합니다. 그러나 몇 개의 외부 대상이 있는 여러 동시 흐름이 필요한 서비스의 경우 초기 포트 할당이 단기간에 소진되고 간헐적인 연결 오류가 발생합니다. 서비스에서 가져올 포트&rsquo; 수와 시작할 수 있는 연결&rsquo; 수를 정확히 예측하는 것은 매우 어려운 일입니다. 주문형 모델을 사용하면 포트가 균등하게 분산되지 않습니다. 이로 인해 풀의 일부 인스턴스에 대해 SNAT 포트 할당에 대한 보류 상태가 길어질 수 있습니다. 위에 나열된 과제는 최신 알고리즘에서 해결됩니다.</p>


  <h2>새 SNAT 알고리즘</h2>


  <p>새로운 Azure Load Balancer 플랫폼은 보다 강력하고 간단하고 예측 가능한 포트 할당 알고리즘을 도입합니다. 이 모델에서는 사용 가능한 모든 포트가 미리 할당되고 풀 크기에 따라 Load Balancer의 백 엔드 풀 간에 균등하게 분산됩니다. 각 IP 구성은 미리 결정된 포트 수를 가져옵니다. 서비스는 백 엔드 풀 인스턴스 간의 연결 배포를 결정하고 리소스를 효율적으로 사용할 수 있습니다. 이 변경은 고객이 서비스를 더 잘 설계하고 크기 조정 제한을 줄이도록 지원합니다.</p>


  <p>다음 표에서는 백 엔드 풀의 크기에 따라 할당된 SNAT 포트 수를 보여 줍니다.</p>


  <table border="1" cellpadding="2" cellspacing="0">
      <tbody>
          <tr>
              <td valign="top" width="306">
              <p style="text-align: center;"><strong>풀 크기</strong></p>
              </td>
              <td valign="top" width="348">
              <p style="text-align: center;"><strong>IP 구성당 미리 할당된 SNAT 포트</strong></p>
              </td>
          </tr>
          <tr>
              <td valign="top" width="312">
              <p style="text-align: center;">1 &ndash; 50</p>
              </td>
              <td valign="top" width="354">
              <p style="text-align: center;">1024</p>
              </td>
          </tr>
          <tr>
              <td valign="top" width="318">
              <p style="text-align: center;">51 &ndash; 100</p>
              </td>
              <td valign="top" width="360">
              <p style="text-align: center;">512</p>
              </td>
          </tr>
          <tr>
              <td valign="top" width="324">
              <p style="text-align: center;">101 &ndash; 200</p>
              </td>
              <td valign="top" width="366">
              <p style="text-align: center;">256</p>
              </td>
          </tr>
          <tr>
              <td valign="top" width="330">
              <p style="text-align: center;">201 &ndash; 400</p>
              </td>
              <td valign="top" width="372">
              <p style="text-align: center;">128</p>
              </td>
          </tr>
          <tr>
              <td valign="top" width="336">
              <p style="text-align: center;">401 &ndash; 800</p>
              </td>
              <td valign="top" width="378">
              <p style="text-align: center;">64</p>
              </td>
          </tr>
          <tr>
              <td valign="top" width="342">
              <p style="text-align: center;">801 &ndash; 1000</p>
              </td>
              <td valign="top" width="384">
              <p style="text-align: center;">32</p>
              </td>
          </tr>
      </tbody>
  </table>


  <p>할당에 대한 자세한 내용은 <a href="https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-connections#snat" target="_blank">Azure 문서에서 아웃바운드 연결 이해</a>의 PAT(포트 위장 SNAT) 섹션에 대한 임시 포트 사전 할당을 참조하세요.</p>


  <h2>마이그레이션</h2>


  <p>Azure에서 이 새로운 할당 알고리즘을 채택하여 고객을 위해 플랫폼에 대한 SNAT 할당을 보다 쉽게 관리할 계획입니다. 기존 배포를 새 SNAT 포트 할당 알고리즘으로 마이그레이션하는 것은 2018년 여름을 대상으로 합니다.</p>


  <p>이렇게 하면 이전 알고리즘이 완전히 대체됩니다. 더 자세한 일정은 향후 발표될 예정입니다.</p>


  <h2>어떤 유형의 SNAT 할당을 받나요?</h2>


  <p>Azure에 배포하는 고객의 경우 서비스에서 볼 수 있는 포트 할당 유형에 대한 의문이 발생할 수 있습니다. 이러한 시나리오를 다른 시나리오로 분류해 보겠습니다&rsquo;.</p>


  <h3>새 배포</h3>


  <p>Azure의 모든 새 배포는 위에서 설명한 최신 포트 할당 모델을 구독합니다. 이는 <a href="https://aka.ms/lbpreview" target="_blank">기본 SKU Load Balancer</a> 기반 배포 및 클래식 클라우드 서비스 배포뿐만 아니라 표준 <a href="https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-overview" target="_blank">SKU Load Balancer</a> 기반 모두에 적용됩니다.</p>


  <p>또한 기존 배포가 있지만 해당 서비스를 마이그레이션하거나 다시 배포하는 경우 새 인스턴스는 모두 새 포트 할당 알고리즘을 사용하여 프로비전됩니다.</p>


  <h3>기존 배포</h3>


  <p>모든 기존 배포는 현재 이전 SNAT 포트 할당 체계를 계속 사용합니다. 그러나 기존 배포도 새 알고리즘으로 마이그레이션되므로 기존 배포에 대한 환경이 변경되고 모든 위치에서 일관성을 유지합니다.</p>


  <h2>내 서비스에 어떤 영향을 주나요?</h2>


  <p>SNAT 포트 할당은 위에서 설명한 것처럼 Azure 인스턴스에 대한 아웃바운드 연결에서 중요한 역할을 합니다. 지금까지 서비스는 포트의 주문형 할당을 즐겼으며, 여기서 소수의 160개 포트에서 시작하여 일부 인스턴스는 수만 개의 포트 할당 수가 매우 많을 수 있지만 풀 또는 가용성 집합의 다른 인스턴스는 적은 수만 소비할 수 있습니다. 일반적으로 포트 할당이 많거나 비율이 높으면 간헐적인 오류가 발생합니다.</p>


  <p>그러나 새 할당 모델을 사용하면 각 IP 구성에 고정된 수의 SNAT 포트가 있으며, 이 포트는 아웃바운드 흐름에 대해 선택됩니다. 사용 가능한 포트가 소진되면 더 이상 할당할 수 없습니다. 이는 개별 인스턴스에서 매우 많은 수의 동시 SNAT 연결을 시작하는 서비스에 영향을 미칠 수 있습니다. 서비스가 이 범주에 속하는 경우 서비스 디자인을 재고하고 가능한 완화 방법을 찾는 것이 좋습니다. <a href="https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-connections" target="_blank">아웃바운드 연결 이해</a> 문서의 <a href="https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-connections#snatexhaust" target="_blank">SNAT 포트 소모 관리 섹션</a>은 더 나은 SNAT 포트 관리 기술을 확장합니다.</p>


  <p>새 모델을 사용하면 스케일 업하는 경우 인스턴스 수가 현재 풀 크기보다 증가하면 인스턴스당 할당된 SNAT 포트 수가 절반으로 감소합니다. 또한 기존 연결을 다시 설정하고 재배포를 위해 일부 포트를 해제하여 서비스에 영향을 줄 수 있습니다.</p>


  <h2>지금 어떻게 해야 하나요?</h2>


  <p>안정적이고 확장 가능한 시나리오를 디자인하는 방법에 대한 지침은 SNAT 포트 고갈 관리에 설명된 시나리오 및 패턴을 검토하고 숙지합니다.</p>


  <h2>이 마이그레이션에서 예외를 얻으려면 어떻게 해야 하나요?</h2>


  <p>포트 할당 알고리즘은 플랫폼 수준 변경입니다. 고객에게 예외가 부여되지 않습니다. 그러나 Azure에서 중요한 프로덕션 워크로드를 실행하고 있으며 더 안전한 완화 구현을 보장하거나 서비스 논리를 변경하기 전에 중요한 기간을 기다려야 한다는 것을 이해합니다. 배포 정보를 사용하여 이러한 시나리오에서 Azure 지원에 문의하고&rsquo; 서비스에 중단이 없도록 웹 작업을 진행하세요.</p>
