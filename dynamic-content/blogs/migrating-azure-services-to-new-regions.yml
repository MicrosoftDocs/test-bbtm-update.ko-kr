### YamlMime:Yaml
ms.openlocfilehash: 2f37f932571ca37f3af78f6a42dccfbae9a5e4f3
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139907680"
Slug: migrating-azure-services-to-new-regions
Title: Azure 서비스를 새 지역으로 마이그레이션
Summary: 지역 간에 Azure 서비스를 이동하는 고객의 경험에 대한 인사이트입니다.  원활하고 간단한 방법으로 마이그레이션을 달성한 방법을 알아봅니다.
Content: >-
  최근에 고객이 미국 중남부 지역에서 미국 동부 지역 데이터 센터로 서비스를 이동해야 하는 계약을 수행했습니다. 참여에는 적절한 크기의 Premium SKU를 계획하고 High-Availability 및 롤백에 대한 Active Geo-Replication 활용하는 용량 처리가 포함되었습니다.


  고객은 미국 중남부에 있는 Azure 서비스를 미국 동부 지역으로 마이그레이션하려고 했습니다. 도움이 필요한 기본 영역은 잠재적 가동 중지 시간을 예측해야 하는 데이터베이스를 중심으로 합니다. 가동 중지 시간은 가능한 한 낮아야 하지만 6시간을 초과할 수 없습니다.

  <h2>고객 개요</h2>

  고객은 지리사회적 모바일 게임의 개발자입니다. 이 게임은 전 세계의 도시와 도시에 대한 인식을 가지고 있으며, 아프리카 2 개국을 제외한 모든 국가에 존재합니다. 플레이어는 주로 물리적 지리적 위치 측면에서 참여합니다.

  <h2>계획</h2>

  계획 관점에서 여러 옵션을 고려했습니다. 이 것들은 특별히 긴 토론은 아니었지만 아이디어였으며 필연적으로 그러한 대화의 전형이기 때문에 주목할 가치가 있습니다.

  <ul>
      <li>데이터베이스는 얼마나 큰가요?</li>
      <li>데이터베이스에 사용되는 현재 SKU는 무엇인가요?</li>
      <li>얼마나 많은 가동 중지 시간을 허용할 수 있습니까?</li>
      <li>마이그레이션하는 동안 얼마나 많은 데이터 손실을 허용할 수 있나요?</li>
      <li>얼마나 많은 돈을 지출할 의향이 있습니까?</li>
      <li>미리 보기 상태인 최근에 게시된 서비스 및/또는 서비스의 사용을 허용할 수 있나요?</li>
      <li>데이터 이동과 관련된 현재 문제는 무엇인가요?</li>
      <li>당신은 무엇에 대해 걱정하지 않습니까?</li>
  </ul>

  &nbsp;


  이 고객에게는 이동하는 것이 가장 중요했습니다. 그래서 우리는 우리가 할 수 있는 일의 관점에서 꽤 많은 위도를 가졌습니다.


  데이터베이스는 약 35GB였습니다. 약 5GB의 데이터는 온라인 상태여야 하는 것으로 간주될 수 있으며, 나머지는 시간이 지남에 따라 추가될 수 있으며, 이는 본질적으로 오프라인입니다.


  데이터베이스는 비즈니스 버전 SKU였으며 페더레이션과 같은 특정 Azure 기능을 활용하지 않았습니다.


  최대 8시간의 가동 중지 시간을 허용할 수 있지만 가동 중지 시간이 2시간 미만인 경우 비즈니스 및 소비자에 대한 기대치를 관리하는 것이 훨씬 쉬웠습니다. 또한 특정 요일 및 하루 중 시간은 가동 중지 시간에 더 많은 적용이 가능했기 때문에 가동 중지 시간을 제어하는 것이 바람직한 요구 사항이었습니다.


  고객은 비용을 의식했지만 비용 고려 사항에 대한 인식을 포함하는 경우 모든 아이디어에 열려 있었습니다.


  고객은 DBCopy 프로세스에 대해 매우 신중했으며, 대규모 데이터 집합을 이동하기 위한 내보내기/가져오기와 함께 10시간보다 훨씬 오래 걸렸으며 이는 비즈니스에 심각한 영향을 미쳤습니다.


  컴퓨팅 노드의 이동은 문제가 되지 않았으며 기존 Blob Storage 데이터를 즉시 이동할 필요가 없었습니다. 기존 Blob에 액세스하는 데 DC 간 논리가 필요하지 않은 솔루션이 설계되었습니다.


  몇 가지 옵션은 다음과 같습니다.

  <ol>
      <li>활성 Geo-Replication 기능 활용</li>
      <li>모든 연결 중지, 데이터 내보내기, 파일 복사, 미국 동부 지역으로 가져오기</li>
      <li>미국 동부 지역에서 DBCopy 만들기, 데이터 내보내기, 파일 복사, 복원</li>
  </ol>

  활성 Geo-Replication 옵션은 다음과 같은 이유로 선호되는 선택이었습니다.

  <ul>
      <li>가장 낮은 가동 중지 시간</li>
      <li>계획된 마이그레이션 중에 데이터 손실 없음</li>
      <li>롤백 옵션을 사용할 수 있습니다.
  <ul>
      <li>실행 실패는 미국 중남부 데이터 센터에서 리소스를 다시 사용하도록 설정하는 간단한 단계입니다.</li>
  </ul>

  </li>
      <li>최저 TCO</li>
      <li>향후 계획에 맞게 조정(Premium SKU로 업그레이드)</li>
  </ul>

  한 가지 우려 사항은 서비스가 미리 보기 상태라는 것이었지만 이는 허용 가능한 위험으로 간주되었습니다. 그들의 역사적 성과를 검토 한 후, P1은 자신의 요구에 충분할 것이라고 결정했다. 복제가 너무 리소스 집약적일지 여부였지만 피크가 한 번 이벤트로 이해되고 예측 가능한 리소스 요구 사항이 낮다는 점을 감안할 때 P1을 유지하고 즉시 P2로 업그레이드할 준비를 하기로 결정했습니다.


  용량 계획 프로세스의 일환으로 고객은 기본, 표준 및 Azure SQL Database()용<a href="https://msdn.microsoft.com/en-us/library/azure/dn369873.aspx">https://msdn.microsoft.com/en-us/library/azure/dn369873.aspx</a> Premium 미리 보기 문서를 지적했습니다.

  <h2>실행</h2>

  고객은 Premium SKU 미리 보기에 등록해야 했습니다. 이 작업은 포털을 통해 수행해야 하며 프로세스가 완료되는 데 몇 초가 걸립니다.


  등록한 후에는 데이터베이스를 Premium 업그레이드할 수 있습니다. 계획에 활용된 항목에 대한 자세한 내용은 "데이터베이스 서비스 계층 및 성능 수준 변경"(<a href="https://msdn.microsoft.com/en-us/library/dn369872.aspx">https://msdn.microsoft.com/en-us/library/dn369872.aspx</a>)을 참조하세요. 아래 수식은 실제로 업그레이드에 소요된 약 12시간의 시간을 예측하는 데 매우 정확했습니다.

  <p align="center">3 * (5 분 + 데이터베이스 크기 / 150MB / 분)</p>

  업그레이드가 원활하게 진행되었습니다. 한 때 여러 연결이 연결되지 않았지만 MSDN 문서에서 설명한 대로 잠시 동안 연결되었습니다.


  다음 단계는 원하는 지역, 즉 미국 동부 지역에 복제본을 만드는 것이었습니다. 시간이 얼마나 걸리는지에 대한 불확실성과 복제본을 수행하는 데 필요한 리소스에 대한 불확실성이 있었습니다. 단계는 이 링크 "활성 Geo-Replication 구성에서 장애 조치(failover)"(<a href="https://msdn.microsoft.com/en-us/library/azure/dn741337.aspx">https://msdn.microsoft.com/en-us/library/azure/dn741337.aspx</a>)에 따라 잘 설명되어 있습니다. 고객은 복제본의 초기 동기화가 얼마나 오래 걸렸는지에 대한 질문에 응답할 때 가장 좋다고 말했습니다.

  <blockquote>"<em>[초기 동기화]는 40분 이하였습니다*.  나는 실제 복사 시간에 확실하지 않다.  이 데이터베이스의 로컬 bacpac 파일을 만드는 데 4시간이 걸린다는 점을 고려하면 매우 놀랍습니다.</em>"</blockquote>

  <span style="font-size: small;">*완전 온라인 환경</span>


  이 실행 계획은 코드 배포 간에 수행되었습니다. 프로세스는 순전히 기술적 인 경우이의 대부분은 24hour 기간 내에 발생할 수 있습니다. 고객은 실행 계획의 다음 작업으로 이동하기 전에 며칠을 기다리기로 결정했습니다. 이 추론은 새 데이터 센터보다 기존 토폴로지에서 발생하는 중요한 코드를 변경하는 것과 관련이 있습니다. DDL 변경 내용이 복제될지 여부에 대해 우려했습니다. 로그인과 같이 마스터 데이터베이스를 업데이트하는 경우를 제외하고 모든 변경 내용이 복제됩니다. 이러한 작업은 각 환경에서 수행해야 하는 반면, 원본에서 사용자를 만들 수 있습니다. 특히 로그인 항목과 관련된 "활성 지역 복제에 대한 보안 구성"(<a href="https://msdn.microsoft.com/en-us/library/azure/dn741335.aspx">https://msdn.microsoft.com/en-us/library/azure/dn741335.aspx</a>)을 참조하세요.


  마지막 단계는 새 지역으로 전환하는 것이었습니다. 다음은 고객이 이러한 작업을 수행하는 다른 사람의 이익을 위해 공유한 단계입니다. 활성 Geo-Replication 토폴로지 종료의 경우 지침은 링크 "연속 복사 관계 종료"(<a href="https://msdn.microsoft.com/en-us/library/azure/dn741323.aspx">https://msdn.microsoft.com/en-us/library/azure/dn741323.aspx</a>)에 따라 잘 설명됩니다.

  <ol>
      <li>1주일 전에 데이터베이스를 프리미엄으로 업그레이드하고 지역 복제를 동부 데이터 센터로 설정합니다.이 작업은 같은 날 수행되었을 수 있습니다.32GB 데이터베이스가 미국 중남부에서 동부로 완전히 복제되는 데 40분 미만이 걸렸습니다.</li>
      <li>[이동일] 미국 중남부의 컨테이너 이름과 일치하도록 동부에 Blob 컨테이너를 만듭니다.(현재 Blob 데이터를 이동하도록 선택하지는 않았지만 여기서는 그렇게 할 것입니다.)</li>
      <li>새 웹 및 작업자 역할을 동부에 배포합니다.동부의 DB 및 Blob Storage에서 새 배포를 가리킵니다.</li>
      <li>새(동부) 환경에서 필요한 모든 SSL 인증서 설정</li>
      <li>(<b>가동 중지 시간 시작</b>) 이전 웹 및 새 웹을 오프라인으로 전환합니다.이 작업은 사용자에게 사이트가 유지 관리 중이라는 친숙한 메시지를 표시하는 애플리케이션의 구성 스위치를 사용하여 수행합니다.관리자만 일반적으로 사이트/API에 들어갈 수 있습니다.</li>
      <li>새 웹 역할 IP 주소를 가리키도록 DNS 변경</li>
      <li>DB에 대한 연결 문자열과 동부를 가리키는 Blob을 사용하여 이전 데이터 센터(미국 중남부)에 새 코드 배포</li>
      <li>미국 중남부 IP 주소에서 연결을 허용하도록 East DB 구성(필요하지 않을 수 있음)</li>
      <li>미국 중남부의 새 배포(준비 영역)를 오프라인 모드로 설정하고 프로덕션 영역과 교환</li>
      <li>DB 활성 Geo-Replication 중지(지속적인 복사 관계의 계획된 종료)
  <ul>
      <li>포털을 사용하여 수행된 단계</li>
  </ul>

  </li>
      <li>미국 중남부 DB를 Read-Only 모드로 설정</li>
      <li>미국 동부 지역 DB를 읽기/쓰기 모드로 설정(복제가 완료된 후)(필요하지 않을 수 있음)</li>
      <li>(<b>가동 중지 시간이 종료됨</b>) 미국 중남부 및 미국 동부 지역 데이터 센터에서 웹 사이트/API를 모두 다시 사용하도록 설정</li>
      <li>새 DB에서 자동 AzureDB 백업을 설정합니다.
  <ul>
      <li>관리 포털의 DB에 있는 "구성" 섹션에서 자동화된 내보내기를 사용합니다.</li>
  </ul>

  </li>
      <li>DNS 복제가 전 세계에 완전히 전파되면 미국 중남부에서 애플리케이션 서버를 삭제합니다.</li>
  </ol>

  고객의 다음 인용문은 경험을 분명히 하는 데 큰 역할을 합니다.

  <blockquote>"<em>이동이 매우 원활하게 진행되었습니다.  약 1시간 동안 중단되었으며, 대부분의 시간 동안 새 코드 배포, 구성 업데이트 및 prod/staging 교환을 기다리고 있었습니다.  Azure DB 복제를 종료하고 읽기/쓰기 모드를 변경하는 실제 프로세스는 간단했습니다.</em>"</blockquote>
