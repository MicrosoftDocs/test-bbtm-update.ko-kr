### YamlMime:Yaml
ms.openlocfilehash: 6852fdf2469f6d97e221778a43a10571bd5fef0f
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139905918"
Slug: improving-azure-virtual-machine-resiliency-with-predictive-ml-and-live-migration
Title: 예측 ML 및 실시간 마이그레이션을 사용하여 Azure Virtual Machine 복원력 향상
Summary: Azure에서 워크로드를 안정적으로 실행할 수 있도록 최선을 다하고 있습니다. 안정성 최적화에 많은 투자를 하고 있는 분야 중 하나는 기계 학습과 실시간 마이그레이션의 조합을 사용하여 잠재적인 오류를 예측하고 사전에 완화하는 것입니다.
Content: >-
  <p><em>이 게시물은 Microsoft Azure 팀의 캐서린 버크, 니코 팜부카스, Yingnong Dang, 오마르 칸, 알리스테어 스페이어가 공동 저술했습니다.</em></p>


  <p>Were&rsquo;는 Azure에서 워크로드를 안정적으로 실행할 수 있도록 하기 위해 최선을 다하고 있습니다. 안정성 최적화에 많은 투자를 하는 분야&rsquo; 중 하나는 기계 학습과 실시간 마이그레이션의 조합을 사용하여 잠재적인 오류를 예측하고 사전에 완화하는 것입니다.</p>


  <p>2018년 초부터 Azure는 하드웨어 오류와 같은 다양한 오류 시나리오와 랙 유지 관리 및 소프트웨어/BIOS 업데이트와 같은 일반 차량 작업에 대응하여 실시간 마이그레이션을 사용하고 있습니다. 실시간 마이그레이션을 사용하여 오류를 정상적으로 처리함으로써 가용성에 대한 오류의 영향을 50% 줄일 수 있습니다.</p>


  <p>실시간 마이그레이션에서 봉투를 더 밀어붙이려면 좋은 예측 신호를 기반으로 이러한 기능의 사전 사용을 살펴봐야 한다는 것을 알았습니다. 심층 함대 원격 분석을 사용하여 기계 학습(ML) 기반 오류 예측을 사용하도록 설정하고 디스크 오류, IO 대기 시간 및 CPU 빈도 변칙을 비롯한 여러 하드웨어 오류 사례에 대한 자동 실시간 마이그레이션에 연결했습니다.</p>


  <p>Microsoft는 MSR(Microsoft Research)과 협력하여 오류가 발생하기 전에 높은 정확도로 오류를 예측하는 ML 모델을 빌드했습니다. 결과적으로,&rsquo; 워크로드가 실패의 징후를 보이기 전에 위험한&rdquo; 머신에서 &ldquo;워크로드를 실시간으로 마이그레이션할 수 있습니다. 즉, Azure에서 실행되는 VM이 기본 하드웨어보다 더 안정적일 수 있습니다.</p>


  <p>VM 관점에서 라이브 마이그레이션은 최소한의 영향을 주어야 하며 실제로 VM이 실시간 마이그레이션되는 데서 비롯되는 문제를 보고한 고객은 없습니다. VM 상태 및 모든 네트워크 연결은 실시간 마이그레이션 중에 유지됩니다. 실시간 마이그레이션의 마지막 단계에서 VM은 몇 초 동안 일시 중지되고 새 호스트로 이동됩니다. 일부 드문 성능 중요한 워크로드는 VM 일시 중지로 이어지는 몇 분 동안 약간의 성능 저하를 알 수 있습니다.</p>


  <h2>하드웨어 오류 예측</h2>


  <p>처음에는 하드웨어 오류의 주요 드라이버인 디스크 오류를 예측하는 데 ML 모델을 집중적으로 설명했습니다. Azure만큼 큰 환경에서 디스크 오류를 예측하는 것은 복잡하며, 성공하려면 여러 가지 과제를 극복해야 했습니다. 디스크 예측 모델은 다음을 고려해야 했습니다.</p>


  <ul>
      <li><strong>다양한 상태 신호:</strong> 일부 예로는 게스트 VM 성능 저하, 호스트 운영 체제 동작 및 디스크 원격 분석이 있습니다.</li>
      <li><strong>다양한 고객 워크로드:</strong> 워크로드가 다르면 디스크 오류의 증상이 다릅니다. 디스크 집약적 워크로드는 초기 증상이 관찰된 직후에 디스크 오류가 발생할 수 있지만, 디스크 집약적 워크로드가 상대적으로 적은 노드는 몇 주 또는 몇 달 동안 이를 볼 수 없습니다.</li>
      <li><strong>다른 디스크 제조업체:</strong> 디스크의 동작 및 실패 패턴은 제조업체마다 다르며 모델 대 모델까지 다양합니다.</li>
      <li><strong>불균형 오류율:</strong> 일반적으로 노드 10,000개 중 1개만 디스크 오류의 징후를 표시합니다. 클래식 기계 학습 접근 방식은 이러한 불균형을 잘 처리하지 않습니다.</li>
  </ul>


  <p>이러한 과제를 해결하려면 신호를 수집하는 방법에 전체적인 접근 방식을 설계하고 가양성을 거부할 수 있을 만큼 유연해야 했습니다.</p>


  <p>먼저 시스템 및 디스크 수준 모두에서 원격 분석을 사용합니다. 시스템 수준 이벤트에는 호스트 IO 성능 카운터 및 시스템 이벤트가 포함됩니다. 디스크 수준 신호는 S.M.A.R.T 데이터(표준 디스크 원격 분석 데이터 형식)를 활용합니다. 포괄적인 기능 엔지니어링 접근 방식을 활용하여 다른 유형의 신호에서 학습합니다.</p>


  <p>둘째, 문제를 분류 문제 대신 순위 문제로 처리합니다. 디스크 오류 확률의 순위를 지정한 후 최적화 모델을 사용하여 실패 가능성이 가장 높은 상위 N 디스크를 식별합니다(N은 예상 최적 비용/혜택 절충에 따라 결정됨).</p>


  <p>셋째, 신호의 이질성뿐만 아니라 상관 관계를 고려하기 위해 순위 접근 방식을 사용자 지정하여 덜 정교한 모델 학습 및 유효성 검사 접근 방식을 사용할 수 없게 해야 했습니다.</p>


  <p>다음은 디스크 오류 예측이 실제 고객 워크로드를 보호하는 데 도움이 된 2018년 10월 30일의 실제 예입니다.</p>


  <ul>
      <li>01:59:26에 디스크가 실패할 확률이 높다고 예측했습니다. 이 오류는 노드에서 실행 중인 5개의 VM에 영향을 미칠 수 있습니다.</li>
      <li>02:10:38에 실시간 마이그레이션을 사용하여 이러한 5개의 VM을 노드에서 마이그레이션하기 시작했습니다. 정전 시간은 0.1~1.6초입니다.</li>
      <li>그런 다음 자세한 진단을 위해 노드가 프로덕션에서 제거되었습니다.</li>
      <li>06:20:34에 노드가 디스크 스트레스 테스트에 실패하고 복구를 위해 전송되었습니다.</li>
  </ul>


  <p>ML 혁신적인 사용에 대한 자세한 내용은 <a href="https://www.microsoft.com/en-us/research/publication/improving-service-availability-cloud-systems-predicting-disk-error/" target="_blank">디스크 오류 예측</a> 및 <a href="https://www.microsoft.com/en-us/research/publication/predicting-node-failure-in-cloud-service-systems/" target="_blank">노드 오류 예측</a>에 대한 논문을 참조하세요.</p>


  <h2>백그라운드에서 실시간 마이그레이션이 작동하는 방식</h2>


  <p>높은 수준에서 실시간 마이그레이션은 사전 마이그레이션, 브라운아웃 및 정전의 세 가지 주요 단계로 구성됩니다. 마이그레이션 전 단계에서 라이브 마이그레이션 오케스트레이터는 최상의 대상 노드를 선택하고, VM 구성을 내보내고, 권한 부여를 설정합니다. 이 단계에서 VM은 가용성 또는 성능에 영향을 주지 않고 원본 노드에서 계속 실행됩니다. 다음은 메모리 및 디스크 상태가 원본 노드에서 대상 노드로 전송되는 브라운아웃 단계입니다. 이 단계에서는 VM이 계속 실행 중이지만 추가 작업이 수행되므로 성능이 저하될 수 있습니다.</p>


  <p>브라운아웃의 길이는 VM 크기(특히 메모리 및 디스크) 및 메모리가 변경되는 속도에 따라 달라집니다. 일반적으로 가장 일반적인 VM 크기는 분 단위 &ndash; 로, 브라운아웃 범위는 1-30분입니다. 실시간 마이그레이션의 마지막 단계는 정전 단계입니다. 브라운아웃 단계가 종료되면 VM은 원본 노드와 대상 노드 모두에서 일시 중단된 상태입니다.</p>


  <p>Azure 라이브 마이그레이션 에이전트는 대상 VM을 시작하기 전에 추가 Azure 관련 상태 정보를 전송합니다. 정전의 길이는 VM이 일시 중지된 후 전송할 남아 있는 VM 상태의 양에 따라 달라집니다. 위 예제의 경우와 마찬가지로 정전은 일반적으로 한 자릿수 이하의 범위에 있습니다.</p>


  <h2>제한 사항</h2>


  <p>이러한 플랫폼 성과에 자부심을 가지고 있지만, 해야 할 일이 더 있다는 것을 항상 알고 있습니다. 실시간 마이그레이션을 사용하는 시나리오를 점진적으로 늘리고 기술 기능을 확장하고 있습니다. 라이브 마이그레이션에서는 다음 시나리오가 아직 지원되지 않습니다.</p>


  <ul>
      <li>하드웨어 서비스 해제</li>
      <li>특수 컴퓨팅(<a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-hpc" target="_blank">고성능 컴퓨팅</a>, <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-gpu" target="_blank">GPU 최적화 VM</a>, <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-memory" target="_blank">메모리 최적화 VM</a> 및 <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-storage" target="_blank">Storage 최적화된 VM</a> 포함)</li>
      <li><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-previous-gen" target="_blank">레거시 A 시리즈 VM</a></li>
      <li><a href="https://docs.microsoft.com/en-us/azure/cloud-services/cloud-services-choose-me" target="_blank">Cloud Services에서 사용하는 VM</a></li>
  </ul>


  <p>VM 가용성은 Azure 플랫폼에서 고객의&rsquo; 성공에 매우 중요하며, 기계 학습 및 실시간 마이그레이션은 이 고객 약속에 대한 Azure&rsquo;의 약속에 중추적인 역할을 합니다. 실시간 마이그레이션을 사용하여 플랫폼 업데이트를 투명하게 수행하고 다양한 하드웨어 및 소프트웨어 오류로부터 복구합니다. 기계 학습은 실시간 마이그레이션의 효율성을 높이는 데 중요한 역할을 했습니다. 실시간 마이그레이션에 대한 기술적 제한 사항이 있지만 지속적으로 개선 사항의 우선 순위를 지정하고 있습니다.</p>


  <p>기본 플랫폼 문제 및 작업으로 인해 VM이 중단되지 않도록 하는 것이 목표입니다. 향후 게시물에서는 Azure에서 실행되는 애플리케이션의 가용성을 최대화할 수 있는 복원력 있는 기반의 추가 개선 사항을 공유합니다.&nbsp;</p>
