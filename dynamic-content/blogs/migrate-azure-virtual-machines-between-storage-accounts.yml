### YamlMime:Yaml
ms.openlocfilehash: 41fa55f774572a954669da5216a170252d16c610
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139907713"
Slug: migrate-azure-virtual-machines-between-storage-accounts
Title: Storage 계정 간에 Azure Virtual Machines 마이그레이션
Summary: 이 게시물에서는 한 스토리지 계정에서 다른 스토리지 계정으로 Virtual Machine을 마이그레이션하는 방법을 알아봅니다.
Content: "Azure의 일반적인 작업 중 하나는 Virtual Machine을 한 스토리지 계정에서 다른 스토리지 계정으로 마이그레이션하는 것입니다.\n\n이러한 단계를 살펴보기 전에 Azure Virtual Machines를 설정하는 방법을 간략하게 검토하는 것이 좋습니다. Azure Virtual Machine을 만들 때 이 머신을 만들기 위해 함께 작동하는 두 가지 서비스인 컴퓨팅 및 Storage 있습니다. Storage 쪽에서는 Azure Storage 서비스 내의 스토리지 계정 중 하나에 VHD가 만들어집니다. 이 VHD가 저장된 실제 노드는 Virtual Machine을 배치하도록 지정한 지역에 있습니다. 컴퓨팅 쪽에서는 가상 머신을 배치할 두 번째 클러스터의 실제 노드를 찾습니다. VM이 해당 클러스터에서 시작되면 Storage 서비스와의 연결을 설정하고 VHD에서 부팅합니다.\n\nVirtual Machine을 만들 때 VHD가 VM을 만드는 동일한 지역의 스토리지 계정에 있어야 합니다. 이는 Virtual Machine과 스토리지 계정 간에 통신할 때 성능 일관성이 있는지 확인하기 위한 것입니다.\n\n<img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px\" title=\"IaaSArchitecture\" alt=\"IaaSArchitecture\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/IaaSArchitecture.png\" width=\"614\" height=\"295\" border=\"0\" />\n\n이 컨텍스트를 염두에 두고 가상 머신을 한 지역에서 다른 지역으로 마이그레이션하는 단계를 살펴보겠습니다.\n<ol>\n <li>가상 머신 중지</li>\n <li>원본 지역의 스토리지 계정에서 대상 지역의 스토리지 계정으로 VHD Blob을 복사합니다.</li>\n <li>Blob에서 Azure Disk 만들기</li>\n <li>디스크에서 가상 머신 부팅</li>\n</ol>\n<h2>가상 머신 중지</h2>\n서비스 관리 포털로 이동하여 마이그레이션할 Virtual Machine을 선택하고 제어 메뉴에서 종료를 선택합니다.\n\n<img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px\" title=\"ShutdownVm\" alt=\"ShutdownVm\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ShutdownVm.png\" width=\"614\" height=\"220\" border=\"0\" />\n\n또는 Azure Powershell cmdlet을 사용하여 동일한 작업을 수행할 수 있습니다.\n<pre class=\"prettyprint\">$servicename = \"KenazTestService\"\n$vmname = \"TestVM1\"\nGet-AzureVM -ServiceName $servicename -Name $vmname | Stop-AzureVM</pre>\n복사 작업을 수행할 때 파일 시스템이 일관되도록 VM을 중지하는 것은 필수 단계입니다. 현재 Azure는 실시간 마이그레이션을 지원하지 않습니다. 이 작업은 특수한 VM을 한 지역에서 다른 지역으로 마이그레이션하는 것을 의미합니다. 일반화된 이미지에서 VM을 만들려면 중지하기 전에 Virtual Machine을 sys-prep합니다.\n<h2>VHD Blob 복사</h2>\nAzure Storage 서비스는 한 스토리지 계정에서 다른 스토리지 계정으로 Blob을 이동하는 기능을 노출합니다. 이렇게 하려면 다음 단계를 수행해야 합니다.\n<ol>\n <li>원본 스토리지 계정 정보 확인</li>\n <li>대상 스토리지 계정 정보 확인</li>\n <li>대상 컨테이너가 대상 스토리지 계정에 있는지 확인합니다.</li>\n <li>Blob 복사 수행</li>\n</ol>\n<b>참고: </b> 다른 지역의 스토리지 계정 간에 Blob을 복사하는 작업은 Blob의 크기에 따라 최대 1시간 이상 걸릴 수 있습니다.\n\n이 작업을 수행하는 가장 쉬운 방법은 Azure Powershell을 통해 수행하는 것입니다.\n<pre class=\"prettyprint\">Select-AzureSubscription \"kenazsubscription\" \n\n# VHD blob to copy #\n$blobName = \"KenazTestService-TestVM1-2014-8-26-15-1-55-658-0.vhd\" \n\n# Source Storage Account Information #\n$sourceStorageAccountName = \"kenazsa\"\n$sourceKey = \"MySourceStorageAccountKey\"\n$sourceContext = New-AzureStorageContext –StorageAccountName $sourceStorageAccountName -StorageAccountKey $sourceKey  \n$sourceContainer = \"vhds\"\n\n# Destination Storage Account Information #\n$destinationStorageAccountName = \"kenazdestinationsa\"\n$destinationKey = \"MyDestinationStorageAccountKey\"\n$destinationContext = New-AzureStorageContext –StorageAccountName $destinationStorageAccountName -StorageAccountKey $destinationKey  \n\n# Create the destination container #\n$destinationContainerName = \"destinationvhds\"\nNew-AzureStorageContainer -Name $destinationContainerName -Context $destinationContext \n\n# Copy the blob # \n$blobCopy = Start-AzureStorageBlobCopy -DestContainer $destinationContainerName `\n                        -DestContext $destinationContext `\n                        -SrcBlob $blobName `\n                        -Context $sourceContext `\n                        -SrcContainer $sourceContainer</pre>\n그러면 원본 스토리지 계정에서 대상 스토리지 계정으로 Blob 복사가 시작됩니다. 이 시점에서 Blob이 완전히 복사될 때까지 잠시 기다려야 할 수 있습니다. 작업의 상태를 확인하려면 다음 명령을 사용해 볼 수 있습니다.\n<pre class=\"prettyprint\">while(($blobCopy | Get-AzureStorageBlobCopyState).Status -eq \"Pending\")\n{\n    Start-Sleep -s 30\n    $blobCopy | Get-AzureStorageBlobCopyState\n}</pre>\nBlob 복사가 완료되면 Blob 복사본의 상태가 \"성공\"이 됩니다.보다 포괄적인 복사 VHD 예제는 \"<a href=\"https://gallery.technet.microsoft.com/scriptcenter/Azure-Virtual-Machine-Copy-1041199c\">Azure Virtual Machine: Storage 계정 간에 VHD 복사</a>\"를 참조하세요.\n<h2>AzCopy를 사용하여 Blob 복사</h2>\n또 다른 옵션은 AzCopy 유틸리티를 사용하는 것입니다(<a href=\"https://aka.ms/downloadazcopy\">여기서 다운로드</a>). 스토리지 계정 간의 동일한 Blob 복사본은 다음과 같습니다.\n<pre class=\"prettyprint\">AzCopy https://sourceaccount.blob.core.windows.net/mycontainer1 https://destaccount.blob.core.windows.net/mycontainer2 /sourcekey:key1 /destkey:key2 abc.txt</pre>\n다양한 시나리오에 AzCopy를 사용하는 방법에 대한 자세한 내용은 \"<a href=\"https://azure.microsoft.com/en-us/documentation/articles/storage-use-azcopy/\">AzCopy Command-Line 유틸리티 시작</a>\"을 참조하세요.\n<h2>Azure Disk 만들기</h2>\n이 시점에서 대상 스토리지 계정에 복사한 Blob은 여전히 Blob에 불과합니다. 부팅하려면 이 Blob에서 Azure Disk를 만들어야 합니다. Virtual Machines의 디스크 섹션으로 이동하고 만들기를 선택합니다.\n\n<b>참고: </b> 이러한 지침은 특수한 VM에만 적용됩니다. VHD를 이미지로 사용하려면 VM을 다시 시작하고, sysprep하고, Blob을 복사한 다음, 이미지(디스크 아님)로 추가해야 합니다.\n\n<img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px\" title=\"VirtualMachineDisks\" alt=\"VirtualMachineDisks\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/VirtualMachineDisks.png\" width=\"614\" height=\"208\" border=\"0\" />\n\nVHD URL 탐색기를 사용하여 Blob을 복사한 대상 컨테이너에서 Blob을 선택합니다. \"VHD에 운영 체제가 포함되어 있습니다.\"라는 토글을 선택합니다. 이는 만드는 디스크 개체가 데이터 디스크 중 하나가 아닌 OS 디스크로 사용됨을 Azure에 나타냅니다.\n\n<img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px\" title=\"CreateVHD\" alt=\"CreateVHD\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/CreateVHD.png\" width=\"578\" height=\"484\" border=\"0\" />\n\n<b>참고: </b> \"Blob에서 임대 충돌이 발생했습니다...\"라는 오류가 발생하면 이전 단계로 돌아가서 Blob 복사가 완료되었는지 확인합니다.\n\n<img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px\" title=\"LeaseCOnflict\" alt=\"LeaseCOnflict\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/LeaseCOnflict.png\" width=\"614\" height=\"161\" border=\"0\" />\n\n또는 Powershell cmdlet을 사용하여 동일한 작업을 수행할 수 있습니다.\n<pre class=\"prettyprint\">Add-AzureDisk -DiskName \"myMigratedTestVM\" `\n            -OS Linux `\n            -MediaLocation \"https://kenazdestinationsa.blob.core.windows.net/destinationvhds/KenazTestService-TestVM1-2014-8-26-16-16-48-522-0.vhd\" `\n            -Verbose</pre>\n완료되면 Virtual Machines의 디스크 섹션 아래에 디스크가 표시됩니다.\n<h2>Virtual Machine 만들기</h2>\n이 시점에서 방금 만든 디스크 개체를 사용하여 Virtual Machine을 만들 수 있습니다. 서비스 관리 포털에서 갤러리에서 Virtual Machine 만들기를 선택하고 내 디스크에서 만든 디스크를 선택합니다.\n\n<b>참고</b>: 스토리지 풀이 구성된 VM을 이동하는 경우(또는 드라이브 문자 순서가 동일하게 유지되도록 하려면) 원본 VM의 VHD 매핑에 LUN 번호를 기록하고 데이터 디스크가 대상 VM의 동일한 LUN에 연결되어 있는지 확인합니다.\n\n<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/15/LinuxVM.png\"><img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px\" title=\"LinuxVM\" alt=\"LinuxVM\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/LinuxVM_thumb.png\" width=\"644\" height=\"362\" border=\"0\" /></a>\n\n이제 Virtual Machine이 대상 스토리지 계정에서 실행되고 있습니다."
