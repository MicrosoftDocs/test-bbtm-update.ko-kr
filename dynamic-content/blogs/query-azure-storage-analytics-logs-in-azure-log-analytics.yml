### YamlMime:Yaml
ms.openlocfilehash: fbd03bae9d8ba69af20c5dde2543d3fb67a8b227
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139897259"
Slug: query-azure-storage-analytics-logs-in-azure-log-analytics
Title: Azure Log Analytics에서 Azure Storage 분석 로그 쿼리
Summary: 이 블로그에서는 azure Log Analytics 작업 영역에 Azure Storage 분석 로그를 게시하는 방법을 소개합니다. 따라서 이러한 훌륭한 기능을 사용하여 리소스를 더 잘 Azure Storage 작동할 수 있습니다.
Content: >-
  <p>Log Analytics는 다양한 원본에서 원격 분석 및 기타 데이터를 수집하고 고급 분석을 위한 쿼리 언어를 제공하는 서비스입니다. <a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-data-collector-api" target="_blank">HTTP 데이터 수집기 API</a>를 사용하여 Log Analytics 작업 영역에 로깅 데이터를 게시한 후에는 문제 해결을 위해 로그를 쿼리하거나 모니터링할 데이터를 시각화하거나 로그 검색을 기반으로 경고를 만들 수 있습니다. 자세한 내용은 <a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-queries" target="_blank">Log Analytics를 참조하세요</a>.</p>


  <p>Log Analytics와 긴밀하게 통합하면 스토리지 작업 문제를 훨씬 쉽게 해결할 수 있습니다. 이 블로그에서는 Azure Storage 분석 로그를 변환하고 Azure Log Analytics 작업 영역으로 게시하는 방법을 공유합니다. 그런 다음 Log Analytics for Azure Storage(Blob, Table 및 Queue)에서 분석 기능을 사용할 수 있습니다. 주요 단계는 다음과 같습니다.</p>


  <ul>
   <li>Log Analytics에서 작업 영역 만들기</li>
   <li>Storage Analytics 로그를 JSON으로 변환</li>
   <li>Log Analytics 작업 영역에 로그 게시</li>
   <li>Log Analytics 작업 영역에서 로그 쿼리</li>
   <li>Log Analytics 작업 영역에서 로그 쿼리 시각화</li>
  </ul>


  <h2>Log Analytics에서 작업 영역 만들기</h2>


  <p>먼저 Log Analytics에서 작업 영역을 만들어야 합니다. 다음 스크린샷은 Azure Portal에서 만드는 방법을 보여 줍니다.</p>


  <p><img alt="create-log-analytics-workspace.png" border="0" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/create-log-analytics-workspace.png" style="border: 0px currentcolor; border-image: none; width: 800px; height: 546px; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;"></p>


  <h2>Storage Analytics 로그를 JSON으로 변환</h2>


  <p>Azure Storage Blob, Table 및 Queue에 대한 분석 로그를 제공합니다. 분석 로그는 동일한 스토리지 계정 내 &quot;의 $logs&quot; 컨테이너에 Blob으로 저장됩니다. Blob 이름 패턴은 Blob/2018/10/07/0000/000000.log와 같습니다&quot;.&quot; <a href="https://azure.microsoft.com/en-us/features/storage-explorer/" target="_blank">Azure Storage Explorer</a> 사용하여 구조 및 로그 파일을 찾아볼 수 있습니다. 다음 스크린샷은 Azure Storage Explorer 구조를 보여줍니다.</p>


  <p><img alt="browse-logs-in-storage-explorer.png" border="0" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/browse-logs-in-storage-explorer.png" style="border: 0px currentcolor; border-image: none; width: 800px; height: 461px; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;"></p>


  <p>각 로그 파일에서 각 줄은 세미콜론으로 나눈 하나의 요청에 대한 하나의 로그 레코드입니다. <a href="https://docs.microsoft.com/en-us/rest/api/storageservices/storage-analytics-log-format" target="_blank">Storage Analytics 로그 형식</a>에서 스키마 정의를 찾을 수 있습니다. 다음 로그 레코드는 샘플로 표시됩니다.</p>


  <pre>

  1.0;2014-06-19T22:59:23.1967767Z;GetBlob;AnonymousSuccess;200;17;16;anonymous;;storagesample;blob;&quot;https://storagesample.blob.core.windows.net/sample-container1/00001.txt&quot;;&quot;/storagesample/sample-container1/00001.txt&quot;;61d2e3f6-bcb7-4cd1-a81e-4f8f497f0da2;0;192.100.0.102:4362;2014-02-14;283;0;354;23;0;;;&quot;&quot;0x8D15A2913C934DE&quot;&quot;;Thursday, 19-Jun-14 22:58:10 GMT;;&quot;WA-Storage/4.0.1 (.NET CLR 4.0.30319.34014; Win32NT 6.3.9600.0)&quot;;;&quot;44dfd78e-7288-4898-8f70-c3478983d3b6&quot;</pre>


  <p>다음 단계 전에 로그 레코드를 JSON으로 변환해야 합니다. 모든 스크립트를 사용하여 변환할 수 있지만 변환하는 동안 처리하려면 다음과 같은 경우가 필요합니다.</p>


  <ul>
   <li>열의 세미콜론 표시: request-url 또는 user-agent-header와 같은 일부 열에는 세미콜론 표시가 포함될 수 있습니다. 세미콜론으로 분할하기 전에 인코딩해야 합니다. 분할 후 다시 디코딩해야 합니다.</li>
   <li>열의 따옴표: client-request-id 또는 etag-identifier와 같은 일부 열에는 따옴표가 포함될 수 있습니다. 다른 키 값에 대한 따옴표를 추가하는 동안 이러한 열에 대해서는 무시해야 합니다.</li>
   <li><a href="https://docs.microsoft.com/en-us/rest/api/storageservices/storage-analytics-log-format" target="_blank">열 정의를 Storage Analytics 로그 형식</a>의 키 이름으로 사용하므로 Log Analytics에서 쉽게 쿼리할 수 있습니다. 예: 버전 번호 또는 request-start-time.</li>
  </ul>


  <p>다음 샘플에서는 하나의 로그 레코드에 대해 준비된 JSON의 모양을 보여줍니다.</p>


  <pre>

  [{&quot;version-number&quot;:&quot;1.0&quot;,&quot;request-start-time&quot;:&quot;2018-10-07T20:00:52.4036565Z&quot;,&quot;operation-type&quot;:&quot;CreateContainer&quot;,&quot;request-status&quot;:&quot;ContainerAlreadyExists&quot;,&quot;http-status-code&quot;:&quot;409&quot;,&quot;end-to-end-latency-in-ms&quot;:&quot;6&quot;,&quot;server-latency-in-ms&quot;:&quot;6&quot;,&quot;authentication-type&quot;:&quot;authenticated&quot;,&quot;requester-account-name&quot;:&quot;testaccount&quot;,&quot;owner-account-name&quot;:&quot;testaccount&quot;,&quot;service-type&quot;:&quot;blob&quot;,&quot;request-url&quot;:&quot;https://testaccount.blob.core.windows.net/insights-metrics-pt1m?restype=container&quot;,&quot;requested-object-key&quot;:&quot;/testaccount/insights-metrics-pt1m&quot;,&quot;request-id-header&quot;:&quot;99999999-c01e-0085-4a78-000000000000&quot;,&quot;operation-count&quot;:&quot;0&quot;,&quot;requester-ip-address&quot;:&quot;100.101.102.103:12345&quot;,&quot;request-version-header&quot;:&quot;2017-04-17&quot;,&quot;request-header-size&quot;:&quot;432&quot;,&quot;request-packet-size&quot;:&quot;0&quot;,&quot;response-header-size&quot;:&quot;145&quot;,&quot;response-packet-size&quot;:&quot;230&quot;,&quot;request-content-length&quot;:&quot;0&quot;,&quot;request-md5&quot;:&quot;&quot;,&quot;server-md5&quot;:&quot;&quot;,&quot;etag-identifier&quot;:&quot;&quot;,&quot;last-modified-time&quot;:&quot;&quot;,&quot;conditions-used&quot;:&quot;&quot;,&quot;user-agent-header&quot;:&quot;Azure-Storage/8.4.0 (.NET CLR 4.0.30319.42000; Win32NT 6.2.9200.0)&quot;,&quot;referrer-header&quot;:&quot;&quot;,&quot;client-request-id&quot;:&quot;88888888-ed38-4a90-bb3f-000000000000&quot;}]</pre>


  <h2>Log Analytics 작업 영역에 로그 게시</h2>


  <p>Azure Log Analytics는 사용자 지정 로그 데이터 Log Analytics 작업 영역을 게시하는 <a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-data-collector-api" target="_blank">HTTP 데이터 수집기 API</a> 를 제공합니다. 문서의 샘플 코드에 따라 마지막 단계에서 준비된 로그 json 페이로드를 보낼 수 있습니다.</p>


  <pre>

  Post-LogAnalyticsData -customerId $customerId -sharedKey $sharedKey -body ([System.Text.Encoding]::UTF8.GetBytes($json)) -logType $logType</pre>


  <h2>Log Analytics 작업 영역에서 로그 쿼리</h2>


  <p>로그를 게시할 때 MyStorageLogs1과 같은 레코드 형식을 만드는 경우 MyStorageLogs1_CL 스트림 이름으로 사용하여 쿼리합니다. 다음 스크린샷은 Log Analytics에서 가져온 Storage 분석 로그를 쿼리하는 방법을 보여 줍니다.</p>


  <p><img alt="query-logs-in-loganalytics.png" border="0" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/query-logs-in-loganalytics-1.png" style="border: 0px currentcolor; border-image: none; width: 800px; height: 359px; font-size: 13px; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;"></p>


  <h2>Log Analytics에서 로그 쿼리 시각화</h2>


  <p>쿼리 결과를 집계하고 패턴 또는 추세를 찾으려는 경우 Log Analytics에서 쿼리 및 시각화를 통해 쉽게 달성할 수 있습니다. 다음 스크린샷은 쿼리 결과를 시각화하는 방법을 보여줍니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/87b0f7d6-ef6c-4e6e-bd4d-8ed259d5eccf.png"><img alt="visualize-in-loganalytics" border="0" height="707" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/87c5468d-6936-4a4e-ba87-44859c7f1ee3.png" style="margin: 0px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" title="visualize-in-loganalytics" width="1370"></a></p>


  <h2>예제 코드</h2>


  <p><a href="https://github.com/Azure/azure-docs-powershell-samples/blob/master/storage/post-storage-logs-to-log-analytics/PostStorageLogs2LogAnalytics.ps1" target="_blank">샘플 Powershell 스크립트</a>는 Storage Analytics 로그 데이터를 JSON 형식으로 변환하고 JSON 데이터를 Log Analytics 작업 영역에 게시하는 방법을 보여 줍니다.</p>


  <h2>다음 단계</h2>


  <p>Storage <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-analytics" target="_blank">Analytics</a> 및 <a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-queries" target="_blank">Log Analytics</a>에 대한 자세한 내용을 읽고 Azure에 등록하여 <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-quickstart-create-account?tabs=portal" target="_blank">Storage 계정을 만듭니</a>다.</p>


  <p>Storage 계정에서 로그 데이터를 읽을 때 읽기 작업의 비용이 발생합니다. 자세한 가격 책정은 <a href="https://azure.microsoft.com/en-us/pricing/details/storage/blobs/" target="_blank">Blob 가격 책정을 참조하세요</a>. 또한 Log Analytics는 <a href="https://azure.microsoft.com/en-us/pricing/details/monitor/" target="_blank">Azure Monitor 가격 책정</a>에 따라 요금을 청구합니다.</p>


  <p>Azure Storage Azure Monitor 팀과 협력하여 로깅 파이프라인을 통합하고 있습니다. Azure Storage 로그에 대한 Log Analytics와 기본 제공 통합이 곧 제공되기를 희망하며, 계획이 결정되면 계속 게시할 예정입니다. 피드백이나 제안이 있는 경우 <a target="_blank">Azure Storage Analytics 피드백</a>으로 전자 메일을 보낼 수 있습니다.</p>
