### YamlMime:Yaml
ms.openlocfilehash: fe20060c628be8d5f74d5ff8769134a5cd8acee0
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139898504"
Slug: archive-elasticsearch-indices-to-azure-blob-storage-using-the-azure-cloud-plugin
Title: Azure Cloud Plugin을 사용하여 Azure Blob Storage Elasticsearch 인덱스 보관
Summary: Elasticsearch용 Azure Cloud 플러그 인을 저렴한 인덱스 보관 솔루션으로 사용하는 방법을 알아봅니다.
Content: >-
  <p>Elasticsearch용 <a href="https://www.elastic.co/guide/en/elasticsearch/plugins/current/cloud-azure.html">Azure Cloud 플러그 인</a> 은 Elasticsearch 환경을 Azure와 통합하는 몇 가지 훌륭한 기능을 추가합니다. Azure Blob Storage 인덱스를 스냅샷하고 복원하여 인덱스를 복구하기 위한 비용 효율적이고 고가용성 옵션을 제공하는 기능 중 하나입니다. 더 이상 사용되지 않지만 나중에 액세스할 수 있도록 인덱스를 보관하는 방법을 제공할 수도 있습니다. 이 문서에서는 새로 통합된 Azure Cloud 플러그 인을 사용하여 Azure VM에 Elasticsearch 클러스터를 배포하는 방법을 안내하고 보관 목적으로 인덱스를 스냅샷하고 복원하는 단계를 자세히 설명합니다.</p>


  <h2>설정</h2>


  <h4>스토리지 계정 만들기</h4>


  <p>가장 먼저 필요한 것 중 하나는 스냅샷의 대상으로 사용할 스토리지 계정입니다. Azure Portal에서 요구 사항(LRS, ZRS, GRS 또는 RA-GRS)에 가장 적합한 중복 옵션을 사용하여 새로 만들기, 데이터 + Storage, Storage 계정을 선택하고 새 스토리지 계정을 만듭니다.</p>


  <p><img alt="image" border="0" height="302" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/19aa1201-8600-4f6c-a8ae-153284861c43.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="이미지" width="610"></p>


  <p>만든 후에는 Elasticsearch 클러스터를 배포할 때 필요하므로 스토리지 계정 이름 및 액세스 키 중 하나를 복사합니다. 이 정보를 얻으려면 스토리지 계정을 열고 모든 설정을 확장하고 액세스 키를 선택합니다. 액세스 키뿐만 아니라 스토리지 계정의 이름을 찾을&#39;있습니다. 나중에 쉽게 사용할 수 있도록 복사 단추를 클릭하여 클립보드에 복사하고 메모장 문서에 붙여넣습니다.</p>


  <p><img alt="image" border="0" height="397" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/86fec469-10ff-43a6-a3eb-ea35cac73e57.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="이미지" width="421"></p>


  <h4>Azure Cloud 플러그 인이 설치된 Elasticsearch 클러스터 빌드</h4>


  <p><a href="https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch">Elasticsearch용 Azure 빠른 시작 템플릿</a>은 최근에 Azure Cloud 플러그 인을 설치하고 구성하는 기능을 포함하도록 업데이트되었습니다. 클러스터를 배포하려면 GitHub 템플릿 링크로 이동하여 Azure에 배포 단추를 클릭합니다. 그러면 클러스터를 Azure 구독에 배포할 수 있는 Azure Portal로 돌아갑니다. 사용자 환경과 관련된 다른 매개 변수를 사용자 지정하거나 기본값을 사용할 수 있습니다.</p>


  <p>설치할 최신 버전의 Elasticsearch를 선택하는 것이 좋습니다(이 작성 당시 2.3.1). 플러그 인을 자동으로 설치하고 구성할 수 있도록 추가된 플러그 인(CLOUDAZURE, CLOUDAZURESTORAGEACCOUNT 및 CLOUDAZURESTORAGEKEY)과 관련된 몇 가지 추가 입력 매개 변수가 있습니다. 예를 선택하여 플러그 인을 설치하고(기본적으로 아니요로 설정됨) 이전에 만든 스토리지 계정 및 스토리지 계정 키를 입력해야 합니다.</p>


  <p><img alt="image" border="0" height="156" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c935f07b-30b7-45d5-94af-05e4385ce526.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="이미지" width="250"></p>


  <p>이 플러그 인 구현은 스토리지 계정 및 키를 지정하는 <code>elasticsearch.yml</code> 클러스터의 각 노드에 있는 파일에 몇 줄의 구성 줄을 추가합니다. 허용되는 매개 변수에 대한 전체 정보는 <a href="https://www.elastic.co/guide/en/elasticsearch/plugins/current/cloud-azure-repository.html">Elasticsearch Azure 리포지토리 설명서 페이지에서</a> 찾을 수 있습니다.</p>


  <p><img alt="image" border="0" height="192" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/df7b90eb-717f-4f0c-b4ae-e25a329ffd19.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="이미지" width="610"></p>


  <p>클러스터를 배포한 후에는 인덱스 만들기 및 스냅샷 프로세스를 진행할 준비가 된 것입니다.</p>


  <h4>인덱스 만들기 및 채우기</h4>


  <p>데모를 위해 스냅샷 및 복원에 필요한 단계를 안내하는 기본 데이터 인덱스 만들기를 진행합니다. 클러스터와 함께 배포된 Sense UI를 사용하여 이 작업을 수행하지만, curl 또는 표준 HTTP 요청을 보낼 수 있는 다른 유틸리티를 사용할 수도 있습니다. 센스는 Kibana 서버에 배포됩니다. URL을 가져와 클러스터가 포함된 부모 리소스 그룹을 열고 마지막 배포 링크를 클릭합니다.</p>


  <p><img alt="image" border="0" height="224" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/90865dea-77a6-4795-8b25-1cabd42d9be1.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="이미지" width="360"></p>


  <p>Kibana를 선택하면 배포에서 KIBANA-URL 출력을 찾을 수 있습니다. 복사 단추를 클릭하여 URL을 클립보드에 복사합니다.</p>


  <p><img alt="image" border="0" height="265" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a67e9d30-e093-4a18-a290-a263f9996b61.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="이미지" width="480"></p>


  <p>Sense의 URL은 IP 주소를 대체하는 URL <a href=""></a>입니다. 의미에서 서버 URL을 Elasticsearch 노드의 내부 주소 중 하나로 업데이트합니다.</p>


  <p><img alt="image" border="0" height="109" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b4092cc1-0f29-4902-be97-4abb28e345a6.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="이미지" width="250"></p>


  <p>이제 몇 가지 문서로 호출 <code>myindex</code> 된 인덱스 만들기를 수행할 수 있습니다. 다음 HTTP 요청을 복사/센스에 붙여넣고 녹색 화살표를 클릭하여 각 명령을 실행합니다(화살표가 표시되려면 커서가 각 명령에 있어야 합니다).</p>


  <pre class="prettyprint">

  PUT myindex

  {
    &quot;number_of_shards&quot; : 1,
    &quot;number_of_replicas&quot; : 0
  }</pre>


  <pre class="prettyprint">

  POST /myindex/documents

  {
    &quot;name&quot; : &quot;document1&quot;,
    &quot;content&quot; : &quot;Some example content for document1&quot;
  }</pre>


  <pre class="prettyprint">

  POST /myindex/documents

  {
    &quot;name&quot; : &quot;document2&quot;,
    &quot;content&quot; : &quot;Some example content for document2&quot;
  }</pre>


  <pre class="prettyprint">

  POST /myindex/documents

  {
    &quot;name&quot; : &quot;document3&quot;,
    &quot;content&quot; : &quot;Some example content for document3&quot;
  }</pre>


  <p>이제 다음 명령을 실행하면 새로 만든 인덱스를 보고 검색하여 방금 추가한 항목을 확인할 수 있습니다.</p>


  <pre class="prettyprint">

  GET _cat/indices?v

  GET myindex/_search</pre>


  <p>이제 인덱스가 있으므로 스냅샷을 사용하여 보관하는 프로세스를 진행합니다.</p>


  <h2>인덱스 스냅샷 및 보관</h2>


  <h4>스냅샷 리포지토리 만들기</h4>


  <p>가장 먼저 해야 할 일은 리포지토리를 만드는 것입니다. 리포지토리는 스냅샷을 저장해야 하는 위치를 가리키는 논리적 컨테이너이며, 이 경우 Azure에 스냅샷을 저장합니다. Sense에서 다음을 실행하여 새 리포지토리를 설정합니다.</p>


  <pre class="prettyprint">

  PUT _snapshot/myrepository

  {
    &quot;type&quot; : &quot;azure&quot;
  }</pre>


  <p>그러면 파일에 지정된 스토리지 계정에 대한 매개 변수를 사용하여 호출 <code>myrepository</code> 되는 새 리포지토리가 <code>elasticsearch.yml</code> 만들어집니다.</p>


  <h4>스냅샷 가져오기</h4>


  <p>이제 인덱스의 스냅샷을 만듭니다.</p>


  <pre class="prettyprint">

  PUT /_snapshot/myrepository/myindexsnapshot

  {
    &quot;indices&quot; : &quot;myindex&quot;,
    &quot;include_global_state&quot; : false
  }

  </pre>


  <p>여기서는 몇 가지 옵션을 지정했습니다. 첫 <code>indices</code> 번째는 이 스냅샷에 포함할 인덱스(또는 쉼표로 구분된 인덱스)를 지정할 수 있는 것입니다. 두 번째 옵션은 <code>include_global_state</code> 클러스터의 전역 상태가 스냅샷에 포함되지 않고 보관하려는 인덱스만 포함되도록 false로 설정하는 것입니다. 다음 요청을 사용하여 스냅샷 진행 상태를 모니터링할 수 있습니다.</p>


  <pre class="prettyprint">

  GET _snapshot/myrepository/myindexsnapshot/_status</pre>


  <p>스냅샷이 완료되면 해당 상태가 어야 <code>SUCCESS</code>합니다.</p>


  <p><img alt="image" border="0" height="217" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/75763f67-7411-4c80-a193-f0b4a0d88aca.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="이미지" width="300"></p>


  <p>스토리지 계정을 살펴보면 기본적으로 호출 <code>elasticsearch-snapshots</code>되는 Blob 컨테이너에서 인덱스와 연결된 파일이 표시됩니다. 이는 스냅샷을 <code>cloud.azure.storage.default.container</code> 저장할&#39;컨테이너의 이름으로 구성 파일에 매개 변수 <code>elasticsearch.yml</code> 를 추가하거나 HTTP 요청에 컨테이너 옵션을 전달하여 구성할 수 있습니다.</p>


  <h4>인덱스 삭제</h4>


  <p>이제 인덱스의 스냅샷이 있으므로 인덱스로 기록되는 항목이 없도록 인덱스 스냅샷을 닫은 다음 클러스터에서 제거할 수 있습니다.</p>


  <pre class="prettyprint">

  POST myindex/_close

  DELETE myindex</pre>


  <p>이 시점에서 인덱스는 더 이상 클러스터에 없으며 스냅샷이 사용하는 Azure Blob Storage 이외의 리소스를 사용하지 않습니다.</p>


  <h2>인덱스 복원</h2>


  <p>동일한 클러스터로 인덱스 복원은 간단한 프로세스입니다. 리포지토리가 이미 등록되었으므로(등록 취소되지 않았다고 가정) 다음과 같이 클러스터에 복원하려는 리포지토리 및 스냅샷을 게시하기만 하면 됩니다.</p>


  <pre class="prettyprint">

  POST _snapshot/myrepository/myindexsnapshot/_restore</pre>


  <p>스냅샷을 다른 클러스터로 복원할 수도 있습니다. 동일한 Azure Cloud 플러그 인 설정을 사용하도록 구성된 두 번째 클러스터가 있다고 가정하면 클러스터에 리포지토리를 등록해야 합니다.</p>


  <pre class="prettyprint">

  PUT _snapshot/myarchiverepository

  {
    &quot;type&quot;:&quot;azure&quot;
  }</pre>


  <p>리포지토리의 이름은 다릅니다. 이는 단순히 리포지토리의 이름이 스냅샷이 수행된 클러스터의 이름과 일치할 필요가 없지만 스냅샷 자체의 이름이 일치해야 한다는 것을 보여주기 위한 것입니다. 이제 리포지토리가 등록되었으므로 인덱스를 복원할 수 있습니다.</p>


  <pre class="prettyprint">

  POST _snapshot/myarchiverepository/myindexsnapshot/_restore</pre>


  <p>클러스터의 복구 활동에 대한 세부 정보를 표시하는 다음 명령을 실행하여 복구를 모니터링할 수 있습니다. 추가 옵션은 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-recovery.html">Elasticsearch Indices Recovery 설명서에 자세히 설명되어 있습니다</a>.</p>


  <pre class="prettyprint">

  GET _cat/recovery?v</pre>


  <p>인덱스를 검색하면 인덱스를 처음 만들 때 추가된 항목이 표시됩니다.</p>


  <pre class="prettyprint">

  GET myindex/_search</pre>


  <h2>자세한 정보</h2>


  <p>Elasticsearch용 Azure Cloud 플러그 인은 Elasticsearch 인덱스를 저비용 Azure Blob Storage에 보관하는 데 유용한 옵션을 제공하므로, 부실하거나 즉시 온라인 상태에서 더 이상 필요하지 않을 수 있는 인덱스 유지 관리와 관련된 리소스 및 비용을 줄일 수 있습니다. Azure IaaS 또는 Elasticsearch Azure Cloud 플러그 인에서 Elasticsearch를 실행하는 방법에 대한 자세한 내용은 다음 링크를 참조하세요.</p>


  <ul>
   <li><a href="https://azure.microsoft.com/en-us/documentation/articles/guidance-elasticsearch/">Azure의 Elasticsearch 참고 자료</a></li>
   <li><a href="https://www.elastic.co/guide/en/elasticsearch/plugins/current/cloud-azure.html">Elasticsearch Azure Cloud 플러그 인</a></li>
   <li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-snapshots.html">Elasticsearch 스냅샷 및 복원</a></li>
  </ul>


  <p>&nbsp;</p>


  <p>이 게시물에 대한 도움을 <a href="https://azure.microsoft.com/en-us/blog/author/hkrijger/"><em>한스 크리거</em></a><em>와 해롤드 페리에게</em> <em>특별한 감사 </em> 드립니다!</p>
