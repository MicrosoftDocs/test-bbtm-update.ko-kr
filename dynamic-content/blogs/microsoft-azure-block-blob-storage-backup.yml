### YamlMime:Yaml
ms.openlocfilehash: 950d9326782e2f1ab43f629158da93c436ab830d
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139903192"
Slug: microsoft-azure-block-blob-storage-backup
Title: Azure 블록 Blob Storage Backup
Summary: Azure Blob Storage는 클라우드를 위한 Microsoft의 개체 스토리지 솔루션입니다. Blob Storage 분산 액세스를 위해 저장, 이미지, 문서 및 기타 파일 형식에 이상적입니다. 다양한 시나리오에서 사용할 수 있는 방법에 대해 자세히 알아보려면 Azure의 개체 스토리지 소개를 참조하세요.
Content: >-
  <p>Azure Blob Storage Microsoft&#39;확장성이 뛰어난 클라우드 개체 저장소입니다. Blob Storage 이미지, 문서 및 기타 파일 형식과 같은 구조화되지 않은 데이터를 저장하는 데 적합합니다. 다양한 시나리오에서 사용할 수 있는 방법에 대해 자세히 알아보려면 <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction" target="_blank">Azure의 개체 스토리지 소개</a> 를 참조하세요.</p>


  <p>Azure Blob Storage 데이터는 항상 복제되어 내구성과 고가용성을 보장합니다. Azure Storage 복제는 계획된 이벤트 그리고 일시적인 하드웨어 오류, 네트워크 또는 정전, 대규모 자연 재해 등의 계획되지 않은 이벤트로부터 데이터를 보호하기 위해 데이터를 복사합니다. 동일한 데이터 센터, 동일한 지역 내의 영역 데이터 센터 또는 전체 지역에 데이터를 복제하도록 선택할 수 있습니다. <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-introduction#replication" target="_blank">스토리지 복제에 대한 자세한 내용을 찾습니다</a>.</p>


  <p>Blob Storage는 기본 제공 복제를 지원하지만 데이터 복제가 애플리케이션 오류로부터 보호되지 않는다는 것을 이해하는 것이&#39;. 애플리케이션 계층의 모든 문제는 Azure Storage 유지 관리하는 복제본에도 커밋됩니다. 이러한 이유로 Azure Storage Blob 데이터의 백업을 유지하는 것이 중요할 수 있습니다.&nbsp;</p>


  <p>현재 Azure Blob Storage 블록 Blob을 백업하기 위한 기본 솔루션을 제공하지 않습니다&rsquo;. 이 블로그 게시물에서는 모든 만들기, 바꾸기 및 삭제 작업에 대한 블록 Blob이 포함된 스토리지 계정의 매주 전체 및 매일 증분 백업을 수행하는 데 사용할 수 있는 백업 솔루션을 디자인합니다. 또한 솔루션은 필요한 경우 스토리지 계정 복구를 안내합니다.</p>


  <p>이 솔루션은 다음 기술을 사용하여 이 백업 기능을 구현합니다.</p>


  <p>이 시나리오에서는 매일 증분 백업을 지원하기 위해 Azure Storage 큐에 이벤트를 게시합니다.</p>


  <ul>
      <li><a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy" target="_blank">Azcopy</a> &ndash; AzCopy는 최적의 성능을 위해 설계된 간단한 명령을 사용하여 Microsoft Azure Blob, File 및 Table Storage 간에 데이터를 복사하도록 설계된 명령줄 유틸리티입니다. 파일 시스템과 스토리지 계정 간 또는 스토리지 계정 간에 데이터를 복사할 수 있습니다. 이 시나리오에서는 AzCopy를 사용하여 전체 백업 기능을 구현하고 이를 사용하여 한 스토리지 계정에서 다른 스토리지 계정으로 콘텐츠를 복사합니다.</li>
      <li><a href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-event-overview" target="_blank">EventGrids</a> &ndash; Azure Storage 이벤트를 사용하면 애플리케이션이 Blob의 생성 및 삭제에 대응할 수 있으며 복잡한 코드나 비용이 많이 들고 비효율적인 폴링 서비스가 필요하지 않습니다. 대신 이벤트는 Azure Event Grid를 통해 Azure Functions, Azure Logic Apps 또는 Azure Storage 큐와 같은 구독자에게 푸시됩니다.</li>
      <li><a href="https://docs.microsoft.com/sl-si/azure/event-grid/custom-event-to-queue-storage" target="_blank">Event Grid 확장</a> &ndash;&nbsp; 스토리지 이벤트를 Azure Queue Storage에 저장합니다. <b>이 블로그를 작성할 때 이 기능은 미리 보기로 제공됩니다. 이를 사용하려면 Azure CLI용 Event Grid 확장을 설치해야 합니다. az extension add --name eventgrid를 사용하여 설치할 수 있습니다. </b></li>
      <li>Docker 컨테이너 &ndash; Azure Queue Storage 이벤트를 읽기 위해 수신기를 호스트합니다. 블로그와 함께 제공되는 샘플 코드는 .Net Core 애플리케이션이며 선택한 플랫폼에서 호스트될 수 있으며 Docker 컨테이너에 대한 종속성이 없습니다.</li>
      <li><a href="https://azure.microsoft.com/en-in/services/storage/tables/" target="_blank">Azure Table Storage</a> &ndash; 이는 증분 백업의 이벤트 메타데이터를 유지하는 데 사용되며 다시 저장을 수행하는 동안 사용됩니다. Azure SQL, Cosmos DB 등 원하는 데이터베이스에 이벤트 메타데이터를 저장할 수 있습니다. 데이터베이스를 변경하려면 샘플 솔루션의 코드 변경이 필요합니다.</li>
  </ul>


  <h2>소개</h2>


  <p>현장에서의 경험을 바탕으로 대부분의 고객은 특정 일정에 따라 전체 및 증분 백업이 필요하다는 것을 알게되었습니다. 매주 전체 및 매일 증분 백업을 수행해야 하는 요구 사항이 있다고 가정해 보겠습니다&rsquo;. 재해의 경우 백업 집합을 사용하여 Blob을 복원하는 기능이 필요합니다.</p>


  <h2>상위 수준 아키텍처/데이터 흐름</h2>


  <p>다음은 증분 백업을 지원하기 위해 제안된 솔루션의 상위 수준 아키텍처 및 데이터 흐름입니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a7785016-fb25-4221-940c-6e4ad6c37f59.png"><img alt="clip_image002" border="0" height="511" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e2a14c0c-6a8c-46c0-b26b-d2996821319e.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="clip_image002" width="824"></a></p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e8bdd515-5b3b-4be3-9501-e5872fd1918d.png"><img alt="clip_image002[6]" border="0" height="455" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/bccabfff-8945-4d15-b6af-1f8672690516.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="clip_image002[6]" width="809"></a></p>


  <p>다음은 원본 스토리지 계정에서 대상 스토리지 계정으로 증분 백업에 대한 데이터를 복사하는 동안 .NET Core 기반 수신기가 이어지는 자세한 논리입니다.</p>


  <p>백업 작업을 수행하는 동안 수신기는 다음 단계를 수행합니다.<a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/31d77b17-ca9a-4af5-8ac5-0496a9b3db64.png"><img align="right" alt="image" border="0" height="475" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1d773edf-6f3a-42d0-8d63-91d4a9a42423.png" style="border: 0px currentcolor; border-image: none; float: right; display: inline; background-image: none;" title="이미지" width="217"></a></p>


  <ol>
      <li>2018&rdquo;과 같이 &ldquo;매년 대상 스토리지 계정에 새 Blob 컨테이너를 만듭니다.</li>
      <li>wk21&rdquo;과 같은 &ldquo;연도 컨테이너 아래에 매주 논리 하위 폴더를 만듭니다. wk21에서 만들거나 삭제한 파일이 없는 경우 논리 폴더가 만들어지지 않습니다. <a href="https://msdn.microsoft.com/en-us/library/system.globalization.calendarweekrule(v=vs.110).aspx" target="_blank">CalendarWeekRule.FirstFullWeek</a> 은 주 번호를 결정하는 데 사용되었습니다.</li>
      <li>dy0, dy1, dy2와 같은 연도 및 주 컨테이너 아래의 각 요일에 대한 논리적 하위 폴더를 만듭니다. 하루 동안 만들거나 삭제한 파일이 없는 경우 해당 날짜에 대해 논리 폴더가 만들어지지 않습니다.</li>
      <li>파일을 복사하는 동안 수신기는 원본 컨테이너 이름을 대상 스토리지 계정의 논리 폴더 이름으로 변경합니다.</li>
  </ol>


  <p>예제:</p>


  <p>SSA1(원본 Storage 계정) -&gt; <b>이미지(컨테이너)</b> &ndash;&gt; Image1.jpg</p>


  <p>다음으로 이동합니다.</p>


  <p>DSA1(대상 Storage 계정) -&gt; 2018<b>(컨테이너)</b>-&gt; WK2(논리 폴더) -&gt; dy0(논리 폴더) -&gt; <b>이미지(논리 폴더)</b> &ndash;&gt; Image1.jpg</p>


  <h3>증분 백업을 구성하는 대략적인 단계는 다음과 같습니다.</h3>


  <ol>
      <li>백업을 수행할 새 스토리지 계정(대상)을 만듭니다.</li>
      <li>스토리지 계정(원본)에 대한 Event Grid 구독을 만들어 만들기/바꾸기 및 삭제 이벤트를 Azure Storage 큐에 저장합니다. <a href="https://github.com/Azure-Samples/storage-block-blob-dotnet-backup" target="_blank">구독을 설정하는 명령은</a> 샘플 사이트에 제공됩니다.</li>
      <li>Azure Table Storage에서 Event Grid 이벤트가 .Net 수신기에 의해 마지막으로 저장되는 테이블을 만듭니다.</li>
      <li>증분 백업을 시작하도록 .Net 수신기(backup.utility)를 구성합니다. 스토리지 계정의 부하에 따라 백업을 수행하는 데 필요한 만큼 이 수신기의 인스턴스가 있을 수 있습니다. <a href="https://github.com/Azure-Samples/storage-block-blob-dotnet-backup" target="_blank">수신기 구성에 대한 세부 정보는</a> 샘플 사이트에 제공됩니다.</li>
  </ol>


  <h3>전체 백업을 구성하는 대략적인 단계는 다음과 같습니다.</h3>


  <ol>
      <li>주 시작 날짜( <i>예</i>: 일요일 오전 12:00)에 AZCopy를 예약하여 원본 스토리지 계정에서 대상 스토리지 계정으로 전체 데이터를 이동합니다.</li>
      <li>AZcopy를 사용하여 fbkp&rdquo;와 같은 &ldquo;논리 폴더의 데이터를 대상 스토리지 계정의 해당 연도 컨테이너 및 주 폴더로 이동합니다.</li>
      <li>기술 환경에 따라 VM, Jenkins 작업 등에서 AZCopy를 예약할 수 있습니다.</li>
  </ol>


  <p>재해가 발생하는 경우 솔루션은 매주 전체 백업을 기본으로 선택하고 증분 백업에서 변경 내용을 적용하여 스토리지 계정을 복원하는 옵션을 제공합니다. 제안된 옵션은 옵션 중 하나입니다. 증분 백업에서 로그만 적용하여 복원하도록 선택할 수 있지만 다시 저장 기간에 따라 더 오래 걸릴 수 있습니다.</p>


  <h3>복원을 구성하는 대략적인 단계는 다음과 같습니다.</h3>


  <ol>
      <li>데이터를 복원해야 하는 새 스토리지 계정(대상)을 만듭니다.</li>
      <li>AZCopy를 사용하여 전체 백업 폴더 &ldquo;fbkp&rdquo; 에서 대상 스토리지 계정으로 데이터를 이동합니다.</li>
      <li>restore.utility에 시작 날짜 및 종료 날짜를 제공하여 증분 복원 프로세스를 시작합니다. 구성에 대한 세부 정보는 샘플 사이트에 제공됩니다.</li>
  </ol>


  <p>예: 복원 프로세스는 복원을 수행하기 위해 2018/01/08~2018년 10월 10일 동안 테이블 스토리지에서 데이터를 순차적으로 읽습니다.</p>


  <p>각 읽기 레코드에 대해 복원 프로세스는 대상 스토리지 계정에서 파일을 추가, 업데이트 또는 삭제합니다.</p>


  <h2>지원되는 Artifacts</h2>


  <p><a href="https://github.com/Azure-Samples/storage-block-blob-dotnet-backup" target="_blank">백업 솔루션을 설정</a>하기 위한 소스 코드 및 지침을 찾습니다.</p>


  <h2>고려 사항/제한 사항</h2>


  <ul>
      <li>Blob Storage 이벤트는 Blob Storage 계정 및 범용 v2 스토리지 계정에서만 사용할 수 있습니다. 따라서 백업에 대해 구성된 스토리지 계정은 Blob Storage 계정 또는 범용 V2 계정이어야 합니다. <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-event-overview" target="_blank">Blob에 대한 Reacting Storage 이벤트 설명서를</a> 방문하여 자세히 알아보세요.</li>
      <li>Blob Storage 이벤트는 만들기, 바꾸기 및 삭제에 대해 발생합니다. 따라서 <b>Blob에 대한 수정은 이 시점에서 지원되지 않지만 </b>결국 지원됩니다.</li>
      <li>사용자가 T1에서 파일을 만들고 T10에서 동일한 파일을 삭제하고 백업 수신기가 해당 파일을&rsquo; 복사하지 않은 경우 백업에서 해당 파일을 복원할 수 없습니다. 이러한 종류의 시나리오에서는 스토리지 계정에서 <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-soft-delete" target="_blank">일시 삭제</a> 를 사용하도록 설정하고 일시 삭제에서 복원을 지원하도록 솔루션을 수정하거나 이러한 누락된 파일을 수동으로 복구할 수 있습니다.</li>
      <li>복원은 로그를 순차적으로 읽어 복원 작업을 실행하기 때문에 완료하는 데 상당한 시간이 걸릴 수 있습니다. 실제 시간은 시간 또는 일에 걸쳐 있을 수 있으며 올바른 기간은 테스트를 수행해야만 확인할 수 있습니다.</li>
      <li>AZCopy를 사용하여 매주 전체 백업을 수행합니다. 실행 기간은 데이터 크기에 따라 달라지며 시간 또는 며칠에 걸쳐 있을 수 있습니다.</li>
  </ul>


  <h2>결론</h2>


  <p>이 블로그 게시물에서 Ive&rsquo;는 Azure Blob에 대한 별도의 스토리지 계정에 증분 백업 지원을 추가하는 방법에 대한 개념 증명을 설명했습니다. 필요한 코드 샘플, 설명 및 각 단계에 대한 배경은 필요한 항목에 맞게 사용자 지정된 고유한 솔루션을 만들 수 있도록 설명되어 있습니다.</p>


  <ul>

  </ul>
