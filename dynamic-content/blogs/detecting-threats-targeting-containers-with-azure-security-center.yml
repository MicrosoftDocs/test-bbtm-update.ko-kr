### YamlMime:Yaml
ms.openlocfilehash: 49065e947e34ba15b67082e8f4b6a59cfb2822fe
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139905563"
Slug: detecting-threats-targeting-containers-with-azure-security-center
Title: Azure Security Center를 사용하여 컨테이너를 대상으로 하는 위협 감지
Summary: 점점 더 많은 서비스가 클라우드로 이동하면서 보안 문제를 해결합니다. 이 블로그 게시물에서는 컨테이너 환경의 보안 문제에 초점을 맞출 것입니다.
Content: >-
  <p>점점 더 많은 서비스가 클라우드로 이동하면서 보안 문제를 해결하고 있습니다. 이 블로그 게시물에서는 컨테이너 환경의 보안 문제에 초점을 맞출 것입니다.</p>


  <p><a href="https://azure.microsoft.com/en-us/blog/protect-linux-containers-running-in-iaas-with-azure-security-center/">이전 블로그 게시물</a>에서 Azure Security Center는 컨테이너에 대한 CIS 벤치마크를 기반으로 하는 Docker 권장 사항 및 규정 준수를 포함하여 컨테이너 보안을 위한 새로운 기능을 발표했습니다. Well&rsquo;은 Docker 수준에서 Kubernetes 클러스터 수준까지 컨테이너화된 환경에서 몇 가지 보안 문제를 해결하며, Azure Security Center가 실시간으로 발생하는 환경에서 위협을&rsquo; 감지하고 완화하는 데 어떻게 도움이 되는지 보여 줍니다.</p>


  <h2>Docker 분석</h2>


  <p>Docker의 경우 공격자에 대한 일반적인 액세스 벡터는 잘못 구성된 디먼입니다. 기본적으로 Docker 엔진은 UNIX 소켓을 통해서만 액세스할 수 있습니다. 이 설정은 Docker 엔진&rsquo;에 원격으로 액세스할 수 없도록 보장합니다. 그러나 대부분의 경우 원격 관리가 필요합니다. 따라서 Docker는 TCP 소켓도 지원합니다. Docker는 암호화되고 인증된 원격 <a href="https://docs.docker.com/engine/security/https/">통신</a>을 지원합니다. 그러나 디먼 실행에서 tlsverify&rdquo; 플래그를 &ldquo;명시적으로 지정하지 않고 TCP 소켓을 사용하여 디먼을 실행하면 Docker 호스트에 대한 네트워크 액세스 권한이 있는 모든 사용자가 인증되지 않은 API 요청을 Docker 엔진으로 보낼 수 있습니다.</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/672ea32d-dcf6-46eb-904a-06337e5de31c.png"><img alt="docker1" border="0" height="428" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f2332f52-cec9-4e8a-b18b-33575f929633.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="docker1" width="640"></a></p>


  <p align="center"><em>그림 1 &ndash; 네트워크를 통해 액세스할 수 있는 노출된 Docker 디먼</em></p>


  <p align="left"><br>

  노출된 Docker 디먼을 실행하는 호스트는 매우 빠르게 손상됩니다. Microsoft 위협 인텔리전스 센터&rsquo; <a href="https://azure.microsoft.com/en-us/blog/leverage-azure-security-center-to-detect-when-compromised-linux-machines-attack/">허니팟</a>에서는 노출된 Docker 디먼을 검색하는 스캐너가 자주 표시됩니다. Azure Security Center는 이러한 동작을 감지하고 경고할 수 있습니다.</p>


  <p align="center">&nbsp;</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/82fcfd99-7f71-4d35-a9b3-220496700689.png"><img alt="exposed_alert" border="0" height="768" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b324b5ff-bd9c-47b9-9b95-4f592e2af611.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="exposed_alert" width="606"></a></p>


  <p align="center"><em>그림 2.&nbsp; &ndash; 노출된 Docker 경고</em></p>


  <p><br>

  또 다른 보안 문제는 실제로 필요한 것보다 높은 권한으로 컨테이너를 실행하는 것일 수 있습니다. 높은 권한이 있는 컨테이너는 호스트&rsquo; 리소스에 액세스할 수 있습니다. 따라서 권한 있는 컨테이너가 손상되면 호스트가 손상될 수 있습니다. Azure Security Center는 권한 있는 컨테이너가 실행될 때 검색하고 경고합니다.</p>


  <p align="center">&nbsp;</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ebeb5bdf-8ea7-4060-9bb4-7d267967db08.png"><img alt="privileged_alert" border="0" height="480" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4c6f2200-6487-42fa-bd75-64552708560e.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="privileged_alert" width="592"></a></p>


  <p align="center"><em>그림 3 &ndash; 권한 컨테이너 경고</em></p>


  <p><br>

  컨테이너에서 SSH 서버를 실행하고 악성 이미지를 실행하는 등 Azure Security Center에서 검색할 수 있는 의심스러운 추가 동작이 있습니다.</p>


  <h2>클러스터 수준 보안</h2>


  <p>일반적으로 Docker의 단일 인스턴스를 실행하는 것만으로는 충분하지 않으며 컨테이너 클러스터가 필요합니다. 대부분의 사람들은 컨테이너 오케스트레이션에 Kubernetes를 사용합니다. 클러스터 관리의 주요 관심사는 클러스터 내에서 권한 상승 및 횡적 이동의 가능성입니다.&nbsp; 몇 가지 시나리오를 시연하고 Azure Security Center가 이러한 악의적인 활동을 식별하는 데 어떻게 도움이 되는지 보여 줍니다.</p>


  <p>첫 번째 데모에서는&rsquo; RBAC를 사용하지 않고 클러스터를 사용합니다.</p>


  <p>이러한 시나리오(그림 4)에서 기본적으로 Pod에 탑재된 서비스 계정에는 높은 클러스터 권한이 있습니다. 컨테이너 중 하나가 손상된 경우 공격자는 해당 컨테이너에 탑재된 서비스 계정에 액세스하여 API 서버와 통신하는 데 사용할 수 있습니다.</p>


  <p align="center">&nbsp;</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/88407d11-28db-457a-976c-cdde024c0270.png"><img alt="k81" border="0" height="425" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0d7111cb-a51f-4800-9e5e-81362d68f710.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="k81" width="640"></a></p>


  <p align="center"><em>그림 4 &ndash; 취약한 웹 애플리케이션 컨테이너가 API 서버에 액세스합니다.</em></p>


  <p><br>

  이 경우 클러스터의 컨테이너 중 하나는 원격 코드 실행 취약성에 취약하고 인터넷에 노출되는 웹 애플리케이션을 실행합니다. <a href="https://www.drupal.org/sa-core-2018-002">CVE-2018-7600</a>을 포함하여 원격 코드 실행을 허용하는 웹 애플리케이션의 취약성 예제가 많이 있습니다.</p>


  <p>이 RCE 취약성을 사용하여 클러스터에서 실행 중인 손상된 애플리케이션에서 API 서버로 요청을 보냅니다. 서비스 계정에는 높은 권한이 있으므로 클러스터에서 모든 작업을 수행할 수 있습니다. 다음 예제에서는 클러스터에서 비밀을 검색하고 나중에 액세스할 수 있도록 웹 애플리케이션의 파일 시스템에 출력을 저장합니다.</p>


  <p align="center"><em><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/bfc1683b-0ccc-49c6-a173-e7db1877cb44.png"><img alt="A snippet of command text which would allow an attacker to retrieve all secrets from a compromised cluster. " border="0" height="43" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0ee5fb58-4f7e-4ab0-8c76-556292cc24bd.png" style="border: 0px currentcolor; border-image: none; width: 1238px; height: 52px; display: inline; background-image: none;" title="공격자가 손상된 클러스터에서 모든 비밀을 검색할 수 있도록 하는 명령 텍스트 조각입니다. " width="1024"></a></em></p>


  <p align="center"><em>그림 5 &ndash; 페이로드가 API 서버에 요청을 보냅니다.</em></p>


  <p><br>

  그림 5.5에서는 기본 네임스페이스의 모든 비밀을 나열하는 API 서버(IP 10.0.0.1)에 요청을 보냅니다. 손상된 컨테이너의 <em>/var/run/secretes/kubernetes.io/serviceaccount/token에 있는 서비스 계정 토큰을</em> 사용하여 이 작업을 수행합니다.</p>


  <p>이제 비밀을 저장하는 파일 secrets.txt 액세스할 수 있습니다.</p>


  <p align="center"><em><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1e8de2ed-bc02-4b88-a4a9-f544bbc97f5c.png"><img alt="An image showing the information dump of the cluster's secrets." height="279" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1de82d82-876b-42f2-b43f-b04e7572b7a8.png" style="border: 0px currentcolor; border-image: none; width: 425px; height: 185px; display: inline; background-image: none;" title="클러스터 비밀의 정보 덤프를 보여 주는 이미지입니다." width="640"></a></em></p>


  <p align="center">&nbsp;</p>


  <p align="center"><em>그림 6 &ndash; 클러스터&rsquo; 비밀 덤프</em></p>


  <p><br>

  새 컨테이너를 나열, 삭제 및 만들고 다른 클러스터 리소스를 변경할 수도 있습니다.</p>


  <p>Azure Security Center는 Kubernetes 노드(필요한 클러스터&rsquo; 노드에서 감사됨)에서 API 서버에 대한 의심스러운 요청을 식별하고 경고할 수 있습니다.</p>


  <p align="center">&nbsp;</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c2e86b7f-f90d-4b20-b562-6c3b28591216.png"><img alt="k8s_alert_1" border="0" height="480" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0e9a32ac-e237-4074-82cb-745c6de11c8c.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="k8s_alert_1" width="600"></a></p>


  <p align="center"><em>그림 7 &ndash; 의심스러운 API 요청 경고</em></p>


  <p><br>

  이 공격에 대한 한 가지 완화 방법은 RBAC를 사용하여 클러스터의 권한을 관리하는 것입니다. RBAC를 사용하면 사용자가 다른 계정에 다른 권한을 부여할 수 있습니다. 기본적으로 서비스 계정에는 클러스터에서 작업을 수행할 수 있는 권한이 없습니다.</p>


  <p>그러나 RBAC를 사용하도록 설정된 경우에도 공격자는 악의적인 목적으로 이러한 취약한 컨테이너를 계속 사용할 수 있습니다. 클러스터를 모니터링하고 관리하는 매우 편리한 방법은 Kubernetes 대시보드를 사용하는 것입니다. 컨테이너 자체인 대시보드는 중요한 작업을 사용하도록 설정하지 않는 기본 RBAC 권한을 가져옵니다. 대시보드를 사용하기 위해 많은 사용자가 kubernetes-dashboard 서비스 계정에 권한을 부여합니다. 이러한 경우 공격자는 API 서버를 직접 사용하는 대신 대시보드 컨테이너를 프록시로 사용하여 클러스터에서 작업을 수행할 수 있습니다. 다음 페이로드는 네임스페이스의 주 리소스에 대한 정보가 포함된 Kubernetes 대시보드에서 기본 네임스페이스의 개요 페이지를 검색합니다.</p>


  <p align="center"><em><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/63d42a1b-5edf-450a-b7b0-c15115614ed1.png"><img alt="A snippet of command text which would allow an attacker to perform any actions in a cluster by using the dashboard container as a proxy for the API server." src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b643570b-12c3-4b8a-9a5a-e18fc9784144.png" style="border: 0px currentcolor; border-image: none; width: 724px; height: 30px; display: inline; background-image: none;" title="공격자가 대시보드 컨테이너를 API 서버의 프록시로 사용하여 클러스터에서 작업을 수행할 수 있도록 하는 명령 텍스트 조각입니다."></a></em></p>


  <p align="center">&nbsp;</p>


  <p align="center"><em>그림 8 &ndash; 대시보드에 대한 요청</em></p>


  <p>&nbsp;</p>


  <p>그림 8에서는 손상된 컨테이너에서 대시보드&rsquo; 클러스터 IP(이 경우 10.0.182.140)로 요청이 전송됩니다. 그림 9에서는 대시보드를 사용할 때의 공격 벡터를 설명합니다.</p>


  <p align="center">&nbsp;</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d684abcb-931f-4260-9d05-7b7bddc46ec9.png"><img alt="k8s2" border="0" height="382" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/9de96d68-59a4-4703-86fa-5a7971ec044f.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="k8s2" width="640"></a></p>


  <p align="center"><em>그림 9 &ndash; 취약한 컨테이너가 Kubernetes 대시보드에 액세스합니다.</em></p>


  <p><br>

  Azure Security Center는 Kubernetes 노드(필요한 클러스터&rsquo; 노드에서 감사됨)에서 대시보드 컨테이너에 대한 의심스러운 요청을 식별하고 경고할 수도 있습니다.</p>


  <p align="center">&nbsp;</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5aaf2254-1817-4d10-b1ee-b6a75c6d4a1d.png"><img alt="k8s_alert_2" border="0" height="521" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e997cdb2-223f-42dd-9ac0-61e2437720ff.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="k8s_alert_2" width="600"></a></p>


  <p align="center"><em>그림 10 &ndash; 대시보드 경고에 대한 의심스러운 요청</em></p>


  <p><br>

  특정 권한이 컨테이너에 부여되지 않은 경우에도 취약한 컨테이너에 액세스할 수 있는 공격자는 클러스터에 대한 중요한 정보를 얻을 수 있습니다. 모든 Kubernetes 노드는 특정 노드에서 실행되는 컨테이너를 관리하는 Kubelet이라는 Kubernetes 에이전트를 실행합니다. Kubelet은 포트 10255에서 인증이 필요하지 않은 읽기 전용 API를 노출합니다. 노드에 대한 네트워크 액세스 권한이 있는 모든 사용자는 이 API를 쿼리하고 노드에 대한 유용한 정보를 얻을 수 있습니다. 특히 https://[NODE IP]:10255/pods/를 쿼리하면 노드에서 실행 중인 모든 Pod가 검색됩니다.</p>


  <p>https://[NODE IP]:10255/spec/은 노드 자체에 대한 정보(예: CPU 및 메모리 사용량)를 검색합니다. 공격자는 손상된 컨테이너의 환경을 더 잘 이해하기 위해 이 정보를 사용할 수 있습니다.<br>

  횡적 이동 및 권한 상승은 컨테이너 클러스터의 주요 보안 문제 중 하나입니다. 클러스터에서 비정상적인 동작을 감지하면 이러한 위협을 감지하고 완화하는 데 도움이 될 수 있습니다.</p>


  <h2>Azure Security Center 시작</h2>


  <p>컨테이너에 대한 Azure Security Center <a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-alerts-type">경고</a> 및 <a href="https://azure.microsoft.com/en-us/blog/protect-linux-containers-running-in-iaas-with-azure-security-center/">보호에</a> 대해 자세히 알아봅니다. 오늘 Azure Security Center의 표준 계층을 사용하여 컨테이너를 <a href="https://azure.microsoft.com/en-us/free/">무료로</a> 보호합니다.</p>
