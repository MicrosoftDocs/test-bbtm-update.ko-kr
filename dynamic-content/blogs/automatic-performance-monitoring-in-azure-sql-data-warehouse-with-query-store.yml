### YamlMime:Yaml
ms.openlocfilehash: 38ce5f2c0b17baa1c4baf0ca16467d3188da8da5
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139901408"
Slug: automatic-performance-monitoring-in-azure-sql-data-warehouse-with-query-store
Title: Azure SQL Data Warehouse의 자동 성능 모니터링(미리 보기)
Summary: 이제 Azure SQL Data Warehouse는 성능 데이터를 모니터링하고 관리하기 위한 쿼리 저장소를 지원합니다.
Content: >-
  <p>데이터 웨어하우스의 성능을 모니터링하고 관리하는 것은 데이터 자산의 전반적인 상태에 매우 중요합니다. 데이터 및 쿼리 속도가 증가함에 따라 사용 빈도, 리소스 사용량 또는 회귀와 관련된 쿼리 메트릭을 추적하면 데이터에서 의미 있는 인사이트를 효율적으로 그릴 수 있는 능력에 영향을 미칠 수 있습니다.</p>


  <p>효율성을&rsquo; 높이기 위해 Gen1 및 Gen2 제품 모두에 대한 <a href="https://aka.ms/sqldw" target="_blank">Azure SQL Data Warehouse</a>용 <a href="https://docs.microsoft.com/sql/relational-databases/performance/monitoring-performance-by-using-the-query-store" target="_blank">쿼리 저장소</a>의 미리 보기를 공개하게 되어 기쁩니다. 쿼리 저장소는 데이터 웨어하우스의 작업 및 성능을 모니터링하기 위해 쿼리, 쿼리 계획, 런타임 통계 및 쿼리 기록을 추적함으로써 쿼리 성능 문제를 해결하는 데 도움을 주도록 디자인되었습니다. 쿼리 저장소는 다음을 지원하는 내부 저장소 및 DMV(동적 관리 뷰) 세트입니다.</p>


  <ul>
   <li>상위 리소스 사용 쿼리를 식별하고 튜닝합니다.</li>
   <li>임시 워크로드를 식별하고 개선합니다.</li>
   <li>통계, 인덱스 또는 시스템 크기(DWU 설정)의 변경으로 쿼리 성능 및 계획에 미치는 영향을 평가합니다.</li>
   <li>실행된 모든 쿼리에 대한 전체 쿼리 텍스트를 참조하세요.</li>
  </ul>


  <p>쿼리 저장소에는 실행 계획 정보를 유지하기 위한 계획 저장소, 실행 통계 정보를 유지하기 위한 런타임 통계 저장소 및 대기 통계 정보를 유지하기 위한 대기 통계 저장소의 세 가지 실제 저장소가 포함됩니다. 이러한 저장소는 SQL Data Warehouse에서 자동으로 관리되며, 추가 비용 없이 지난 7일 동안 누적된 쿼리 수를 무제한으로 제공합니다.</p>


  <h2>쿼리 저장소 사용</h2>


  <p>쿼리 저장소를 사용하도록 설정하는 것은 <a href="https://docs.microsoft.com/sql/t-sql/statements/alter-database-transact-sql-set-options?view=sql-server-2017" target="_blank">ALTER DATABASE</a> T-SQL 문을 실행하는 것만큼 간단합니다.</p>


  <pre>

  <code>ALTER DATABASE [Database Name] SET QUERY_STORE = ON;</code>

  </pre>


  <p><strong>참고</strong>: 지정하는 명령을 실행하여 쿼리 저장소를 <code>ALTER DATABASE</code> 사용하지 않도록 설정할 수 있습니다 <code>OFF</code>.</p>


  <h2>쿼리에 대한 전체 텍스트 찾기</h2>


  <p>쿼리 저장소를 사용하면 sys.query_store_query 사용하여 지난 7일 동안 실행된 쿼리의 전체 텍스트를 검색하고 <a href="https://docs.microsoft.com/sql/relational-databases/system-catalog-views/sys-query-store-query-transact-sql" target="_blank">DMV</a><a href="https://docs.microsoft.com/sql/relational-databases/system-catalog-views/sys-query-store-query-text-transact-sql" target="_blank">를 sys.query_store_query_text</a> 수 있습니다.</p>


  <pre>

  <code>SELECT
   q.query_id
   , t.query_sql_text
  FROM
   sys.query_store_query q
   JOIN sys.query_store_query_text t ON q.query_text_id = t.query_text_id;</code></pre>

  <p>결과에는 실행 중인 쿼리의 query_id 및 텍스트가 표시됩니다.</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/81940945-5172-40f3-bcd6-05371e9bc57b.png"><img alt="query_text" border="0" height="98" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/19bec1f8-8589-492b-a895-b43ad9c804f6.png" style="margin: 0px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" title="query_text" width="450"></a></p>


  <h2>상위 실행 쿼리 찾기</h2>


  <p>사용하도록 설정하면 쿼리 저장소는 모든 쿼리 실행을 추적합니다. 사용 중인 데이터 웨어하우스에서 실행 횟수별로 상위 쿼리를 살펴볼 수 있습니다. 쿼리 저장소 뷰를 사용하여 가장 자주 실행되는 10개 명령에 대한 쿼리 실행 수를 가져올 수 있습니다.</p>


  <pre>

  <code>SELECT TOP 10
        q.query_id                    [query_id]
        , t.query_sql_text            [command]
        , SUM(rs.count_executions)    [execution_count]
  FROM
        sys.query_store_query q
        JOIN sys.query_store_query_text t ON q.query_text_id = t.query_text_id
        JOIN sys.query_store_plan p ON p.query_id = q.query_id
        JOIN sys.query_store_runtime_stats rs ON rs.plan_id = p.plan_id
  GROUP BY

  </code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code>q.query_id
        , t.query_sql_text
  ORDER BY
        3 DESC;</code></pre>

  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/74d42be7-66e1-42b8-9fd9-ff0ad6531eb8.png"><img alt="Results" border="0" height="99" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/43370fff-8b42-4335-af4c-819db0a2f294.png" style="margin: 0px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" title="결과" width="505"></a></p>


  <h2>쿼리에 대한 실행 시간 찾기</h2>


  <p>또한 쿼리 저장소는 실행 분산이 높은 쿼리에 집중할 수 있도록 런타임 쿼리 통계를 수집합니다. sys.query_store_plan 및 sys.query_store_runtime_stats DMV를 사용하여 다음을 수집할 수 있습니다.</p>


  <pre>

  <code>SELECT
        q.query_id               [query_id]
        , t.query_sql_text       [command]
        , rs.avg_duration        [avg_duration]
        , rs.min_duration        [min_duration]
        , rs.max_duration        [max_duration]
   FROM
        sys.query_store_query q
        JOIN sys.query_store_query_text t ON q.query_text_id = t.query_text_id
        JOIN sys.query_store_plan p ON p.query_id = q.query_id
        JOIN sys.query_store_runtime_stats rs ON rs.plan_id = p.plan_id
  WHERE
        q.query_id = 10
        AND rs.avg_duration &gt; 0;</code></pre>

  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a5fa9c87-2d64-4e11-981a-7881b9386d0e.png"><img alt="Results after execution" border="0" height="110" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f2e46c5f-2bdb-4157-8cce-bfab9f48fee6.png" style="margin: 0px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" title="실행 후 결과" width="561"></a></p>


  <h2>실행에서 가장 높은 분산을 가진 쿼리 찾기</h2>


  <pre>

  <code>WITH RawData AS

  (
      SELECT
          q.query_id               [query_id]
          , t.query_sql_text       [command]
          , rs.avg_duration        [avg_duration]
          , rs.min_duration        [min_duration]
          , rs.max_duration        [max_duration]
          , (((rs.max_duration * 1.0)/ (rs.min_duration * 1.0)) - 1) * 100&nbsp;&nbsp; [variance_pct]
      FROM
          sys.query_store_query q
          JOIN sys.query_store_query_text t ON q.query_text_id = t.query_text_id
          JOIN sys.query_store_plan p ON p.query_id = q.query_id
          JOIN sys.query_store_runtime_stats rs ON rs.plan_id = p.plan_id
      WHERE
          rs.min_duration &gt; 0
  )

  SELECT
      *
  FROM
      RawData
  ORDER BY
      variance_pct DESC</code></pre>

  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/82503acb-cea9-4477-9cda-f51dbba0bf87.png"><img alt="Results with the highest variance in execution" border="0" height="83" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c0631b55-739d-4864-9669-2e2e40678564.png" style="margin: 0px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" title="실행에서 가장 높은 분산을 가진 결과" width="599"></a></p>


  <h2>다음 단계</h2>


  <p>쿼리 저장소는 추가 비용 없이 모든 Azure 지역에서 사용할 수 있습니다. Azure SQL Data Warehouse는 보안, 규정 준수, 개인 정보 보호 및 감사 분야에서 계속 앞장서고 있습니다. 자세한 내용은 백서, Microsoft SQL 플랫폼&rdquo;, &ldquo; Microsoft <a href="https://www.microsoft.com/en-us/trustcenter" target="_blank">보안 센터</a> 또는 설명서 &ldquo; 인 SQL <a href="https://docs.microsoft.com/en-us/azure/sql-data-warehouse/sql-data-warehouse-overview-manage-security" target="_blank">Data Warehouse의 데이터베이스 보안을</a> 사용하여 <a href="https://aka.ms/gdprsqlwhitepaper" target="_blank">개인 정보 보호 및 GDPR 요구 사항 해결 가이드</a>를 참조하세요.&rdquo;</p>


  <ul>
   <li>Azure SQL Data Warehouse의 쿼리 저장소&nbsp;에 대한 자세한 내용은 문서, &ldquo;<a href="https://docs.microsoft.com/en-us/sql/relational-databases/performance/monitoring-performance-by-using-the-query-store?view=sql-server-2017" target="_blank">쿼리 저장소를 사용한 성능 모니터링</a> 및&rdquo; <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-query-store-query-transact-sql?view=sql-server-2017" target="_blank">sys.query_store_query</a> 같은 쿼리 저장소 DMV를 참조하세요.</li>
   <li>기능 요청의 경우 <a href="https://feedback.azure.com/forums/307516-sql-data-warehouse" target="_blank">UserVoice</a>에 투표하세요.</li>
   <li>오늘 시작하려면 <a href="https://docs.microsoft.com/azure/sql-data-warehouse/create-data-warehouse-portal" target="_blank">Azure SQL Data Warehouse를 만듭니다</a>.</li>
   <li>최신 Azure SQL Data Warehouse 뉴스 및 기능을 최신 상태로 유지하려면 Twitter<a href="https://twitter.com/AzureSQLDW" target="_blank">@AzureSQLDW</a>에서 팔로우하세요.</li>
  </ul>
