### YamlMime:Yaml
ms.openlocfilehash: 902ccb3fb38dda1c3df164106538efcaf61b211d
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139899605"
Slug: performance-best-practices-for-using-azure-database-for-postgresql
Title: Azure Database for PostgreSQL 사용에 대한 성능 모범 사례
Summary: Microsoft는 PostgreSQL 및 MySQL용 단순하고 완전 관리형 데이터베이스 서비스인 빌드 2017에서 PostgreSQL 및 MySQL용 Azure Database 서비스의 공개 미리 보기를 발표했습니다.
Content: "<p>Microsoft는 인프라 관리, 데이터 가용성, 보호 및 규모와 관련된 복잡성을 제거하는 PostgreSQL 및 MySQL용 간단하고 완전 관리형 데이터베이스 서비스인 빌드 2017에서 PostgreSQL 및 MySQL용 Azure Database 서비스의 <a href=\"https://azure.microsoft.com/en-us/blog/announcing-azure-database-for-postgresql-preview/\" target=\"_blank\">공개 미리 보기를</a> 발표했습니다. 이 서비스는 엄청난 성장을 보였으며 고객이 서비스에 대한 최적의 쿼리 성능을 달성하기 위한 모범 사례에 대해 문의해 주었습니다. 이 게시물에서는 Azure Database for PostgreSQL을 백 엔드 데이터베이스로 사용하는 동안 성능 문제를 해결하는 방법을 간략하게 설명합니다.</p>\n\n<p>사용 패턴에 따라 두 가지 일반적인 배포 패턴이 표시됩니다.</p>\n\n<ul>\n <li>데이터베이스에 연결되는 애플리케이션 서버에서 웹 엔드포인트를 노출하는 애플리케이션 서버입니다.</li>\n <li>클라이언트가 데이터베이스에 직접 연결하는 클라이언트-서버 아키텍처입니다.</li>\n</ul>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ebec4fc5-93be-4ee6-8205-b6dbd743765e.png\"><img alt=\"Azure Database for PostgreSQL\" border=\"0\" height=\"697\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f3d30f5c-483f-4390-b9f3-985ee1af3ab1.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"Azure Database for PostgreSQL\" width=\"1154\"></a></p>\n\n<p>Azure Database for PostgreSQL 서비스를 사용하는 애플리케이션 또는 서비스의 성능 문제는 다음 범주로 광범위하게 분류할 수 있습니다. 탄원은 자세한 내용은 아래 글머리 기호 섹션의 숫자를 참조합니다.</p>\n\n<p><strong>1. 클라이언트의 리소스 경합(CPU, 메모리 및 디스크) 클라이언트 &ndash;</strong> 역할을 하는 컴퓨터/서버에는 클라이언트 컴퓨터가 Azure에서 실행되는 경우 작업 관리자, Azure Portal 또는 CLI에서 식별할 수 있는 리소스 제약 조건이 있을 수 있습니다.</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/7c34d278-73c5-486d-b37a-59bf264aecb3.png\"><img alt=\"Pic1\" border=\"0\" height=\"430\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0557d5ad-0782-4532-95e5-4de954e37c2c.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"Pic1\" width=\"1024\"></a></p>\n\n<p><strong>2. 리소스 경합(CPU, 메모리 및 디스크) &ndash;</strong> 애플리케이션 서버 역할을 하는 컴퓨터/서버로 인해 리소스 제약 조건이 발생할 수 있으며, 애플리케이션 서버/서비스 VM이 Azure에서 실행 중인 경우 작업 관리자, Azure Portal 또는 CLI에서 식별할 수 있습니다. 애플리케이션 서버가 Azure 서비스 또는 가상 머신인 경우 Azure 메트릭은 리소스 경합을 결정하는 데 도움이 될 수 있습니다.</p>\n\n<p><strong>3. Azure Database for PostgreSQL&ndash;의 리소스 경합</strong> 데이터베이스 서비스에는 데이터베이스 서비스 인스턴스에 대한 Azure 메트릭에서 확인할 수 있는 CPU, 메모리 및 스토리지와 관련된 성능 병목 현상이 발생할 수 있습니다. 자세한 내용은 아래를 참조하세요. 자세한 내용은 <a href=\"https://docs.microsoft.com/en-us/azure/postgresql/concepts-monitoring\" target=\"_blank\">Azure Database for PostgreSQL</a> 모니터링에 대해 읽어보세요.</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/be6d2ef6-83c0-4b70-964d-1a223dad370e.png\"><img alt=\"Pic2\" border=\"0\" height=\"429\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2e366381-55ec-4d3e-82bc-465ebfd42222.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"Pic2\" width=\"1024\"></a></p>\n\n<p><strong>4. 네트워크 대기 시간 &ndash;</strong> 성능 문제를 해결하는 동안 발생하는 일반적인 문제 중 하나는 클라이언트와 데이터베이스 서비스 인스턴스 간의 네트워크 대기 시간입니다.&nbsp; 성능 벤치마킹 실행을 시작하기 전에 간단한 SELECT 1 쿼리를 사용하여 클라이언트와 데이터베이스 간의 네트워크 대기 시간을 확인하는 것이 빠른 검사입니다. 대부분의 지역에서 고객은 Azure Database for PostgreSQL 서버와 동일한 지역 및 리소스 그룹에 있는 Azure에서 호스트되는 원격 클라이언트를 사용할 때 SELECT 1 타이밍에 2밀리초 미만의 대기 시간을 관찰합니다.</p>\n\n<p>psql을 사용하여 SELECT 1 타이밍을 가져오는 명령:</p>\n\n<pre>\n\\timing\nSELECT;\n\\watch 1</pre>\n\n<p>고객은 동일한 지역, 리소스 그룹에 애플리케이션 서버 및 데이터베이스 서비스를 만들고 해당하는 경우 애플리케이션 서버/클라이언트 컴퓨터에 가속 네트워킹을 사용하여 애플리케이션 처리량을 크게 늘릴 수 있음을 확인했습니다. <strong>가속화된 네트워킹을</strong> 사용하면 VM에 대한 SR-IOV(단일 루트 I/O 가상화)가 가능해 네트워킹 성능이 크게 향상됩니다. 이 고성능 경로는 데이터 경로에서 호스트를 우회하여 대기 시간, 지터 및 지원되는 VM 형식의 가장 까다로운 네트워크 작업에 사용할 CPU 사용률을 줄여줍니다. 가속화된 네트워킹을 사용하여 <a href=\"https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-create-vm-accelerated-networking\" target=\"_blank\">가상 머신을 만드는</a> 단계를 따라 가속 네트워킹을 지원하는 OS 릴리스에 대한 자세한 정보를 가져옵니다.</p>\n\n<h2>데이터베이스 성능</h2>\n\n<p>가능한 근본 원인으로 리소스 경합을 제거한 후에는 가장 높은 기간에 기여하는 데이터베이스 서버의 쿼리를 결정해야 합니다. 이 작업은 <a href=\"https://www.postgresql.org/docs/9.6/static/pgstatstatements.html\" target=\"_blank\">pg_stat_statements</a> 모듈을 사용하여 수행할 수 있습니다. 커뮤니티 PostgreSQL과 패리티를 유지하므로 PostgreSQL에서 쿼리 성능 문제를 해결하는 데 사용한 모든 네이티브 쿼리도 서비스에 적용됩니다.</p>\n\n<p>Azure Database for PostgreSQL 서버에서 아래 쿼리를 실행하여 성능/벤치마킹 실행 중에 실행된 상위 5개 기간 쿼리를 가져올 수 있습니다.</p>\n\n<pre>\nSELECT query, calls, total_time, rows, 100.0 * shared_blks_hit/           \nnullif(shared_blks_hit + shared_blks_read, 0) AS hit_percent\nFROM pg_stat_statements\nORDER BY total_time\nDESC LIMIT 5</pre>\n\n<p>성능/벤치마킹 실행에서만 문을 캡처하도록 아래 쿼리를 사용하여 <a href=\"https://www.postgresql.org/docs/9.6/static/pgstatstatements.html\" target=\"_blank\">pg_stat_statements</a> 다시 설정하는 것이 좋습니다.</p>\n\n<pre>\nSELECT pg_stat_statements_reset()</pre>\n\n<h2>유용한 팁</h2>\n\n<p><em>Azure Database for PostgreSQL 서버의<strong> CPU 사용량이</strong> 100%로 포화 상태인 경우 더 높은 수준의 컴퓨팅 단위를 선택하여 더 많은 CPU를 가져옵니다. </em> 예를 들어 표준 100의 업무 시간 동안 CPU 사용량이 약 100% 계속 가리키면 표준 200을 고려하는 것이 좋습니다.</p>\n\n<p>일반적인 문제는 데이터베이스에 포함된 <strong>기본 스토리지 크기</strong> (125GB)를 사용하는 것입니다. 125GB의 기본 스토리지 크기는 <strong>375IOP로 제한</strong>됩니다. 애플리케이션에 더 높은 IOP가 필요한 경우 스토리지 크기가 더 높은 Azure Database for PostgreSQL 서버를 만들어 더 많은 IOP를 가져와서 애플리케이션 성능이 스토리지 제한의 영향을 받지 않도록 하는 것이 좋습니다.</p>\n\n<p><em>MySQL/PostgreSQL 성능 문제 해결에서 <strong>IO 대기</strong> 가 관찰되는 경우 스토리지 크기를 늘리면 더 높은 IO 처리량을 고려해야 합니다. </em>예를 들어, pg_stat_activity 사용하여 최대 요청에 대한 대기 이벤트 유형으로 <strong>WALWriteLock</strong> 을 관찰하는 경우 스토리지 성능이 할당된 스토리지 크기로 확장될 때 스토리지 크기가 더 높은 서버를 사용하는 것이 좋습니다.</p>\n\n<p>미리 쓰기 로그 쓰기와 관련된 IO 병목 상태를 나타내는 WALWriteLock의 대기 수를 확인하는 쿼리:</p>\n\n<pre>\nselect wait_event, wait_event_type, count(*) as counts\nfrom pg_stat_activity\ngroup by wait_event, wait_event_type;</pre>\n\n<p>클라이언트/애플리케이션 서버와 데이터베이스 간을 줄이려면 Azure의 동일한 지역 및 리소스 그룹에 애플리케이션 서버/클라이언트 머신을 두는 것이 좋습니다.</p>\n\n<p>성능 테스트에 <strong>pgbench</strong> 를 사용하는 경우 적어도 연결 수보다 높은 배율 인수를 사용하여 성능 벤치마킹이 업데이트 경합 시 병목 상태가 되지 않도록 하는 것이 좋습니다. 예를 들어 pgbench3을 실행하기 위해 100개의 연결을 사용하는 경우 최소한 100개 이상의 배율 인수를 사용해야 합니다.</p>\n\n<p><em>애플리케이션 서버 역할을 하는 가상 머신의 메모리 또는 CPU 사용량과 관련된 리소스 경합</em>이 있고 애플리케이션에서 가능한 모든 최적화가 구현된 경우 가상 머신 크기를 늘려 가상 머신에서 사용할 수 있는 컴퓨팅 및 메모리를 늘리는 것이 좋습니다.</p>\n\n<p>애플리케이션 서버 역할을 하는 가상 머신에서 관찰된 IO 관련 병목 현상이 있는 경우 애플리케이션 파일을 호스트하고 <a href=\"https://docs.microsoft.com/en-us/azure/storage/storage-managed-disks-overview\" target=\"_blank\">Premium Managed Disks</a>의 사용을 평가하는 디스크 크기를 늘리는 것이 좋습니다.</p>\n\n<p>여전히 성능 문제가 있고 도움이 필요한 경우 다음 옵션이 있습니다.</p>\n\n<ul>\n <li>Microsoft 지원을 사용하여 지원 인시던트 열기</li>\n <li><a href=\"https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureDatabaseforPostgreSQL\" target=\"_blank\">MSDN 포럼</a>에 질문을 게시합니다.</li>\n <li>에 트윗을 보냅니다 <a href=\"https://twitter.com/AzureDBPostgres\" target=\"_blank\">@AzureDBforPostgreSQL</a>.</li>\n</ul>\n\n<h2>참조</h2>\n\n<ul>\n <li><a href=\"https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-create-vm-accelerated-networking\" target=\"_blank\">가속화된 네트워킹을 사용하여 가상 머신 만들기</a></li>\n <li><a href=\"https://wiki.postgresql.org/wiki/Pgbenchtesting\" target=\"_blank\">Pgbench 테스트</a></li>\n <li><a href=\"https://wiki.postgresql.org/wiki/Performance_Optimization\" target=\"_blank\">PostgreSQL 성능</a>에 대한 자세한 내용은</li>\n <li><a href=\"https://docs.microsoft.com/en-us/azure/postgresql/concepts-compute-unit-and-storage\" target=\"_blank\">Azure Database for PostgreSQL에 대한 컴퓨팅 단위 설명</a></li>\n</ul>"
