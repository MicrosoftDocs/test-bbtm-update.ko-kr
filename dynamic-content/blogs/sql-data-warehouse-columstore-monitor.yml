### YamlMime:Yaml
ms.openlocfilehash: 47aa92e82da727bfa471fbf941cf1730c12888ca
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139900431"
Slug: sql-data-warehouse-columstore-monitor
Title: Columnstore에 대한 새로운 모니터링 기능을 사용하여 Azure SQL Data Warehouse 성능 향상
Summary: 이 블로그에서는 DMV를 사용하여 SQLDW에서 columnstore 상태를 모니터링하는 방법을 보여줍니다.
Content: >-
  <p><a href="https://azure.microsoft.com/en-us/services/sql-data-warehouse/" target="_blank">Azure SQL Data Warehouse</a>(SQL DW)는 데이터 웨어하우징을 위한 SQL 기반 페타바이트 규모의 대규모 병렬 클라우드 솔루션입니다. 완전히 관리되고 매우 탄력적이므로 몇 분 안에 용량을 프로비전하고 크기를 조정할 수 있습니다. 컴퓨팅 및 스토리지의 크기를 독립적으로 조정할 수 있으므로 버스트에서 보관 시나리오까지의 범위를 지정할 수 있습니다.</p>


  <p>Azure SQL DW는 분석 워크로드에 매우 빠른 성능을 제공하기 위해 <a href="https://docs.microsoft.com/en-us/sql/relational-databases/indexes/columnstore-indexes-overview" target="_blank">Columnstore</a> 엔진에 의해 구동됩니다. Microsoft에서 <a href="https://blogs.msdn.microsoft.com/sqlserverstorageengine/2016/03/14/columnstore-index-how-does-sql-server-delivers-industry-leading-performance-for-analytic-queries/" target="_blank">업계 최고의 SQL Server Database</a>에 기본 제공되는 것과 동일한 Columnstore 엔진입니다. Azure SQL DW에서 최고 속도를 얻으려면 Columnstore 행 그룹 품질을 최대화하는 것이 중요합니다. 행 그룹은 Columnstore에서 함께 압축되는 행의 청크입니다. 행 그룹 품질을 보다 쉽게 모니터링하고 튜닝할 수 있도록 새 DMV( <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/system-dynamic-management-views" target="_blank">동적 관리 뷰</a> )를 공개합니다.</p>


  <h2>고품질 행 그룹이란?</h2>


  <p>행이 100만 개(정확히 1,048,576개 행)인 행 그룹은 이상적인 품질이며 적절한 상황에서 Azure SQL DW가 만들 것입니다. <a href="https://docs.microsoft.com/en-us/azure/sql-data-warehouse/sql-data-warehouse-memory-optimizations-for-columnstore-compression#rowgroups-can-get-trimmed-during-compression" target="_blank">메모리 부족</a>과 같은 최적이 낮은 조건에서는 행 수가 적은 행 그룹이 만들어집니다. 이는 압축 품질에 부정적인 영향을 줄 뿐만 아니라 행 그룹에 대한 보조 구조의 행당 오버헤드를 증가시킬 수 있습니다. 이렇게 하면 쿼리 성능이 크게 저하됩니다(참고: SQL DW는 이제 행 그룹 &lt; 10,000개 행을 만들지 못하게 합니다).</p>


  <h2>행 그룹 품질을 모니터링하는 방법</h2>


  <p>이제 Azure SQL DW에는 Columnstore 테이블에 대한 행 그룹의 실제 통계에 대한 정보를 노출하기 위한 새로운 DMV(<a href="https://docs.microsoft.com/en-us/azure/sql-data-warehouse/sql-data-warehouse-reference-tsql-system-views#sql-server-dmvs-available-in-sql-data-warehouse" target="_blank">sys.dm_pdw_nodes_db_column_store_row_group_physical_stats</a>)가 있습니다. 이 DMV에서 정보를 가져오는 데 사용할 수 있는 편리한 보기(<a href="https://docs.microsoft.com/en-us/azure/sql-data-warehouse/sql-data-warehouse-memory-optimizations-for-columnstore-compression#how-to-monitor-rowgroup-quality" target="_blank">vCS_rg_physical_stats</a>)가 있는 긴 이름 &ndash; 에 겁을 먹지 마세요&rsquo;. 정보의 핵심은 행 그룹이 조기에 잘렸는지 여부를 알려주는 trim_reason_desc. 트리밍되지 않은 경우 이상적인 품질입니다(trim_reason_desc = NO_TRIM). 트리밍된 경우 trim_reason_desc MEMORY_LIMITATION 또는 DICTIONARY_SIZE 같은 트리밍 이유로 설정됩니다. 아래 예제 스크린샷은 다양한 트리밍 이유로 인해 품질이 낮은 행 그룹이 있는 테이블의 스냅샷을 보여 줍니다.</p>


  <p><img alt="DMVBlogSS1" border="0" height="356" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f48f973d-e806-4e14-b5fa-d2df9176ad8b.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="DMVBlogSS1" width="610"></p>


  <h2>행 그룹 품질을 개선하는 방법</h2>


  <p>잘려진 행 그룹을 식별하면 trim_reason_desc 설명에 따라 <em>수정</em> 작업을 수행할 수 있습니다. 다음은 가장 중요한 팁입니다.</p>


  <ul>
   <li>BULKLOAD: 부하에 대해 들어오는 행 일괄 처리가 100만 개 미만인 경우 트리밍 이유가 설정됩니다. 엔진은 <a href="https://docs.microsoft.com/en-us/sql/relational-databases/indexes/columnstore-indexes-overview" target="_blank">델타 저장소</a>에 삽입하는 것과 달리 100,000개 이상의 행이 삽입될 때마다 압축된 행 그룹을 만들지만 트리밍 이유를 BULKLOAD로 설정합니다. 이 작업을 통과하려면 더 많은 행을 누적하도록 일괄 처리 로드 창을 늘리는 것이 좋습니다. 또한 <a href="https://docs.microsoft.com/en-us/azure/sql-data-warehouse/sql-data-warehouse-best-practices#do-not-over-partition" target="_blank">분할 체계를</a> 다시 평가하여 행 그룹이 파티션 경계를 넘을 수 없으므로 분할 체계가 너무 세분화되지 않도록 합니다.</li>
   <li>MEMORY_LIMITATION: 행이 100만 개인 행 그룹을 만들려면 엔진에서 일정량의 <a href="https://docs.microsoft.com/en-us/azure/sql-data-warehouse/sql-data-warehouse-memory-optimizations-for-columnstore-compression#how-to-estimate-memory-requirements" target="_blank">작업 메모리</a> 가 필요합니다. 로딩 세션의 사용 가능한 메모리가 필요한 작업 메모리보다 적으면 행 그룹이 중간에 잘립니다. <a href="https://docs.microsoft.com/en-us/azure/sql-data-warehouse/sql-data-warehouse-memory-optimizations-for-columnstore-compression" target="_blank">columstore 압축 문서에서</a>는 이 문제를 해결하기 위해 수행할 수 있는 작업을 설명하지만, 간단히 말해서 썸의 규칙은 적어도 <a href="https://docs.microsoft.com/en-us/azure/sql-data-warehouse/sql-data-warehouse-develop-concurrency#resource-classes" target="_blank">mediumrc</a> 사용자를 사용하여 데이터를 로드하는 것입니다. 또한 로드 요구 사항에 충분한 메모리를 갖기 위해 <a href="https://docs.microsoft.com/en-us/azure/sql-data-warehouse/sql-data-warehouse-develop-concurrency#memory-allocation" target="_blank">충분히 큰 SLO</a> 에 있어야 합니다.</li>
   <li>DICTIONARY_SIZE: 매우 넓은 및/또는 높은 카디널리티 문자열이 있는 문자열 열이 하나 이상 있었기 때문에 행 그룹 트리밍이 발생했음을 나타냅니다. 사전 크기는 메모리에서 16MB로 제한되며 이 값에 도달하면 행 그룹이 압축됩니다. 이러한 상황이 발생하는 경우 문제가 되는 열을 별도의 테이블에 포함해 보세요.</li>
  </ul>


  <p>아래 스크린샷은 MEMORY_LIMITATION 인해 트리밍을 방지하기 위해 권장 사항에 따라 행 그룹 품질이 고정된 동일한 테이블의 복사본을 보여 줍니다.</p>


  <p><img alt="DMVBlogSS2" border="0" height="367" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/dcd2799d-a4f7-43c8-8e4c-dbe0fd520de0.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="DMVBlogSS2" width="610"></p>


  <h2>다음 단계</h2>


  <p>Columnstore 행 그룹 품질을 모니터링하는 방법을 알게 되었으므로 일반 부하의 일부로 적극적으로 최적의 성능을 유지하고 발생하는 경우 품질 문제를 해결할 수 있습니다. Azure SQL DW를 아직 사용하지 않는 경우 비즈니스 인텔리전스 및 비즈니스 분석 워크로드에 사용해보는 것이 좋습니다.</p>


  <h2>자세한 정보</h2>


  <p>다음을 포함하여 Azure SQL DW에 대해 자세히 알아보기 위한 많은 리소스를 확인하세요.</p>


  <p><a href="https://azure.microsoft.com/documentation/articles/sql-data-warehouse-overview-what-is/" target="_blank">Azure SQL Data Warehouse란?</a></p>


  <p><a href="https://azure.microsoft.com/documentation/articles/sql-data-warehouse-best-practices/" target="_blank">SQL Data Warehouse 모범 사례</a></p>


  <p><a href="https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureSQLDataWarehouse" target="_blank">MSDN 포럼</a></p>


  <p><a href="https://stackoverflow.com/questions/tagged/azure-sqldw" target="_blank">스택 오버플로 포럼</a></p>
