### YamlMime:Yaml
ms.openlocfilehash: 6c33d0a9018373838d9c8301429f0e885f3ec1f4
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139911059"
Slug: finding-blocking-queries-in-sql-azure
Title: SQL Azure에서 쿼리 차단 문제 발견
Summary: '[이 문서는 SQL Azure 팀에서 제공했습니다.] 느리거나 오래 실행되는 쿼리는 과도한 리소스 소비에 기여하고 차단된 쿼리의 결과일 수 있습니다. 즉, 가난한 ...'
Content: <p>[이 문서는 SQL Azure 팀에서 제공했습니다.]</p><p>느린 속도로 또는 장시간 실행하는 쿼리는 과도한 리소스 소비에 기여하고 차단된 쿼리에 따른 결과일 수 있습니다. 즉, 성능이 저하됩니다. 차단의 개념은 SQL Server SQL Azure 다르지 않습니다. 차단은 잠금 기반 동시성을 가진 모든 관계형 데이터베이스 관리 시스템의 불가피한 특성이지만</p>  <p>아래 쿼리는 총 경과 시간이 가장 길고 다른 쿼리를 차단하는 상위 10개의 실행 중인 쿼리를 표시합니다. </p>  <pre class="csharpcode"><span class="kwrd">SELECT</span> <span class="kwrd">TOP</span> 10 r.session_id, r.plan_handle,      r.sql_handle, r.request_id,      r.start_time, r.status,      r.command, r.database_id,      r.user_id, r.wait_type,      r.wait_time, r.last_wait_type,      r.wait_resource, r.total_elapsed_time,      r.cpu_time, r.transaction_isolation_level,      r.row_count, st.text  <span class="kwrd">FROM</span> sys.dm_exec_requests r  <span class="kwrd">CROSS</span> APPLY sys.dm_exec_sql_text(r.sql_handle) <span class="kwrd">as</span> st  <span class="kwrd">WHERE</span> r.blocking_session_id = 0       <span class="kwrd">and</span> r.session_id <span class="kwrd">in</span>       (<span class="kwrd">SELECT</span> <span class="kwrd">distinct</span>(blocking_session_id)           <span class="kwrd">FROM</span> sys.dm_exec_requests)  <span class="kwrd">GROUP</span> <span class="kwrd">BY</span> r.session_id, r.plan_handle,      r.sql_handle, r.request_id,      r.start_time, r.status,      r.command, r.database_id,      r.user_id, r.wait_type,      r.wait_time, r.last_wait_type,      r.wait_resource, r.total_elapsed_time,      r.cpu_time, r.transaction_isolation_level,      r.row_count, st.text  <span class="kwrd">ORDER</span> <span class="kwrd">BY</span> r.total_elapsed_time <span class="kwrd">desc</span></pre>      <p>차단의 원인으로 부실한 애플리케이션 디자인, 잘못된 쿼리 계획, 유용한 인덱스 부족 등이 있습니다. </p>    <h4>차단 이해</h4>    <p>SQL Azure 한 연결이 특정 리소스에 대한 잠금을 보유하고 두 번째 연결이 동일한 리소스에서 충돌하는 잠금 유형을 획득하려고 할 때 차단이 발생합니다. 일반적으로 첫 번째 연결이 리소스를 잠그는 시간 프레임은 매우 작습니다. 잠금을 해제하면 두 번째 연결은 리소스에 대한 자체 잠금을 획득하고 처리를 계속할 수 있습니다. 이는 정상적인 동작이며 하루 종일 시스템 성능에 별다른 영향을 주지 않으면서 여러 번 발생할 수 있습니다.</p>    <p>    <br>쿼리의 기간 및 트랜잭션 컨텍스트는 잠금이 유지되는 기간과 다른 쿼리에 미치는 영향을 결정합니다. 쿼리가 트랜잭션 내에서 실행되지 않고 잠금 힌트가 사용되지 않는 경우 SELECT 문에 대한 잠금은 쿼리 기간이 아니라 실제로 읽는 시점에 리소스에만 유지됩니다. INSERT, UPDATE 및 DELETE 문의 경우 데이터 일관성과 필요한 경우 쿼리를 롤백할 수 있도록 쿼리 기간 동안 잠금이 유지됩니다.</p>    <p>    <br>트랜잭션 내에서 실행되는 쿼리의 경우 잠금이 유지되는 기간은 쿼리 유형, 트랜잭션 격리 수준 및 쿼리에서 잠금 힌트가 사용되는지 여부에 따라 결정됩니다. 잠금, 잠금 힌트 및 트랜잭션 격리 수준에 대한 설명은 SQL Server 온라인 설명서의 다음 항목을 참조하세요. </p>    <ul>    <li><a href="https://msdn.microsoft.com/en-us/library/ms190615.aspx">데이터베이스 엔진에서의 잠금</a></li>      <li><a href="https://msdn.microsoft.com/en-us/library/ms187101.aspx">잠금 및 행 버전 관리 사용자 지정</a></li>      <li><a href="https://msdn.microsoft.com/en-us/library/ms175519.aspx">잠금 모드</a></li>      <li><a href="https://msdn.microsoft.com/en-us/library/ms186396.aspx">잠금 호환성</a></li>      <li><a href="https://msdn.microsoft.com/en-us/library/ms177404.aspx">데이터베이스 엔진의 행 버전 관리 기반 격리 수준</a></li>      <li><a href="https://msdn.microsoft.com/en-us/library/ms175523.aspx">트랜잭션 제어(데이터베이스 엔진)</a></li>  </ul>    <h4>요약</h4>    <p>짧고 간단한 것은 짧은 짧은 쿼리가 많을수록 더 오래 실행되는 쿼리 수에 비해 차단 가능성을 줄일 수 있다는 것입니다. 수행하는 작업을 작은 단위로 분할하여 트랜잭션 양을 줄이고 빠른 실행 쿼리를 작성하면 최상의 성능을 얻을 수 있습니다. 잘못 작성된 느린 쿼리가 하나라도 더 빠르게 더 효율적인 쿼리를 차단하여 느리게 만들 수 있습니다. 질문, 우려 사항, 의견이 있나요? 아래에 게시하고 우리는 그들을 해결하기 위해 노력할 것입니다.</p>
