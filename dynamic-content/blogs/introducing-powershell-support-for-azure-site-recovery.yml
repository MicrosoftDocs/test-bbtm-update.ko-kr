### YamlMime:Yaml
ms.openlocfilehash: 7b11f5674cca39e5a0569b073cdc576337681b41
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139908357"
Slug: introducing-powershell-support-for-azure-site-recovery
Title: Azure Site Recovery에 대한 PowerShell 지원 소개
Summary: 지난 주 Azure Site Recovery에서 관리하는 두 Hyper-V 사이트 간의 복구에 대한 PowerShell 지원을 발표했습니다. ASR cmdlet을 사용하여 가상 머신에 대한 보호를 사용하도록 설정하고 가상 머신 또는 가상 머신을 포함하는 복구 계획에서 복구 작업을 수행할 수 있습니다.
Content: "지난 주 Azure Site Recovery에서 관리하는 두 Hyper-V 사이트 간의 복구에 대한 PowerShell 지원을 <a href=\"https://aka.ms/powershell_blog_annoucement\">발표</a> 했습니다. ASR cmdlet을 사용하여 가상 머신에 대한 보호를 사용하도록 설정하고 가상 머신 또는 가상 머신을 포함하는 복구 계획에서 복구 작업을 수행할 수 있습니다. PowerShell 지원을 통해 관리자는 ASR 서비스에 대해 스크립팅을 수행할 수 있으며 호스팅 서비스 공급자가 Self-Service 포털을 확장하여 재해 복구를 제공할 수 있습니다.\n\nASR에 대한 PowerShell 지원은 Azure PowerShell 일부로 제공되며 Azure PowerShell 2014년 10월 릴리스에서 사용할 수 있습니다. 이미 Azure PowerShell 사용 중인 경우 버전 <a href=\"https://aka.ms/powershell_blog_v0.8.10\">0.8.10</a> 이상으로 업그레이드해야 합니다. <a href=\"https://aka.ms/powershell_blog_setup\">Azure PowerShell 설정 및 구성</a>한 후에는 사용 가능한 모든 Azure Site Recovery cmdlet 목록을 볼 수 있습니다.\n\n<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/11/03/ASR_cmdlet_List.png\"><img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px\" title=\"ASR_cmdlet_List\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ASR_cmdlet_List_thumb.png\" alt=\"ASR_cmdlet_List\" width=\"1342\" height=\"310\" border=\"0\" /></a>\n<h3>ASR Vault 컨텍스트 설정</h3>\nAzure Site Recovery cmdlet을 시작하려면 ASR 자격 증명 모음 정보를 사용하여 PowerShell Runspace 컨텍스트를 설정해야 합니다. 설치하려면 SCVMM을 설치하고 자격 증명 모음에 등록하는 동안에도 사용되는 Azure Portal에서 등록 키 파일을 다운로드해야 합니다. 컨텍스트가 설정되면 cmdlet의 나머지는 설정된 컨텍스트 내에서 실행됩니다.\n\n<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/11/03/ASR_cmdlet_registrationFile2.png\"><img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px\" title=\"ASR_cmdlet_registrationFile2\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ASR_cmdlet_registrationFile2_thumb.png\" alt=\"ASR_cmdlet_registrationFile2\" width=\"1408\" height=\"605\" border=\"0\" /></a>\n\n<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/11/03/ASR_cmdlet_Import.png\"><img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px\" title=\"ASR_cmdlet_Import\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ASR_cmdlet_Import_thumb.png\" alt=\"ASR_cmdlet_Import\" width=\"915\" height=\"113\" border=\"0\" /></a>\n<h3>등록된 SCVMM 서버 나열</h3>\n<a href=\"https://aka.ms/powershell_blog_scvmmsetup\">SCVMM 서버가 설정되고 Azure Site Recovery에 등록되면</a> Get-AzureSiteRecoveryServer cmdlet을 사용하여 볼 수 있습니다. cmdlet은 ASR 보기에서 서버 상태 모니터링을 사용하도록 설정하는 서버 정보와 함께 통신 하트비트 및 공급자 버전을 출력합니다.\n\n<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/11/03/ASR_cmdlet_Server.png\"><img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px\" title=\"ASR_cmdlet_Server\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ASR_cmdlet_Server_thumb.png\" alt=\"ASR_cmdlet_Server\" width=\"447\" height=\"170\" border=\"0\" /></a>\n<h3>SCVMM 클라우드 나열</h3>\nAzure Site Recovery는 SCVMM 클라우드를 사용하여 가상 머신의 크기 조정 관리를 수행합니다. SCVMM에서 구성한 후 ASR에서 검색한 SCVMM 클라우드 정보는 Get-AzureSiteRecoveryProtectionContainer를 사용하여 볼 수 있습니다. SCVMM 클라우드 이름 또는 SCVMM 클라우드 ID를 사용하여 필요한 클라우드를 필터링할 수 있습니다.\n\n&nbsp;\n\n<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/11/03/ASR_cmdlet_Cloud.png\"><img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px\" title=\"ASR_cmdlet_Cloud\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ASR_cmdlet_Cloud_thumb.png\" alt=\"ASR_cmdlet_Cloud\" width=\"699\" height=\"347\" border=\"0\" /></a>\n\n<b><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/11/03/ASR_cmdlet_PC.png\"><img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px\" title=\"ASR_cmdlet_PC\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ASR_cmdlet_PC_thumb.png\" alt=\"ASR_cmdlet_PC\" width=\"689\" height=\"119\" border=\"0\" /></a></b>\n<h3>Virtual Machines 나열</h3>\n가상 머신은 보호 컨테이너의 컨텍스트에서 볼 수 있습니다. ASR에서 검색한 SCVMM 가상 머신의 정보는 Get-AzureSiteRecoveryProtectionEntity를 사용하여 볼 수 있습니다. 보호 컨테이너와 마찬가지로 SCVMM VMID 또는 Virtual Machine 이름을 사용하여 보호 엔터티를 필터링할 수 있습니다.\n\n<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/11/03/ASR_cmdlet_PE.png\"><img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px\" title=\"ASR_cmdlet_PE\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ASR_cmdlet_PE_thumb.png\" alt=\"ASR_cmdlet_PE\" width=\"1113\" height=\"114\" border=\"0\" /></a>\n<h3>Virtual Machines 보호</h3>\n보호 엔터티 목록은 보호된 가상 머신과 보호되지 않는 가상 머신을 모두 반환합니다. Set-AzureSiteRecoveryProtectionEntity를 사용하여 보호 엔터티에서 보호 관리를 수행할 수 있습니다. Azure Site Recovery 작업을 반환하는 비동기 작업입니다. Get-AzureSiteRecoveryJobGet-AzureSiteRecoveryJob을 사용하여 작업 상태를 완료까지 추가로 추적할 수 있습니다.\n\n동일한 간단한 샘플 스크립트 코드 조각은 다음과 같습니다.\n<pre class=\"prettyprint\">param\n(    \n    [parameter(Mandatory=$TRUE, HelpMessage=\"SCVMM Cloud Name\")]\n    [ValidateNotNullOrEmpty()]\n    [string] $ProtectedContainerName,\n\n    [parameter(Mandatory=$TRUE, HelpMessage=\"List of VM names in the SCVMM cloud\")]\n    [ValidateNotNullOrEmpty()]\n    [string[]] $VMList,\n\n    [parameter(Mandatory=$TRUE, HelpMessage=\"Protection State\")]\n    [ValidateNotNullOrEmpty()]\n [ValidateSet('ENABLE','DISABLE')]\n    [string] $ProtectionState\n)\n\n$ProtectedContainers =  Get-AzureSiteRecoveryProtectionContainer | %{ $_.Name }\nif(!$ProtectedContainers.Contains($ProtectedContainerName))\n{ \n Write-Error \"PROTECTED CONTAINER $CloudName NOT FOUND IN ASR\"\n return;\n}\n\n$ASRProtectedContainer = Get-AzureSiteRecoveryProtectionContainer -Name $ProtectedContainerName\nWrite-Output \"ProtectedContainer \" $ASRProtectedContainer\n\n$JobsList = $VMList | %{ \n  Write-Host \"Starting $ProtectionState Protections on $_\"; \n  Get-AzureSiteRecoveryProtectionEntity -Name $_ -ProtectionContainer $ASRProtectedContainer | Set-AzureSiteRecoveryProtectionEntity -Protection $ProtectionState -WaitForCompletion\n } \n\n$hasFailed = $FALSE\nforeach($Job in $JobsList)\n{\n    $JobDetails = Get-AzureSiteRecoveryJob -Job $Job\n    if($JobDetails.Errors.Count -ne 0)\n    {\n  $hasFailed = $TRUE\n  Write-Host \"JobID $Job.Id Failed\"\n  foreach($JobError in $JobDetails.Errors)\n  {\n   Write-Host $JobError.ServiceErrorDetails\n   Write-Host $JobError.ProviderErrorDetails\n   Write-Host $JobError\n  }  \n    }\n}\n\nWrite-Host \"PROPERTIES AFTER $ProtectionState DR OPERATION\"\n\n$VMList | %{ Get-AzureSiteRecoveryProtectionEntity -Name $_ -ProtectionContainer $ASRProtectedContainer }\n\nif(!$hasFailed)\n{\n Write-Host \"ENABLE DR OF ALL VMs COMPLETED SUCCESSFULLY\"\n}</pre>\n&nbsp;\n<h3>복구 계획 만들기 및 관리</h3>\n가상 컴퓨터의 보호를 활성화한 후에는 복구 계획을 만들 수 있습니다. 복구 계획은 장애 조치(failover) 및 복구를 위해 가상 컴퓨터를 함께 그룹화하고 가상 컴퓨터 그룹이 장애 조치(failover)되는 순서를 지정합니다. Azure Site Recovery cmdlet을 사용하면 사용자가 XML 파일 형식으로 Azure Portal에서 만든 종료 복구 계획을 다운로드할 수 있습니다. 복구 계획 XML 파일을 활용하여 새 복구 계획을 만들거나 기존 복구 계획을 업데이트할 수 있습니다.\n\n복구 계획 관리 cmdlet은 다음과 같이 나열됩니다.\n\n<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/11/03/ASR_cmdlet_RPcmdList.png\"><img style=\"padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px\" title=\"ASR_cmdlet_RPcmdList\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ASR_cmdlet_RPcmdList_thumb.png\" alt=\"ASR_cmdlet_RPcmdList\" width=\"1186\" height=\"122\" border=\"0\" /></a>\n\n복구 계획에 대한 샘플 XML은 다음과 같습니다.\n<pre class=\"prettyprint\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;RecoveryPlan Id=\"1077cccd-e483-4320-bbcd-b04ca39a7015\" Name=\"Contoso\" PrimaryServerId=\"4c6e08af-7a59-4749-9ccd-0ea089ad264c\" \n              SecondaryServerId=\"fc769e95-24cc-41e2-919e-1e25b2c5d50a\" Description=\"\" Version=\"V2014_07\"&gt;\n  &lt;Actions /&gt;\n  &lt;ActionGroups&gt;\n    &lt;ShutdownAllActionGroup Id=\"ShutdownAllActionGroup\"&gt;\n      &lt;PreActionSequence /&gt;\n      &lt;PostActionSequence /&gt;\n    &lt;/ShutdownAllActionGroup&gt;\n    &lt;FailoverAllActionGroup Id=\"FailoverAllActionGroup\"&gt;\n      &lt;PreActionSequence /&gt;\n      &lt;PostActionSequence /&gt;\n    &lt;/FailoverAllActionGroup&gt;\n    &lt;BootActionGroup Id=\"DefaultActionGroup\"&gt;\n      &lt;PreActionSequence /&gt;\n      &lt;PostActionSequence /&gt;\n      &lt;ProtectionEntity PrimaryProtectionEntityId=\"aa4718c1-19c2-4c44-b749-3b87a5ed4954\" /&gt;\n      &lt;ProtectionEntity PrimaryProtectionEntityId=\"981dab28-644d-4cca-aea7-b65123eb5ee3\" /&gt;\n    &lt;/BootActionGroup&gt;\n    &lt;BootActionGroup Id=\"Group2\"&gt;\n      &lt;PreActionSequence /&gt;\n      &lt;PostActionSequence /&gt;\n      &lt;ProtectionEntity PrimaryProtectionEntityId=\"7f24915d-5415-4d7a-86fe-6beef5b8acfd\" /&gt;\n      &lt;ProtectionEntity PrimaryProtectionEntityId=\"050414cf-03b0-4d2c-bb63-0993c047d658\" /&gt;\n      &lt;ProtectionEntity PrimaryProtectionEntityId=\"be96b86f-0257-42ce-8fe7-c627cfb90410\" /&gt;\n    &lt;/BootActionGroup&gt;\n  &lt;/ActionGroups&gt;\n  &lt;ActionGroupSequence&gt;\n    &lt;ActionGroup Id=\"ShutdownAllActionGroup\" ActionId=\"ShutdownAllActionGroup\" Before=\"FailoverAllActionGroup\" /&gt;\n    &lt;ActionGroup Id=\"FailoverAllActionGroup\" ActionId=\"FailoverAllActionGroup\" After=\"ShutdownAllActionGroup\" Before=\"DefaultActionGroup\" /&gt;\n    &lt;ActionGroup Id=\"DefaultActionGroup\" ActionId=\"DefaultActionGroup\" After=\"FailoverAllActionGroup\" Before=\"864672ba-0c94-4cc7-b7f0-c3d202c3aaeb\" /&gt;\n    &lt;ActionGroup Id=\"864672ba-0c94-4cc7-b7f0-c3d202c3aaeb\" ActionId=\"Group2\" After=\"DefaultActionGroup\" /&gt;\n  &lt;/ActionGroupSequence&gt;\n&lt;/RecoveryPlan&gt;</pre>\n&nbsp;\n<h3>장애 조치 </h3>\nAzure Site Recovery는 테스트, 계획 및 계획되지 않은 3가지 유형의 장애 조치(failover)를 지원합니다. 모든 장애 조치(failover) 작업은 개별 Virtual Machines 및 복구 계획 모두에서 지원됩니다. 이러한 기능은 이제 PowerShell cmdlet에서도 사용할 수 있습니다. ASR 장애 조치(failover)는 비동기 작업이므로 이러한 cmdlet을 실행하면 이에 대한 응답으로 Azure Site Recovery 작업이 반환됩니다. Get-AzureSiteRecoveryJob을 사용하여 작업 상태를 완료까지 추가로 추적할 수 있습니다.\n\n동일한 간단한 샘플 스크립트 코드 조각은 다음과 같습니다.\n<pre class=\"prettyprint\">param\n(    \n    [parameter(Mandatory=$FALSE, HelpMessage=\"Name of the RP\")]\n    [ValidateNotNullOrEmpty()]\n    [string] $RPName,\n\n    [parameter(Mandatory=$TRUE, HelpMessage=\"Failover Type\")]\n    [ValidateNotNullOrEmpty()]\n [ValidateSet('PLANNED','UNPLANNED', 'TEST')]\n [string] $FailoverType,\n\n    [parameter(Mandatory=$TRUE, HelpMessage=\"Failover direction\")]\n    [ValidateNotNullOrEmpty()]\n [ValidateSet('PrimaryToRecovery','RecoveryToPrimary')]\n    [string] $FailoverDirection,\n\n    [parameter(Mandatory=$TRUE, HelpMessage=\"Should do commit on the RP after failover\")]\n    [ValidateNotNullOrEmpty()]\n    [bool] $ShouldCommit,\n\n    [parameter(Mandatory=$TRUE, HelpMessage=\"Should do reverse replicate on the RP after commit\")]\n    [ValidateNotNullOrEmpty()]\n    [bool] $ShouldReverseReplicate\n)\n\n##\n## This routine checks for error in jobs.\n##\nfunction WaitForJobCompletionAndCheck-JobErrors([string] $JobId)\n{\n        $IsCompleted = $false\n\n        while(!$IsCompleted)\n        {\n\n         $Job = Get-AzureSiteRecoveryJob -Id $JobId\n\n         if($Job.State -eq \"Succeeded\")\n         {\n          $IsCompleted = $true\n                Write-Output \"Job with Id $JobId executed successfully.\"\n                return\n         }\n         if($Job.State -eq \"Failed\")\n         {\n          $IsCompleted = $true;\n                 Write-Output \"The Job Id $JobId has failed in execution\"\n         }\n\n         if($Job.State -eq \"Suspended\" )\n         {\n         Resume-AzureSiteRecoveryJob -Job $Job\n         }\n            else\n            {\n                Write-Output \"The job $JobID is in progress\"  \n          Start-Sleep -s 15\n            }\n        }\n\n  $hasFailed = $false\n\n  $JobDetails = Get-AzureSiteRecoveryJob -Id $JobId\n  if($JobDetails.Errors.Count -ne 0)\n  {\n   $hasFailed = $true\n   Write-Error \"JobID $JobId Failed\"\n   foreach($JobError in $JobDetails.Errors)\n   {\n    Write-Error $JobError.ServiceErrorDetails\n    Write-Error $JobError.ProviderErrorDetails\n   }\n  }\n\n}\n\n$RecoveryPlans =  Get-AzureSiteRecoveryRecoveryPlan | %{ $_.Name }\nif(!$RecoveryPlans.Contains($RPName))\n{ \n Write-Error \"RECOVERY PLAN $RPName NOT FOUND IN ASR\"\n return;\n}\n\n$RecoveryPlanObject = Get-AzureSiteRecoveryRecoveryPlan -Name $RPName\n\nWrite-Output \"RECOVERY PLAN DETAILS : \" \nWrite-Output $RecoveryPlanObject\n\nWrite-Output \"Starting RP $FailoverType Failover of $RPName :\";\n\nif($FailoverType.ToUpper() -eq \"PLANNED\")\n{\n $Job = Start-AzureSiteRecoveryPlannedFailoverJob -RecoveryPlan $RecoveryPlanObject -Direction $FailoverDirection \n}\nelseif($FailoverType.ToUpper() -eq \"UNPLANNED\")\n{\n $Job = Start-AzureSiteRecoveryUnplannedFailoverJob -RecoveryPlan $RecoveryPlanObject -Direction $FailoverDirection \n}\nelseif($FailoverType.ToUpper() -eq \"TEST\")\n{\n $Job = Start-AzureSiteRecoveryTestFailoverJob -RecoveryPlan $RecoveryPlanObject -Direction $FailoverDirection \n}\nelse\n{\n Write-Error \"Invalid RP Failover Type - $FailoverType\"\n} \nWaitForJobCompletionAndCheck-JobErrors $Job.ID\n\nif($ShouldCommit)\n{\n Write-Output \"Starting RP Commit Failover for $RPName\"; \n\n $RecoveryPlanObject = Get-AzureSiteRecoveryRecoveryPlan -Name $RPName\n Write-Output $RecoveryPlanObject\n\n $JobsList = Start-AzureSiteRecoveryCommitFailoverJob -RecoveryPlan $RecoveryPlanObject \n\n WaitForJobCompletionAndCheck-JobErrors $JobsList.ID\n}\n\nif($ShouldReverseReplicate)\n{\n Write-Output \"Starting RP Reverse Replication for $RPName\"; \n\n $RecoveryPlanObject = Get-AzureSiteRecoveryRecoveryPlan -Name $RPName\n Write-Output $RecoveryPlanObject\n\n $JobsList = Update-AzureSiteRecoveryProtectionDirection  -RecoveryPlan  $RecoveryPlanObject -Direction $FailoverDirection \n\n WaitForJobCompletionAndCheck-JobErrors $JobsList.ID\n}\n\n$RecoveryPlanObject = Get-AzureSiteRecoveryRecoveryPlan -Name $RPName\nWrite-Output $RecoveryPlanObject</pre>"
