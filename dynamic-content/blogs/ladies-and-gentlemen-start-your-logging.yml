### YamlMime:Yaml
ms.openlocfilehash: f1f7b31ec378f246a5f66419501b72e13744f01a
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/11/2022
ms.locfileid: "139899707"
Slug: ladies-and-gentlemen-start-your-logging
Title: 신사 숙녀 여러분, 로깅 시작
Summary: 'ELK에서 Azure Log Analytics로 마이그레이션하면 운영 비용을 90% 이상 절감할 수 있는 방법을 알아봅니다. '
Content: >-
  <p><em>이 게시물은 </em><a href="https://mvp.microsoft.com/en-us/PublicProfile/5001078?fullName=Mat%c3%adas%20%20Quaranta"><em>Matas&iacute; Quaranta</em></a><em>, Azure MVP, Autocosmos</em>에 의해 작성되었습니다.</p>


  <p>이 블로그 게시물에서 Im&rsquo;은 ELK에서 <a href="https://azure.microsoft.com/services/log-analytics/">Azure Log Analytics</a> 로 마이그레이션하고 <strong>운영 비용을 90% 이상 절감하고 유지 관리 시간을 줄이는</strong> 방법을 보여 줍니다.</p>


  <h3>배경</h3>


  <p>로깅의 필요성은 컴퓨터만큼 오래되었을 수 있으며 분산 아키텍처의 복잡성과 함께 로깅의 중요성이 커지고 있습니다.</p>


  <p>애플리케이션 및 플랫폼이 여러 서버, 서비스 인스턴스, 언어 및 심지어 기술에 걸쳐 있는 것이 일반적입니다. 모든 파트의 상태와 로그를 유지하는 것은 어려운 일입니다.</p>


  <p>Autocosmos에서 전체 아키텍처는 Azure App Services, Azure Redis Cache 및 Azure SQL Database Azure Search, Azure DocumentDB 및 Microsoft Cognitive Services와 같은 가장 일반적인 서비스부터 다양한 Azure 서비스에서 실행됩니다. Microsoft는 AzureS&rsquo; SaaS 및 PaaS 제품을 활용하여 라틴 아메리카의 자동차 및 자동차 애호가를 위한 최고의 제품과 플랫폼을 만들고 배포하는 데 중점을 둔 기술 팀입니다.</p>


  <p>몇 년 전 중앙 집중식 로깅 플랫폼을 구현하기로 결정했을 때 다양한 로그 출력 및 구조를 관리할 수 있는 많은 옵션이 없었기&rsquo; 때문에 결국 Azure Virtual Machines에서 실행되는 ELK(Elasticsearch-Logstash-Kibana) 스택을 구현했습니다. 나는 인정해야, 그것은 아주 잘 작동하고 우리는 Logstash를 통해 JSON 로그를 흡수하고 Kibana를 통해 시각화 할 수 있었다.</p>


  <h3>문제점</h3>


  <p>앞서 언급했듯이, 우리는 개발자와 엔지니어의 집중된 기술 팀이며 ELK Stack이 작동했음에도 불구하고 가상 Linux 환경을 유지 관리하고 Elasticsearch 클러스터 상태 및 개발자로서 실제로 신경 쓰지 않은 많은 작업을 감시해야 했습니다&rsquo;. 로깅 아키텍처를 유지하기 위한 시간 싱크가 되고 있다고 생각했으며 제품에 가치를 더하는 것은 아니었&rsquo;습니다.</p>


  <p>또한 Azure VM은 모든 종류의 크기 조정 및 네트워크 분산을 개발자에게 지루하고 복잡한 작업으로 만드는 IaaS 제품입니다. 그리고 이 모든 노력은 로깅 아키텍처에 불과합니다.<br>

  Who 비디오 게임이 우리의 문제에 대한 해결책의 문을 열 것이라고 생각했을까요?</p>


  <h3>예기치 않은 기회</h3>


  <p><a href="https://azure.microsoft.com/blog/how-halo-5-uses-log-analytics-oms-azure-for-operational-intelligence/">Halo 5가 로깅 파이프라인을 관리하는</a> 방법을 읽은 후 Azure Log Analytics 뒤에 있는 놀라운 팀과 연락을 취하여 현재 시나리오를 공유했습니다.</p>


  <p>Azure Log Analytics&rsquo;에 익숙하지 않은 사용자를 위해 Microsoft Operations Management Suite의 서비스 부분을 사용하지만 별도의 가격 책정(무료 계층 포함)을 가지며 Windows 및 Linux 환경 원본(온-프레미스 또는 클라우드)을 포함하는 여러 원본의 로그 데이터를 수집, 저장 및 분석할 수 있습니다.</p>


  <p>놀랍게도, 그들은 이미 HTTP API 및 JSON 개체를 통해 선언된 에이전트 또는 원본에서 독점적으로 제공되는 사용자 지정 로그 수집&rsquo;을 허용하는 구현을 작업하고 있었습니다.</p>


  <p>이것이 바로 우리가 필요로 하는 솔루션이었습니다! ELK Stack에 이미 JSON을 사용하고 있었기 때문에 로그 흐름을 <a href="https://azure.microsoft.com/documentation/articles/log-analytics-data-collector-api/">Azure Log Analytics HTTP 데이터 수집기 API</a>로 쉽게 리디렉션할 수 있었습니다. 전체 아키텍처는 HTTP 및 JSON의 자유와 Azure Log Analytics가 각 JSON 특성을 개별적으로 구문 분석하고 이해한다는 사실을 활용하여 로그를 전달하기 시작했습니다. 프런트 엔드 로그, DocumentDB 로그, Cognitive Services 로그만 보낼 수 있습니다. Azure Functions 내부에서 로그를 보낼 수도 있지만, 서로 다른 정보를 가진 다른 원본이었지만 방금 작동했습니다.</p>


  <p><img alt="Autocosmos Azure Architecture" border="0" height="610" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/723c26c9-4372-4c19-8748-ae8c66e037ff.png" style="border: 0px currentColor; border-image: none; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="Autocosmos Azure 아키텍처" width="574"></p>


  <p>그것은 우리의 모든 운영 통찰력의 중추가되었다.</p>


  <h3>HTTP로 JSON 로깅 구현</h3>


  <p>솔루션의 일부인 모든 서비스 및 애플리케이션이 ASP.NET Core 실행되므로 GitHub <a href="https://github.com/ealsur/HTTPDataCollectorAPI">공용 리포지토리</a>의 기여에 열려 있는 Nuget 패키지 형식으로 Azure Log Analytics HTTP 데이터 수집기 API에 대한 .Net 래퍼를 만들었습니다. 이 래퍼를 사용하면 아키텍처의 모든 부분에서 JSON 페이로드를 보낼 수 있으며 개체 직렬화를 지원할 수도 있습니다.</p>


  <p>API 또는 Webjob 함수에 대한 내부 호출이 실패할 때 예외를 직접 전송한 다음 Azure Log Analytics의 검색 환경을 사용하여 문제의 근본 원인을 찾는 방식으로 사후 분석용 로깅을 사용합니다.</p>


  <p><img alt="Sending Exceptions" border="0" height="272" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c210dcf6-0686-4d52-ba06-1fd12065694f.png" style="border: 0px currentColor; border-image: none; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="예외 보내기" width="610"></p>


  <p>로그를 사용하여 성능을 측정할 수도 있습니다. 각 호출에 사용되는 DocumentDB 요청 단위(노출된 헤더 사용)를 추적하여 시간당 할당량이 사용되는 방법을 측정하고 크기를 조정해야 하는 지점에 도달하면 경고합니다.</p>


  <p><img alt="Sending Data" border="0" height="229" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e6519d38-b72b-4724-93e6-f93b540390a4.png" style="border: 0px currentColor; border-image: none; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="데이터 보내기" width="610"></p>


  <h3>검색 환경</h3>


  <p>Azure Log Analytics는 로그 스토리지일 뿐만 아니라 잘 문서화된 쿼리 구문을 사용하여 로그 데이터를 심층 분석하고 필터링 가능한 각 JSON 특성을 보여 주는 강력한 검색 기능을 포함합니다.</p>


  <p><img alt="Perf" border="0" height="261" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/838f06da-4a3c-41f9-b980-a0cd21650480.png" style="border: 0px currentColor; border-image: none; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="Perf" width="610"></p>


  <p>&nbsp;</p>


  <p><img alt="Search" border="0" height="202" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/92bd17c0-c272-4a51-a32a-31be89b336bc.png" style="border: 0px currentColor; border-image: none; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="검색" width="610"></p>


  <p>원하는 위젯 및 타일을 사용하여 사용자 지정 대시보드를 만들고 시나리오에 가장 적합한 시각화를 빌드할 수도 있습니다.</p>


  <p><img alt="Visualization" border="0" height="370" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/cbbb20ee-9083-4e08-aa30-b20237ef7bd4.png" style="border: 0px currentColor; border-image: none; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="시각화" width="610"></p>


  <p>마지막으로 검색 및 시간 프레임에 따라 경고를 구성하고 웹후크, Azure Automation Runbook 또는 이메일 알림과 연결할 수 있습니다.</p>


  <p><img alt="Alerts" border="0" height="328" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/87fd3654-4a73-42ed-ad7e-7c153a0e77a5.png" style="border: 0px currentColor; border-image: none; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="경고" width="610"></p>


  <h3>결론</h3>


  <p>Azure Log Analytics를 구현한다는 것은 유지 관리 시간을 줄일 뿐만 아니라 운영 비용(더 이상 VM 없음!)을 90% 이상 낮췄다는 것을 의미합니다. 우리의 모든 시간은 이제 라틴 아메리카에서 자동차 애호가를위한 최고의 제품과 플랫폼을 만들고 구축, 우리의 사업에 가장 중요한 일에 전념.</p>
