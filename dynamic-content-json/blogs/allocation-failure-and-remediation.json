{
    "Slug": "allocation-failure-and-remediation",
    "Title": "할당 오류 및 수정",
    "Summary": "This post explains the causes of some of the common allocation failures and suggests possible remediation. The information may also be useful when you plan the deployment of your services.",
    "Content": "VM을 만들 때 중지(할당 취소)된 VM을 다시 시작하거나, VM 크기를 조정하거나, 새 웹 또는 작업자 역할 인스턴스를 추가할 때 Microsoft Azure 구독에 컴퓨팅 리소스를 할당합니다. 이러한 작업을 수행하면서 Azure 구독 제한에 도달하기 전에 오류를 수신하는 경우도 있습니다. 이 블로그 게시물에서는 몇 가지 일반적인 할당 오류의 원인을 설명하고 가능한 수정을 제안합니다. 서비스 배포를 계획하는 사용자에게 이 정보가 유용할 수 있습니다.\n\nAzure 데이터 센터의 서버는 클러스터로 분할되어 있습니다. 일반적으로 할당 요청은 여러 클러스터에서 시도되지만 할당 요청의 특정 제약 조건으로 인해 Azure 플랫폼이 하나의 클러스터에서만 요청을 시도하도록 할 수 있습니다. 이 블로그 게시물에서는 이를 \"클러스터에 고정\"이라고 합니다. 아래 다이어그램 1은 여러 클러스터에서 시도되는 일반 할당의 경우를 보여 줍니다. 다이어그램 2는 기존 클라우드 서비스 <em>CS_1</em> 호스트되는 위치이기 때문에 <em>클러스터 2</em>에 고정된 할당의 사례를 보여 줍니다.\n\n<img style=\"float: none; padding-top: 0px; padding-left: 0px; margin: 0px auto; padding-right: 0px; border: 0px;\" title=\"AllocationBlogPost1\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/AllocationBlogPost1.png\" alt=\"AllocationBlogPost1\" width=\"610\" height=\"296\" border=\"0\" />\n\n할당 요청이 클러스터에 고정되는 경우 리소스 풀이 더 작기 때문에 사용 가능한 리소스를 찾지 못할 가능성이 높습니다. 할당 요청이 클러스터에 고정되어 있지만 요청하는 리소스 유형이 이 클러스터에서 지원되지 않으면, 클러스터에 유휴 리소스가 있어도 사용자의 요청은 실패합니다. 아래 다이어그램 3은 유일한 후보 클러스터에 무료 리소스가 없기 때문에 고정된 할당이 실패하는 경우를 보여 줍니다. 다이어그램 4는 클러스터에 사용 가능한 리소스가 있더라도 유일한 후보 클러스터가 요청된 VM 크기를 지원하지 않으므로 고정된 할당이 실패하는 경우를 보여 줍니다.\n\n<img style=\"float: none; padding-top: 0px; padding-left: 0px; margin: 0px auto; padding-right: 0px; border: 0px;\" title=\"AllocationBlogPost2\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/AllocationBlogPost2.png\" alt=\"AllocationBlogPost2\" width=\"610\" height=\"345\" border=\"0\" />\n\n다음 섹션에서는 할당 요청이 고정되는 일반적인 사례를 나열합니다. 할당 오류가 발생하면 설명된 상황이 적용되는지 확인합니다. 요청이 고정된 경우 고정 제약 조건 중 일부를 제거하여 더 많은 클러스터에 대한 요청을 열어 할당 성공 가능성을 높입니다.\n\n일반적으로 오류가 \"요청된 VM 크기가 지원되지 않음\"을 나타내지 않는 한, 요청을 수용하기 위해 클러스터에서 충분한 리소스가 해제되었을 수 있으므로 나중에 언제든지 다시 시도할 수 있습니다. 요청된 VM 크기가 지원되지 않는 문제인 경우 다른 VM 크기를 시도합니다. 그렇지 않은 경우 유일한 옵션은 다음 섹션에서 제안된 대로 고정 제약 조건을 제거하는 것입니다.\n\n두 가지 일반적인 오류 시나리오는 선호도 그룹과 관련이 있습니다. 과거에 선호도 그룹은 VM/서비스 인스턴스에 근접성을 제공하는 데 사용되었거나 VNet(Virtual Network)을 만드는 데 사용되었습니다. 지역 Virtual Network 도입된 선호도 그룹은 더 이상 Virtual Network 만들 필요가 없습니다. Azure 인프라의 네트워크 대기 시간이 감소하면서 VM/서비스 근접성을 위해 선호도 그룹을 사용하는 것이 좋습니다. 선호도 그룹 권장 사항 항목에 대한 후속 설명서 업데이트가 있습니다.\n\n아래 다이어그램 5는 (고정된) 할당 시나리오의 분류법을 나타냅니다. 다음 섹션에서 각 시나리오를 살펴보겠습니다.\n\n<img style=\"float: none; padding-top: 0px; padding-left: 0px; margin: 0px auto; padding-right: 0px; border: 0px;\" title=\"AllocationBlogPost3\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/AllocationBlogPost3.png\" alt=\"AllocationBlogPost3\" width=\"610\" height=\"237\" border=\"0\" />\n<h1>할당 시나리오</h1>\n<blockquote>참고(*): Azure 플랫폼에서 반환된 할당 오류를 사용하여 해당 시나리오를 식별합니다. 각 시나리오 섹션에 나열된 오류는 짧은 형식입니다. 자세한 오류 문자열은 부록을 참조하세요.</blockquote>\n<h2>시나리오: VM 크기 조정 또는 기존 클라우드 서비스에 추가 VM 또는 역할 인스턴스 추가</h2>\n<strong>오류</strong>: Upgrade_VMSizeNotSupported* 또는 GeneralError*\n\n<strong>클러스터 고정의 원인</strong>: 기존 클라우드 서비스를 호스트하는 원래 클러스터에서 VM 크기 조정 또는 기존 클라우드 서비스에 VM 또는 역할 인스턴스 추가 요청을 시도해야 합니다. 새 클라우드 서비스를 만들면 Azure 플랫폼에서 무료 리소스가 있는 다른 클러스터 또는 요청한 VM 크기를 지원하는 클러스터를 찾을 수 있습니다.\n\n<strong>수정</strong>:\n\n오류가 Upgrade_VMSizeNotSupported*이면, 다른 VM 크기를 시도합니다. 다른 VM 크기를 사용하는 것은 옵션이 아니지만 다른 VIP를 사용할 수 있는 경우 새 클라우드 서비스를 만들어 새 VM을 호스트하고 기존 VM이 실행 중인 지역 Virtual Network 새 클라우드 서비스를 추가합니다. 기존 클라우드 서비스에서 지역 Virtual Network 사용하지 않는 경우 새 클라우드 서비스에 대한 새 Virtual Network 만들고 이 <a href=\"https://msdn.microsoft.com/en-us/library/azure/dn690122.aspx\">링크</a>의 지침에 따라 기존 VNet을 새 VNet에 연결할 수 있습니다. 지역 Virtual Network 대한 자세한 내용은 이 <a href=\"https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/\">블로그 게시물</a>에서 찾을 수 있습니다.\n\n오류가 GeneralError인 경우 *클러스터에서 리소스 유형(예: 특정 VM 크기)을 지원하지만 현재 클러스터에 무료 리소스가 없는 것 같습니다. 위와 마찬가지로 새 클라우드 서비스를 만들어 원하는 컴퓨팅 리소스를 추가하고(새 클라우드 서비스가 다른 VIP를 사용해야 합니다) 지역 Virtual Network 사용하여 Cloud Services 연결합니다. <h2> 시나리오: 중지됨(할당 해제) VM 다시 시작 - <span style=\"text-decoration: underline;\">부분</span> 할당</h2>\n 해제 <strong>Error</strong>: GeneralError*\n\n<strong>클러스터 고정의 원인</strong>: <span style=\"text-decoration: underline;\">부분</span> 할당 해제는 클라우드 서비스의 모든 VM이 <span style=\"text-decoration: underline;\">아닌</span> 하나 이상의 VM을 중지(할당 해제)했음을 의미합니다. VM을 중지(할당 해제)하면 연결된 리소스가 해제됩니다. 따라서 중지(할당 해제)된 VM을 다시 시작하는 것은 새 할당 요청입니다. 부분적으로 할당되지 않은 클라우드 서비스에서 VM을 다시 시작하는 것은 기존 클라우드 서비스에 VM을 추가하는 것과 동일하며 기존 클라우드 서비스를 호스트하는 원래 클러스터에서 할당 요청을 시도해야 합니다. 다른 클라우드 서비스를 만들면 Azure 플랫폼에서 무료 리소스가 있는 다른 클러스터 또는 요청한 VM 크기를 지원하는 클러스터를 찾을 수 있습니다.\n\n<strong>수정</strong>:\n\n다른 VIP를 사용할 수 있는 경우 중지된(할당 해제) VM을 삭제하고(연결된 디스크를 유지함) 다른 클라우드 서비스를 통해 VM을 다시 추가합니다. 지역 Virtual Network 사용하여 Cloud Services 연결합니다.\n<ol>\n <li>기존 클라우드 서비스에서 지역 Virtual Network 사용하는 경우 새 클라우드 서비스를 동일한 Virtual Network 추가하면 됩니다.</li>\n <li>기존 클라우드 서비스에서 지역 Virtual Network 사용하지 않는 경우 새 클라우드 서비스에 대한 새 Virtual Network 만듭니다. 이 <a href=\"https://msdn.microsoft.com/en-us/library/azure/dn690122.aspx\">링크</a> 의 지침에 따라 기존 VNet을 새 VNet에 연결합니다. 지역 Virtual Network 대한 자세한 내용은 이 <a href=\"https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/\">블로그 게시물</a>에서 찾을 수 있습니다.</li>\n</ol>\n<h2>시나리오: 중지됨(할당 해제) VM 다시 시작 - <span style=\"text-decoration: underline;\">전체</span> De-Allocation</h2>\n<strong>오류</strong>: GeneralError*\n\n<strong>클러스터 고정의 원인</strong>: <span style=\"text-decoration: underline;\">전체</span> 할당 해제는 클라우드 서비스에서 <span style=\"text-decoration: underline;\">모든</span> VM을 중지(할당 해제)했음을 의미합니다. 현재 이러한 VM을 다시 시작하기 위한 할당 요청은 클라우드 서비스를 호스트하는 원래 클러스터에서 시도해야 합니다. 새 클라우드 서비스를 만들면 Azure 플랫폼에서 무료 리소스가 있는 다른 클러스터 또는 요청한 VM 크기를 지원하는 클러스터를 찾을 수 있습니다.\n\n<strong>수정</strong>:\n\n다른 VIP를 사용할 수 있는 경우 원래 중지된(할당 해제된) VM을 삭제하고(연결된 디스크를 유지함) 해당 클라우드 서비스를 삭제합니다(VM을 중지(할당 해제)할 때 연결된 컴퓨팅 리소스가 이미 릴리스됨). 새 클라우드 서비스를 만들어 VM을 다시 추가합니다.\n<h2>시나리오: 스테이징/프로덕션 배포(Platform-as-A-Service에만 해당)</h2>\n<strong>오류</strong>: New_General* 또는 New_VMSizeNotSupported*\n\n<strong>클러스터 고정의 원인</strong>: 스테이징 배포 및 클라우드 서비스의 프로덕션 배포는 동일한 클러스터에서 호스트됩니다. 두 번째 배포를 추가하는 경우 할당 요청은 첫 번째 배포를 호스팅하는 동일한 클러스터에서 시도됩니다.\n\n<strong>수정</strong>:\n\n허용되는 경우 첫 번째 배포 및 원래 클라우드 서비스를 삭제하고 클라우드 서비스를 다시 배포합니다. 이 작업은 두 배포 모두에 맞게 충분한 사용 가능한 리소스가 있는 클러스터 또는 요청한 VM 크기를 지원하는 클러스터에서 첫 번째 배포를 수행할 수 있습니다.\n<h2>시나리오: 선호도 그룹 - VM/서비스 근접</h2>\n<strong>오류</strong>: New_General* 또는 New_VMSizeNotSupported*\n\n<strong>클러스터 고정의 원인</strong>: 선호도 그룹에 할당된 모든 컴퓨팅 리소스는 하나의 클러스터에 연결됩니다. 해당 선호도 그룹의 새 컴퓨팅 리소스 요청은 기존 리소스가 호스트되는 동일한 클러스터에서 시도됩니다. 새 리소스가 새 클라우드 서비스 또는 기존 클라우드 서비스를 통해 만들어지는 경우와 관계없이 마찬가지입니다.\n\n<strong>수정</strong>:\n\n필요하지 않은 경우 선호도 그룹을 사용하지 않거나 여러 선호도 그룹에서 컴퓨팅 리소스를 그룹화해 보세요.\n<h2>시나리오: 선호도 그룹 기반 Virtual Network</h2>\n<strong>오류</strong>: New_General* 또는 New_VMSizeNotSupported*\n\n<strong>클러스터 고정의 원인</strong>: 지역 Virtual Network 발표되기 전에 Virtual Network 선호도 그룹에 연결해야 했습니다. 결과적으로 선호도 그룹에 배치된 컴퓨팅 리소스는 위의 \"선호도 그룹 - VM/서비스 근접\" 시나리오에 설명된 것과 동일한 제약 조건에 바인딩됩니다. 컴퓨팅 리소스는 하나의 클러스터에 연결됩니다.\n\n<strong>수정</strong>:\n\n선호도 그룹이 필요하지 않은 경우 추가하려는 새 리소스에 대한 새 지역 Virtual Network 만듭니다. 이 <a href=\"https://msdn.microsoft.com/en-us/library/azure/dn690122.aspx\">링크</a> 의 지침에 따라 기존 VNet을 새 VNet에 연결합니다. 지역 Virtual Network 대한 자세한 내용은 이 <a href=\"https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/\">블로그 게시물</a>에서 찾을 수 있습니다.\n\n또는 이 <a href=\"https://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/\">링크</a>의 지침에 따라 선호도 그룹 기반 Virtual Network 지역 Virtual Network 마이그레이션한 다음 원하는 리소스를 다시 추가해 보세요.\n<h1>부록</h1>\n<h2>오류 문자열 조회</h2>\n<strong>New_VMSizeNotSupported</strong>: \"배포 요청 제약 조건으로 인해 이 배포에 필요한 VM 크기(또는 VM 크기의 조합)를 프로비전할 수 없습니다. 가능한 경우, 가상 네트워크 바인딩 같은 제약 조건을 해제하고 다른 배포를 포함하지 않는 호스티드 서비스에 배포를 시도하거나 다른 선호도 그룹 또는 선호도 그룹 없이 배포를 시도하거나 다른 지역으로 배포를 시도합니다.”\n\n<strong>New_General</strong>: \"할당 실패; 요청의 제약 조건을 충족할 수 없습니다. 요청된 새로운 서비스 배포가 선호도 그룹에 바인딩되어 있거나 가상 네트워크를 대상으로 하거나 호스티드 서비스에 기존 배포가 있습니다. 이러한 조건이 특정 Azure 리소스에 대한 새로운 배포를 제한합니다. 나중에 다시 시도하거나, VM 크기를 줄이거나 역할 인스턴스의 수를 줄입니다. 가능하다면 앞서 말한 제약 조건을 제거하거나 다른 지역에 배포를 시도합니다.”\n\n<strong>Upgrade_VMSizeNotSupported</strong>: \"배포를 업그레이드할 수 없습니다. 요청된 VM 크기 XXX는 기존 배포를 지원하는 리소스에서 사용할 수 없습니다. 나중에 다시 시도하거나, 다른 VM 크기 또는 적은 수의 역할 인스턴스로 시도하거나 새 선호도 그룹 또는 선호도 그룹 바인딩 없이 빈 호스티드 서비스에 배포를 만듭니다.”\n\n<strong>GeneralError</strong>: \"서버에서 내부 오류가 발생했습니다. 요청을 다시 시도하세요.” 또는 \"서비스에 대한 할당을 생성하지 못했습니다.\""
}