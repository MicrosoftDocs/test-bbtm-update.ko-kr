{
    "Slug": "analysis-of-network-connection-data-with-azure-monitor-for-virtual-machines",
    "Title": "가상 머신용 Azure Monitor를 사용하여 네트워크 연결 데이터 분석",
    "Summary": "Azure Monitor for virtual machines (VMs) collects network connection data that you can use to analyze the dependencies and network traffic of your VMs.",
    "Content": "<p>VM(가상 머신)용 Azure Monitor는 VM의 종속성 및 네트워크 트래픽을 분석하는 데 사용할 수 있는 네트워크 연결 데이터를 수집합니다. 라이브 및 실패한 연결 수, 전송 및 수신된 바이트, 프로세스 수준까지 VM의 연결 종속성을 분석할 수 있습니다. 악의적인 연결이 검색되면 해당 IP 주소 및 위협 수준에 대한 정보가 포함됩니다. 새로 릴리스된 <strong>VMBoundPort</strong> 데이터 집합을 사용하면 보안 분석을 위해 열린 포트 및 해당 연결을 분석할 수 있습니다.</p>\n\n<p>이 데이터 분석을 시작하려면 <a href=\"https://docs.microsoft.com/en-us/azure/azure-monitor/insights/vminsights-onboard\" target=\"_blank\">VM용 Azure Monitor 위해 온보딩</a>해야 합니다.</p>\n\n<h2>통합 문서</h2>\n\n<p>미리 빌드된 편집 가능한 보고서로 분석을 시작하려면 VM용 Azure Monitor 함께 제공되는 통합 문서 중 일부를 사용해 볼 수 있습니다. 등록되면 Azure Monitor로 이동하여 인사이트 메뉴 섹션에서 <strong>Virtual Machines(미리 보기)</strong>를 선택합니다. 여기에서 <strong>성능 또는 맵 탭</strong> 으로 이동하여 네트워크 데이터를 분석하는 다음 <strong>통합 문서가</strong> 포함된 통합 문서 갤러리를 여는 통합 문서 보기 링크를 볼 수 있습니다.</p>\n\n<ul>\n <li>연결 개요</li>\n <li>실패한 연결</li>\n <li>TCP 트래픽</li>\n <li>트래픽 비교</li>\n <li>활성 포트</li>\n <li>포트 열기</li>\n</ul>\n\n<p>이러한 편집 가능한 보고서를 사용하면 단일 VM, VM 그룹 및 가상 머신 확장 집합에 대한 연결 데이터를 분석할 수 있습니다.</p>\n\n<h2>Log Analytics</h2>\n\n<p>Log Analytics를 사용하여 데이터를 분석하려면 Azure Monitor로 이동하여 <strong>로그를</strong> 선택하여 데이터 쿼리를 시작할 수 있습니다. 로그 보기에는 선택한 작업 영역의 이름과 해당 작업 영역 내의 스키마가 표시됩니다. <strong> ServiceMap </strong>데이터 형식 아래에는 다음 두 개의 테이블이 있습니다.</p>\n\n<ul>\n <li>VMBoundPort</li>\n <li>VMConnection</li>\n</ul>\n\n<p>아래 쿼리를 복사하여 Log Analytics 쿼리 상자에 붙여넣어 실행할 수 있습니다. 쿼리할 컴퓨터의 이름을 제공하려면 아래 예제 중 일부를 편집해야 합니다.</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f4803989-7e95-431a-8ec0-7487f2499176.png\"><img alt=\"Screenshot of copying and pasting queries into the Log Analytics query box\" border=\"0\" height=\"859\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3bba4bf7-c087-4d77-84b1-547fcc9174ba.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"Log Analytics 쿼리 상자에 쿼리 복사 및 붙여넣기 스크린샷\" width=\"1583\"></a></p>\n\n<h2>일반 쿼리</h2>\n\n<p>VM에서 열린 포트 수를 검토합니다. 이는 VM 구성 및 보안 취약성을 평가할 때 유용합니다.</p>\n\n<pre>\nVMBoundPort\n| where Ip != &quot;127.0.0.1&quot;\n| summarize by Computer, Machine, Port, Protocol\n| summarize OpenPorts=count() by Computer, Machine\n| order by OpenPorts desc</pre>\n\n<p>VM의 바인딩된 포트를 나열합니다. 이 포트는 VM 구성 및 보안 취약성을 평가할 때 유용합니다.</p>\n\n<pre>\nVMBoundPort\n| distinct Computer, Port, ProcessName</pre>\n\n<p>포트별 네트워크 작업을 분석하여 애플리케이션 또는 서비스를 구성하는 방법을 결정합니다.</p>\n\n<pre>\nVMBoundPort\n| where Ip != &quot;127.0.0.1&quot;\n| summarize BytesSent=sum(BytesSent), BytesReceived=sum(BytesReceived), LinksEstablished=sum(LinksEstablished), LinksTerminated=sum(LinksTerminated), arg_max(TimeGenerated, LinksLive) by Machine, Computer, ProcessName, Ip, Port, IsWildcardBind\n| project-away TimeGenerated\n| order by Machine, Computer, Port, Ip, ProcessName</pre>\n\n<p>VM에 대한 바이트 전송 및 수신 추세입니다.</p>\n\n<pre>\nVMConnection\n| summarize sum(BytesSent), sum(BytesReceived) by bin(TimeGenerated,1hr), Computer\n| order by Computer desc\n//| limit 5000\n| render timechart</pre>\n\n<p>작업 영역에 컴퓨터가 많은 경우 위의 예제에서 제한 문의 주석 처리를 해제할 수 있습니다. 차트 도구를 사용하여 보내거나 받은 바이트를 보고 특정 컴퓨터로 필터링할 수 있습니다.</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f88791f3-002a-464a-8fdb-74a468153a2e.png\"><img alt=\"Screenshot of chart tools being used to view Bytes sent or received\" border=\"0\" height=\"575\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/59117028-f2a7-4e56-8dde-082fea7321bc.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"보내거나 받은 바이트를 보는 데 사용되는 차트 도구의 스크린샷\" width=\"1046\"></a></p>\n\n<p>시간이 지남에 따라 연결 오류가 발생하여 실패율이 안정적인지 또는 변경 중인지 확인합니다.</p>\n\n<pre>\nVMConnection\n| where Computer == &lt;replace this with a computer name, e.g. &lsquo;acme-demo&rsquo;&gt;\n| extend bythehour = datetime_part(&quot;hour&quot;, TimeGenerated)\n| project bythehour, LinksFailed\n| summarize failCount = count() by bythehour\n| sort by bythehour asc\n| render timechart</pre>\n\n<p>상태 추세를 연결하여 컴퓨터의 동작 및 연결 상태를 분석합니다.</p>\n\n<pre>\nVMConnection\n| where Computer == &lt;replace this with a computer name, e.g. &lsquo;acme-demo&rsquo;&gt;\n| summarize  dcount(LinksEstablished), dcount(LinksLive), dcount(LinksFailed), dcount(LinksTerminated) by bin(TimeGenerated, 1h)\n| render timechart</pre>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e3ff4bd7-e708-426d-a35f-b8622593c2f8.png\"><img alt=\"Screenshot of line chart showing query results from the last 24 hours\" border=\"0\" height=\"570\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b308be9d-4320-43ec-b2cf-e153ebf2db98.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"지난 24시간 동안의 쿼리 결과를 보여 주는 꺾은선형 차트의 스크린샷\" width=\"1047\"></a></p>\n\n<h2>VM용 Azure Monitor 로그 쿼리 시작</h2>\n\n<p>VM용 Azure Monitor 대한 자세한 내용은 개요인 &ldquo;<a href=\"https://docs.microsoft.com/en-us/azure/azure-monitor/insights/vminsights-overview\" target=\"_blank\">VM용 Azure Monitor(미리 보기)</a>를 참조하세요.&rdquo; 이미 VM용 Azure Monitor 사용하고 있는 경우 <a href=\"https://docs.microsoft.com/en-us/azure/azure-monitor/insights/vminsights-log-search\" target=\"_blank\">Log Analytics를 사용하여 데이터를 쿼리하기</a> 위한 추가 예제 쿼리를 설명서에서 찾을 수 있습니다.</p>\n"
}